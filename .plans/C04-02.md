# C04-02 â€” Add server-side tool argument validation

Implement server-side validation for tool-call arguments against each tool's JSON schema (reuse `rest_validate_value_from_schema()` or equivalent). Define a consistent error result shape for invalid args. Acceptance: invalid tool args never reach domain services and tests cover validation failures.

## Implementation

### New Files

1. **`src/Validation/ToolArgumentValidator.php`**
   - Validates tool arguments against FunctionSchema's JSON schema
   - Uses WordPress `rest_validate_value_from_schema()` for validation
   - Returns `ToolArgumentValidationResult` value object

2. **`src/Validation/ToolArgumentValidationResult.php`**
   - Value object encapsulating validation results
   - Provides `isValid` boolean and `errors` array
   - `toErrorArray()` returns consistent error shape for AI consumption

3. **`tests/Unit/Validation/ToolArgumentValidatorTest.php`**
   - Unit tests for validator covering type errors, required fields, enums, min/max values

4. **`tests/Unit/Validation/ToolArgumentValidationIntegrationTest.php`**
   - Integration tests proving invalid args never reach domain services
   - Tests valid args pass through to services
   - Tests unknown tools bypass validation

5. **`tests/Support/rest-validation-functions.php`**
   - Test stub for `rest_validate_value_from_schema()` and related functions

### Modified Files

1. **`src/Intent/Handlers/AbstractAgenticHandler.php`**
   - Added `ToolArgumentValidator` dependency (optional, defaults to new instance)
   - Modified `executeToolCalls()` to validate before execution
   - Added `validateToolArguments()` helper method
   - Invalid args return error to AI, valid args proceed to `execute_tool()`

2. **`tests/bootstrap.php`**
   - Enhanced `WP_Error` stub with all required methods
   - Added include for rest-validation-functions.php

### Error Result Shape

Invalid tool arguments return this consistent structure:
```php
[
    'success' => false,
    'error' => 'Invalid arguments for tool "tool_name": field_name: error message',
    'code' => 'invalid_tool_arguments',
    'validation_errors' => [
        ['field' => 'field_name', 'message' => 'error message', 'code' => 'error_code']
    ]
]
```

### Key Design Decisions

- Validation happens in `executeToolCalls()` after JSON decode but before `execute_tool()`
- Unknown tools (not in registry) skip validation - handler returns "unknown tool" error
- `ToolArgumentValidator` is an optional constructor parameter for testability
- Uses WordPress REST API schema validation for consistency with other validations
