# Handoff: C06-06

Created: 2026-01-17T20:07:52.184271Z

Spec: .plans/C06-06.md


## 2026-01-17T20:12:39.798293Z — claude — impl

Command:
```
claude -p --output-format json --model opus --permission-mode acceptEdits --dangerously-skip-permissions You are implementing task C06-06 in this git repository.

1) Read the spec: .plans/C06-06.md
2) Read handoff/context: .t2/handoff/C06-06.md

Implement the spec fully.

Verification commands (run if non-empty):
- format: 
- lint: 
- test: 

In your final response, include:
- Status: DONE or NEEDS-REVIEW
- Summary of changes
- How to verify (exact commands)
- Risks / follow-ups

```

Return code: 0

Session: 1a0c1c9f-fab7-4968-8929-95d6d3fc24bc

Agent final message (file: C06-06.claude.impl.last.md):

---

**Status: DONE**

## Summary of changes

### `docs/API.md`
- Added link to OpenAPI specification at top
- Added comprehensive **Error codes** section with three categories:
  - Authentication/Authorization errors
  - Validation errors
  - API/Network errors
- Updated **POST /intent** with:
  - Request body schema table showing maxLength: 10000 constraints
  - Error codes listing
  - Success response example
- Updated **GET /health** with success response example
- Updated **GET /search** with query parameters table and success response example
- Updated **GET /settings** with full success response including demo_mode
- Updated **POST /settings** with:
  - Complete request body schema table with constraints (enums, min/max values)
  - Added demo_mode field documentation
  - Error codes listing
- Updated **POST /settings/api-key** with:
  - Request body schema showing minLength: 20, maxLength: 256, prefix: sk-
  - Validation notes explaining format requirements
  - Error codes listing
  - Success response examples for both store and delete operations
- Updated **GET /usage** with:
  - Query parameters table with default value
  - Error codes listing
  - Full success response example

### `docs/openapi.json`
- Added `maxLength: 10000` to IntentRequest prompt/input fields
- Added constraints to Settings schema: budget_limit min/max, draft_ttl_minutes min/max, hotkey maxLength
- Added `demo_mode` field to Settings schema
- Added `additionalProperties: false` to SettingsUpdateRequest
- Added full constraints to SettingsUpdateRequest matching DTO
- Added `demo_mode` field to SettingsUpdateRequest
- Added `additionalProperties: false` to ApiKeyRequest
- Added minLength: 20, maxLength: 256, pattern: ^sk- to ApiKeyRequest

## How to verify
```bash
# Validate OpenAPI spec structure and sync with controllers
php scripts/openapi-validate.php

# Verify JSON is valid
php -r "json_decode(file_get_contents('docs/openapi.json'), true); echo json_last_error() === JSON_ERROR_NONE ? 'Valid' : 'Invalid';"
```

## Risks / follow-ups
- **Low risk**: Documentation changes only; no runtime behavior affected
- **Follow-up consideration**: The ApiKeyRequest schema in openapi.json uses `pattern: "^sk-"` but the runtime validation in `ApiKeyRequestDTO::hasValidFormat()` also allows empty strings for deletion. The OpenAPI spec reflects the "store key" case which is the primary use case; the delete behavior is documented in the markdown.


Repo snapshot:
```
branch: main

status:
M .t2/state.json
 M docs/API.md
 M docs/openapi.json
?? .logs/C06-05.gitcommit.txt
?? .logs/C06-06.claude.impl.last.md
?? .logs/C06-06.claude.impl.raw.txt
?? .plans/C06-06.md
?? .t2/handoff/C06-06.md

diff --stat:
.t2/state.json    |   5 +-
 docs/API.md       | 208 +++++++++++++++++++++++++++++++++++++++++++++++++++---
 docs/openapi.json |  39 +++++++---
 3 files changed, 233 insertions(+), 19 deletions(-)

```
