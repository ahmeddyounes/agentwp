# Handoff: C01-02

Created: 2026-01-17T16:00:19.343592Z

Spec: .plans/C01-02.md


## 2026-01-17T16:03:15.737217Z — claude — impl

Command:
```
claude -p --output-format json --model opus --permission-mode acceptEdits --dangerously-skip-permissions You are implementing task C01-02 in this git repository.

1) Read the spec: .plans/C01-02.md
2) Read handoff/context: .t2/handoff/C01-02.md

Implement the spec fully.

Verification commands (run if non-empty):
- format: 
- lint: 
- test: 

In your final response, include:
- Status: DONE or NEEDS-REVIEW
- Summary of changes
- How to verify (exact commands)
- Risks / follow-ups

```

Return code: 0

Session: 7b4c2ef7-06bf-47ae-ab88-799af872c0f8

Agent final message (file: C01-02.claude.impl.last.md):

The ADR has been created successfully. Let me verify the acceptance criteria from the spec:

**Spec Requirements:**
> "ADR names the primary classifier implementation and extension hook contract"

**Verification:**
1. **Primary classifier implementation named:** Yes - `ScorerRegistry` is explicitly designated as "the canonical intent classification mechanism" in the Decision section
2. **Extension hook contract defined:** Yes - Two extension points are documented:
   - `agentwp_intent_scorers` filter with full contract (input, output, timing)
   - `agentwp_intent_classified` action with parameters

3. **Weights/thresholds from AgentWPConfig:** Yes - Section "Weights and Thresholds from AgentWPConfig" explains how they should apply (WeightedScorerDecorator pattern for weights, confidence calculation for thresholds)

4. **Testing strategy:** Yes - Comprehensive section covering unit tests, integration tests, extension point tests, and property-based testing

---

**Status: DONE**

**Summary of changes:**
- Created `docs/adr/0003-intent-classification-strategy.md` - An Architecture Decision Record that:
  - Designates `Intent\Classifier\ScorerRegistry` as the primary (canonical) intent classification implementation
  - Deprecates `IntentClassifier` with a clear timeline (supported through v2.x, deprecated in v2.0, removed in v3.0)
  - Defines `agentwp_intent_scorers` filter for registering custom scorers with full contract specification
  - Defines `agentwp_intent_classified` action for post-classification hooks
  - Explains how `AgentWPConfig` weights should apply via `WeightedScorerDecorator` pattern
  - Explains how confidence thresholds should be used for UI/UX decisions (with note that implementation is deferred)
  - Provides comprehensive testing strategy (unit tests per scorer, integration tests, extension tests, property-based tests)
  - Includes migration checklists for both core and third-party developers

**How to verify:**
```bash
# Check file exists and is readable
cat docs/adr/0003-intent-classification-strategy.md

# Verify key sections are present
grep -E "^## (Context|Decision|Consequences|Testing Strategy)" docs/adr/0003-intent-classification-strategy.md

# Verify primary implementation is named
grep -i "ScorerRegistry.*canonical" docs/adr/0003-intent-classification-strategy.md

# Verify extension hooks are documented
grep -E "agentwp_intent_(scorers|classified)" docs/adr/0003-intent-classification-strategy.md
```

**Risks / follow-ups:**
1. **Implementation work pending:** The ADR documents the decision but the actual code changes (updating `IntentServiceProvider`, adding deprecation notices, implementing `WeightedScorerDecorator`) are tracked in the Migration Checklist and should be separate tasks
2. **Confidence interface extension:** The ADR notes that exposing classification confidence requires extending `IntentClassifierInterface` - this is a potential breaking change for v2.0
3. **Third-party impact:** Plugins directly instantiating `IntentClassifier` will need migration guidance when deprecation notices are added


Repo snapshot:
```
branch: main

status:
A  .logs/C01-01.claude.after1.last.md
A  .logs/C01-01.claude.after1.raw.txt
A  .logs/C01-01.claude.impl.last.md
A  .logs/C01-01.claude.impl.raw.txt
A  .plans/C01-01.md
A  .plans/C01-02.md
AM .t2/after_prompts/01.md
 M .t2/config.json
A  .t2/handoff/C01-01.md
A  .t2/handoff/C01-02.md
 M .t2/state.json
A  docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
A  docs/adr/0002-intent-handler-registration.md
A  plan_tasks.csv
?? .logs/C01-02.claude.impl.last.md
?? .logs/C01-02.claude.impl.raw.txt
?? docs/adr/0003-intent-classification-strategy.md

diff --stat:
.t2/after_prompts/01.md |  1 +
 .t2/config.json         |  3 ++-
 .t2/state.json          | 45 +++++----------------------------------------
 3 files changed, 8 insertions(+), 41 deletions(-)

```


## 2026-01-17T16:04:12.244066Z — claude — after1

Command:
```
claude -p --output-format json --model opus --permission-mode acceptEdits --dangerously-skip-permissions --resume 7b4c2ef7-06bf-47ae-ab88-799af872c0f8 We just completed/updated task C01-02.

Spec: .plans/C01-02.md
Handoff/context: .t2/handoff/C01-02.md

Run this follow-up instruction:
Self review all your uncommited changes

If you modify code, keep changes minimal and consistent with the task.
Summarize what you did.

```

Return code: 0

Session: 7b4c2ef7-06bf-47ae-ab88-799af872c0f8

Agent final message (file: C01-02.claude.after1.last.md):

## Self-Review Summary

**Reviewed File:** `docs/adr/0003-intent-classification-strategy.md` (new, untracked)

**Checklist against spec requirements:**

| Requirement | Status | Notes |
|-------------|--------|-------|
| Names primary classifier implementation | ✅ | `ScorerRegistry` designated as "canonical" |
| Extension hook contract defined | ✅ | `agentwp_intent_scorers` filter with full contract |
| Decides `IntentClassifier` vs `ScorerRegistry` | ✅ | ScorerRegistry wins; IntentClassifier deprecated |
| Weights/thresholds from `AgentWPConfig` explained | ✅ | WeightedScorerDecorator pattern + confidence thresholds |
| Testing strategy | ✅ | Unit, integration, extension point, and property-based tests |

**Quality Review:**

- **Structure:** Follows ADR template from 0001 (Context → Decision → Consequences)
- **Completeness:** Includes comparison table, code examples, migration checklist
- **Accuracy:** References actual file paths and classes in codebase
- **Actionable:** Clear migration checklists for core and third-party developers

**No changes needed.** The ADR is complete and addresses all acceptance criteria.


Repo snapshot:
```
branch: main

status:
A  .logs/C01-01.claude.after1.last.md
A  .logs/C01-01.claude.after1.raw.txt
A  .logs/C01-01.claude.impl.last.md
A  .logs/C01-01.claude.impl.raw.txt
A  .plans/C01-01.md
A  .plans/C01-02.md
AM .t2/after_prompts/01.md
 M .t2/config.json
A  .t2/handoff/C01-01.md
AM .t2/handoff/C01-02.md
 M .t2/state.json
A  docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
A  docs/adr/0002-intent-handler-registration.md
A  plan_tasks.csv
?? .logs/C01-02.claude.after1.last.md
?? .logs/C01-02.claude.after1.raw.txt
?? .logs/C01-02.claude.impl.last.md
?? .logs/C01-02.claude.impl.raw.txt
?? docs/adr/0003-intent-classification-strategy.md

diff --stat:
.t2/after_prompts/01.md |   1 +
 .t2/config.json         |   3 +-
 .t2/handoff/C01-02.md   | 113 ++++++++++++++++++++++++++++++++++++++++++++++++
 .t2/state.json          |  44 +++----------------
 4 files changed, 122 insertions(+), 39 deletions(-)

```


## 2026-01-18T11:57:06.411375Z — claude — impl

Command:
```
claude -p --output-format json --model opus --permission-mode acceptEdits --dangerously-skip-permissions You are implementing task C01-02 in this git repository.

1) Read the spec: .plans/C01-02.md
2) Read handoff/context: .t2/handoff/C01-02.md

Implement the spec fully.

Verification commands (run if non-empty):
- format: 
- lint: 
- test: 

In your final response, include:
- Status: DONE or NEEDS-REVIEW
- Summary of changes
- How to verify (exact commands)
- Risks / follow-ups

```

Return code: 0

Session: cbee6d61-b23a-4033-9706-843931b3d348

Agent final message (file: C01-02.claude.impl.last.md):

All files are correctly importing `AgentWP\Rest\RestController`. The implementation is complete.

---

**Status: DONE**

**Summary of changes:**

1. **Created** `src/Rest/RestController.php` - Moved the base REST controller from `src/API/RestController.php` to the canonical location with updated namespace `AgentWP\Rest`

2. **Deleted** `src/API/RestController.php` - Removed the original file

3. **Updated imports in `src/Rest/` controllers:**
   - `HealthController.php`
   - `IntentController.php`
   - `SearchController.php`
   - `AnalyticsController.php`
   - `SettingsController.php`

4. **Updated imports in `src/API/` legacy controllers:**
   - `HistoryController.php`
   - `ThemeController.php`

5. **Updated `src/Providers/RestServiceProvider.php`** - Changed import to use new namespace

6. **Updated documentation:**
   - `docs/DEVELOPER.md` - Updated canonical location reference and code examples
   - `docs/EXTENSIONS.md` - Updated extension example code

**How to verify:**

```bash
# Run PHP syntax check on modified files
php -l src/Rest/RestController.php

# Run PHPStan (only pre-existing unrelated error remains)
composer run phpstan

# Run controller tests (all pass)
composer run phpunit -- --filter="Controller"

# Run full PHPUnit suite (pre-existing Search/Index errors unrelated to this change)
composer run phpunit
```

**Risks / follow-ups:**

1. **Pre-existing test failures:** 8 test errors exist in `Search/BackfillTest` and `Search/IndexTest` related to undefined constants (`BACKFILL_LIMIT`, `BACKFILL_WINDOW`, `DEFAULT_LIMIT`). These are unrelated to this change.

2. **Pre-existing PHPStan error:** 1 error in `src/API/RateLimiter.php` ("If condition is always true") is unrelated to this change.

3. **Legacy controllers remain in `src/API/`:** `HistoryController.php` and `ThemeController.php` still exist in `src/API/` but now correctly import `AgentWP\Rest\RestController`. A future task could migrate these to `src/Rest/` for consistency.


Repo snapshot:
```
branch: main

status:
M .logs/C01-02.claude.impl.last.md
 M .logs/C01-02.claude.impl.raw.txt
 M .plans/C01-02.md
 M .t2/state.json
 M docs/DEVELOPER.md
 M docs/EXTENSIONS.md
 M src/API/HistoryController.php
 D src/API/RestController.php
 M src/API/ThemeController.php
 M src/Providers/RestServiceProvider.php
 M src/Rest/AnalyticsController.php
 M src/Rest/HealthController.php
 M src/Rest/IntentController.php
 M src/Rest/SearchController.php
 M src/Rest/SettingsController.php
?? .logs/C01-01.gitcommit.txt
?? src/Rest/RestController.php

diff --stat:
.logs/C01-02.claude.impl.last.md      |  69 +++----
 .logs/C01-02.claude.impl.raw.txt      |   2 +-
 .plans/C01-02.md                      |   4 +-
 .t2/state.json                        |   5 +-
 docs/DEVELOPER.md                     |   8 +-
 docs/EXTENSIONS.md                    |   2 +-
 src/API/HistoryController.php         |   1 +
 src/API/RestController.php            | 339 ----------------------------------
 src/API/ThemeController.php           |   1 +
 src/Providers/RestServiceProvider.php |   2 +-
 src/Rest/AnalyticsController.php      |   2 +-
 src/Rest/HealthController.php         |   2 +-
 src/Rest/IntentController.php         |   2 +-
 src/Rest/SearchController.php         |   2 +-
 src/Rest/SettingsController.php       |   2 +-
 15 files changed, 54 insertions(+), 389 deletions(-)

```
