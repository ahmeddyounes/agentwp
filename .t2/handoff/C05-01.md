# Handoff: C05-01

Created: 2026-01-17T18:37:47.284605Z

Spec: .plans/C05-01.md


## 2026-01-17T18:40:23.570860Z — claude — impl

Command:
```
claude -p --output-format json --model opus --permission-mode acceptEdits --dangerously-skip-permissions You are implementing task C05-01 in this git repository.

1) Read the spec: .plans/C05-01.md
2) Read handoff/context: .t2/handoff/C05-01.md

Implement the spec fully.

Verification commands (run if non-empty):
- format: 
- lint: 
- test: 

In your final response, include:
- Status: DONE or NEEDS-REVIEW
- Summary of changes
- How to verify (exact commands)
- Risks / follow-ups

```

Return code: 0

Session: b21359df-f0fe-4f9e-a7fe-d11f019dd7ff

Agent final message (file: C05-01.claude.impl.last.md):

---

## Status: DONE

### Summary of Changes

Deleted the unused `src/AI/Client/*` directory containing 6 files:
- `ParsedResponse.php` - DTO for parsed responses
- `RequestBuilder.php` - Request payload builder
- `ResponseParser.php` - Non-streaming response parser
- `StreamParser.php` - SSE streaming response parser
- `ToolNormalizer.php` - Function/tool definition normalizer
- `UsageEstimator.php` - Token usage estimator

**Rationale:** Per ADR 0004, these classes duplicated logic already present in `src/AI/OpenAIClient.php`. They were completely unused—no imports existed anywhere in the codebase, and `OpenAIClient.php` contains its own inline implementations of the same functionality. Deleting them ensures there is now only one implementation for:
- Request building (`chat()` method, lines 82-175)
- Tool normalization (`normalize_tools()` method, lines 364-402)
- Response parsing (`parse_response_body()`, lines 515-557)
- Stream parsing (`parse_stream_response()`, lines 563-672)
- Usage estimation (`estimate_usage()`, lines 730-748)

### How to Verify

```bash
# Verify Client directory is gone
ls src/AI/Client 2>&1  # Should show "No such file or directory"

# Run the OpenAIClient tests
./vendor/bin/phpunit tests/Unit/AI/OpenAIClientTest.php

# Regenerate autoload to confirm no broken references
composer dump-autoload
```

### Risks / Follow-ups

- **Low risk:** The deleted classes had zero usage across the codebase
- **No follow-ups needed:** The acceptance criteria is met—no duplicated OpenAI logic remains in parallel modules


Repo snapshot:
```
branch: main

status:
M .t2/state.json
 D src/AI/Client/ParsedResponse.php
 D src/AI/Client/RequestBuilder.php
 D src/AI/Client/ResponseParser.php
 D src/AI/Client/StreamParser.php
 D src/AI/Client/ToolNormalizer.php
 D src/AI/Client/UsageEstimator.php
?? .logs/C04-07.gitcommit.txt
?? .logs/C05-01.claude.impl.last.md
?? .logs/C05-01.claude.impl.raw.txt
?? .plans/C05-01.md
?? .t2/handoff/C05-01.md

diff --stat:
.t2/state.json                   |   5 +-
 src/AI/Client/ParsedResponse.php | 155 --------------------
 src/AI/Client/RequestBuilder.php | 100 -------------
 src/AI/Client/ResponseParser.php | 132 -----------------
 src/AI/Client/StreamParser.php   | 299 ---------------------------------------
 src/AI/Client/ToolNormalizer.php | 100 -------------
 src/AI/Client/UsageEstimator.php |  96 -------------
 7 files changed, 3 insertions(+), 884 deletions(-)

```
