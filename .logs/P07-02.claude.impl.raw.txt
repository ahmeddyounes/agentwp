{"type":"result","subtype":"success","is_error":false,"duration_ms":90156,"duration_api_ms":94170,"num_turns":19,"result":"---\n\n**Status: DONE**\n\n## Summary of changes\n\nAdded a new `release-artifacts` job to `.github/workflows/ci.yml` that validates release-critical artifacts on every PR. The job:\n\n1. **Sets up the build environment** - Installs PHP dependencies (production mode) and builds frontend assets exactly like the release workflow\n2. **Creates a dry-run release package** - Uses the same rsync command with all exclusions as the release workflow\n3. **Validates UI build manifest** - Checks that `assets/build/.vite/manifest.json` exists (proves frontend build succeeded)\n4. **Validates asset directories** - Ensures:\n   - Built assets directory exists at `assets/build/assets/`\n   - At least one JavaScript file is present\n   - Build entry point `index.html` exists\n5. **Checks for forbidden folders** - Fails if any of these are found in the package:\n   - `node_modules` (anywhere in the tree)\n   - `.git`\n   - `tests`\n   - `react` (source directory)\n   - `.github`\n\n## How to verify\n\n1. Push a PR to trigger the CI workflow and observe the `release-artifacts` job\n2. Locally simulate validation:\n   ```bash\n   # Build frontend\n   npm ci --prefix react && npm --prefix react run build\n   \n   # Create test package\n   mkdir -p dist/package/agentwp\n   rsync -a --exclude '.git' --exclude 'react' --exclude 'node_modules' --exclude '**/node_modules' --exclude 'tests' --exclude '.github' ./ dist/package/agentwp/\n   \n   # Check manifest exists\n   test -f dist/package/agentwp/assets/build/.vite/manifest.json && echo \"✓ Manifest exists\"\n   \n   # Check for forbidden folders\n   find dist/package/agentwp -type d -name \"node_modules\" | grep -q . && echo \"✗ node_modules found\" || echo \"✓ No node_modules\"\n   ```\n\n## Risks / follow-ups\n\n- **Risk**: The job mirrors the release workflow's rsync excludes. If the release workflow changes its excludes, this job should be updated to match.\n- **Follow-up**: Consider extracting the rsync excludes into a shared script or file to keep them in sync between CI and release workflows.\n- **Note**: The job runs independently from the `php` and `node` jobs, so all three run in parallel on PRs.","session_id":"913f39f7-9a6d-4817-8762-1c36dadce6a1","total_cost_usd":0.6204605,"usage":{"input_tokens":3395,"cache_creation_input_tokens":35214,"cache_read_input_tokens":530936,"output_tokens":4513,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":0,"ephemeral_5m_input_tokens":35214}},"modelUsage":{"claude-opus-4-5-20251101":{"inputTokens":3395,"outputTokens":4513,"cacheReadInputTokens":530936,"cacheCreationInputTokens":35214,"webSearchRequests":0,"costUSD":0.6153554999999999,"contextWindow":200000,"maxOutputTokens":64000},"claude-haiku-4-5-20251001":{"inputTokens":4380,"outputTokens":145,"cacheReadInputTokens":0,"cacheCreationInputTokens":0,"webSearchRequests":0,"costUSD":0.005105,"contextWindow":200000,"maxOutputTokens":64000}},"permission_denials":[],"uuid":"79c6566a-ec8d-477d-92d2-663e03b1d313"}

