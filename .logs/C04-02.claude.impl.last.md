---

**Status: DONE**

## Summary of Changes

### New Files Created
1. **`src/Validation/ToolArgumentValidator.php`** - Validates tool arguments against JSON schemas using `rest_validate_value_from_schema()`
2. **`src/Validation/ToolArgumentValidationResult.php`** - Value object for validation results with consistent error shape
3. **`tests/Unit/Validation/ToolArgumentValidatorTest.php`** - 10 unit tests covering type errors, required fields, enums, min/max values, nested objects, additional properties
4. **`tests/Unit/Validation/ToolArgumentValidationIntegrationTest.php`** - 4 integration tests proving invalid args never reach domain services
5. **`tests/Support/rest-validation-functions.php`** - Test stubs for WordPress REST API validation functions

### Modified Files
1. **`src/Intent/Handlers/AbstractAgenticHandler.php`** - Added validation in `executeToolCalls()` before calling `execute_tool()`
2. **`tests/bootstrap.php`** - Enhanced `WP_Error` stub with all required methods, added rest-validation-functions.php include

### Consistent Error Shape
```php
[
    'success' => false,
    'error' => 'Invalid arguments for tool "tool_name": error message',
    'code' => 'invalid_tool_arguments',
    'validation_errors' => [...]
]
```

## How to Verify

```bash
# Run validation tests only
php vendor/bin/phpunit --no-coverage tests/Unit/Validation/

# Run handler tests (includes validation integration)
php vendor/bin/phpunit --no-coverage tests/Unit/Intent/Handlers/

# Syntax check new files
php -l src/Validation/ToolArgumentValidator.php
php -l src/Validation/ToolArgumentValidationResult.php
php -l src/Intent/Handlers/AbstractAgenticHandler.php
```

## Risks / Follow-ups

1. **Backward compatibility**: The `AbstractAgenticHandler` constructor now has an optional 4th parameter. Existing handlers that extend it will continue to work since the validator defaults to a new instance.

2. **Pre-existing test failures**: 8 test failures exist in `tests/Unit/Search/` related to missing constants (`BACKFILL_LIMIT`, `BACKFILL_WINDOW`, `DEFAULT_LIMIT`). These are unrelated to this change.

3. **Performance**: Schema validation adds minimal overhead per tool call. The validation is lightweight since it uses WordPress's built-in `rest_validate_value_from_schema()`.

4. **Test stub completeness**: The `rest_validate_value_from_schema()` stub in tests/Support covers common validation scenarios but may not cover all edge cases of the real WordPress function. If more complex validation is needed, the stub may need extension.
