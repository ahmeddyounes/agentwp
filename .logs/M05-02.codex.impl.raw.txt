Status: DONE

Summary of changes:
- Added wp-env setup plus test-only mu-plugins for OpenAI VCR and WooCommerce/intent test endpoints in `tests/wp-env/mu-plugins/agentwp-openai-vcr.php` and `tests/wp-env/mu-plugins/agentwp-test-tools.php`.
- Implemented Playwright integration suite covering REST, OpenAI VCR, WooCommerce flows, intent flow, and Command Deck interactions in `tests/e2e/*.js`, with helpers in `tests/e2e/helpers/wp.js`.
- Added OpenAI fixtures in `tests/fixtures/openai` and test runner scaffolding in `package.json`, `playwright.config.cjs`, and `docs/integration-tests.md`.

How to verify (exact commands):
- `npm install`
- `npm run wp-env:start`
- `npm run test:e2e`

Risks / follow-ups:
- The Command Deck Playwright test assumes the Command Deck UI is bundled and rendered on `/wp-admin/admin.php?page=agentwp`; if the current asset build doesn’t include it, update the build pipeline or selectors.
- If Playwright browsers aren’t installed locally, run `npx playwright install` before `npm run test:e2e`.

OpenAI Codex v0.79.0 (research preview)
--------
workdir: /Users/ahmedyounis/Documents/Projects/agentwp
model: gpt-5.2-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019b97e5-b3ae-7653-9e02-e8bab7d22a50
--------
user
You are implementing task M05-02 in this git repository.

1) Read the spec: .plans/M05-02.md
2) Read handoff/context: .t2/handoff/M05-02.md

Implement the spec fully.

Verification commands (run if non-empty):
- format: 
- lint: 
- test: 

In your final response, include:
- Status: DONE or NEEDS-REVIEW
- Summary of changes
- How to verify (exact commands)
- Risks / follow-ups

mcp startup: no servers

thinking
**Preparing to read specification**
exec
/bin/zsh -lc ls in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 48ms:
agentwp.php
assets
composer.json
docker
docker-compose.yml
docs
includes
languages
phpunit.xml.dist
react
README.md
scripts
setup.sh
src
tasks.csv
tests
uninstall.php
exec
/bin/zsh -lc 'cat .plans/M05-02.md' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
# M05-02 — Integration Test Suite

Create end-to-end integration tests: 1) Use wp-env for WordPress testing environment. 2) REST API integration tests hitting actual endpoints with authenticated requests. 3) OpenAI integration tests using recorded responses (VCR-style recording). 4) WooCommerce integration: test refund processing, order status changes, stock updates against real WC data. 5) Test the complete intent flow: input → API → OpenAI → handler → response. 6) Browser tests using Playwright for Command Deck interactions. 7) Test scenarios: happy path for each feature, error conditions, edge cases (empty store, huge order). Acceptance Criteria: Integration tests cover all major user flows, can run against real OpenAI API (optional flag), browser tests run headlessly in CI, test data reset between runs.
exec
/bin/zsh -lc 'cat .t2/handoff/M05-02.md' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 52ms:
# Handoff: M05-02

Created: 2026-01-07T09:59:31.981100Z

Spec: .plans/M05-02.md

thinking
**Exploring test infrastructure**
exec
/bin/zsh -lc "rg --files -g '*test*' -g '*Test*'" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 51ms:
react/tests/App.test.jsx
react/tests/setupTests.js
react/tests/components/ErrorBoundary.test.jsx
react/tests/components/HistoryPanel.test.jsx
react/tests/components/cards/ChartCard.test.jsx
react/tests/components/cards/DataTableCard.test.jsx
react/tests/components/cards/InfoCard.test.jsx
react/tests/components/cards/SuccessCard.test.jsx
react/tests/components/cards/BaseCard.test.jsx
react/tests/components/cards/DangerousActionCard.test.jsx
react/tests/components/cards/ErrorCard.test.jsx
tests/TestCase.php
tests/Integration/Intent/EngineTest.php
tests/Unit/AI/OpenAIClientTest.php
tests/Unit/Intent/Handlers/ProductStockHandlerTest.php
tests/Unit/Intent/Handlers/OrderSearchHandlerTest.php
tests/Unit/Intent/Handlers/CustomerLookupHandlerTest.php
tests/Unit/Intent/Handlers/SimpleHandlersTest.php
tests/Unit/Security/EncryptionTest.php

thinking
**Examining test organization**
exec
/bin/zsh -lc 'ls tests' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 37ms:
bootstrap.php
fixtures
Integration
Support
TestCase.php
Unit

thinking
**Browsing Integration Tests**
exec
/bin/zsh -lc "sed -n '1,200p' tests/Integration/Intent/EngineTest.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 56ms:
<?php
/**
 * Integration tests for intent engine.
 */

namespace AgentWP\Tests\Integration\Intent;

use AgentWP\AI\Response;
use AgentWP\Intent\ContextBuilder;
use AgentWP\Intent\Engine;
use AgentWP\Intent\FunctionRegistry;
use AgentWP\Intent\Handler;
use AgentWP\Intent\Intent;
use AgentWP\Intent\IntentClassifier;
use AgentWP\Tests\TestCase;

class EngineTest extends TestCase {
	public function test_engine_routes_to_matching_handler_and_records_memory(): void {
		$handler = new class() implements Handler {
			public function canHandle( string $intent ): bool {

thinking
**Planning integration tests**
exec
/bin/zsh -lc 'rg -n "wp-env|Playwright|woocommerce|OpenAI|rest" README.md docs -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 56ms:
docs/openapi.json:137:        "summary": "Store OpenAI API key",
docs/ARCHITECTURE.md:5:AgentWP is a WordPress plugin that provides a React-powered admin UI (Command Deck) and a PHP backend that integrates with WooCommerce and the OpenAI API. The plugin exposes REST endpoints under `/wp-json/agentwp/v1` and uses standard WooCommerce tables plus `wp_options` for settings and encrypted BYOK storage.
docs/ARCHITECTURE.md:29:  OpenAI[(OpenAI API)]
docs/ARCHITECTURE.md:33:  PHP --> OpenAI
docs/ARCHITECTURE.md:34:  OpenAI --> PHP
docs/ARCHITECTURE.md:98:  wp_woocommerce_order_items {
docs/ARCHITECTURE.md:105:  wp_woocommerce_order_itemmeta {
docs/ARCHITECTURE.md:116:  wp_posts ||--o{ wp_woocommerce_order_items : order_items
docs/ARCHITECTURE.md:117:  wp_woocommerce_order_items ||--o{ wp_woocommerce_order_itemmeta : item_meta
docs/ARCHITECTURE.md:178:Validates and stores a BYOK OpenAI key (encrypted).
docs/ARCHITECTURE.md:349:- Authentication: `current_user_can('manage_woocommerce')` required.
docs/ARCHITECTURE.md:356:AgentWP never stores or logs plaintext API keys. Keys are encrypted at rest using AES-256 and WordPress salts as key material.
docs/ARCHITECTURE.md:365:  OPENAI[(OpenAI API)]
docs/ARCHITECTURE.md:426:    "restock_items": true
docs/ARCHITECTURE.md:461:4) OpenAI response determines intent and produces a draft or answer.
docs/ARCHITECTURE.md:466:- Major subsystems documented: UI, REST API, PHP backend, OpenAI integration.
docs/agentwp-prd.md:41:**BYOK (Bring Your Own Key) is the dominant model** for AI plugins on CodeCanyon. Users provide their OpenAI API credentials, eliminating ongoing cost liability for the developer while ensuring transparency. This approach works because WooCommerce's user base skews more technical than Shopify's, and cost-conscious merchants prefer controlling their own API usage.
docs/agentwp-prd.md:58:**OpenAI Function Calling integration patterns:**
docs/agentwp-prd.md:60:The Function Calling API requires careful design. Enable **strict mode** (`strict: true`) for reliable JSON schema adherence—this ensures the AI generates properly structured responses every time. Key principles from OpenAI's guidelines:
docs/agentwp-prd.md:119:- Execute OpenAI's Data Processing Addendum (available at openai.com) before launch

thinking
**Inspecting plugin structure for tests**
exec
/bin/zsh -lc 'rg -n "rest" src includes -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 44ms:
src/Rest/HealthController.php:3: * Health REST controller.
src/Rest/HealthController.php:8:namespace AgentWP\Rest;
src/Rest/HealthController.php:10:use AgentWP\API\RestController;
src/Rest/HealthController.php:11:use WP_REST_Server;
src/Rest/HealthController.php:13:class HealthController extends RestController {
src/Rest/HealthController.php:15:	 * Register REST routes.
src/Rest/HealthController.php:20:		register_rest_route(
src/Rest/HealthController.php:24:				'methods'             => WP_REST_Server::READABLE,
src/Rest/HealthController.php:34:	 * @param WP_REST_Request $request Request instance.
src/Rest/HealthController.php:35:	 * @return \WP_REST_Response
src/Plugin.php:84:		add_action( 'rest_api_init', array( $this, 'register_rest_routes' ) );
src/Plugin.php:85:		add_filter( 'rest_post_dispatch', array( $this, 'format_rest_response' ), 10, 3 );
src/Plugin.php:177:						'root'  => esc_url_raw( rest_url() ),
src/Plugin.php:178:						'nonce' => wp_create_nonce( 'wp_rest' ),
src/Plugin.php:247:	 * Register REST routes.
src/Plugin.php:251:	public function register_rest_routes() {
src/Plugin.php:252:		if ( class_exists( 'AgentWP\\Rest\\SettingsController' ) ) {
src/Plugin.php:253:			$controller = new Rest\SettingsController();
src/Plugin.php:257:		if ( class_exists( 'AgentWP\\Rest\\IntentController' ) ) {
src/Plugin.php:258:			$controller = new Rest\IntentController();

thinking
**Exploring test setup**
exec
/bin/zsh -lc "sed -n '1,200p' tests/bootstrap.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 74ms:
<?php
/**
 * PHPUnit bootstrap for AgentWP.
 */

require dirname( __DIR__ ) . '/vendor/autoload.php';

if ( ! class_exists( 'WP_Error' ) ) {
	class WP_Error {
		private $code;
		private $message;

		public function __construct( $code = '', $message = '' ) {
			$this->code    = $code;
			$this->message = $message;
		}

		public function get_error_message() {
			return $this->message;
		}

thinking
**Evaluating current testing strategy**
exec
/bin/zsh -lc 'cat composer.json' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 71ms:
{
  "name": "agentwp/agentwp",
  "description": "AgentWP WordPress plugin.",
  "type": "wordpress-plugin",
  "license": "GPL-2.0-or-later",
  "autoload": {
    "psr-4": {
      "AgentWP\\": "src/"
    }
  },
  "require": {
    "php": ">=7.4",
    "yethee/tiktoken": "^0.1.2"
  },
  "require-dev": {
    "10up/wp_mock": "^1.0",
    "mockery/mockery": "^1.6",
    "phpunit/phpunit": "^9.6"
  },
  "autoload-dev": {

thinking
**Checking testing environment for composer**
exec
/bin/zsh -lc 'cat react/package.json' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 69ms:
{
  "name": "agentwp-react",
  "private": true,
  "version": "0.1.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "test": "jest --coverage"
  },
  "dependencies": {
    "chart.js": "^4.4.1",
    "html2canvas": "^1.4.1",
    "react": "^18.2.0",
    "react-chartjs-2": "^5.2.0",
    "react-dom": "^18.2.0",
    "react-markdown": "^9.0.1"
  },
  "devDependencies": {

thinking
**Searching for wp-env configuration**
exec
/bin/zsh -lc 'rg -n "wp-env" -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 66ms:
tasks.csv:30:M05-02,"Integration Test Suite","Create end-to-end integration tests: 1) Use wp-env for WordPress testing environment. 2) REST API integration tests hitting actual endpoints with authenticated requests. 3) OpenAI integration tests using recorded responses (VCR-style recording). 4) WooCommerce integration: test refund processing, order status changes, stock updates against real WC data. 5) Test the complete intent flow: input → API → OpenAI → handler → response. 6) Browser tests using Playwright for Command Deck interactions. 7) Test scenarios: happy path for each feature, error conditions, edge cases (empty store, huge order). Acceptance Criteria: Integration tests cover all major user flows, can run against real OpenAI API (optional flag), browser tests run headlessly in CI, test data reset between runs."

thinking
**Preparing for WordPress integration testing**
exec
/bin/zsh -lc "rg --files -g 'package.json'" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 74ms:
react/package.json

thinking
**Searching for AGENTS.md file**
exec
/bin/zsh -lc "rg --files -g 'AGENTS.md'" in /Users/ahmedyounis/Documents/Projects/agentwp exited 1 in 79ms:


thinking
**Considering plan creation for integration task**
Plan update
Integration test suite touches WordPress/wp-env config, REST/OpenAI/WooCommerce flows, and Playwright coverage, so a short plan helps coordinate changes.
  → Inspect existing plugin endpoints/handlers and test utilities to align integration coverage and data setup
  • Add wp-env configuration and integration test scaffolding (PHP/JS) for REST + OpenAI VCR + WooCommerce flows + intent flow
  • Add Playwright browser tests for Command Deck interactions and reset/fixtures guidance

thinking
**Examining plugin endpoint controllers**
exec
/bin/zsh -lc "sed -n '1,220p' src/Rest/IntentController.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 70ms:
<?php
/**
 * Intent REST controller.
 *
 * @package AgentWP
 */

namespace AgentWP\Rest;

use AgentWP\API\RestController;
use AgentWP\Intent\Engine;
use WP_REST_Server;

class IntentController extends RestController {
	/**
	 * Register REST routes.
	 *
	 * @return void
	 */
	public function register_routes() {

thinking
**Verifying Engine location**
exec
/bin/zsh -lc "sed -n '1,220p' src/Intent/Engine.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 71ms:
<?php
/**
 * Intent engine for routing requests.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

use AgentWP\AI\Response;
use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
use AgentWP\Intent\Handlers\CustomerLookupHandler;
use AgentWP\Intent\Handlers\EmailDraftHandler;
use AgentWP\Intent\Handlers\FallbackHandler;
use AgentWP\Intent\Handlers\OrderRefundHandler;
use AgentWP\Intent\Handlers\OrderSearchHandler;
use AgentWP\Intent\Handlers\OrderStatusHandler;
use AgentWP\Intent\Handlers\ProductStockHandler;

class Engine {

thinking
**Planning WordPress and WooCommerce testing setup**

I'm figuring out how to set up integration tests using the wp-env environment to run WordPress and WooCommerce in Docker, considering network restrictions and the need to include configs and dependencies like @wordpress/env and Playwright without installing them at runtime. I want to inspect the plugin's React admin UI next to connect the testing strategy there.
exec
/bin/zsh -lc 'ls react/src' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 48ms:
App.jsx
index.css
main.jsx
theme.js
exec
/bin/zsh -lc "sed -n '1,200p' react/src/App.jsx" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 75ms:
import { useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react';
import { createPortal } from 'react-dom';
import html2canvas from 'html2canvas';
import ReactMarkdown from 'react-markdown';
import HistoryPanel from '../components/HistoryPanel.jsx';
import { ChartCard, ErrorCard } from '../components/cards';
import {
  applyTheme,
  getInitialThemePreference,
  getServerTheme,
  resolveTheme,
  THEME_STORAGE_KEY,
} from './theme.js';

const OPEN_STATE_KEY = 'agentwp-command-deck-open';
const DRAFT_HISTORY_KEY = 'agentwp-draft-history';
const MAX_DRAFT_HISTORY = 10;
const COMMAND_HISTORY_KEY = 'agentwp-command-history';
const COMMAND_FAVORITES_KEY = 'agentwp-command-favorites';
const COMMAND_USAGE_KEY = 'agentwp-command-usage';

thinking
**Inspecting command deck selectors**
exec
/bin/zsh -lc 'rg -n "command deck|command-deck|agentwp" react/src -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 87ms:
react/src/App.jsx:15:const OPEN_STATE_KEY = 'agentwp-command-deck-open';
react/src/App.jsx:16:const DRAFT_HISTORY_KEY = 'agentwp-draft-history';
react/src/App.jsx:18:const COMMAND_HISTORY_KEY = 'agentwp-command-history';
react/src/App.jsx:19:const COMMAND_FAVORITES_KEY = 'agentwp-command-favorites';
react/src/App.jsx:20:const COMMAND_USAGE_KEY = 'agentwp-command-usage';
react/src/App.jsx:26:  '#wp-admin-bar-agentwp',
react/src/App.jsx:27:  '[data-agentwp-command-deck]',
react/src/App.jsx:28:  '#agentwp-command-deck',
react/src/App.jsx:30:const REST_PATH = '/agentwp/v1/intent';
react/src/App.jsx:31:const SEARCH_PATH = '/agentwp/v1/search';
react/src/App.jsx:32:const USAGE_PATH = '/agentwp/v1/usage';
react/src/App.jsx:33:const SETTINGS_PATH = '/agentwp/v1/settings';
react/src/App.jsx:34:const THEME_PATH = '/agentwp/v1/theme';
react/src/App.jsx:35:const HEALTH_PATH = '/agentwp/v1/health';
react/src/App.jsx:139:const DEFAULT_ERROR_MESSAGE = 'AgentWP ran into a problem. Please try again.';
react/src/App.jsx:162:const AGENTWP_ERROR_MESSAGES = {
react/src/App.jsx:163:  agentwp_rate_limited: 'Too many requests. Please wait and retry.',
react/src/App.jsx:164:  agentwp_invalid_key: 'The OpenAI API key is invalid. Update it in settings.',
react/src/App.jsx:165:  agentwp_invalid_request: 'Please check your request and try again.',
react/src/App.jsx:166:  agentwp_missing_prompt: 'Please enter a prompt to continue.',

thinking
**Reviewing backend controllers for endpoints**
exec
/bin/zsh -lc "sed -n '1,220p' src/Rest/SettingsController.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 71ms:
<?php
/**
 * Settings REST controller.
 *
 * @package AgentWP
 */

namespace AgentWP\Rest;

use AgentWP\API\RestController;
use AgentWP\Billing\UsageTracker;
use AgentWP\Plugin;
use AgentWP\Security\Encryption;
use WP_Error;
use WP_REST_Server;

class SettingsController extends RestController {

	/**
	 * Register REST routes.

thinking
**Searching for VCR references**
exec
/bin/zsh -lc "sed -n '1,200p' tests/Support/ai-functions.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 50ms:
<?php
/**
 * Namespaced function overrides for AgentWP\AI.
 */

namespace AgentWP\AI;

function usleep( $microseconds ) {
	return 0;
}

thinking
**Checking AI client availability**
exec
/bin/zsh -lc "sed -n '1,240p' src/AI/OpenAIClient.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 54ms:
<?php
/**
 * OpenAI API client wrapper.
 *
 * @package AgentWP
 */

namespace AgentWP\AI;

use AgentWP\AI\Functions\FunctionSchema;
use AgentWP\Billing\UsageTracker;

class OpenAIClient {
	const API_BASE = 'https://api.openai.com/v1';

	/**
	 * @var string
	 */
	private $api_key;


thinking
**Investigating OpenAI client integration**
exec
/bin/zsh -lc 'rg -n "OpenAIClient" -S src' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 60ms:
src/Handlers/EmailDraftHandler.php:11:use AgentWP\AI\OpenAIClient;
src/Handlers/EmailDraftHandler.php:340:		$client   = new OpenAIClient(
src/AI/OpenAIClient.php:13:class OpenAIClient {
exec
/bin/zsh -lc "sed -n '300,460p' src/Handlers/EmailDraftHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 44ms:
				'email_body'         => isset( $payload['email_body'] ) ? $payload['email_body'] : '',
				'plain_text_version' => isset( $payload['plain_text_version'] ) ? $payload['plain_text_version'] : '',
				'template_variables' => $template_variables,
				'expires_at'         => $expires_at,
			)
		);
	}

	/**
	 * @param array $context Order context.
	 * @param string $intent Email intent.
	 * @param string $tone Email tone.
	 * @param string $custom_instructions Custom instructions.
	 * @param array $template_variables Template variables.
	 * @return array
	 */
	private function generate_draft( array $context, $intent, $tone, $custom_instructions, array $template_variables ) {
		$draft = $this->generate_draft_with_ai( $context, $intent, $tone, $custom_instructions, $template_variables );
		if ( ! empty( $draft['subject_line'] ) && ! empty( $draft['email_body'] ) ) {
			return $draft;

thinking
**Exploring OpenAI integration options**
exec
/bin/zsh -lc 'rg -n "openai" src -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 58ms:
src/Billing/UsageTracker.php:3: * Track OpenAI usage and costs.
src/Rest/SettingsController.php:145:		$validation = $this->validate_openai_api_key( $api_key );
src/Rest/SettingsController.php:268:	 * Validate API key against OpenAI.
src/Rest/SettingsController.php:273:	private function validate_openai_api_key( $api_key ) {
src/Rest/SettingsController.php:275:			'https://api.openai.com/v1/models',
src/Rest/SettingsController.php:286:			return new WP_Error( 'agentwp_openai_unreachable', __( 'OpenAI API is unreachable.', 'agentwp' ) );
src/Rest/SettingsController.php:291:			return new WP_Error( 'agentwp_openai_invalid', __( 'OpenAI rejected the API key.', 'agentwp' ) );
src/Handlers/EmailDraftHandler.php:11:use AgentWP\AI\OpenAIClient;
src/Handlers/EmailDraftHandler.php:340:		$client   = new OpenAIClient(
src/AI/TokenCounter.php:32:	 * Count tokens for messages using OpenAI chat heuristics.
src/AI/OpenAIClient.php:3: * OpenAI API client wrapper.
src/AI/OpenAIClient.php:13:class OpenAIClient {
src/AI/OpenAIClient.php:14:	const API_BASE = 'https://api.openai.com/v1';
src/AI/OpenAIClient.php:72:	 * @param string $api_key OpenAI API key.
src/AI/OpenAIClient.php:103:			return Response::error( 'Missing OpenAI API key.', 401 );
src/AI/OpenAIClient.php:172:			'usage_source'  => $usage_fallback ? 'tiktoken' : 'openai',
src/AI/OpenAIClient.php:197:	 * Validate an OpenAI API key.
src/AI/OpenAIClient.php:309:			$error   = 'OpenAI API request failed.';
src/AI/OpenAIClient.php:428:				'error'      => 'Invalid response from OpenAI.',
src/AI/Model.php:3: * OpenAI model abstraction.

thinking
**Planning WordPress integration test setup**

I'm thinking about creating a VCR-style mechanism for integration tests by hooking into WordPress's HTTP API to record and replay OpenAI requests, possibly using mu-plugins and environment variables for test mode. Alongside that, I want to explore REST API integration tests via Node or Playwright with authenticated requests, and I'll look into the plugin's admin page to gather more context.
exec
/bin/zsh -lc 'rg -n "Command Deck|command deck|agentwp" src -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 51ms:
src/Billing/UsageTracker.php:16:	const TABLE          = 'agentwp_usage';
src/Billing/UsageTracker.php:18:	const VERSION_OPTION = 'agentwp_usage_version';
src/Rest/SettingsController.php:95:			return $this->response_error( 'agentwp_invalid_request', $validation->get_error_message(), 400 );
src/Rest/SettingsController.php:122:			return $this->response_error( 'agentwp_invalid_request', $validation->get_error_message(), 400 );
src/Rest/SettingsController.php:142:			return $this->response_error( 'agentwp_invalid_key', __( 'API key format looks invalid.', 'agentwp' ), 400 );
src/Rest/SettingsController.php:177:			return $this->response_error( 'agentwp_invalid_request', $validation->get_error_message(), 400 );
src/Rest/SettingsController.php:184:			return $this->response_error( 'agentwp_invalid_period', __( 'Invalid usage period.', 'agentwp' ), 400 );
src/Rest/SettingsController.php:286:			return new WP_Error( 'agentwp_openai_unreachable', __( 'OpenAI API is unreachable.', 'agentwp' ) );
src/Rest/SettingsController.php:291:			return new WP_Error( 'agentwp_openai_invalid', __( 'OpenAI rejected the API key.', 'agentwp' ) );
src/Rest/SettingsController.php:308:			return new WP_Error( 'agentwp_encryption_failed', __( 'Unable to encrypt the API key.', 'agentwp' ) );
src/Rest/IntentController.php:41:			return $this->response_error( 'agentwp_invalid_request', $validation->get_error_message(), 400 );
src/Rest/IntentController.php:55:			return $this->response_error( 'agentwp_missing_prompt', __( 'Please provide a prompt.', 'agentwp' ), 400 );
src/Rest/IntentController.php:70:				'agentwp_intent_failed',
src/Rest/SearchController.php:41:			return $this->response_error( 'agentwp_invalid_request', $validation->get_error_message(), 400 );
src/Handlers/RefundHandler.php:538:		$notify = apply_filters( 'agentwp_refund_notify_customer', false, $refund, $order, $payload );
src/Handlers/CustomerHandler.php:602:			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
src/Handlers/OrderStatusHandler.php:420:		$notify_customer = apply_filters( 'agentwp_status_notify_customer', $notify_customer, $order, $new_status );
src/API/HistoryController.php:13:	const HISTORY_META_KEY   = 'agentwp_command_history';
src/API/HistoryController.php:14:	const FAVORITES_META_KEY = 'agentwp_command_favorites';
src/API/HistoryController.php:73:			return $this->response_error( 'agentwp_invalid_request', $validation->get_error_message(), 400 );

thinking
**Reviewing plugin admin page setup**
exec
/bin/zsh -lc "sed -n '80,200p' src/Plugin.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
		add_action( 'init', array( $this, 'load_textdomain' ) );
		add_action( 'admin_menu', array( $this, 'register_menu' ) );
		add_action( 'admin_enqueue_scripts', array( $this, 'enqueue_admin_assets' ) );
		add_action( 'admin_head', array( $this, 'output_theme_attribute' ) );
		add_action( 'rest_api_init', array( $this, 'register_rest_routes' ) );
		add_filter( 'rest_post_dispatch', array( $this, 'format_rest_response' ), 10, 3 );

		if ( class_exists( 'AgentWP\\Billing\\UsageTracker' ) ) {
			Billing\UsageTracker::init();
		}

		if ( class_exists( 'AgentWP\\Search\\Index' ) ) {
			Search\Index::init();
		}
	}

	/**
	 * Load translations.
	 *
	 * @return void

thinking
**Planning integration and e2e tests**

I'm thinking through how to set up integration and Playwright tests for the admin page and REST API, including using wp-env and mu-plugins to intercept and record OpenAI requests for playback. It looks like I'll create test fixtures, configure recording modes, and ensure the tests cover the intent flow involving WooCommerce data and OpenAI calls.
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/IntentClassifier.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 44ms:
<?php
/**
 * Rule-based intent classifier.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

class IntentClassifier {
	/**
	 * @param string $input User input.
	 * @param array  $context Enriched context.
	 * @return string
	 */
	public function classify( $input, array $context = array() ) {
		if ( isset( $context['intent'] ) ) {
			$override = Intent::normalize( $context['intent'] );
			if ( Intent::UNKNOWN !== $override ) {
				return $override;

thinking
**Examining intent handling and WooCommerce integration**
exec
/bin/zsh -lc "sed -n '1,220p' src/Handlers/OrderRefundHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp exited 1 in 54ms:
sed: src/Handlers/OrderRefundHandler.php: No such file or directory

thinking
**Searching in Intent Handlers**
exec
/bin/zsh -lc 'rg -n "class OrderRefundHandler" -S src' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 61ms:
src/Intent/Handlers/OrderRefundHandler.php:13:class OrderRefundHandler extends BaseHandler {
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/Handlers/OrderRefundHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 50ms:
<?php
/**
 * Handle order refund intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class OrderRefundHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::ORDER_REFUND );
	}

	/**
	 * @param array $context Context data.
	 * @return Response

thinking
**Investigating refund handling classes**
exec
/bin/zsh -lc "sed -n '1,160p' src/Handlers/RefundHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 55ms:
<?php
/**
 * Handle refund draft preparation and confirmation.
 *
 * @package AgentWP
 */

namespace AgentWP\Handlers;

use AgentWP\AI\Response;
use AgentWP\Plugin;

class RefundHandler {
	const DRAFT_TYPE = 'refund';

	/**
	 * Handle refund-related requests.
	 *
	 * @param array $args Request args.
	 * @return Response

thinking
**Checking OrderStatusHandler.php**
exec
/bin/zsh -lc "sed -n '1,120p' src/Handlers/OrderStatusHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 52ms:
<?php
/**
 * Handle order status draft preparation and confirmation.
 *
 * @package AgentWP
 */

namespace AgentWP\Handlers;

use AgentWP\AI\Response;
use AgentWP\Plugin;

class OrderStatusHandler {
	const DRAFT_TYPE = 'status_update';
	const MAX_BULK   = 50;

	/**
	 * Handle order status requests.
	 *
	 * @param array $args Request args.

thinking
**Checking update functions**
exec
/bin/zsh -lc "sed -n '1,120p' src/Handlers/ProductStockHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp exited 1 in 42ms:
sed: src/Handlers/ProductStockHandler.php: No such file or directory

thinking
**Searching for StockHandler location**
exec
/bin/zsh -lc 'rg -n "class ProductStockHandler|class Stock" src/Handlers -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 61ms:
src/Handlers/StockHandler.php:13:class StockHandler {
exec
/bin/zsh -lc "sed -n '1,120p' src/Handlers/StockHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 39ms:
<?php
/**
 * Handle product stock searches and updates.
 *
 * @package AgentWP
 */

namespace AgentWP\Handlers;

use AgentWP\AI\Response;
use AgentWP\Plugin;

class StockHandler {
	const DRAFT_TYPE    = 'stock_update';
	const DEFAULT_LIMIT = 10;

	/**
	 * Handle stock-related requests.
	 *
	 * @param array $args Request args.

thinking
**Planning integration test setup**

I’m mapping out a strategy to implement reliable REST API integration tests using Playwright in a WordPress environment with WooCommerce. This includes managing test data resets via custom mu-plugins exposing REST endpoints, configuring wp-env to install necessary plugins and define constants for test mode, and scripting login flows with cookie-based authentication for seamless API requests. I’m also considering ways to seed deterministic test data either through REST calls or WP-CLI evaluations to ensure consistent test states. Let’s explore how to best combine these tools to build stable end-to-end scenarios, including tests for OpenAI integration with recorded API responses.
exec
/bin/zsh -lc "sed -n '1,160p' src/Intent/Handlers/EmailDraftHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 54ms:
<?php
/**
 * Handle email draft intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class EmailDraftHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::EMAIL_DRAFT );
	}

	/**
	 * @param array $context Context data.
	 * @return Response

thinking
**Investigating draft handling and AI functions**
exec
/bin/zsh -lc 'ls src/AI/Functions' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 38ms:
AbstractFunction.php
BulkUpdate.php
ConfirmRefund.php
DraftEmail.php
FunctionSchema.php
GetCustomerProfile.php
GetSalesReport.php
PrepareBulkStatusUpdate.php
PrepareRefund.php
PrepareStatusUpdate.php
PrepareStockUpdate.php
SearchOrders.php
SearchProduct.php
SelectOrders.php

thinking
**Inspecting DraftEmail function**
exec
/bin/zsh -lc "sed -n '1,200p' src/AI/Functions/DraftEmail.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 59ms:
<?php
/**
 * Function schema for drafting emails.
 *
 * @package AgentWP
 */

namespace AgentWP\AI\Functions;

class DraftEmail extends AbstractFunction {
	public function get_name() {
		return 'draft_email';
	}

	public function get_description() {
		return 'Draft a customer email for a given order and intent.';
	}

	public function get_parameters() {
		return array(

thinking
**Investigating function registry usage**
exec
/bin/zsh -lc 'rg -n "FunctionRegistry|tool_calls|tool call" -S src' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 60ms:
src/AI/OpenAIClient.php:189:				'tool_calls' => $parsed['tool_calls'],
src/AI/OpenAIClient.php:430:				'tool_calls' => array(),
src/AI/OpenAIClient.php:441:		$tool_calls = isset( $message['tool_calls'] ) && is_array( $message['tool_calls'] ) ? $message['tool_calls'] : array();
src/AI/OpenAIClient.php:443:		if ( empty( $tool_calls ) && isset( $message['function_call'] ) && is_array( $message['function_call'] ) ) {
src/AI/OpenAIClient.php:444:			$tool_calls = array(
src/AI/OpenAIClient.php:457:			'tool_calls' => $tool_calls,
src/AI/OpenAIClient.php:471:		$tool_calls = array();
src/AI/OpenAIClient.php:517:			if ( isset( $delta['tool_calls'] ) && is_array( $delta['tool_calls'] ) ) {
src/AI/OpenAIClient.php:518:				$tool_calls = $this->merge_tool_call_deltas( $tool_calls, $delta['tool_calls'] );
src/AI/OpenAIClient.php:522:				$tool_calls = $this->merge_tool_call_deltas(
src/AI/OpenAIClient.php:523:					$tool_calls,
src/AI/OpenAIClient.php:539:			'tool_calls' => array_values( $tool_calls ),
src/AI/OpenAIClient.php:547:	 * @param array $tool_calls Existing tool calls.
src/AI/OpenAIClient.php:551:	private function merge_tool_call_deltas( array $tool_calls, array $deltas ) {
src/AI/OpenAIClient.php:555:			if ( ! isset( $tool_calls[ $index ] ) ) {
src/AI/OpenAIClient.php:556:				$tool_calls[ $index ] = array(
src/AI/OpenAIClient.php:567:				$tool_calls[ $index ]['id'] = $delta['id'];
src/AI/OpenAIClient.php:571:				$tool_calls[ $index ]['type'] = $delta['type'];
src/AI/OpenAIClient.php:576:					$tool_calls[ $index ]['function']['name'] = $delta['function']['name'];
src/AI/OpenAIClient.php:580:					$tool_calls[ $index ]['function']['arguments'] .= $delta['function']['arguments'];

thinking
**Investigating OpenAI usage in handlers**
exec
/bin/zsh -lc 'rg -n "OpenAIClient|draft_email|prepare_refund|prepare_status_update|prepare_stock_update" src -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 59ms:
src/Handlers/RefundHandler.php:27:		return $this->prepare_refund( $args );
src/Handlers/RefundHandler.php:36:	public function prepare_refund( array $args ): Response {
src/Handlers/EmailDraftHandler.php:11:use AgentWP\AI\OpenAIClient;
src/Handlers/EmailDraftHandler.php:54:		return $this->draft_email( $args );
src/Handlers/EmailDraftHandler.php:63:	public function draft_email( array $args ): Response {
src/Handlers/EmailDraftHandler.php:340:		$client   = new OpenAIClient(
src/Handlers/OrderStatusHandler.php:32:		return $this->prepare_status_update( $args );
src/Handlers/OrderStatusHandler.php:41:	public function prepare_status_update( array $args ): Response {
src/Handlers/StockHandler.php:32:		return $this->prepare_stock_update( $args );
src/Handlers/StockHandler.php:73:	public function prepare_stock_update( array $args ): Response {
src/AI/Functions/PrepareStockUpdate.php:12:		return 'prepare_stock_update';
src/AI/Functions/PrepareRefund.php:12:		return 'prepare_refund';
src/AI/Functions/DraftEmail.php:12:		return 'draft_email';
src/AI/Functions/PrepareStatusUpdate.php:12:		return 'prepare_status_update';
src/AI/OpenAIClient.php:13:class OpenAIClient {
src/Intent/Engine.php:177:			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
src/Intent/Engine.php:178:			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
src/Intent/Engine.php:179:			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
src/Intent/Engine.php:180:			Intent::EMAIL_DRAFT     => array( 'draft_email' ),

thinking
**Searching for function orchestration classes**
exec
/bin/zsh -lc 'rg -n "function_registry|tool_calls|function call" src -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 38ms:
src/AI/OpenAIClient.php:189:				'tool_calls' => $parsed['tool_calls'],
src/AI/OpenAIClient.php:430:				'tool_calls' => array(),
src/AI/OpenAIClient.php:441:		$tool_calls = isset( $message['tool_calls'] ) && is_array( $message['tool_calls'] ) ? $message['tool_calls'] : array();
src/AI/OpenAIClient.php:443:		if ( empty( $tool_calls ) && isset( $message['function_call'] ) && is_array( $message['function_call'] ) ) {
src/AI/OpenAIClient.php:444:			$tool_calls = array(
src/AI/OpenAIClient.php:457:			'tool_calls' => $tool_calls,
src/AI/OpenAIClient.php:471:		$tool_calls = array();
src/AI/OpenAIClient.php:517:			if ( isset( $delta['tool_calls'] ) && is_array( $delta['tool_calls'] ) ) {
src/AI/OpenAIClient.php:518:				$tool_calls = $this->merge_tool_call_deltas( $tool_calls, $delta['tool_calls'] );
src/AI/OpenAIClient.php:522:				$tool_calls = $this->merge_tool_call_deltas(
src/AI/OpenAIClient.php:523:					$tool_calls,
src/AI/OpenAIClient.php:539:			'tool_calls' => array_values( $tool_calls ),
src/AI/OpenAIClient.php:547:	 * @param array $tool_calls Existing tool calls.
src/AI/OpenAIClient.php:551:	private function merge_tool_call_deltas( array $tool_calls, array $deltas ) {
src/AI/OpenAIClient.php:555:			if ( ! isset( $tool_calls[ $index ] ) ) {
src/AI/OpenAIClient.php:556:				$tool_calls[ $index ] = array(
src/AI/OpenAIClient.php:567:				$tool_calls[ $index ]['id'] = $delta['id'];
src/AI/OpenAIClient.php:571:				$tool_calls[ $index ]['type'] = $delta['type'];
src/AI/OpenAIClient.php:576:					$tool_calls[ $index ]['function']['name'] = $delta['function']['name'];
src/AI/OpenAIClient.php:580:					$tool_calls[ $index ]['function']['arguments'] .= $delta['function']['arguments'];

thinking
**Investigating AI orchestration presence**
exec
/bin/zsh -lc "rg -n \"Handlers\\\\\" src -S" in /Users/ahmedyounis/Documents/Projects/agentwp exited 2 in 54ms:
rg: regex parse error:
    (?:Handlers\)
    ^
error: unclosed group

thinking
**Correcting regex usage to plain string**
exec
/bin/zsh -lc "rg -n \"AgentWP\\\\Handlers\" src -S" in /Users/ahmedyounis/Documents/Projects/agentwp exited 2 in 56ms:
rg: regex parse error:
    (?:AgentWP\Handlers)
              ^^
error: unrecognized escape sequence

thinking
**Considering command-line options**
exec
/bin/zsh -lc "rg -n -F \"AgentWP\\\\Handlers\" src" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 50ms:
src/Handlers/RefundHandler.php:8:namespace AgentWP\Handlers;
src/Handlers/AnalyticsHandler.php:8:namespace AgentWP\Handlers;
src/Handlers/CustomerHandler.php:8:namespace AgentWP\Handlers;
src/Handlers/OrderSearchHandler.php:8:namespace AgentWP\Handlers;
src/Handlers/EmailDraftHandler.php:8:namespace AgentWP\Handlers;
src/Handlers/OrderStatusHandler.php:8:namespace AgentWP\Handlers;
src/Handlers/StockHandler.php:8:namespace AgentWP\Handlers;
src/Intent/Handlers/ProductStockHandler.php:11:use AgentWP\Handlers\StockHandler;
src/Intent/Handlers/CustomerLookupHandler.php:11:use AgentWP\Handlers\CustomerHandler;
src/Intent/Handlers/OrderSearchHandler.php:11:use AgentWP\Handlers\OrderSearchHandler as OrderSearchService;

thinking
**Inspecting ProductStockHandler in Intent**
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/Handlers/ProductStockHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 37ms:
<?php
/**
 * Handle product stock intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Handlers\StockHandler;
use AgentWP\Intent\Intent;

class ProductStockHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::PRODUCT_STOCK );
	}

	/**
	 * @param array $context Context data.

thinking
**Tracing OpenAI integration paths**
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/Handlers/BaseHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 49ms:
<?php
/**
 * Base handler for intent responses.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Handler;
use AgentWP\Intent\Intent;

abstract class BaseHandler implements Handler {
	/**
	 * @var string
	 */
	protected $intent;

	/**

thinking
**Investigating OpenAI usage in JavaScript**
exec
/bin/zsh -lc 'rg -n "openai" react/src react/components -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 49ms:
react/src/App.jsx:146:const OPENAI_ERROR_CODE_MESSAGES = {
react/src/App.jsx:147:  invalid_api_key: 'The OpenAI API key is invalid. Update it in settings.',
react/src/App.jsx:148:  insufficient_quota: 'OpenAI billing quota has been exhausted. Check your plan or usage.',
react/src/App.jsx:149:  rate_limit_exceeded: 'OpenAI rate limit reached. Please wait and retry.',
react/src/App.jsx:154:const OPENAI_ERROR_TYPE_MESSAGES = {
react/src/App.jsx:155:  authentication_error: 'OpenAI authentication failed. Check your API key.',
react/src/App.jsx:156:  rate_limit_error: 'OpenAI rate limit reached. Please wait and retry.',
react/src/App.jsx:157:  invalid_request_error: 'This request was rejected by OpenAI. Please try again.',
react/src/App.jsx:158:  server_error: 'OpenAI is having trouble right now. Please retry.',
react/src/App.jsx:159:  overloaded_error: 'OpenAI is overloaded right now. Please retry.',
react/src/App.jsx:164:  agentwp_invalid_key: 'The OpenAI API key is invalid. Update it in settings.',
react/src/App.jsx:594:  const openAiCode =
react/src/App.jsx:596:  const openAiType =
react/src/App.jsx:599:  if (openAiCode && OPENAI_ERROR_CODE_MESSAGES[openAiCode]) {
react/src/App.jsx:600:    return OPENAI_ERROR_CODE_MESSAGES[openAiCode];
react/src/App.jsx:602:  if (openAiType && OPENAI_ERROR_TYPE_MESSAGES[openAiType]) {
react/src/App.jsx:603:    return OPENAI_ERROR_TYPE_MESSAGES[openAiType];

thinking
**Analyzing integration test options**
exec
/bin/zsh -lc "sed -n '1,200p' src/Rest/SearchController.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 35ms:
<?php
/**
 * Search REST controller.
 *
 * @package AgentWP
 */

namespace AgentWP\Rest;

use AgentWP\API\RestController;
use AgentWP\Search\Index;
use WP_REST_Server;

class SearchController extends RestController {
	/**
	 * Register REST routes.
	 *
	 * @return void
	 */
	public function register_routes() {

thinking
**Investigating API endpoints and plugin integration**
exec
/bin/zsh -lc 'rg -n "function_suggestions|draft_id|prepare_|confirm_|draft" react/src/App.jsx -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 51ms:
16:const DRAFT_HISTORY_KEY = 'agentwp-draft-history';
17:const MAX_DRAFT_HISTORY = 10;
897:  const [draftSubject, setDraftSubject] = useState('');
898:  const [draftBody, setDraftBody] = useState('');
899:  const [draftHistory, setDraftHistory] = useState([]);
955:  const offlineDrafts = useMemo(
956:    () => (Array.isArray(draftHistory) ? draftHistory.slice(0, OFFLINE_CACHE_LIMIT) : []),
957:    [draftHistory]
1347:  const addDraftToHistory = useCallback((draft) => {
1348:    if (!draft?.markdown) {
1351:    setDraftHistory((prev) => {
1353:        id: `draft-${Date.now()}-${Math.random().toString(16).slice(2)}`,
1354:        prompt: draft.prompt || '',
1355:        subject: draft.subject || '',
1356:        markdown: draft.markdown,
1357:        plainText: draft.plainText || '',
1366:      return [nextEntry, ...filtered].slice(0, MAX_DRAFT_HISTORY);
1434:  const handleRestoreDraft = useCallback(
1435:    (draft) => {
1436:      if (!draft) {

thinking
**Investigating REST_PATH usage**
exec
/bin/zsh -lc 'rg -n "REST_PATH" -n react/src/App.jsx' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 54ms:
30:const REST_PATH = '/agentwp/v1/intent';
378:    return REST_PATH;
382:    return REST_PATH;
384:  return `${root.replace(/\/$/, '')}${REST_PATH}`;

thinking
**Searching for fetch usage**
exec
/bin/zsh -lc "rg -n \"fetch\\(|apiFetch|intent\" react/src/App.jsx -S" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
30:const REST_PATH = '/agentwp/v1/intent';
222:  breakdownByIntent: Array.isArray(payload?.breakdown_by_intent) ? payload.breakdown_by_intent : [],
661:  `${entry?.raw_input || ''}::${entry?.parsed_intent || ''}`;
671:  const parsedIntent = typeof entry.parsed_intent === 'string' ? entry.parsed_intent : '';
679:    parsed_intent: parsedIntent,
701:  const { raw_input, parsed_intent, timestamp, was_successful } = normalized;
702:  return { raw_input, parsed_intent, timestamp, was_successful };
1019:      const response = await fetch(getThemeEndpoint(), {
1064:      const response = await fetch(`${endpoint}?period=month`, {
1103:      const response = await fetch(endpoint, {
1146:      const response = await fetch(endpoint, {
1496:        const response = await fetch(url.toString(), {
1842:        const response = await fetch(restEndpoint, {
1881:          typeof data?.data?.intent === 'string'
1882:            ? data.data.intent
1883:            : typeof data?.data?.parsed_intent === 'string'
1884:              ? data.data.parsed_intent
1900:          parsed_intent: parsedIntent,
1927:          parsed_intent: '',

thinking
**Inspecting fetch usage**
exec
/bin/zsh -lc "sed -n '1800,1940p' react/src/App.jsx" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 56ms:
      if (exportTimerRef.current) {
        window.clearTimeout(exportTimerRef.current);
      }
    };
  }, []);

  const submitCommand = useCallback(
    async (rawInput, options = {}) => {
      const trimmedPrompt = typeof rawInput === 'string' ? rawInput.trim() : '';
      if (!trimmedPrompt || loading || isOffline) {
        return;
      }
      const isRetry = options?.isRetry === true;

      setIsTypeaheadOpen(false);
      setActiveSuggestionIndex(-1);
      abortActiveRequest();
      const controller = new AbortController();
      requestControllerRef.current = controller;
      setLoading(true);

thinking
**Planning integration and API tests**

I'm mapping out how to implement integration tests that cover the full intent flow—input through REST API, OpenAI interaction (stubbed or recorded), and handler response. Since no existing REST endpoints directly call all handlers, I'm considering adding test-only endpoints within a mu-plugin to safely expose WooCommerce handlers for testing. I'll also set up a mechanism to intercept OpenAI API calls with recorded fixtures or optional real requests, ensuring reliable test runs without network dependency. This approach should cover authentication, settings validation, WooCommerce operations, and OpenAI responses while aligning with the spec’s requirements.
exec
/bin/zsh -lc 'rg -n "parse_response_body" -n src/AI/OpenAIClient.php' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 51ms:
142:			$parsed = $this->parse_response_body( $result['body'] );
423:	private function parse_response_body( $body ) {
exec
/bin/zsh -lc "sed -n '420,560p' src/AI/OpenAIClient.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 52ms:
	 * @param string $body Response body.
	 * @return array
	 */
	private function parse_response_body( $body ) {
		$payload = json_decode( $body, true );
		if ( ! is_array( $payload ) ) {
			return array(
				'success'    => false,
				'error'      => 'Invalid response from OpenAI.',
				'content'    => '',
				'tool_calls' => array(),
				'usage'      => array(),
				'raw'        => array(),
				'model'      => '',
			);
		}

		$message    = isset( $payload['choices'][0]['message'] ) && is_array( $payload['choices'][0]['message'] )
			? $payload['choices'][0]['message']
			: array();

thinking
**Designing comprehensive integration tests**

I'm mapping out test endpoints for REST and WooCommerce handlers with scenarios covering happy paths, errors, and edge cases like empty stores and huge orders. I plan to use seeded test data created via mu-plugin functions and WP CLI in the test environment, plus implement VCR fixtures to simulate OpenAI API calls during tests for consistency and isolation.
exec
/bin/zsh -lc 'rg -n "get_api_key" -n src/Handlers/EmailDraftHandler.php' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 55ms:
334:		$api_key = $this->get_api_key();
1302:	private function get_api_key() {
exec
/bin/zsh -lc "sed -n '1280,1345p' src/Handlers/EmailDraftHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
		}

		$decoded = json_decode( $content, true );
		if ( is_array( $decoded ) ) {
			return $decoded;
		}

		$start = strpos( $content, '{' );
		$end   = strrpos( $content, '}' );
		if ( false === $start || false === $end || $end <= $start ) {
			return array();
		}

		$snippet = substr( $content, $start, $end - $start + 1 );
		$decoded = json_decode( $snippet, true );

		return is_array( $decoded ) ? $decoded : array();
	}

	/**

thinking
**Planning API key handling and email draft testing**

I’m figuring out how to store and encrypt an API key for calling EmailDraftHandler, leaning on the plugin’s encryption and WordPress salts. I’ll run integration tests by setting the API key via the settings endpoint, then hit a test endpoint that calls EmailDraftHandler. To confirm, I’m checking how to invoke EmailDraftHandler’s handle method and parse its response for the email draft content.
exec
/bin/zsh -lc "sed -n '1,120p' src/Handlers/EmailDraftHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 37ms:
<?php
/**
 * Handle email draft preparation and editing.
 *
 * @package AgentWP
 */

namespace AgentWP\Handlers;

use AgentWP\AI\Model;
use AgentWP\AI\OpenAIClient;
use AgentWP\AI\Response;
use AgentWP\Context\EmailContextBuilder;
use AgentWP\Intent\Intent;
use AgentWP\Plugin;
use AgentWP\Security\Encryption;

class EmailDraftHandler {
	const DRAFT_TYPE          = 'email_draft';
	const DEFAULT_TTL_MINUTES = 30;

thinking
**Preparing WooCommerce data for testing**
exec
/bin/zsh -lc "sed -n '1,200p' src/Context/EmailContextBuilder.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 33ms:
<?php
/**
 * Build email drafting context for orders.
 *
 * @package AgentWP
 */

namespace AgentWP\Context;

class EmailContextBuilder {
	const RECENT_NOTES_LIMIT     = 5;
	const DELAYED_SHIPPING_DAYS  = 3;
	const FALLBACK_SPEND_CUTOFF  = 50;

	/**
	 * Build email drafting context for a specific order.
	 *
	 * @param int $order_id Order ID.
	 * @return array
	 */

thinking
**Designing integration test setup**

I'm outlining integration tests by adding order and shipping data generators in a mu-plugin, with endpoints to seed and reset test data marked by metadata. I'll manage dependencies with a root package.json for WP env and Playwright, configure headless tests, and optionally enable live OpenAI API testing via env vars—considering some basic docs to help users run these tests smoothly.
exec
/bin/zsh -lc 'ls scripts' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 52ms:
agent_csv_runner.py
agentflow.py
audit_to_sarif.py
seed-woocommerce.php
wp-setup.sh

thinking
**Inspecting seed-woocommerce.php file**
exec
/bin/zsh -lc "sed -n '1,200p' scripts/seed-woocommerce.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 54ms:
<?php

if (!class_exists('WooCommerce')) {
    fwrite(STDERR, "WooCommerce is not active.\n");
    exit(1);
}

$targetProducts = (int) (getenv('SEED_PRODUCTS') ?: 60);
$targetOrders = (int) (getenv('SEED_ORDERS') ?: 120);

$productIds = wc_get_products([
    'limit' => -1,
    'return' => 'ids',
]);

$productCount = is_array($productIds) ? count($productIds) : 0;

for ($i = $productCount; $i < $targetProducts; $i++) {
    $product = new WC_Product_Simple();
    $product->set_name('Sample Product ' . ($i + 1));

thinking
**Designing test seeding and OpenAI VCR plugins**

I'm outlining a minimal WP mu-plugin for seeding test data via REST endpoints with permission checks, integrating it in wp-env and Playwright tests. I'm also planning a separate OpenAI VCR mu-plugin to intercept API requests for playback and recording modes by hashing requests and saving fixtures, configuring paths and environment variables carefully for container access. This will help streamline integration tests with controlled data and consistent external API responses.
exec
/bin/zsh -lc "sed -n '1,200p' agentwp.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 35ms:
<?php
/**
 * Plugin Name: AgentWP
 * Plugin URI: https://agentwp.example
 * Description: React-powered admin UI for WooCommerce automation.
 * Version: 0.1.0
 * Requires at least: 6.4
 * Requires PHP: 7.4
 * WC requires at least: 8.0
 * Author: AgentWP
 * Text Domain: agentwp
 * Domain Path: /languages
 */

if ( ! defined( 'ABSPATH' ) ) {
	exit;
}

define( 'AGENTWP_VERSION', '0.1.0' );
define( 'AGENTWP_PLUGIN_FILE', __FILE__ );

thinking
**Analyzing plugin load order and path constants**
exec
/bin/zsh -lc 'rg -n "store_draft" -n src/Handlers -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 73ms:
src/Handlers/StockHandler.php:137:		$stored     = $this->store_draft(
src/Handlers/StockHandler.php:538:	private function store_draft( $draft_id, array $draft, $ttl_seconds ) {
src/Handlers/OrderStatusHandler.php:98:		$stored     = $this->store_draft(
src/Handlers/OrderStatusHandler.php:218:		$stored     = $this->store_draft(
src/Handlers/OrderStatusHandler.php:629:	private function store_draft( $draft_id, array $draft, $ttl_seconds ) {
src/Handlers/RefundHandler.php:99:		$stored     = $this->store_draft(
src/Handlers/RefundHandler.php:427:	private function store_draft( $draft_id, array $draft, $ttl_seconds ) {
src/Handlers/EmailDraftHandler.php:112:		$stored = $this->store_draft(
src/Handlers/EmailDraftHandler.php:279:		$stored = $this->store_draft(
src/Handlers/EmailDraftHandler.php:1373:	private function store_draft( $draft_id, array $draft, $ttl_seconds ) {

thinking
**Inspecting transient key in store_draft**
exec
/bin/zsh -lc "sed -n '520,580p' src/Handlers/StockHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 54ms:
			}
		}

		if ( ! is_int( $ttl_minutes ) || $ttl_minutes <= 0 ) {
			$ttl_minutes = 10;
		}

		$minute_seconds = defined( 'MINUTE_IN_SECONDS' ) ? MINUTE_IN_SECONDS : 60;

		return $ttl_minutes * $minute_seconds;
	}

	/**
	 * @param string $draft_id Draft identifier.
	 * @param array  $draft Draft payload.
	 * @param int    $ttl_seconds Expiration seconds.
	 * @return bool
	 */
	private function store_draft( $draft_id, array $draft, $ttl_seconds ) {
		if ( ! function_exists( 'set_transient' ) ) {

thinking
**Planning test reset and seeding**

I’m outlining a full reset of test data by deleting test orders, products, and plugin options, plus clearing transients with a specific prefix via direct database queries. For seeding, I plan to create test products and orders with set quantities and use RefundHandler to simulate refunds, making sure to check stock restocking and refund confirmations along the way. This should keep tests isolated and consistent.
exec
/bin/zsh -lc "sed -n '180,320p' src/Handlers/RefundHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 56ms:
			? $payload['items_to_restock']
			: array();
		$should_restock = $this->is_full_refund( $refund_amount, $remaining ) && ! empty( $items_to_restock );

		$refund = wc_create_refund(
			array(
				'amount'         => $refund_amount,
				'reason'         => $reason,
				'order_id'       => $order_id,
				'refund_payment' => ! $requires_manual_refund,
				'restock_items'  => false,
			)
		);

		if ( is_wp_error( $refund ) ) {
			return Response::error( $refund->get_error_message(), 400 );
		}

		$refund_id = is_object( $refund ) && method_exists( $refund, 'get_id' ) ? $refund->get_id() : 0;
		$restocked = $should_restock ? $this->restock_items( $order, $items_to_restock ) : array();

thinking
**Planning test assertions**
exec
/bin/zsh -lc 'rg -n "confirm_status_update" -n src/Handlers/OrderStatusHandler.php' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 58ms:
25:			return $this->confirm_status_update( $args['draft_id'] );
248:	public function confirm_status_update( $draft_id ): Response {
exec
/bin/zsh -lc "sed -n '240,360p' src/Handlers/OrderStatusHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 55ms:
	}

	/**
	 * Confirm and apply a draft status update.
	 *
	 * @param string $draft_id Draft identifier.
	 * @return Response
	 */
	public function confirm_status_update( $draft_id ): Response {
		if ( ! function_exists( 'wc_get_order' ) || ! function_exists( 'wc_get_order_statuses' ) ) {
			return Response::error( 'WooCommerce is required to update order statuses.', 400 );
		}

		$draft_id = is_string( $draft_id ) ? trim( $draft_id ) : '';
		if ( '' === $draft_id ) {
			return Response::error( 'Missing status update draft ID.', 400 );
		}

		$draft = $this->load_draft( $draft_id );
		if ( null === $draft ) {

thinking
**Verifying response includes new_status**
exec
/bin/zsh -lc 'rg -n "confirm_stock_update" -n src/Handlers/StockHandler.php' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 62ms:
29:			return $this->confirm_stock_update( $args['draft_id'] );
167:	public function confirm_stock_update( $draft_id ): Response {
exec
/bin/zsh -lc "sed -n '160,260p' src/Handlers/StockHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 51ms:

	/**
	 * Confirm and apply a draft stock update.
	 *
	 * @param string $draft_id Draft identifier.
	 * @return Response
	 */
	public function confirm_stock_update( $draft_id ): Response {
		if ( ! function_exists( 'wc_get_product' ) || ! function_exists( 'wc_update_product_stock' ) ) {
			return Response::error( 'WooCommerce is required to update product stock.', 400 );
		}

		$draft_id = is_string( $draft_id ) ? trim( $draft_id ) : '';
		if ( '' === $draft_id ) {
			return Response::error( 'Missing stock update draft ID.', 400 );
		}

		$draft = $this->load_draft( $draft_id );
		if ( null === $draft ) {
			return Response::error( 'Stock update draft not found or expired.', 404 );

thinking
**Designing API response handling**

I’m verifying that the confirm function returns new_stock so tests can call prepare and confirm smoothly. To integrate with the API, I plan to use a mu-plugin that provides REST endpoints invoking these handlers and returning WP_REST_Response objects. I want to ensure consistent success responses by mimicking the plugin’s RestController response structure, which uses rest_ensure_response for success and data. For tests, simpler array returns could work, but mimicking the plugin format keeps things consistent and minimal. I’ll check RestController to confirm the exact response shape.
exec
/bin/zsh -lc "sed -n '1,160p' src/API/RestController.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
<?php
/**
 * Base REST controller.
 *
 * @package AgentWP
 */

namespace AgentWP\API;

use AgentWP\Error\Handler as ErrorHandler;
use AgentWP\Plugin;
use WP_Error;
use WP_REST_Controller;
use WP_REST_Response;

abstract class RestController extends WP_REST_Controller {
	const REST_NAMESPACE = 'agentwp/v1';
	const RATE_LIMIT     = 60;
	const RATE_WINDOW    = 60;
	const LOG_LIMIT      = 50;

thinking
**Designing test endpoint responses**
exec
/bin/zsh -lc "sed -n '1,200p' src/AI/Response.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
<?php
/**
 * OpenAI response wrapper.
 *
 * @package AgentWP
 */

namespace AgentWP\AI;

class Response {
	/**
	 * @var bool
	 */
	private $success;

	/**
	 * @var int
	 */
	private $status;


thinking
**Updating implementation plan**
Plan update
  ✓ Inspect existing plugin endpoints/handlers and test utilities to align integration coverage and data setup
  → Add wp-env configuration and integration test scaffolding (PHP/JS) for REST + OpenAI VCR + WooCommerce flows + intent flow
  • Add Playwright browser tests for Command Deck interactions and reset/fixtures guidance

thinking
**Outlining testing and fixture setup**

I’m mapping out a detailed plan to add configuration files, test helpers, mu-plugins, and Playwright tests, while also figuring out a solid hashing strategy for OpenAI fixture files to enable stable and efficient test recording and playback. I’m exploring fallback hashing to handle dynamic request bodies gracefully and planning fixture computations using Python or PHP scripts.
exec
/bin/zsh -lc "python - <<'PY'
import hashlib

def h(s):
    return hashlib.sha1(s.encode()).hexdigest()

print('models', h('GET|https://api.openai.com/v1/models'))
print('chat', h('POST|https://api.openai.com/v1/chat/completions'))
PY" in /Users/ahmedyounis/Documents/Projects/agentwp exited 127 in 54ms:
zsh:1: command not found: python

thinking
**Checking Python installation command**
exec
/bin/zsh -lc "python3 - <<'PY'
import hashlib

def h(s):
    return hashlib.sha1(s.encode()).hexdigest()

print('models', h('GET|https://api.openai.com/v1/models'))
print('chat', h('POST|https://api.openai.com/v1/chat/completions'))
PY" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 77ms:
models 54ba30f164b23236c55ccaab74c99d73ebfb9b05
chat f0dacf52138a5ddda002c7e93d2c931b3d8dad84

thinking
**Designing fixtures and Playwright tests**

I'll outline fixture JSON structures for API responses to support VCR recording and plan detailed Playwright tests for REST API, OpenAI integration, WooCommerce flows, and intent classification, ensuring setup steps like login and test data resets are clear to maintain consistent test states.
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/Intent.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 54ms:
<?php
/**
 * Intent categories.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

class Intent {
	const ORDER_SEARCH    = 'ORDER_SEARCH';
	const ORDER_REFUND    = 'ORDER_REFUND';
	const ORDER_STATUS    = 'ORDER_STATUS';
	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
	const UNKNOWN         = 'UNKNOWN';

	/**

thinking
**Designing integration test environment and intent flow endpoint**

I’m mapping out how to handle uppercase intent constants versus email intent strings and designing a complete intent flow endpoint. Then I plan to set up a root package.json with necessary WordPress and testing dependencies, configure `.wp-env.json` to include WooCommerce and mu-plugins, and build mu-plugins for OpenAI HTTP request recording/playback (VCR) and test utilities with REST routes for seeding, resetting, and other test actions. I’m considering handling edge cases like fixture lookup, permission checks, and test data seeding scenarios, finishing by outlining E2E Playwright tests for the command deck UI. There is a lot here, but it all fits together to create a robust test environment for the user’s WordPress agent plugin.
exec
/bin/zsh -lc "sed -n '1,160p' src/Intent/Handlers/OrderStatusHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 41ms:
<?php
/**
 * Handle order status intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class OrderStatusHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::ORDER_STATUS );
	}

	/**
	 * @param array $context Context data.
	 * @return Response

thinking
**Planning UI and asset checks**
exec
/bin/zsh -lc 'ls assets | head' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 57ms:
agentwp-admin.css
agentwp-admin.js
index.php

thinking
**Preparing integration tests update**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/package.json
{
  "name": "agentwp-integration",
  "private": true,
  "scripts": {
    "wp-env:start": "wp-env start",
    "wp-env:stop": "wp-env stop",
    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
    "test:e2e": "playwright test",
    "test:e2e:headed": "playwright test --headed",
    "test:e2e:ui": "playwright test --ui"
  },
  "devDependencies": {
    "@playwright/test": "^1.50.0",
    "@wordpress/env": "^9.0.0"
  }
}
apply_patch(auto_approved=true) exited 0 in 34ms:
Success. Updated the following files:
A package.json
file update:
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}

file update:
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}


thinking
**Adding .wp-env.json file**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/.wp-env.json
{
  "core": "WordPress/WordPress#6.4",
  "plugins": [
    ".",
    "woocommerce"
  ],
  "mappings": {
    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
  },
  "config": {
    "WP_DEBUG": true,
    "WP_DEBUG_LOG": true,
    "WP_ENVIRONMENT_TYPE": "development",
    "AGENTWP_E2E": true
  }
}
apply_patch(auto_approved=true) exited 0 in 39ms:
Success. Updated the following files:
A .wp-env.json
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}


thinking
**Creating Playwright config file**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/playwright.config.cjs
const { defineConfig } = require('@playwright/test');

const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';

module.exports = defineConfig({
  testDir: 'tests/e2e',
  timeout: 90_000,
  expect: {
    timeout: 10_000,
  },
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  use: {
    baseURL,
    headless: true,
    screenshot: 'only-on-failure',
    video: 'retain-on-failure',
  },
});
apply_patch(auto_approved=true) exited 0 in 47ms:
Success. Updated the following files:
A playwright.config.cjs
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});


thinking
**Creating WordPress mu-plugin for VCR**

I'm putting together a minimal WordPress mu-plugin to handle VCR-style HTTP request recording and playback for AgentWP integration tests. I’m defining helper functions for mode detection, fixture directory, body normalization, hashing, fixture loading, and response formatting, plus filters to intercept HTTP requests and responses—this will let tests replay or record API calls as JSON fixtures neatly. I'll do this carefully to keep the plugin compact and integrate with WordPress filters properly.
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
<?php
/**
 * OpenAI VCR for AgentWP integration tests.
 */

if ( ! defined( 'ABSPATH' ) ) {
	return;
}

if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
	return;
}

function agentwp_openai_vcr_mode() {
	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';

	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
		$mode = 'playback';
	}

	return $mode;
}

function agentwp_openai_vcr_fixture_dir() {
	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
	$dir = is_string( $dir ) ? trim( $dir ) : '';

	if ( '' !== $dir ) {
		return rtrim( $dir, '/' );
	}

	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
}

function agentwp_openai_vcr_should_capture( $url ) {
	if ( ! is_string( $url ) ) {
		return false;
	}

	return false !== strpos( $url, 'api.openai.com/v1' );
}

function agentwp_openai_vcr_normalize_body( $body ) {
	if ( is_array( $body ) ) {
		return wp_json_encode( $body );
	}

	if ( is_string( $body ) ) {
		return $body;
	}

	return '';
}

function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
	$url    = is_string( $url ) ? $url : '';
	$body   = is_string( $body ) ? $body : '';

	return sha1( $method . '|' . $url . '|' . $body );
}

function agentwp_openai_vcr_hash_url( $method, $url ) {
	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
	$url    = is_string( $url ) ? $url : '';

	return sha1( $method . '|' . $url );
}

function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
	$dir = agentwp_openai_vcr_fixture_dir();
	if ( ! is_dir( $dir ) ) {
		return null;
	}

	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
	$body_path = $dir . '/' . $body_hash . '.json';
	if ( file_exists( $body_path ) ) {
		$contents = file_get_contents( $body_path );
		return is_string( $contents ) ? json_decode( $contents, true ) : null;
	}

	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
	$url_path = $dir . '/' . $url_hash . '.json';
	if ( file_exists( $url_path ) ) {
		$contents = file_get_contents( $url_path );
		return is_string( $contents ) ? json_decode( $contents, true ) : null;
	}

	return null;
}

function agentwp_openai_vcr_build_response( array $fixture ) {
	return array(
		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
		'response' => array(
			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
		),
		'cookies'  => array(),
		'filename' => null,
	);
}

add_filter(
	'pre_http_request',
	function ( $preempt, $args, $url ) {
		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
			return $preempt;
		}

		$mode = agentwp_openai_vcr_mode();
		if ( 'live' === $mode || 'record' === $mode ) {
			return $preempt;
		}

		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );

		if ( null === $fixture ) {
			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
		}

		return agentwp_openai_vcr_build_response( $fixture );
	},
	10,
	3
);

add_filter(
	'http_response',
	function ( $response, $args, $url ) {
		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
			return $response;
		}

		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
		$dir    = agentwp_openai_vcr_fixture_dir();

		if ( ! is_dir( $dir ) ) {
			wp_mkdir_p( $dir );
		}

		$fixture = array(
			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
			'body'    => isset( $response['body'] ) ? $response['body'] : '',
		);

		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );

		return $response;
	},
	10,
	3
);
apply_patch(auto_approved=true) exited 0 in 51ms:
Success. Updated the following files:
A tests/wp-env/mu-plugins/agentwp-openai-vcr.php
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);


thinking
**Designing test utility plugin and endpoints**

I'm mapping out a test mu-plugin with helpers for seeding products, orders, and refunds, plus clearing test data and transients. I’m also planning REST endpoints to handle refunds, email drafts, and intent flows, carefully checking WooCommerce availability and structuring consistent API responses. Let’s build robust test tools that gracefully handle missing dependencies while supporting the needed test workflows.
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/tests/wp-env/mu-plugins/agentwp-test-tools.php
<?php
/**
 * AgentWP test helpers for wp-env integration tests.
 */

use AgentWP\AI\Response;
use AgentWP\Handlers\EmailDraftHandler;
use AgentWP\Handlers\OrderStatusHandler;
use AgentWP\Handlers\RefundHandler;
use AgentWP\Handlers\StockHandler;
use AgentWP\Intent\Engine;
use AgentWP\Intent\Intent;

if ( ! defined( 'ABSPATH' ) ) {
	return;
}

if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
	return;
}

const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';

function agentwp_test_permissions() {
	if ( current_user_can( 'manage_woocommerce' ) ) {
		return true;
	}

	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
}

function agentwp_test_response_from_ai( $result ) {
	if ( ! $result instanceof Response ) {
		$response = rest_ensure_response(
			array(
				'success' => false,
				'data'    => array(),
				'error'   => array(
					'message' => 'Invalid AgentWP test response.',
				),
			)
		);
		$response->set_status( 500 );
		return $response;
	}

	if ( $result->is_success() ) {
		$response = rest_ensure_response(
			array(
				'success' => true,
				'data'    => $result->get_data(),
				'meta'    => $result->get_meta(),
			)
		);
		$response->set_status( $result->get_status() );
		return $response;
	}

	$response = rest_ensure_response(
		array(
			'success' => false,
			'data'    => array(),
			'error'   => array(
				'message' => $result->get_message(),
				'meta'    => $result->get_meta(),
			),
		)
	);
	$response->set_status( $result->get_status() );

	return $response;
}

function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
	if ( ! class_exists( 'WC_Product_Simple' ) ) {
		return 0;
	}

	$product = new WC_Product_Simple();
	$product->set_name( $name );
	$product->set_regular_price( (string) $price );
	$product->set_status( 'publish' );
	$product->set_catalog_visibility( 'visible' );
	$product->set_manage_stock( true );
	$product->set_stock_quantity( $stock );
	$product->set_sku( $sku );
	$product->save();

	$product_id = $product->get_id();
	if ( $product_id ) {
		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
	}

	return $product_id;
}

function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
		return 0;
	}

	$product = wc_get_product( $product_id );
	if ( ! $product ) {
		return 0;
	}

	$order = wc_create_order();
	$order->add_product( $product, $quantity );
	$order->set_address( $address, 'billing' );
	$order->set_address( $address, 'shipping' );
	$order->set_status( $status );
	$order->calculate_totals();
	$order->save();

	$order_id = $order->get_id();
	if ( $order_id ) {
		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
	}

	return $order_id;
}

function agentwp_test_seed_default() {
	if ( ! class_exists( 'WooCommerce' ) ) {
		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
	}

	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );

	$address = array(
		'first_name' => 'Test',
		'last_name'  => 'Customer',
		'email'      => 'test.customer@example.com',
		'phone'      => '555-0100',
		'address_1'  => '100 Market St',
		'city'       => 'San Francisco',
		'state'      => 'CA',
		'postcode'   => '94105',
		'country'    => 'US',
	);

	$order_id = agentwp_test_seed_order( $product_id, 2, $address );

	return array(
		'product_id'    => $product_id,
		'order_id'      => $order_id,
		'stock_quantity' => 10,
	);
}

function agentwp_test_seed_huge_order() {
	if ( ! class_exists( 'WooCommerce' ) ) {
		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
	}

	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );

	$address = array(
		'first_name' => 'Big',
		'last_name'  => 'Buyer',
		'email'      => 'big.buyer@example.com',
		'phone'      => '555-0199',
		'address_1'  => '500 Commerce Way',
		'city'       => 'Austin',
		'state'      => 'TX',
		'postcode'   => '73301',
		'country'    => 'US',
	);

	$order_id = agentwp_test_seed_order( $product_id, 200, $address );

	return array(
		'product_id'    => $product_id,
		'order_id'      => $order_id,
		'stock_quantity' => 500,
	);
}

function agentwp_test_reset() {
	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
	$posts      = get_posts(
		array(
			'post_type'      => $post_types,
			'posts_per_page' => -1,
			'fields'         => 'ids',
			'meta_key'       => AGENTWP_TEST_META_KEY,
		)
	);

	foreach ( $posts as $post_id ) {
		wp_delete_post( $post_id, true );
	}

	$refunds = get_posts(
		array(
			'post_type'      => 'shop_order_refund',
			'posts_per_page' => -1,
			'fields'         => 'ids',
		)
	);

	foreach ( $refunds as $refund_id ) {
		wp_delete_post( $refund_id, true );
	}

	$options = array(
		'agentwp_settings',
		'agentwp_api_key',
		'agentwp_api_key_last4',
		'agentwp_budget_limit',
		'agentwp_draft_ttl_minutes',
		'agentwp_usage_stats',
	);

	foreach ( $options as $option ) {
		delete_option( $option );
	}

	global $wpdb;
	if ( $wpdb ) {
		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );

		$usage_table  = $wpdb->prefix . 'agentwp_usage';
		$search_table = $wpdb->prefix . 'agentwp_search_index';

		$tables = $wpdb->get_col( 'SHOW TABLES' );
		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
		}
		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
		}
	}

	return array(
		'reset' => true,
	);
}

function agentwp_test_seed( WP_REST_Request $request ) {
	$payload  = $request->get_json_params();
	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';

	if ( 'huge' === $scenario ) {
		$result = agentwp_test_seed_huge_order();
	} else {
		$result = agentwp_test_seed_default();
	}

	if ( is_wp_error( $result ) ) {
		return $result;
	}

	return rest_ensure_response(
		array(
			'success' => true,
			'data'    => array_merge(
				$result,
				array(
					'scenario' => $scenario,
				)
			),
		)
	);
}

function agentwp_test_refund( WP_REST_Request $request ) {
	$payload = $request->get_json_params();
	$payload = is_array( $payload ) ? $payload : array();

	if ( ! class_exists( RefundHandler::class ) ) {
		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
	}

	$handler = new RefundHandler();
	$result  = $handler->handle( $payload );

	return agentwp_test_response_from_ai( $result );
}

function agentwp_test_status_update( WP_REST_Request $request ) {
	$payload = $request->get_json_params();
	$payload = is_array( $payload ) ? $payload : array();

	if ( ! class_exists( OrderStatusHandler::class ) ) {
		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
	}

	$handler = new OrderStatusHandler();
	$result  = $handler->handle( $payload );

	return agentwp_test_response_from_ai( $result );
}

function agentwp_test_stock_update( WP_REST_Request $request ) {
	$payload = $request->get_json_params();
	$payload = is_array( $payload ) ? $payload : array();

	if ( ! class_exists( StockHandler::class ) ) {
		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
	}

	$handler = new StockHandler();
	$result  = $handler->handle( $payload );

	return agentwp_test_response_from_ai( $result );
}

function agentwp_test_email_draft( WP_REST_Request $request ) {
	$payload = $request->get_json_params();
	$payload = is_array( $payload ) ? $payload : array();

	if ( ! class_exists( EmailDraftHandler::class ) ) {
		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
	}

	$handler = new EmailDraftHandler();
	$result  = $handler->handle( $payload );

	return agentwp_test_response_from_ai( $result );
}

function agentwp_test_intent_flow( WP_REST_Request $request ) {
	$payload = $request->get_json_params();
	$payload = is_array( $payload ) ? $payload : array();

	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';

	if ( '' === $prompt ) {
		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
	}

	if ( $order_id <= 0 ) {
		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
	}

	$engine = new Engine();
	$engine_result = $engine->handle( $prompt, array() );
	if ( ! $engine_result->is_success() ) {
		return agentwp_test_response_from_ai( $engine_result );
	}

	$engine_data   = $engine_result->get_data();
	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';

	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
	}

	if ( ! class_exists( EmailDraftHandler::class ) ) {
		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
	}

	$handler = new EmailDraftHandler();
	$draft_result = $handler->draft_email(
		array(
			'order_id' => $order_id,
			'intent'   => $email_intent,
			'tone'     => $tone,
		)
	);

	if ( ! $draft_result->is_success() ) {
		return agentwp_test_response_from_ai( $draft_result );
	}

	return rest_ensure_response(
		array(
			'success' => true,
			'data'    => array(
				'engine' => $engine_data,
				'draft'  => $draft_result->get_data(),
			),
		)
	);
}

add_action(
	'rest_api_init',
	function () {
		register_rest_route(
			'agentwp-test/v1',
			'/reset',
			array(
				'methods'             => 'POST',
				'callback'            => 'agentwp_test_reset',
				'permission_callback' => 'agentwp_test_permissions',
			)
		);

		register_rest_route(
			'agentwp-test/v1',
			'/seed',
			array(
				'methods'             => 'POST',
				'callback'            => 'agentwp_test_seed',
				'permission_callback' => 'agentwp_test_permissions',
			)
		);

		register_rest_route(
			'agentwp-test/v1',
			'/refund',
			array(
				'methods'             => 'POST',
				'callback'            => 'agentwp_test_refund',
				'permission_callback' => 'agentwp_test_permissions',
			)
		);

		register_rest_route(
			'agentwp-test/v1',
			'/status',
			array(
				'methods'             => 'POST',
				'callback'            => 'agentwp_test_status_update',
				'permission_callback' => 'agentwp_test_permissions',
			)
		);

		register_rest_route(
			'agentwp-test/v1',
			'/stock',
			array(
				'methods'             => 'POST',
				'callback'            => 'agentwp_test_stock_update',
				'permission_callback' => 'agentwp_test_permissions',
			)
		);

		register_rest_route(
			'agentwp-test/v1',
			'/email-draft',
			array(
				'methods'             => 'POST',
				'callback'            => 'agentwp_test_email_draft',
				'permission_callback' => 'agentwp_test_permissions',
			)
		);

		register_rest_route(
			'agentwp-test/v1',
			'/intent-flow',
			array(
				'methods'             => 'POST',
				'callback'            => 'agentwp_test_intent_flow',
				'permission_callback' => 'agentwp_test_permissions',
			)
		);
	}
);
apply_patch(auto_approved=true) exited 0 in 63ms:
Success. Updated the following files:
A tests/wp-env/mu-plugins/agentwp-test-tools.php
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Creating OpenAI test fixtures**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
{
  "status": 200,
  "headers": {
    "content-type": "application/json"
  },
  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
}
apply_patch(auto_approved=true) exited 0 in 67ms:
Success. Updated the following files:
A tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Adding chat fixture**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
{
  "status": 200,
  "headers": {
    "content-type": "application/json"
  },
  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
}
apply_patch(auto_approved=true) exited 0 in 61ms:
Success. Updated the following files:
A tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Drafting e2e helper utilities and tests**
exec
/bin/zsh -lc "sed -n '1,200p' src/Search/Index.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 54ms:
<?php
/**
 * Search index management.
 *
 * @package AgentWP
 */

namespace AgentWP\Search;

class Index {
	const TABLE           = 'agentwp_search_index';
	const VERSION         = '1.0';
	const VERSION_OPTION  = 'agentwp_search_index_version';
	const STATE_OPTION    = 'agentwp_search_index_state';
	const DEFAULT_LIMIT   = 5;
	const BACKFILL_LIMIT  = 200;
	const BACKFILL_WINDOW = 0.35;

	/**
	 * Register hooks.
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Investigating type normalization**
exec
/bin/zsh -lc 'rg -n "normalize_types" -n src/Search/Index.php' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 54ms:
97:		$types  = self::normalize_types( $types );
600:	private static function normalize_types( array $types ) {
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);

exec
/bin/zsh -lc "sed -n '600,680p' src/Search/Index.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 55ms:
	private static function normalize_types( array $types ) {
		$allowed = array( 'products', 'orders', 'customers' );
		$types   = array_map( 'sanitize_text_field', $types );
		$types   = array_filter( $types );
		$types   = array_values( array_intersect( $types, $allowed ) );

		if ( empty( $types ) ) {
			return $allowed;
		}

		return $types;
	}

	/**
	 * Normalize text for searching.
	 *
	 * @param string $text Raw text.
	 * @return string
	 */
	private static function normalize_text( $text ) {
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Setting expectations for result keys**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/tests/e2e/helpers/wp.js
const { expect } = require('@playwright/test');

const WP_USERNAME = process.env.WP_USERNAME || 'admin';
const WP_PASSWORD = process.env.WP_PASSWORD || 'password';

async function login(page) {
  await page.goto('/wp-login.php');
  await page.fill('#user_login', WP_USERNAME);
  await page.fill('#user_pass', WP_PASSWORD);
  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
}

async function apiGet(page, path) {
  const response = await page.request.get(path);
  const json = await response.json().catch(() => null);
  return { response, json };
}

async function apiPost(page, path, data) {
  const response = await page.request.post(path, { data });
  const json = await response.json().catch(() => null);
  return { response, json };
}

async function resetTestData(page) {
  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
  expect(response.ok()).toBeTruthy();
  expect(json?.success).toBeTruthy();
}

async function seedTestData(page, scenario = 'default') {
  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
  expect(response.ok()).toBeTruthy();
  expect(json?.success).toBeTruthy();
  return json.data;
}

async function setApiKey(page, apiKey) {
  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
    api_key: apiKey,
  });
  return { response, json };
}

module.exports = {
  apiGet,
  apiPost,
  login,
  resetTestData,
  seedTestData,
  setApiKey,
};
apply_patch(auto_approved=true) exited 0 in 97ms:
Success. Updated the following files:
A tests/e2e/helpers/wp.js
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Crafting API endpoint tests**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/tests/e2e/rest-api.spec.js
const { test, expect } = require('@playwright/test');
const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');

test.beforeEach(async ({ page }) => {
  await login(page);
  await resetTestData(page);
});

test('settings endpoint returns defaults', async ({ page }) => {
  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');

  expect(response.ok()).toBeTruthy();
  expect(json?.success).toBeTruthy();
  expect(json?.data?.settings).toBeTruthy();
});

test('intent rejects empty prompt', async ({ page }) => {
  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });

  expect(response.status()).toBe(400);
  expect(json?.success).toBeFalsy();
  expect(json?.error?.code).toBe('agentwp_missing_prompt');
});

test('search returns empty results on empty store', async ({ page }) => {
  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');

  expect(response.ok()).toBeTruthy();
  expect(json?.success).toBeTruthy();
  const results = json?.data?.results || {};
  expect(Array.isArray(results.products)).toBeTruthy();
  expect(Array.isArray(results.orders)).toBeTruthy();
  expect(Array.isArray(results.customers)).toBeTruthy();
  expect(results.products).toHaveLength(0);
  expect(results.orders).toHaveLength(0);
  expect(results.customers).toHaveLength(0);
});
apply_patch(auto_approved=true) exited 0 in 100ms:
Success. Updated the following files:
A tests/e2e/rest-api.spec.js
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Creating OpenAI integration tests**

I’m planning to add end-to-end tests for the OpenAI API key validation and the email draft feature, ensuring they use recorded VCR responses for reliability. I'll write tests that log in, reset state, and seed data before each run, calling `setApiKey` and verifying email drafts include expected content, carefully organizing setup to keep each test self-contained and clear.
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/tests/e2e/openai.spec.js
const { test, expect } = require('@playwright/test');
const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');

const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';

test.beforeEach(async ({ page }) => {
  await login(page);
  await resetTestData(page);
});

test('stores API key using OpenAI validation', async ({ page }) => {
  const { response, json } = await setApiKey(page, TEST_API_KEY);

  expect(response.ok()).toBeTruthy();
  expect(json?.success).toBeTruthy();
  expect(json?.data?.stored).toBeTruthy();
  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
});

test('drafts email using recorded OpenAI response', async ({ page }) => {
  const seed = await seedTestData(page, 'default');
  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);

  expect(keyResponse.ok()).toBeTruthy();

  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
    order_id: seed.order_id,
    intent: 'shipping_update',
    tone: 'friendly',
  });

  expect(response.ok()).toBeTruthy();
  expect(json?.success).toBeTruthy();
  expect(json?.data?.email_body).toContain('order is on the way');
  expect(json?.data?.subject_line).toBeTruthy();
});
apply_patch(auto_approved=true) exited 0 in 91ms:
Success. Updated the following files:
A tests/e2e/openai.spec.js
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Creating intent-flow end-to-end test**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/tests/e2e/intent-flow.spec.js
const { test, expect } = require('@playwright/test');
const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');

const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';

test.beforeEach(async ({ page }) => {
  await login(page);
  await resetTestData(page);
});

test('intent flow runs from prompt to draft', async ({ page }) => {
  const seed = await seedTestData(page, 'default');
  await setApiKey(page, TEST_API_KEY);

  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
    prompt: 'Please draft a shipping update email.',
    order_id: seed.order_id,
    tone: 'friendly',
    email_intent: 'shipping_update',
  });

  expect(response.ok()).toBeTruthy();
  expect(json?.success).toBeTruthy();
  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
  expect(json?.data?.draft?.email_body).toContain('order is on the way');
});
apply_patch(auto_approved=true) exited 0 in 91ms:
Success. Updated the following files:
A tests/e2e/intent-flow.spec.js
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Designing WooCommerce E2E tests**

I’m outlining end-to-end tests for WooCommerce refund, status updates, stock changes, and edge cases like huge orders. Each test will log in, reset, and seed data as needed, verifying responses and error conditions carefully to cover normal and partial refunds, restock logic, and invalid operations. I’m planning separate tests for refund flows, status changes, stock operations, huge orders, and expected failures to ensure consistency and robustness.
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/tests/e2e/woocommerce.spec.js
const { test, expect } = require('@playwright/test');
const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');

test.beforeEach(async ({ page }) => {
  await login(page);
  await resetTestData(page);
});

test('refund flow prepares and confirms with restock', async ({ page }) => {
  const seed = await seedTestData(page, 'default');

  const { response: prepareResponse, json: prepareJson } = await apiPost(
    page,
    '/wp-json/agentwp-test/v1/refund',
    {
      order_id: seed.order_id,
      restock_items: true,
    }
  );

  expect(prepareResponse.ok()).toBeTruthy();
  expect(prepareJson?.success).toBeTruthy();
  expect(prepareJson?.data?.draft_id).toBeTruthy();

  const { response: confirmResponse, json: confirmJson } = await apiPost(
    page,
    '/wp-json/agentwp-test/v1/refund',
    {
      draft_id: prepareJson.data.draft_id,
    }
  );

  expect(confirmResponse.ok()).toBeTruthy();
  expect(confirmJson?.success).toBeTruthy();
  expect(confirmJson?.data?.confirmed).toBeTruthy();
  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
});

test('status update flow prepares and confirms', async ({ page }) => {
  const seed = await seedTestData(page, 'default');

  const { response: prepareResponse, json: prepareJson } = await apiPost(
    page,
    '/wp-json/agentwp-test/v1/status',
    {
      order_id: seed.order_id,
      new_status: 'completed',
      notify_customer: false,
    }
  );

  expect(prepareResponse.ok()).toBeTruthy();
  expect(prepareJson?.success).toBeTruthy();
  expect(prepareJson?.data?.draft_id).toBeTruthy();

  const { response: confirmResponse, json: confirmJson } = await apiPost(
    page,
    '/wp-json/agentwp-test/v1/status',
    {
      draft_id: prepareJson.data.draft_id,
    }
  );

  expect(confirmResponse.ok()).toBeTruthy();
  expect(confirmJson?.success).toBeTruthy();
  expect(confirmJson?.data?.new_status).toBe('completed');
});

test('stock update flow prepares and confirms', async ({ page }) => {
  const seed = await seedTestData(page, 'default');

  const { response: prepareResponse, json: prepareJson } = await apiPost(
    page,
    '/wp-json/agentwp-test/v1/stock',
    {
      product_id: seed.product_id,
      operation: 'decrease',
      quantity: 1,
    }
  );

  expect(prepareResponse.ok()).toBeTruthy();
  expect(prepareJson?.success).toBeTruthy();
  expect(prepareJson?.data?.draft_id).toBeTruthy();

  const { response: confirmResponse, json: confirmJson } = await apiPost(
    page,
    '/wp-json/agentwp-test/v1/stock',
    {
      draft_id: prepareJson.data.draft_id,
    }
  );

  expect(confirmResponse.ok()).toBeTruthy();
  expect(confirmJson?.success).toBeTruthy();
  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
});

test('stock update rejects missing operation', async ({ page }) => {
  const seed = await seedTestData(page, 'default');

  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
    product_id: seed.product_id,
    quantity: 2,
  });

  expect(response.ok()).toBeFalsy();
  expect(json?.success).toBeFalsy();
});

test('refund handles huge order totals', async ({ page }) => {
  const seed = await seedTestData(page, 'huge');

  const { response: prepareResponse, json: prepareJson } = await apiPost(
    page,
    '/wp-json/agentwp-test/v1/refund',
    {
      order_id: seed.order_id,
    }
  );

  expect(prepareResponse.ok()).toBeTruthy();
  expect(prepareJson?.success).toBeTruthy();
  expect(prepareJson?.data?.draft_id).toBeTruthy();
});
apply_patch(auto_approved=true) exited 0 in 100ms:
Success. Updated the following files:
A tests/e2e/woocommerce.spec.js
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Drafting Playwright test plan**
exec
/bin/zsh -lc "sed -n '1,120p' react/src/main.jsx" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 52ms:
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App.jsx';
import ErrorBoundary from '../components/ErrorBoundary.jsx';
import styles from './index.css?inline';
import { applyTheme, getInitialThemePreference, getSystemTheme, resolveTheme } from './theme.js';

const getHostElement = () => {
  if (typeof document === 'undefined') {
    return null;
  }
  return document.getElementById('agentwp-root') || document.getElementById('root');
};

const ensureShadowNode = (shadowRoot, selector, createNode) => {
  const existing = shadowRoot.querySelector(selector);
  if (existing) {
    return existing;
  }
  const node = createNode();
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Analyzing shadow DOM usage and selectors**
exec
/bin/zsh -lc 'rg -n "agentwp-admin-root|agentwp-root" assets/agentwp-admin.js' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 61ms:
815:		var root = document.getElementById('agentwp-admin-root');
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Investigating built JS entry points**
exec
/bin/zsh -lc "sed -n '780,860p' assets/agentwp-admin.js" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 46ms:
					{ className: 'agentwp-settings__full' },
					el(CardHeader, null, el('h2', null, __('Export / Import', 'agentwp'))),
					el(
						CardBody,
						null,
						el(
							Flex,
							{ className: 'agentwp-settings__import-export' },
							el(
								FlexItem,
								null,
								el(Button, { isSecondary: true, onClick: handleExport }, __('Export Settings', 'agentwp'))
							),
							el(
								FlexItem,
								null,
								el(FormFileUpload, {
									accept: 'application/json',
									onChange: handleImport,
									isSecondary: true,
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Analyzing React app and asset relationships**
exec
/bin/zsh -lc 'rg -n "Command Deck|command" assets/agentwp-admin.js' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 33ms:
649:							label: __('Command Deck Hotkey', 'agentwp'),
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Investigating command deck implementation**
exec
/bin/zsh -lc 'rg -n "agentwp-command-deck" assets/agentwp-admin.js' in /Users/ahmedyounis/Documents/Projects/agentwp exited 1 in 32ms:

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Investigating command deck integration**
exec
/bin/zsh -lc 'rg -n "agentwp-app|agentwp-markdown|agentwp-command" assets/agentwp-admin.js' in /Users/ahmedyounis/Documents/Projects/agentwp exited 1 in 52ms:

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Assessing Command Deck assets and testing options**

I'm figuring out that the Command Deck React app isn't built into the plugin assets, which complicates testing it inside the WordPress environment. Since the spec demands browser tests for Command Deck interaction within WordPress, I’m considering whether to target the React app standalone via Vite dev server or find a way to integrate it into the wp-env. I’ll explore if plugin assets include command deck-related styles or scripts and think about adding a test harness page if needed to run proper integration tests.
exec
/bin/zsh -lc 'rg -n "agentwp-app" assets/agentwp-admin.css' in /Users/ahmedyounis/Documents/Projects/agentwp exited 1 in 37ms:

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Investigating command deck integration**
exec
/bin/zsh -lc 'rg -n "command deck|command" src -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 37ms:
src/API/HistoryController.php:13:	const HISTORY_META_KEY   = 'agentwp_command_history';
src/API/HistoryController.php:14:	const FAVORITES_META_KEY = 'agentwp_command_favorites';
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Analyzing Command Deck test setup**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/tests/e2e/command-deck.spec.js
const { test, expect } = require('@playwright/test');
const { login, resetTestData } = require('./helpers/wp');

test.beforeEach(async ({ page }) => {
  await login(page);
  await resetTestData(page);
});

test('command deck opens and submits a prompt', async ({ page }) => {
  await page.goto('/wp-admin/admin.php?page=agentwp');

  const openButton = page.getByRole('button', { name: 'Open Command Deck' });
  await expect(openButton).toBeVisible();
  await openButton.click();

  const promptInput = page.locator('#agentwp-prompt');
  await expect(promptInput).toBeVisible();
  await promptInput.fill('Check order status for a customer');
  await promptInput.press('Enter');

  const response = page.locator('.agentwp-markdown');
  await expect(response).toContainText('order status');
});
apply_patch(auto_approved=true) exited 0 in 131ms:
Success. Updated the following files:
A tests/e2e/command-deck.spec.js
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/command-deck.spec.js b/tests/e2e/command-deck.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..a58d912d6c7e5139d9f62b449ca0f141f3e0a896
--- /dev/null
+++ b/tests/e2e/command-deck.spec.js
@@ -0,0 +1,23 @@
+const { test, expect } = require('@playwright/test');
+const { login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('command deck opens and submits a prompt', async ({ page }) => {
+  await page.goto('/wp-admin/admin.php?page=agentwp');
+
+  const openButton = page.getByRole('button', { name: 'Open Command Deck' });
+  await expect(openButton).toBeVisible();
+  await openButton.click();
+
+  const promptInput = page.locator('#agentwp-prompt');
+  await expect(promptInput).toBeVisible();
+  await promptInput.fill('Check order status for a customer');
+  await promptInput.press('Enter');
+
+  const response = page.locator('.agentwp-markdown');
+  await expect(response).toContainText('order status');
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/command-deck.spec.js b/tests/e2e/command-deck.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..a58d912d6c7e5139d9f62b449ca0f141f3e0a896
--- /dev/null
+++ b/tests/e2e/command-deck.spec.js
@@ -0,0 +1,23 @@
+const { test, expect } = require('@playwright/test');
+const { login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('command deck opens and submits a prompt', async ({ page }) => {
+  await page.goto('/wp-admin/admin.php?page=agentwp');
+
+  const openButton = page.getByRole('button', { name: 'Open Command Deck' });
+  await expect(openButton).toBeVisible();
+  await openButton.click();
+
+  const promptInput = page.locator('#agentwp-prompt');
+  await expect(promptInput).toBeVisible();
+  await promptInput.fill('Check order status for a customer');
+  await promptInput.press('Enter');
+
+  const response = page.locator('.agentwp-markdown');
+  await expect(response).toContainText('order status');
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Drafting integration test docs**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/docs/integration-tests.md
# Integration tests

## Setup
- `npm install`
- `npm run wp-env:start`

Optional reset if the database gets dirty:
- `npm run wp-env:reset`

## Run
- `npm run test:e2e`

## Environment variables
- `AGENTWP_BASE_URL` (default `http://localhost:8888`)
- `WP_USERNAME` / `WP_PASSWORD` (default `admin` / `password`)
- `AGENTWP_OPENAI_MODE` (`playback` default, or `record`, or `live`)
- `AGENTWP_OPENAI_API_KEY` (required for `live` or `record`)
- `AGENTWP_OPENAI_FIXTURES` (defaults to `wp-content/plugins/agentwp/tests/fixtures/openai`)

## Notes
- The wp-env config loads test-only endpoints under `/wp-json/agentwp-test/v1`.
- VCR fixtures are keyed by request method + URL. Record mode writes new fixtures into the fixtures directory.
apply_patch(auto_approved=true) exited 0 in 110ms:
Success. Updated the following files:
A docs/integration-tests.md
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/docs/integration-tests.md b/docs/integration-tests.md
new file mode 100644
index 0000000000000000000000000000000000000000..6def3e314f2f6258b47225b2a824ff6e97bc7e54
--- /dev/null
+++ b/docs/integration-tests.md
@@ -0,0 +1,22 @@
+# Integration tests
+
+## Setup
+- `npm install`
+- `npm run wp-env:start`
+
+Optional reset if the database gets dirty:
+- `npm run wp-env:reset`
+
+## Run
+- `npm run test:e2e`
+
+## Environment variables
+- `AGENTWP_BASE_URL` (default `http://localhost:8888`)
+- `WP_USERNAME` / `WP_PASSWORD` (default `admin` / `password`)
+- `AGENTWP_OPENAI_MODE` (`playback` default, or `record`, or `live`)
+- `AGENTWP_OPENAI_API_KEY` (required for `live` or `record`)
+- `AGENTWP_OPENAI_FIXTURES` (defaults to `wp-content/plugins/agentwp/tests/fixtures/openai`)
+
+## Notes
+- The wp-env config loads test-only endpoints under `/wp-json/agentwp-test/v1`.
+- VCR fixtures are keyed by request method + URL. Record mode writes new fixtures into the fixtures directory.
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/command-deck.spec.js b/tests/e2e/command-deck.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..a58d912d6c7e5139d9f62b449ca0f141f3e0a896
--- /dev/null
+++ b/tests/e2e/command-deck.spec.js
@@ -0,0 +1,23 @@
+const { test, expect } = require('@playwright/test');
+const { login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('command deck opens and submits a prompt', async ({ page }) => {
+  await page.goto('/wp-admin/admin.php?page=agentwp');
+
+  const openButton = page.getByRole('button', { name: 'Open Command Deck' });
+  await expect(openButton).toBeVisible();
+  await openButton.click();
+
+  const promptInput = page.locator('#agentwp-prompt');
+  await expect(promptInput).toBeVisible();
+  await promptInput.fill('Check order status for a customer');
+  await promptInput.press('Enter');
+
+  const response = page.locator('.agentwp-markdown');
+  await expect(response).toContainText('order status');
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);

file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/docs/integration-tests.md b/docs/integration-tests.md
new file mode 100644
index 0000000000000000000000000000000000000000..6def3e314f2f6258b47225b2a824ff6e97bc7e54
--- /dev/null
+++ b/docs/integration-tests.md
@@ -0,0 +1,22 @@
+# Integration tests
+
+## Setup
+- `npm install`
+- `npm run wp-env:start`
+
+Optional reset if the database gets dirty:
+- `npm run wp-env:reset`
+
+## Run
+- `npm run test:e2e`
+
+## Environment variables
+- `AGENTWP_BASE_URL` (default `http://localhost:8888`)
+- `WP_USERNAME` / `WP_PASSWORD` (default `admin` / `password`)
+- `AGENTWP_OPENAI_MODE` (`playback` default, or `record`, or `live`)
+- `AGENTWP_OPENAI_API_KEY` (required for `live` or `record`)
+- `AGENTWP_OPENAI_FIXTURES` (defaults to `wp-content/plugins/agentwp/tests/fixtures/openai`)
+
+## Notes
+- The wp-env config loads test-only endpoints under `/wp-json/agentwp-test/v1`.
+- VCR fixtures are keyed by request method + URL. Record mode writes new fixtures into the fixtures directory.
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/command-deck.spec.js b/tests/e2e/command-deck.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..a58d912d6c7e5139d9f62b449ca0f141f3e0a896
--- /dev/null
+++ b/tests/e2e/command-deck.spec.js
@@ -0,0 +1,23 @@
+const { test, expect } = require('@playwright/test');
+const { login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('command deck opens and submits a prompt', async ({ page }) => {
+  await page.goto('/wp-admin/admin.php?page=agentwp');
+
+  const openButton = page.getByRole('button', { name: 'Open Command Deck' });
+  await expect(openButton).toBeVisible();
+  await openButton.click();
+
+  const promptInput = page.locator('#agentwp-prompt');
+  await expect(promptInput).toBeVisible();
+  await promptInput.fill('Check order status for a customer');
+  await promptInput.press('Enter');
+
+  const response = page.locator('.agentwp-markdown');
+  await expect(response).toContainText('order status');
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Updating plan steps**
Plan update
  ✓ Inspect existing plugin endpoints/handlers and test utilities to align integration coverage and data setup
  ✓ Add wp-env configuration and integration test scaffolding (PHP/JS) for REST + OpenAI VCR + WooCommerce flows + intent flow
  ✓ Add Playwright browser tests for Command Deck interactions and reset/fixtures guidance
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/docs/integration-tests.md b/docs/integration-tests.md
new file mode 100644
index 0000000000000000000000000000000000000000..6def3e314f2f6258b47225b2a824ff6e97bc7e54
--- /dev/null
+++ b/docs/integration-tests.md
@@ -0,0 +1,22 @@
+# Integration tests
+
+## Setup
+- `npm install`
+- `npm run wp-env:start`
+
+Optional reset if the database gets dirty:
+- `npm run wp-env:reset`
+
+## Run
+- `npm run test:e2e`
+
+## Environment variables
+- `AGENTWP_BASE_URL` (default `http://localhost:8888`)
+- `WP_USERNAME` / `WP_PASSWORD` (default `admin` / `password`)
+- `AGENTWP_OPENAI_MODE` (`playback` default, or `record`, or `live`)
+- `AGENTWP_OPENAI_API_KEY` (required for `live` or `record`)
+- `AGENTWP_OPENAI_FIXTURES` (defaults to `wp-content/plugins/agentwp/tests/fixtures/openai`)
+
+## Notes
+- The wp-env config loads test-only endpoints under `/wp-json/agentwp-test/v1`.
+- VCR fixtures are keyed by request method + URL. Record mode writes new fixtures into the fixtures directory.
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/command-deck.spec.js b/tests/e2e/command-deck.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..a58d912d6c7e5139d9f62b449ca0f141f3e0a896
--- /dev/null
+++ b/tests/e2e/command-deck.spec.js
@@ -0,0 +1,23 @@
+const { test, expect } = require('@playwright/test');
+const { login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('command deck opens and submits a prompt', async ({ page }) => {
+  await page.goto('/wp-admin/admin.php?page=agentwp');
+
+  const openButton = page.getByRole('button', { name: 'Open Command Deck' });
+  await expect(openButton).toBeVisible();
+  await openButton.click();
+
+  const promptInput = page.locator('#agentwp-prompt');
+  await expect(promptInput).toBeVisible();
+  await promptInput.fill('Check order status for a customer');
+  await promptInput.press('Enter');
+
+  const response = page.locator('.agentwp-markdown');
+  await expect(response).toContainText('order status');
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Verifying PHP use statement placement**
exec
/bin/zsh -lc "sed -n '1,80p' tests/wp-env/mu-plugins/agentwp-test-tools.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 55ms:
<?php
/**
 * AgentWP test helpers for wp-env integration tests.
 */

use AgentWP\AI\Response;
use AgentWP\Handlers\EmailDraftHandler;
use AgentWP\Handlers\OrderStatusHandler;
use AgentWP\Handlers\RefundHandler;
use AgentWP\Handlers\StockHandler;
use AgentWP\Intent\Engine;
use AgentWP\Intent\Intent;

if ( ! defined( 'ABSPATH' ) ) {
	return;
}

if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
	return;
}
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/docs/integration-tests.md b/docs/integration-tests.md
new file mode 100644
index 0000000000000000000000000000000000000000..6def3e314f2f6258b47225b2a824ff6e97bc7e54
--- /dev/null
+++ b/docs/integration-tests.md
@@ -0,0 +1,22 @@
+# Integration tests
+
+## Setup
+- `npm install`
+- `npm run wp-env:start`
+
+Optional reset if the database gets dirty:
+- `npm run wp-env:reset`
+
+## Run
+- `npm run test:e2e`
+
+## Environment variables
+- `AGENTWP_BASE_URL` (default `http://localhost:8888`)
+- `WP_USERNAME` / `WP_PASSWORD` (default `admin` / `password`)
+- `AGENTWP_OPENAI_MODE` (`playback` default, or `record`, or `live`)
+- `AGENTWP_OPENAI_API_KEY` (required for `live` or `record`)
+- `AGENTWP_OPENAI_FIXTURES` (defaults to `wp-content/plugins/agentwp/tests/fixtures/openai`)
+
+## Notes
+- The wp-env config loads test-only endpoints under `/wp-json/agentwp-test/v1`.
+- VCR fixtures are keyed by request method + URL. Record mode writes new fixtures into the fixtures directory.
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/command-deck.spec.js b/tests/e2e/command-deck.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..a58d912d6c7e5139d9f62b449ca0f141f3e0a896
--- /dev/null
+++ b/tests/e2e/command-deck.spec.js
@@ -0,0 +1,23 @@
+const { test, expect } = require('@playwright/test');
+const { login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('command deck opens and submits a prompt', async ({ page }) => {
+  await page.goto('/wp-admin/admin.php?page=agentwp');
+
+  const openButton = page.getByRole('button', { name: 'Open Command Deck' });
+  await expect(openButton).toBeVisible();
+  await openButton.click();
+
+  const promptInput = page.locator('#agentwp-prompt');
+  await expect(promptInput).toBeVisible();
+  await promptInput.fill('Check order status for a customer');
+  await promptInput.press('Enter');
+
+  const response = page.locator('.agentwp-markdown');
+  await expect(response).toContainText('order status');
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Reviewing plugin and test integration details**
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/MemoryStore.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 36ms:
<?php
/**
 * Conversation memory stored in session.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

class MemoryStore {
	const SESSION_KEY = 'agentwp_intent_memory';

	/**
	 * @var int
	 */
	private $limit;

	/**
	 * @param int $limit Max memory entries.
	 */
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/docs/integration-tests.md b/docs/integration-tests.md
new file mode 100644
index 0000000000000000000000000000000000000000..6def3e314f2f6258b47225b2a824ff6e97bc7e54
--- /dev/null
+++ b/docs/integration-tests.md
@@ -0,0 +1,22 @@
+# Integration tests
+
+## Setup
+- `npm install`
+- `npm run wp-env:start`
+
+Optional reset if the database gets dirty:
+- `npm run wp-env:reset`
+
+## Run
+- `npm run test:e2e`
+
+## Environment variables
+- `AGENTWP_BASE_URL` (default `http://localhost:8888`)
+- `WP_USERNAME` / `WP_PASSWORD` (default `admin` / `password`)
+- `AGENTWP_OPENAI_MODE` (`playback` default, or `record`, or `live`)
+- `AGENTWP_OPENAI_API_KEY` (required for `live` or `record`)
+- `AGENTWP_OPENAI_FIXTURES` (defaults to `wp-content/plugins/agentwp/tests/fixtures/openai`)
+
+## Notes
+- The wp-env config loads test-only endpoints under `/wp-json/agentwp-test/v1`.
+- VCR fixtures are keyed by request method + URL. Record mode writes new fixtures into the fixtures directory.
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/command-deck.spec.js b/tests/e2e/command-deck.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..a58d912d6c7e5139d9f62b449ca0f141f3e0a896
--- /dev/null
+++ b/tests/e2e/command-deck.spec.js
@@ -0,0 +1,23 @@
+const { test, expect } = require('@playwright/test');
+const { login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('command deck opens and submits a prompt', async ({ page }) => {
+  await page.goto('/wp-admin/admin.php?page=agentwp');
+
+  const openButton = page.getByRole('button', { name: 'Open Command Deck' });
+  await expect(openButton).toBeVisible();
+  await openButton.click();
+
+  const promptInput = page.locator('#agentwp-prompt');
+  await expect(promptInput).toBeVisible();
+  await promptInput.fill('Check order status for a customer');
+  await promptInput.press('Enter');
+
+  const response = page.locator('.agentwp-markdown');
+  await expect(response).toContainText('order status');
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Reviewing test setup and environment details**
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/ContextBuilder.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 65ms:
<?php
/**
 * Build enriched intent context.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

class ContextBuilder {
	/**
	 * Build context with store and user data.
	 *
	 * @param array $context Request context.
	 * @param array $metadata Request metadata.
	 * @return array
	 */
	public function build( array $context = array(), array $metadata = array() ) {
		return array(
			'request'       => $context,
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/docs/integration-tests.md b/docs/integration-tests.md
new file mode 100644
index 0000000000000000000000000000000000000000..6def3e314f2f6258b47225b2a824ff6e97bc7e54
--- /dev/null
+++ b/docs/integration-tests.md
@@ -0,0 +1,22 @@
+# Integration tests
+
+## Setup
+- `npm install`
+- `npm run wp-env:start`
+
+Optional reset if the database gets dirty:
+- `npm run wp-env:reset`
+
+## Run
+- `npm run test:e2e`
+
+## Environment variables
+- `AGENTWP_BASE_URL` (default `http://localhost:8888`)
+- `WP_USERNAME` / `WP_PASSWORD` (default `admin` / `password`)
+- `AGENTWP_OPENAI_MODE` (`playback` default, or `record`, or `live`)
+- `AGENTWP_OPENAI_API_KEY` (required for `live` or `record`)
+- `AGENTWP_OPENAI_FIXTURES` (defaults to `wp-content/plugins/agentwp/tests/fixtures/openai`)
+
+## Notes
+- The wp-env config loads test-only endpoints under `/wp-json/agentwp-test/v1`.
+- VCR fixtures are keyed by request method + URL. Record mode writes new fixtures into the fixtures directory.
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/command-deck.spec.js b/tests/e2e/command-deck.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..a58d912d6c7e5139d9f62b449ca0f141f3e0a896
--- /dev/null
+++ b/tests/e2e/command-deck.spec.js
@@ -0,0 +1,23 @@
+const { test, expect } = require('@playwright/test');
+const { login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('command deck opens and submits a prompt', async ({ page }) => {
+  await page.goto('/wp-admin/admin.php?page=agentwp');
+
+  const openButton = page.getByRole('button', { name: 'Open Command Deck' });
+  await expect(openButton).toBeVisible();
+  await openButton.click();
+
+  const promptInput = page.locator('#agentwp-prompt');
+  await expect(promptInput).toBeVisible();
+  await promptInput.fill('Check order status for a customer');
+  await promptInput.press('Enter');
+
+  const response = page.locator('.agentwp-markdown');
+  await expect(response).toContainText('order status');
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);


thinking
**Summarizing final response details**

I'll prepare a clear final summary covering status, change highlights with file references, verification commands including possible Playwright setup, and risks—especially the UI test dependencies and API key/network considerations—to wrap up the task comprehensively.
codex
Status: DONE

Summary of changes:
- Added wp-env setup plus test-only mu-plugins for OpenAI VCR and WooCommerce/intent test endpoints in `tests/wp-env/mu-plugins/agentwp-openai-vcr.php` and `tests/wp-env/mu-plugins/agentwp-test-tools.php`.
- Implemented Playwright integration suite covering REST, OpenAI VCR, WooCommerce flows, intent flow, and Command Deck interactions in `tests/e2e/*.js`, with helpers in `tests/e2e/helpers/wp.js`.
- Added OpenAI fixtures in `tests/fixtures/openai` and test runner scaffolding in `package.json`, `playwright.config.cjs`, and `docs/integration-tests.md`.

How to verify (exact commands):
- `npm install`
- `npm run wp-env:start`
- `npm run test:e2e`

Risks / follow-ups:
- The Command Deck Playwright test assumes the Command Deck UI is bundled and rendered on `/wp-admin/admin.php?page=agentwp`; if the current asset build doesn’t include it, update the build pipeline or selectors.
- If Playwright browsers aren’t installed locally, run `npx playwright install` before `npm run test:e2e`.
file update:
diff --git a/.wp-env.json b/.wp-env.json
new file mode 100644
index 0000000000000000000000000000000000000000..dca122cd2c86a70060fede937a0280db77833ee2
--- /dev/null
+++ b/.wp-env.json
@@ -0,0 +1,17 @@
+{
+  "core": "WordPress/WordPress#6.4",
+  "plugins": [
+    ".",
+    "woocommerce"
+  ],
+  "mappings": {
+    "wp-content/mu-plugins/agentwp-openai-vcr.php": "./tests/wp-env/mu-plugins/agentwp-openai-vcr.php",
+    "wp-content/mu-plugins/agentwp-test-tools.php": "./tests/wp-env/mu-plugins/agentwp-test-tools.php"
+  },
+  "config": {
+    "WP_DEBUG": true,
+    "WP_DEBUG_LOG": true,
+    "WP_ENVIRONMENT_TYPE": "development",
+    "AGENTWP_E2E": true
+  }
+}
diff --git a/docs/integration-tests.md b/docs/integration-tests.md
new file mode 100644
index 0000000000000000000000000000000000000000..6def3e314f2f6258b47225b2a824ff6e97bc7e54
--- /dev/null
+++ b/docs/integration-tests.md
@@ -0,0 +1,22 @@
+# Integration tests
+
+## Setup
+- `npm install`
+- `npm run wp-env:start`
+
+Optional reset if the database gets dirty:
+- `npm run wp-env:reset`
+
+## Run
+- `npm run test:e2e`
+
+## Environment variables
+- `AGENTWP_BASE_URL` (default `http://localhost:8888`)
+- `WP_USERNAME` / `WP_PASSWORD` (default `admin` / `password`)
+- `AGENTWP_OPENAI_MODE` (`playback` default, or `record`, or `live`)
+- `AGENTWP_OPENAI_API_KEY` (required for `live` or `record`)
+- `AGENTWP_OPENAI_FIXTURES` (defaults to `wp-content/plugins/agentwp/tests/fixtures/openai`)
+
+## Notes
+- The wp-env config loads test-only endpoints under `/wp-json/agentwp-test/v1`.
+- VCR fixtures are keyed by request method + URL. Record mode writes new fixtures into the fixtures directory.
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..51376038555f0f656c3565a4de3076753352d169
--- /dev/null
+++ b/package.json
@@ -0,0 +1,16 @@
+{
+  "name": "agentwp-integration",
+  "private": true,
+  "scripts": {
+    "wp-env:start": "wp-env start",
+    "wp-env:stop": "wp-env stop",
+    "wp-env:reset": "wp-env run cli wp db reset --yes && wp-env run cli wp core install --url=localhost:8888 --title=AgentWP --admin_user=admin --admin_password=password --admin_email=admin@example.com --skip-email",
+    "test:e2e": "playwright test",
+    "test:e2e:headed": "playwright test --headed",
+    "test:e2e:ui": "playwright test --ui"
+  },
+  "devDependencies": {
+    "@playwright/test": "^1.50.0",
+    "@wordpress/env": "^9.0.0"
+  }
+}
diff --git a/playwright.config.cjs b/playwright.config.cjs
new file mode 100644
index 0000000000000000000000000000000000000000..ec26e009e7230ea6da6178a246cce1eec0cd271b
--- /dev/null
+++ b/playwright.config.cjs
@@ -0,0 +1,19 @@
+const { defineConfig } = require('@playwright/test');
+
+const baseURL = process.env.AGENTWP_BASE_URL || 'http://localhost:8888';
+
+module.exports = defineConfig({
+  testDir: 'tests/e2e',
+  timeout: 90_000,
+  expect: {
+    timeout: 10_000,
+  },
+  retries: process.env.CI ? 2 : 0,
+  workers: process.env.CI ? 1 : undefined,
+  use: {
+    baseURL,
+    headless: true,
+    screenshot: 'only-on-failure',
+    video: 'retain-on-failure',
+  },
+});
diff --git a/tests/e2e/command-deck.spec.js b/tests/e2e/command-deck.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..a58d912d6c7e5139d9f62b449ca0f141f3e0a896
--- /dev/null
+++ b/tests/e2e/command-deck.spec.js
@@ -0,0 +1,23 @@
+const { test, expect } = require('@playwright/test');
+const { login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('command deck opens and submits a prompt', async ({ page }) => {
+  await page.goto('/wp-admin/admin.php?page=agentwp');
+
+  const openButton = page.getByRole('button', { name: 'Open Command Deck' });
+  await expect(openButton).toBeVisible();
+  await openButton.click();
+
+  const promptInput = page.locator('#agentwp-prompt');
+  await expect(promptInput).toBeVisible();
+  await promptInput.fill('Check order status for a customer');
+  await promptInput.press('Enter');
+
+  const response = page.locator('.agentwp-markdown');
+  await expect(response).toContainText('order status');
+});
diff --git a/tests/e2e/helpers/wp.js b/tests/e2e/helpers/wp.js
new file mode 100644
index 0000000000000000000000000000000000000000..94fd7af3fe385e0891edff13fd820fbf0b334cc4
--- /dev/null
+++ b/tests/e2e/helpers/wp.js
@@ -0,0 +1,52 @@
+const { expect } = require('@playwright/test');
+
+const WP_USERNAME = process.env.WP_USERNAME || 'admin';
+const WP_PASSWORD = process.env.WP_PASSWORD || 'password';
+
+async function login(page) {
+  await page.goto('/wp-login.php');
+  await page.fill('#user_login', WP_USERNAME);
+  await page.fill('#user_pass', WP_PASSWORD);
+  await Promise.all([page.waitForURL(/wp-admin/), page.click('#wp-submit')]);
+}
+
+async function apiGet(page, path) {
+  const response = await page.request.get(path);
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function apiPost(page, path, data) {
+  const response = await page.request.post(path, { data });
+  const json = await response.json().catch(() => null);
+  return { response, json };
+}
+
+async function resetTestData(page) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/reset', {});
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+}
+
+async function seedTestData(page, scenario = 'default') {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/seed', { scenario });
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  return json.data;
+}
+
+async function setApiKey(page, apiKey) {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/settings/api-key', {
+    api_key: apiKey,
+  });
+  return { response, json };
+}
+
+module.exports = {
+  apiGet,
+  apiPost,
+  login,
+  resetTestData,
+  seedTestData,
+  setApiKey,
+};
diff --git a/tests/e2e/intent-flow.spec.js b/tests/e2e/intent-flow.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..b2f12e77ef86f58b16f876e4141d5871c25c3a2f
--- /dev/null
+++ b/tests/e2e/intent-flow.spec.js
@@ -0,0 +1,26 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('intent flow runs from prompt to draft', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  await setApiKey(page, TEST_API_KEY);
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/intent-flow', {
+    prompt: 'Please draft a shipping update email.',
+    order_id: seed.order_id,
+    tone: 'friendly',
+    email_intent: 'shipping_update',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.engine?.intent).toBe('EMAIL_DRAFT');
+  expect(json?.data?.draft?.email_body).toContain('order is on the way');
+});
diff --git a/tests/e2e/openai.spec.js b/tests/e2e/openai.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef9d5d8b34f18be49144db9712c88b3785843d0a
--- /dev/null
+++ b/tests/e2e/openai.spec.js
@@ -0,0 +1,36 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData, setApiKey } = require('./helpers/wp');
+
+const TEST_API_KEY = process.env.AGENTWP_OPENAI_API_KEY || 'sk-test-1234';
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('stores API key using OpenAI validation', async ({ page }) => {
+  const { response, json } = await setApiKey(page, TEST_API_KEY);
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.stored).toBeTruthy();
+  expect(json?.data?.last4).toBe(TEST_API_KEY.slice(-4));
+});
+
+test('drafts email using recorded OpenAI response', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+  const { response: keyResponse } = await setApiKey(page, TEST_API_KEY);
+
+  expect(keyResponse.ok()).toBeTruthy();
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/email-draft', {
+    order_id: seed.order_id,
+    intent: 'shipping_update',
+    tone: 'friendly',
+  });
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.email_body).toContain('order is on the way');
+  expect(json?.data?.subject_line).toBeTruthy();
+});
diff --git a/tests/e2e/rest-api.spec.js b/tests/e2e/rest-api.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..6335d811b9e521cc670b5e5455b688f09fd02f4c
--- /dev/null
+++ b/tests/e2e/rest-api.spec.js
@@ -0,0 +1,37 @@
+const { test, expect } = require('@playwright/test');
+const { apiGet, apiPost, login, resetTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('settings endpoint returns defaults', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/settings');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  expect(json?.data?.settings).toBeTruthy();
+});
+
+test('intent rejects empty prompt', async ({ page }) => {
+  const { response, json } = await apiPost(page, '/wp-json/agentwp/v1/intent', { prompt: '' });
+
+  expect(response.status()).toBe(400);
+  expect(json?.success).toBeFalsy();
+  expect(json?.error?.code).toBe('agentwp_missing_prompt');
+});
+
+test('search returns empty results on empty store', async ({ page }) => {
+  const { response, json } = await apiGet(page, '/wp-json/agentwp/v1/search?q=hoodie');
+
+  expect(response.ok()).toBeTruthy();
+  expect(json?.success).toBeTruthy();
+  const results = json?.data?.results || {};
+  expect(Array.isArray(results.products)).toBeTruthy();
+  expect(Array.isArray(results.orders)).toBeTruthy();
+  expect(Array.isArray(results.customers)).toBeTruthy();
+  expect(results.products).toHaveLength(0);
+  expect(results.orders).toHaveLength(0);
+  expect(results.customers).toHaveLength(0);
+});
diff --git a/tests/e2e/woocommerce.spec.js b/tests/e2e/woocommerce.spec.js
new file mode 100644
index 0000000000000000000000000000000000000000..980d55527080d85b0c5c01ffb0a1b46aaab7ee48
--- /dev/null
+++ b/tests/e2e/woocommerce.spec.js
@@ -0,0 +1,125 @@
+const { test, expect } = require('@playwright/test');
+const { apiPost, login, resetTestData, seedTestData } = require('./helpers/wp');
+
+test.beforeEach(async ({ page }) => {
+  await login(page);
+  await resetTestData(page);
+});
+
+test('refund flow prepares and confirms with restock', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+      restock_items: true,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.confirmed).toBeTruthy();
+  expect(confirmJson?.data?.restocked_items?.length).toBeGreaterThan(0);
+});
+
+test('status update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      order_id: seed.order_id,
+      new_status: 'completed',
+      notify_customer: false,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/status',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_status).toBe('completed');
+});
+
+test('stock update flow prepares and confirms', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      product_id: seed.product_id,
+      operation: 'decrease',
+      quantity: 1,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+
+  const { response: confirmResponse, json: confirmJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/stock',
+    {
+      draft_id: prepareJson.data.draft_id,
+    }
+  );
+
+  expect(confirmResponse.ok()).toBeTruthy();
+  expect(confirmJson?.success).toBeTruthy();
+  expect(confirmJson?.data?.new_stock).toBe(seed.stock_quantity - 1);
+});
+
+test('stock update rejects missing operation', async ({ page }) => {
+  const seed = await seedTestData(page, 'default');
+
+  const { response, json } = await apiPost(page, '/wp-json/agentwp-test/v1/stock', {
+    product_id: seed.product_id,
+    quantity: 2,
+  });
+
+  expect(response.ok()).toBeFalsy();
+  expect(json?.success).toBeFalsy();
+});
+
+test('refund handles huge order totals', async ({ page }) => {
+  const seed = await seedTestData(page, 'huge');
+
+  const { response: prepareResponse, json: prepareJson } = await apiPost(
+    page,
+    '/wp-json/agentwp-test/v1/refund',
+    {
+      order_id: seed.order_id,
+    }
+  );
+
+  expect(prepareResponse.ok()).toBeTruthy();
+  expect(prepareJson?.success).toBeTruthy();
+  expect(prepareJson?.data?.draft_id).toBeTruthy();
+});
diff --git a/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
new file mode 100644
index 0000000000000000000000000000000000000000..f60cbe9f67a913f23aa987e9f0168406fe611780
--- /dev/null
+++ b/tests/fixtures/openai/54ba30f164b23236c55ccaab74c99d73ebfb9b05.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"object\":\"list\",\"data\":[{\"id\":\"gpt-4o-mini\",\"object\":\"model\"}]}"
+}
diff --git a/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
new file mode 100644
index 0000000000000000000000000000000000000000..73db8a0da3086a9f040cf6e8380df57b1b19f361
--- /dev/null
+++ b/tests/fixtures/openai/f0dacf52138a5ddda002c7e93d2c931b3d8dad84.json
@@ -0,0 +1,7 @@
+{
+  "status": 200,
+  "headers": {
+    "content-type": "application/json"
+  },
+  "body": "{\"id\":\"chatcmpl-test\",\"object\":\"chat.completion\",\"created\":1710000000,\"model\":\"gpt-4o-mini\",\"choices\":[{\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"{\\\"subject_line\\\":\\\"Order update\\\",\\\"email_body\\\":\\\"<p>Your order is on the way.</p>\\\",\\\"plain_text_version\\\":\\\"Your order is on the way.\\\"}\"},\"finish_reason\":\"stop\"}],\"usage\":{\"prompt_tokens\":120,\"completion_tokens\":40,\"total_tokens\":160}}"
+}
diff --git a/tests/wp-env/mu-plugins/agentwp-openai-vcr.php b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
new file mode 100644
index 0000000000000000000000000000000000000000..ea12bb5cf0e5a55b5de9052dd51949bdf1577b65
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-openai-vcr.php
@@ -0,0 +1,161 @@
+<?php
+/**
+ * OpenAI VCR for AgentWP integration tests.
+ */
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+function agentwp_openai_vcr_mode() {
+	$mode = getenv( 'AGENTWP_OPENAI_MODE' );
+	$mode = is_string( $mode ) ? strtolower( trim( $mode ) ) : '';
+
+	if ( ! in_array( $mode, array( 'playback', 'record', 'live' ), true ) ) {
+		$mode = 'playback';
+	}
+
+	return $mode;
+}
+
+function agentwp_openai_vcr_fixture_dir() {
+	$dir = getenv( 'AGENTWP_OPENAI_FIXTURES' );
+	$dir = is_string( $dir ) ? trim( $dir ) : '';
+
+	if ( '' !== $dir ) {
+		return rtrim( $dir, '/' );
+	}
+
+	return WP_PLUGIN_DIR . '/agentwp/tests/fixtures/openai';
+}
+
+function agentwp_openai_vcr_should_capture( $url ) {
+	if ( ! is_string( $url ) ) {
+		return false;
+	}
+
+	return false !== strpos( $url, 'api.openai.com/v1' );
+}
+
+function agentwp_openai_vcr_normalize_body( $body ) {
+	if ( is_array( $body ) ) {
+		return wp_json_encode( $body );
+	}
+
+	if ( is_string( $body ) ) {
+		return $body;
+	}
+
+	return '';
+}
+
+function agentwp_openai_vcr_hash( $method, $url, $body = '' ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+	$body   = is_string( $body ) ? $body : '';
+
+	return sha1( $method . '|' . $url . '|' . $body );
+}
+
+function agentwp_openai_vcr_hash_url( $method, $url ) {
+	$method = is_string( $method ) ? strtoupper( $method ) : 'GET';
+	$url    = is_string( $url ) ? $url : '';
+
+	return sha1( $method . '|' . $url );
+}
+
+function agentwp_openai_vcr_load_fixture( $method, $url, $body ) {
+	$dir = agentwp_openai_vcr_fixture_dir();
+	if ( ! is_dir( $dir ) ) {
+		return null;
+	}
+
+	$body_hash = agentwp_openai_vcr_hash( $method, $url, $body );
+	$body_path = $dir . '/' . $body_hash . '.json';
+	if ( file_exists( $body_path ) ) {
+		$contents = file_get_contents( $body_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	$url_hash = agentwp_openai_vcr_hash_url( $method, $url );
+	$url_path = $dir . '/' . $url_hash . '.json';
+	if ( file_exists( $url_path ) ) {
+		$contents = file_get_contents( $url_path );
+		return is_string( $contents ) ? json_decode( $contents, true ) : null;
+	}
+
+	return null;
+}
+
+function agentwp_openai_vcr_build_response( array $fixture ) {
+	return array(
+		'headers'  => isset( $fixture['headers'] ) && is_array( $fixture['headers'] ) ? $fixture['headers'] : array(),
+		'body'     => isset( $fixture['body'] ) ? $fixture['body'] : '',
+		'response' => array(
+			'code'    => isset( $fixture['status'] ) ? (int) $fixture['status'] : 200,
+			'message' => isset( $fixture['message'] ) ? (string) $fixture['message'] : 'OK',
+		),
+		'cookies'  => array(),
+		'filename' => null,
+	);
+}
+
+add_filter(
+	'pre_http_request',
+	function ( $preempt, $args, $url ) {
+		if ( false !== $preempt || ! agentwp_openai_vcr_should_capture( $url ) ) {
+			return $preempt;
+		}
+
+		$mode = agentwp_openai_vcr_mode();
+		if ( 'live' === $mode || 'record' === $mode ) {
+			return $preempt;
+		}
+
+		$method  = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body    = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$fixture = agentwp_openai_vcr_load_fixture( $method, $url, $body );
+
+		if ( null === $fixture ) {
+			return new WP_Error( 'agentwp_vcr_missing', 'OpenAI fixture not found for request.' );
+		}
+
+		return agentwp_openai_vcr_build_response( $fixture );
+	},
+	10,
+	3
+);
+
+add_filter(
+	'http_response',
+	function ( $response, $args, $url ) {
+		if ( ! agentwp_openai_vcr_should_capture( $url ) || 'record' !== agentwp_openai_vcr_mode() ) {
+			return $response;
+		}
+
+		$method = isset( $args['method'] ) ? $args['method'] : 'GET';
+		$body   = agentwp_openai_vcr_normalize_body( isset( $args['body'] ) ? $args['body'] : '' );
+		$hash   = agentwp_openai_vcr_hash( $method, $url, $body );
+		$dir    = agentwp_openai_vcr_fixture_dir();
+
+		if ( ! is_dir( $dir ) ) {
+			wp_mkdir_p( $dir );
+		}
+
+		$fixture = array(
+			'status'  => isset( $response['response']['code'] ) ? (int) $response['response']['code'] : 0,
+			'headers' => isset( $response['headers'] ) ? $response['headers'] : array(),
+			'body'    => isset( $response['body'] ) ? $response['body'] : '',
+		);
+
+		file_put_contents( $dir . '/' . $hash . '.json', wp_json_encode( $fixture, JSON_PRETTY_PRINT ) );
+
+		return $response;
+	},
+	10,
+	3
+);
diff --git a/tests/wp-env/mu-plugins/agentwp-test-tools.php b/tests/wp-env/mu-plugins/agentwp-test-tools.php
new file mode 100644
index 0000000000000000000000000000000000000000..ceba7c3f6455f17dd6c5e15e4d0404deb67c0cfd
--- /dev/null
+++ b/tests/wp-env/mu-plugins/agentwp-test-tools.php
@@ -0,0 +1,457 @@
+<?php
+/**
+ * AgentWP test helpers for wp-env integration tests.
+ */
+
+use AgentWP\AI\Response;
+use AgentWP\Handlers\EmailDraftHandler;
+use AgentWP\Handlers\OrderStatusHandler;
+use AgentWP\Handlers\RefundHandler;
+use AgentWP\Handlers\StockHandler;
+use AgentWP\Intent\Engine;
+use AgentWP\Intent\Intent;
+
+if ( ! defined( 'ABSPATH' ) ) {
+	return;
+}
+
+if ( ! defined( 'AGENTWP_E2E' ) || ! AGENTWP_E2E ) {
+	return;
+}
+
+const AGENTWP_TEST_META_KEY = '_agentwp_test_seed';
+
+function agentwp_test_permissions() {
+	if ( current_user_can( 'manage_woocommerce' ) ) {
+		return true;
+	}
+
+	return new WP_Error( 'agentwp_test_forbidden', 'Insufficient permissions for AgentWP test route.' );
+}
+
+function agentwp_test_response_from_ai( $result ) {
+	if ( ! $result instanceof Response ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => false,
+				'data'    => array(),
+				'error'   => array(
+					'message' => 'Invalid AgentWP test response.',
+				),
+			)
+		);
+		$response->set_status( 500 );
+		return $response;
+	}
+
+	if ( $result->is_success() ) {
+		$response = rest_ensure_response(
+			array(
+				'success' => true,
+				'data'    => $result->get_data(),
+				'meta'    => $result->get_meta(),
+			)
+		);
+		$response->set_status( $result->get_status() );
+		return $response;
+	}
+
+	$response = rest_ensure_response(
+		array(
+			'success' => false,
+			'data'    => array(),
+			'error'   => array(
+				'message' => $result->get_message(),
+				'meta'    => $result->get_meta(),
+			),
+		)
+	);
+	$response->set_status( $result->get_status() );
+
+	return $response;
+}
+
+function agentwp_test_seed_product( $name, $price, $stock, $sku ) {
+	if ( ! class_exists( 'WC_Product_Simple' ) ) {
+		return 0;
+	}
+
+	$product = new WC_Product_Simple();
+	$product->set_name( $name );
+	$product->set_regular_price( (string) $price );
+	$product->set_status( 'publish' );
+	$product->set_catalog_visibility( 'visible' );
+	$product->set_manage_stock( true );
+	$product->set_stock_quantity( $stock );
+	$product->set_sku( $sku );
+	$product->save();
+
+	$product_id = $product->get_id();
+	if ( $product_id ) {
+		update_post_meta( $product_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $product_id;
+}
+
+function agentwp_test_seed_order( $product_id, $quantity, array $address, $status = 'processing' ) {
+	if ( ! function_exists( 'wc_create_order' ) || ! function_exists( 'wc_get_product' ) ) {
+		return 0;
+	}
+
+	$product = wc_get_product( $product_id );
+	if ( ! $product ) {
+		return 0;
+	}
+
+	$order = wc_create_order();
+	$order->add_product( $product, $quantity );
+	$order->set_address( $address, 'billing' );
+	$order->set_address( $address, 'shipping' );
+	$order->set_status( $status );
+	$order->calculate_totals();
+	$order->save();
+
+	$order_id = $order->get_id();
+	if ( $order_id ) {
+		update_post_meta( $order_id, AGENTWP_TEST_META_KEY, 1 );
+	}
+
+	return $order_id;
+}
+
+function agentwp_test_seed_default() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Test Product', 25, 10, 'agentwp-test-001' );
+
+	$address = array(
+		'first_name' => 'Test',
+		'last_name'  => 'Customer',
+		'email'      => 'test.customer@example.com',
+		'phone'      => '555-0100',
+		'address_1'  => '100 Market St',
+		'city'       => 'San Francisco',
+		'state'      => 'CA',
+		'postcode'   => '94105',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 2, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 10,
+	);
+}
+
+function agentwp_test_seed_huge_order() {
+	if ( ! class_exists( 'WooCommerce' ) ) {
+		return new WP_Error( 'agentwp_test_no_wc', 'WooCommerce is required to seed data.' );
+	}
+
+	$product_id = agentwp_test_seed_product( 'AgentWP Bulk Product', 8, 500, 'agentwp-test-bulk' );
+
+	$address = array(
+		'first_name' => 'Big',
+		'last_name'  => 'Buyer',
+		'email'      => 'big.buyer@example.com',
+		'phone'      => '555-0199',
+		'address_1'  => '500 Commerce Way',
+		'city'       => 'Austin',
+		'state'      => 'TX',
+		'postcode'   => '73301',
+		'country'    => 'US',
+	);
+
+	$order_id = agentwp_test_seed_order( $product_id, 200, $address );
+
+	return array(
+		'product_id'    => $product_id,
+		'order_id'      => $order_id,
+		'stock_quantity' => 500,
+	);
+}
+
+function agentwp_test_reset() {
+	$post_types = array( 'product', 'shop_order', 'shop_order_refund' );
+	$posts      = get_posts(
+		array(
+			'post_type'      => $post_types,
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+			'meta_key'       => AGENTWP_TEST_META_KEY,
+		)
+	);
+
+	foreach ( $posts as $post_id ) {
+		wp_delete_post( $post_id, true );
+	}
+
+	$refunds = get_posts(
+		array(
+			'post_type'      => 'shop_order_refund',
+			'posts_per_page' => -1,
+			'fields'         => 'ids',
+		)
+	);
+
+	foreach ( $refunds as $refund_id ) {
+		wp_delete_post( $refund_id, true );
+	}
+
+	$options = array(
+		'agentwp_settings',
+		'agentwp_api_key',
+		'agentwp_api_key_last4',
+		'agentwp_budget_limit',
+		'agentwp_draft_ttl_minutes',
+		'agentwp_usage_stats',
+	);
+
+	foreach ( $options as $option ) {
+		delete_option( $option );
+	}
+
+	global $wpdb;
+	if ( $wpdb ) {
+		$like      = $wpdb->esc_like( '_transient_agentwp_' ) . '%';
+		$like_time = $wpdb->esc_like( '_transient_timeout_agentwp_' ) . '%';
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like ) );
+		$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $like_time ) );
+
+		$usage_table  = $wpdb->prefix . 'agentwp_usage';
+		$search_table = $wpdb->prefix . 'agentwp_search_index';
+
+		$tables = $wpdb->get_col( 'SHOW TABLES' );
+		if ( is_array( $tables ) && in_array( $usage_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$usage_table}" );
+		}
+		if ( is_array( $tables ) && in_array( $search_table, $tables, true ) ) {
+			$wpdb->query( "TRUNCATE TABLE {$search_table}" );
+		}
+	}
+
+	return array(
+		'reset' => true,
+	);
+}
+
+function agentwp_test_seed( WP_REST_Request $request ) {
+	$payload  = $request->get_json_params();
+	$scenario = isset( $payload['scenario'] ) ? sanitize_text_field( $payload['scenario'] ) : 'default';
+
+	if ( 'huge' === $scenario ) {
+		$result = agentwp_test_seed_huge_order();
+	} else {
+		$result = agentwp_test_seed_default();
+	}
+
+	if ( is_wp_error( $result ) ) {
+		return $result;
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array_merge(
+				$result,
+				array(
+					'scenario' => $scenario,
+				)
+			),
+		)
+	);
+}
+
+function agentwp_test_refund( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( RefundHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Refund handler not available.' );
+	}
+
+	$handler = new RefundHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_status_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( OrderStatusHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Order status handler not available.' );
+	}
+
+	$handler = new OrderStatusHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_stock_update( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( StockHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Stock handler not available.' );
+	}
+
+	$handler = new StockHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_email_draft( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$result  = $handler->handle( $payload );
+
+	return agentwp_test_response_from_ai( $result );
+}
+
+function agentwp_test_intent_flow( WP_REST_Request $request ) {
+	$payload = $request->get_json_params();
+	$payload = is_array( $payload ) ? $payload : array();
+
+	$prompt       = isset( $payload['prompt'] ) ? sanitize_text_field( $payload['prompt'] ) : '';
+	$order_id     = isset( $payload['order_id'] ) ? absint( $payload['order_id'] ) : 0;
+	$email_intent = isset( $payload['email_intent'] ) ? sanitize_text_field( $payload['email_intent'] ) : 'shipping_update';
+	$tone         = isset( $payload['tone'] ) ? sanitize_text_field( $payload['tone'] ) : 'friendly';
+
+	if ( '' === $prompt ) {
+		return new WP_Error( 'agentwp_test_missing_prompt', 'Intent flow requires a prompt.' );
+	}
+
+	if ( $order_id <= 0 ) {
+		return new WP_Error( 'agentwp_test_missing_order', 'Intent flow requires an order ID.' );
+	}
+
+	$engine = new Engine();
+	$engine_result = $engine->handle( $prompt, array() );
+	if ( ! $engine_result->is_success() ) {
+		return agentwp_test_response_from_ai( $engine_result );
+	}
+
+	$engine_data   = $engine_result->get_data();
+	$resolved_intent = isset( $engine_data['intent'] ) ? $engine_data['intent'] : '';
+
+	if ( Intent::EMAIL_DRAFT !== $resolved_intent ) {
+		return new WP_Error( 'agentwp_test_intent_mismatch', 'Intent flow resolved to a non-email intent.' );
+	}
+
+	if ( ! class_exists( EmailDraftHandler::class ) ) {
+		return new WP_Error( 'agentwp_test_missing_handler', 'Email draft handler not available.' );
+	}
+
+	$handler = new EmailDraftHandler();
+	$draft_result = $handler->draft_email(
+		array(
+			'order_id' => $order_id,
+			'intent'   => $email_intent,
+			'tone'     => $tone,
+		)
+	);
+
+	if ( ! $draft_result->is_success() ) {
+		return agentwp_test_response_from_ai( $draft_result );
+	}
+
+	return rest_ensure_response(
+		array(
+			'success' => true,
+			'data'    => array(
+				'engine' => $engine_data,
+				'draft'  => $draft_result->get_data(),
+			),
+		)
+	);
+}
+
+add_action(
+	'rest_api_init',
+	function () {
+		register_rest_route(
+			'agentwp-test/v1',
+			'/reset',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_reset',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/seed',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_seed',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/refund',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_refund',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/status',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_status_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/stock',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_stock_update',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/email-draft',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_email_draft',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+
+		register_rest_route(
+			'agentwp-test/v1',
+			'/intent-flow',
+			array(
+				'methods'             => 'POST',
+				'callback'            => 'agentwp_test_intent_flow',
+				'permission_callback' => 'agentwp_test_permissions',
+			)
+		);
+	}
+);

tokens used
156,074
