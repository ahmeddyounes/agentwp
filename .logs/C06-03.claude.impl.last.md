---

## Status: DONE

### Summary of changes

Created a minimal Request DTO/validator helper system that reduces controller boilerplate while preserving WP REST schema validation:

**New Files (5):**
1. `src/DTO/RequestDTO.php` - Abstract base class providing:
   - Automatic WP REST schema validation via `rest_validate_value_from_schema()`
   - Typed getter helpers: `getString()`, `getInt()`, `getFloat()`, `getBool()`, `getArray()`, `has()`
   - Support for both JSON body and query parameter sources

2. `src/DTO/IntentRequestDTO.php` - DTO for `/intent` endpoint:
   - Schema validation (prompt/input max length 10000)
   - `getPrompt()`, `hasPrompt()`, `getContext()`, `getMetadata()` accessors

3. `src/DTO/SettingsUpdateDTO.php` - DTO for `POST /settings` endpoint:
   - Schema validation for model, budget_limit, draft_ttl_minutes, hotkey, theme, dark_mode, demo_mode
   - `applyTo($settings)` method that applies validated updates with sanitization

4. `src/DTO/ApiKeyRequestDTO.php` - DTO for `POST /settings/api-key` endpoint:
   - Schema validation (minLength 20, maxLength 256)
   - `getApiKey()`, `isEmpty()`, `hasValidFormat()` accessors

5. `src/DTO/UsageQueryDTO.php` - DTO for `GET /usage` endpoint:
   - Query parameter validation for period (day/week/month)
   - `getPeriod()`, `hasValidPeriod()` accessors

**Modified Files (2):**
- `src/Rest/IntentController.php` - Reduced from ~124 to ~85 lines (-31%)
- `src/Rest/SettingsController.php` - Reduced from ~425 to ~286 lines (-33%)

### How to verify

```bash
# Run PHPStan (only pre-existing errors remain)
composer phpstan

# Run unit tests (306 tests pass)
composer phpunit

# Run code style check
composer phpcs -- src/DTO/ src/Rest/IntentController.php src/Rest/SettingsController.php

# Syntax verification
php -l src/DTO/RequestDTO.php src/DTO/IntentRequestDTO.php src/DTO/SettingsUpdateDTO.php src/DTO/ApiKeyRequestDTO.php src/DTO/UsageQueryDTO.php src/Rest/IntentController.php src/Rest/SettingsController.php
```

### Risks / follow-ups

1. **Low risk** - API behavior unchanged; identical schema validation rules, same error codes, same response format
2. **Future enhancement** - The `RequestDTO` base class can be extended to other REST controllers to further reduce boilerplate
3. **Pre-existing PHPStan issues** - 2 errors in `src/Infrastructure/OpenAIKeyValidator.php` for unused constants (unrelated to this change)
