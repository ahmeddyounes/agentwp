---

## Status: DONE

## Summary of Changes

1. **Created custom PHPStan rule** (`phpstan/ForbiddenServicesGlobalsRule.php`) that detects and forbids 40+ WordPress/WooCommerce global function calls in `src/Services/**`

2. **Created PHPStan configuration** (`phpstan/services-boundaries.neon`) to register the rule

3. **Updated `phpstan.neon`** to include the new rules configuration

4. **Updated `composer.json`** with autoload-dev entry for the PHPStan namespace

5. **Refactored `DateRangeParser`** - removed `withWordPressTimezone()` static factory that was the only violation in Services

6. **Updated `ServicesServiceProvider`** to construct DateRangeParser using timezone from ClockInterface

## How to Verify

```bash
# PHPStan passes with zero errors
composer run-script phpstan

# All tests pass (519 tests)
composer run-script phpunit

# Test violation detection (create a test file with forbidden calls):
# echo '<?php namespace AgentWP\Services; class X { function f() { get_option("x"); } }' > src/Services/Test.php
# composer run-script phpstan  # Should fail with helpful error
# rm src/Services/Test.php
```

## Risks / Follow-ups

- **Low risk**: The DateRangeParser refactor is minimal and timezone is now obtained from the already-injected ClockInterface
- **Extensible**: New forbidden functions can be easily added to the `FORBIDDEN_FUNCTIONS` constant in the rule class
- **CI integration**: The rule runs as part of normal `composer run-script phpstan` so it will fail CI if violations are introduced
