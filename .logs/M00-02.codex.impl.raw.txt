Status: DONE

Summary of changes
- Built the dockerized stack with WordPress, MySQL, Node/Vite, Mailhog, and an auto-seeding init service in `docker-compose.yml`.
- Added a custom WordPress image that bundles WP-CLI, WooCommerce 8.4.x, and Mailhog sendmail config in `docker/wordpress/Dockerfile`.
- Added setup and seeding automation in `setup.sh`, `scripts/wp-setup.sh`, and `scripts/seed-woocommerce.php`.
- Added a minimal React dev scaffold under `react/` and a full config template in `.env.example`.

How to verify
```sh
cp .env.example .env
docker-compose up -d
docker-compose exec -T wordpress wp wc product list --path=/var/www/html --allow-root
docker-compose exec -T wordpress wp wc order list --path=/var/www/html --allow-root
```

Risks / follow-ups
- Docker build and the Node dev container require network access to fetch WP-CLI, WooCommerce, Mailhog sendmail, and npm dependencies.
- If the init run doesn’t seed as expected, rerun `./setup.sh` or inspect `docker-compose logs wp_setup`.

OpenAI Codex v0.77.0 (research preview)
--------
workdir: /Users/ahmedyounis/Documents/Projects/agentwp
model: gpt-5.2-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019b9473-d0e2-7dd0-a892-8cad6abc56ac
--------
user
You are implementing task M00-02 in this git repository.

1) Read the spec: .plans/M00-02.md
2) Read handoff/context: .t2/handoff/M00-02.md

Implement the spec fully.

Verification commands (run if non-empty):
- format: 
- lint: 
- test: 

In your final response, include:
- Status: DONE or NEEDS-REVIEW
- Summary of changes
- How to verify (exact commands)
- Risks / follow-ups

mcp startup: no servers

thinking
**Preparing to read files for implementation**
exec
/bin/zsh -lc ls in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 45ms:
docs
README.md
scripts
tasks.csv

thinking
**Checking for hidden files**
exec
/bin/zsh -lc 'ls -a' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 30ms:
.
..
.git
.idea
.logs
.plans
.t2
docs
README.md
scripts
tasks.csv

thinking
**Reading instructions and spec**
exec
/bin/zsh -lc 'cat .plans/M00-02.md' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 69ms:
# M00-02 — Docker Development Environment

Create Docker-based development environment with docker-compose.yml including: 1) WordPress container with PHP 8.1+ and WooCommerce 8.x pre-installed. 2) MySQL 8.0 container with persistent volume. 3) Node.js container for React build tooling. 4) Mailhog for email testing. 5) Volume mounts for live code reloading. Include .env.example with all configuration variables. Create setup script (setup.sh) that initializes WooCommerce with sample data. Acceptance Criteria: Running 'docker-compose up' creates fully functional dev environment within 5 minutes, hot reloading works for both PHP and React, sample store has 50+ products and 100+ orders.

thinking
**Reading handoff instructions**
exec
/bin/zsh -lc 'cat .t2/handoff/M00-02.md' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 65ms:
# Handoff: M00-02

Created: 2026-01-06T17:56:16.714322Z

Spec: .plans/M00-02.md

thinking
**Assessing implementation needs**
exec
/bin/zsh -lc 'rg --files' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 84ms:
scripts/agent_csv_runner.py
scripts/agentflow.py
tasks.csv
README.md
docs/agentwp-prd.md
docs/ARCHITECTURE.md

thinking
**Planning Docker setup and sample data**

I'm outlining a minimal Docker environment with a WordPress 6.4.3 PHP 8.1 Apache container, MySQL, Node.js for React building, and Mailhog. I'll prepare a setup script using WP-CLI to install WooCommerce and load sample products and orders, plus an example .env file. Since network use is assumed for Docker images but not runtime, the script will handle plugin install and data import after containers are up. This aims to meet the user's specs for live reload and sample WooCommerce data initialization.
exec
/bin/zsh -lc 'cat README.md' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 76ms:
# agentwp

thinking
**Designing Docker Compose setup**

I’m outlining the docker-compose.yml with MySQL, WordPress, Node.js for React tooling, and Mailhog services, considering volumes and environment variables for each. I’m also planning a custom WordPress Dockerfile to add WP-CLI and configuring a setup.sh script to orchestrate container startup and checks. I want to ensure hot reloading for PHP and React with minimal placeholder frontend code. Let’s explore how best to organize these pieces so the dev environment can come up smoothly with sample data and live reload support.
exec
/bin/zsh -lc 'cat docs/ARCHITECTURE.md' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 87ms:
# AgentWP Technical Architecture

## 1) System Overview

AgentWP is a WordPress plugin that provides a React-powered admin UI (Command Deck) and a PHP backend that integrates with WooCommerce and the OpenAI API. The plugin exposes REST endpoints under `/wp-json/agentwp/v1` and uses standard WooCommerce tables plus `wp_options` for settings and encrypted BYOK storage.

```mermaid
flowchart LR
  subgraph WP[WordPress + WooCommerce]
    WPCore[WordPress Core]
    WC[WooCommerce]
    DB[(MySQL: wp_* tables)]
    WPCore --> WC
    WPCore --> DB
    WC --> DB
  end

  subgraph AgentWP[AgentWP Plugin]
    PHP[PHP Backend (AgentWP\*)]
    REST[REST API /wp-json/agentwp/v1/*]


thinking
**Designing multi-service Docker setup with WordPress and React**

This is quite a thorough plan to build a Docker Compose environment including WordPress, MySQL, Mailhog, and a React frontend with hot reload. I'm outlining service definitions, environment variables, mounting volumes, and setting up PHP mail forwarding to Mailhog using `mhsendmail`. Also, I'm designing a setup script to initialize WordPress, install WooCommerce, configure store options, and seed sample products/orders via a PHP script run inside the container. The approach balances Docker build constraints, offline considerations, and practical defaults, aiming for a smooth developer experience with hot reloading React and a ready WooCommerce store. This looks like a balanced and manageable multi-container environment aligned with the spec!
thinking
**Setting up minimal React app and automation script**

I’m building a lightweight Vite React app with typical config files and a simple UI scaffold, designed for hot reloading inside the Docker setup. Alongside, I’m crafting a robust `setup.sh` script to manage the Docker services lifecycle, WordPress installation, WooCommerce plugin activation, store configuration through environment variables, and idempotent seeding of products and orders via a PHP script. This ties the frontend and backend orchestrations smoothly and ensures easy environment initialization.
exec
/bin/zsh -lc 'mkdir -p docker/wordpress react/src' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 84ms:


thinking
**Creating docker-compose.yml file**
exec
/bin/zsh -lc "cat <<'EOF' > docker-compose.yml
version: \"3.9\"

services:
  db:
    image: mysql:8.0
    command: --default-authentication-plugin=mysql_native_password
    environment:
      MYSQL_DATABASE: "'${WORDPRESS_DB_NAME}
      MYSQL_USER: ${WORDPRESS_DB_USER}
      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
    ports:
      - "${MYSQL_PORT}:3306"
    volumes:
      - db_data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
      interval: 5s
      timeout: 5s
      retries: 20

  wordpress:
    build:
      context: ./docker/wordpress
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "${WORDPRESS_PORT}:80"
    environment:
      WORDPRESS_DB_HOST: db:3306
      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
      WORDPRESS_CONFIG_EXTRA: |
        define('"'WP_DEBUG', "'${WORDPRESS_DEBUG});
        define('"'WP_DEBUG_LOG', "'${WORDPRESS_DEBUG_LOG});
        define('"'WP_DEBUG_DISPLAY', "'${WORDPRESS_DEBUG_DISPLAY});
        define('"'WP_ENVIRONMENT_TYPE', 'development');
        define('WP_HOME', '"'${WORDPRESS_SITE_URL}'"');
        define('WP_SITEURL', '"'${WORDPRESS_SITE_URL}'"');
        define('FS_METHOD', 'direct');
    volumes:
      - ./wp:/var/www/html
      - ./scripts:/scripts

  node:
    image: node:20-alpine
    working_dir: /app
    command: sh -c \"npm install && npm run dev -- --host 0.0.0.0 --port "'${REACT_DEV_PORT}"
    environment:
      CHOKIDAR_USEPOLLING: "true"
      REACT_DEV_PORT: ${REACT_DEV_PORT}
    ports:
      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
    volumes:
      - ./react:/app

  mailhog:
    image: mailhog/mailhog:v1.0.1
    ports:
      - "${MAILHOG_UI_PORT}:8025"
      - "${MAILHOG_SMTP_PORT}:1025"

volumes:
  db_data:
EOF' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 71ms:


thinking
**Creating Dockerfile for WordPress**
exec
/bin/zsh -lc "cat <<'EOF' > docker/wordpress/Dockerfile
FROM wordpress:6.4.3-php8.1-apache

RUN set -eux; \\
  apt-get update; \\
  apt-get install -y --no-install-recommends ca-certificates curl less; \\
  curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \\
  chmod +x /usr/local/bin/wp; \\
  curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \\
  chmod +x /usr/local/bin/mhsendmail; \\
  echo \"sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025\" > /usr/local/etc/php/conf.d/mailhog.ini; \\
  apt-get clean; \\
  rm -rf /var/lib/apt/lists/*
EOF" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 69ms:


thinking
**Adding .env.example file**
exec
/bin/zsh -lc "cat <<'EOF' > .env.example
WORDPRESS_DB_NAME=agentwp
WORDPRESS_DB_USER=agentwp
WORDPRESS_DB_PASSWORD=agentwp
WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
WORDPRESS_TABLE_PREFIX=wp_

WORDPRESS_SITE_URL=http://localhost:8080
WORDPRESS_SITE_TITLE=AgentWP Dev Store
WORDPRESS_ADMIN_USER=admin
WORDPRESS_ADMIN_PASSWORD=admin123
WORDPRESS_ADMIN_EMAIL=admin@example.com

WORDPRESS_PORT=8080
MYSQL_PORT=3306
MAILHOG_UI_PORT=8025
MAILHOG_SMTP_PORT=1025
REACT_DEV_PORT=5173

WORDPRESS_DEBUG=false
WORDPRESS_DEBUG_LOG=true
WORDPRESS_DEBUG_DISPLAY=false

WC_STORE_ADDRESS=100 Market St
WC_STORE_CITY=San Francisco
WC_STORE_STATE=CA
WC_STORE_POSTCODE=94105
WC_DEFAULT_COUNTRY=US:CA
WC_CURRENCY=USD

SEED_PRODUCTS=60
SEED_ORDERS=120
EOF" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:


thinking
**Preparing setup script**
exec
/bin/zsh -lc "cat <<'EOF' > setup.sh
#"'!/usr/bin/env bash
set -euo pipefail

COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
ENV_FILE=${ENV_FILE:-.env}

if [ ! -f "$ENV_FILE" ]; then
  if [ -f .env.example ]; then
    cp .env.example "$ENV_FILE"
    echo "Created $ENV_FILE from .env.example. Update values as needed."
  else
    echo "Missing $ENV_FILE and .env.example." >&2
    exit 1
  fi
fi

set -a
# shellcheck source=/dev/null
source "$ENV_FILE"
set +a

$COMPOSE_CMD up -d db wordpress mailhog node

echo "Waiting for MySQL to be ready..."
until $COMPOSE_CMD exec -T db mysqladmin ping -h "localhost" -p"${WORDPRESS_DB_ROOT_PASSWORD}" --silent; do
  sleep 2
done

echo "Waiting for WordPress to be ready..."
until $COMPOSE_CMD exec -T wordpress test -f /var/www/html/wp-config.php; do
  sleep 2
done

if ! $COMPOSE_CMD exec -T wordpress wp core is-installed --path=/var/www/html --allow-root >/dev/null 2>&1; then
  $COMPOSE_CMD exec -T wordpress wp core install '"\\
    --path=/var/www/html \\
    --url=\""'$WORDPRESS_SITE_URL" '"\\
    --title=\""'$WORDPRESS_SITE_TITLE" '"\\
    --admin_user=\""'$WORDPRESS_ADMIN_USER" '"\\
    --admin_password=\""'$WORDPRESS_ADMIN_PASSWORD" '"\\
    --admin_email=\""'$WORDPRESS_ADMIN_EMAIL" '"\\
    --skip-email \\
    --allow-root
fi

if "'! $COMPOSE_CMD exec -T wordpress wp plugin is-installed woocommerce --allow-root >/dev/null 2>&1; then
  $COMPOSE_CMD exec -T wordpress wp plugin install woocommerce --activate --allow-root
else
  $COMPOSE_CMD exec -T wordpress wp plugin activate woocommerce --allow-root
fi

$COMPOSE_CMD exec -T wordpress wp wc tool run install_pages --allow-root || true

$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_address "$WC_STORE_ADDRESS" --allow-root
$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_city "$WC_STORE_CITY" --allow-root
$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_state "$WC_STORE_STATE" --allow-root
$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_postcode "$WC_STORE_POSTCODE" --allow-root
$COMPOSE_CMD exec -T wordpress wp option update woocommerce_default_country "$WC_DEFAULT_COUNTRY" --allow-root
$COMPOSE_CMD exec -T wordpress wp option update woocommerce_currency "$WC_CURRENCY" --allow-root

$COMPOSE_CMD exec -T wordpress bash -c "SEED_PRODUCTS=${SEED_PRODUCTS:-60} SEED_ORDERS=${SEED_ORDERS:-120} wp eval-file /scripts/seed-woocommerce.php --path=/var/www/html --allow-root"

echo "Setup complete."
EOF' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 65ms:


thinking
**Making file executable**
exec
/bin/zsh -lc 'chmod +x setup.sh' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 66ms:


thinking
**Creating seed script**
exec
/bin/zsh -lc "cat <<'EOF' > scripts/seed-woocommerce.php
<?php

if ("'!class_exists('"'WooCommerce')) {
    fwrite(STDERR, \"WooCommerce is not active.\\n\");
    exit(1);
}

"'$targetProducts = (int) (getenv('"'SEED_PRODUCTS') ?: 60);
"'$targetOrders = (int) (getenv('"'SEED_ORDERS') ?: 120);

"'$productIds = wc_get_products([
    '"'limit' => -1,
    'return' => 'ids',
]);

"'$productCount = is_array($productIds) ? count($productIds) : 0;

for ($i = $productCount; $i < $targetProducts; $i++) {
    $product = new WC_Product_Simple();
    $product->set_name('"'Sample Product ' . ("'$i + 1));
    $product->set_regular_price((string) rand(10, 120));
    $product->set_description('"'Sample product generated for development.');
    "'$product->set_short_description('"'Sample product.');
    "'$product->set_status('"'publish');
    "'$product->set_catalog_visibility('"'visible');
    "'$product->set_stock_status('"'instock');
    "'$product->set_sku('"'sample-' . ("'$i + 1));
    $product->save();
    $productIds[] = $product->get_id();
}

echo "Products available: " . count($productIds) . "'"\\n\";

"'$orderIds = wc_get_orders([
    '"'limit' => -1,
    'return' => 'ids',
]);

"'$orderCount = is_array($orderIds) ? count($orderIds) : 0;

if (empty($productIds)) {
    fwrite(STDERR, "No products found to seed orders.'"\\n\");
    exit(1);
}

"'$statuses = ['"'processing', 'completed', 'on-hold'];

for ("'$i = $orderCount; $i < $targetOrders; $i++) {
    $order = wc_create_order();
    $items = rand(1, 3);
    for ($j = 0; $j < $items; $j++) {
        $productId = $productIds[array_rand($productIds)];
        $product = wc_get_product($productId);
        if ($product) {
            $order->add_product($product, rand(1, 3));
        }
    }

    $address = [
        '"'first_name' => 'Sample',
        'last_name' => 'Customer ' . ("'$i + 1),
        '"'email' => 'customer' . ("'$i + 1) . '"'@example.com',
        'phone' => '555-0100',
        'address_1' => '100 Market St',
        'city' => 'San Francisco',
        'state' => 'CA',
        'postcode' => '94105',
        'country' => 'US',
    ];

    "'$order->set_address($address, '"'billing');
    "'$order->set_address($address, '"'shipping');
    "'$order->set_status($statuses[array_rand($statuses)]);
    $order->calculate_totals();
    $order->save();
}

echo "Orders available: " . max($targetOrders, $orderCount) . "'"\\n\";
EOF" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 62ms:


thinking
**Creating React app boilerplate files**
exec
/bin/zsh -lc "cat <<'EOF' > react/package.json
{
  \"name\": \"agentwp-react\",
  \"private\": true,
  \"version\": \"0.1.0\",
  \"type\": \"module\",
  \"scripts\": {
    \"dev\": \"vite\",
    \"build\": \"vite build\",
    \"preview\": \"vite preview\"
  },
  \"dependencies\": {
    \"react\": \""'^18.2.0",
    "react-dom": "''^18.2.0"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "''^4.2.0",
    "vite": "''^5.0.0"
  }
}
EOF' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 62ms:


thinking
**Creating vite.config.js file**
exec
/bin/zsh -lc "cat <<'EOF' > react/vite.config.js
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  server: {
    host: true,
    port: Number.parseInt(process.env.REACT_DEV_PORT || '5173', 10),
    strictPort: true,
  },
});
EOF" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 60ms:


thinking
**Creating index.html**
exec
/bin/zsh -lc "cat <<'EOF' > react/index.html
<"'!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AgentWP Dev UI</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
EOF' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 63ms:


thinking
**Adding initial source files**
exec
/bin/zsh -lc "cat <<'EOF' > react/src/main.jsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App.jsx';
import './index.css';

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
EOF" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 67ms:


thinking
**Checking main app file**
exec
/bin/zsh -lc "cat <<'EOF' > react/src/App.jsx
export default function App() {
  return (
    <div className=\"app\">
      <header className=\"app__header\">
        <p className=\"app__eyebrow\">AgentWP</p>
        <h1>Command Deck Dev UI</h1>
        <p className=\"app__lead\">
          Hot reload is wired through the Node container. Edit this file to
          verify live updates.
        </p>
      </header>
      <section className=\"app__card\">
        <h2>Local endpoints</h2>
        <ul>
          <li>WordPress: http://localhost:8080</li>
          <li>Mailhog: http://localhost:8025</li>
          <li>React: http://localhost:5173</li>
        </ul>
      </section>
    </div>
  );
}
EOF" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 61ms:


thinking
**Checking index.css file**
exec
/bin/zsh -lc "cat <<'EOF' > react/src/index.css
:root {
  color: #0b0d12;
  background-color: #f7f2ea;
  font-family: \"Space Grotesk\", \"Trebuchet MS\", sans-serif;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  min-height: 100vh;
}

.app {
  min-height: 100vh;
  padding: 3rem 2rem 4rem;
  background: radial-gradient(circle at top, #f9d39b 0%, #f7f2ea 40%, #efe6dd 100%);
}

.app__header {
  max-width: 640px;
}

.app__eyebrow {
  text-transform: uppercase;
  letter-spacing: 0.3em;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.app__lead {
  font-size: 1.1rem;
  line-height: 1.5;
}

.app__card {
  margin-top: 2.5rem;
  padding: 1.5rem;
  border-radius: 16px;
  background: white;
  box-shadow: 0 20px 45px rgba(0, 0, 0, 0.08);
  max-width: 520px;
}

.app__card ul {
  margin: 0.75rem 0 0;
  padding-left: 1.25rem;
}
EOF" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 58ms:


thinking
**Evaluating font inclusion and project setup**
exec
/bin/zsh -lc 'ls scripts' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 67ms:
agent_csv_runner.py
agentflow.py
seed-woocommerce.php

thinking
**Reviewing environment and setup script details**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/setup.sh
@@ -3,3 +3,9 @@
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -n "${COMPOSE_CMD:-}" ]; then
+  COMPOSE_CMD=$COMPOSE_CMD
+elif command -v docker-compose >/dev/null 2>&1; then
+  COMPOSE_CMD=docker-compose
+else
+  COMPOSE_CMD="docker compose"
+fi
 ENV_FILE=${ENV_FILE:-.env}
apply_patch(auto_approved=true) exited 0 in 19ms:
Success. Updated the following files:
M setup.sh
file update:
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..04a293921e594073c8e0765efbb363f5c0f18054
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -n "${COMPOSE_CMD:-}" ]; then
+  COMPOSE_CMD=$COMPOSE_CMD
+elif command -v docker-compose >/dev/null 2>&1; then
+  COMPOSE_CMD=docker-compose
+else
+  COMPOSE_CMD="docker compose"
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then

file update:
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..04a293921e594073c8e0765efbb363f5c0f18054
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -n "${COMPOSE_CMD:-}" ]; then
+  COMPOSE_CMD=$COMPOSE_CMD
+elif command -v docker-compose >/dev/null 2>&1; then
+  COMPOSE_CMD=docker-compose
+else
+  COMPOSE_CMD="docker compose"
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Simplifying COMPOSE_CMD assignment**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/setup.sh
@@ -3,8 +3,8 @@
 
-if [ -n "${COMPOSE_CMD:-}" ]; then
-  COMPOSE_CMD=$COMPOSE_CMD
-elif command -v docker-compose >/dev/null 2>&1; then
-  COMPOSE_CMD=docker-compose
-else
-  COMPOSE_CMD="docker compose"
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
 fi
apply_patch(auto_approved=true) exited 0 in 34ms:
Success. Updated the following files:
M setup.sh
file update:
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then

file update:
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Analyzing shell command usage and environment setup**
exec
/bin/zsh -lc 'rg --files' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 65ms:
react/src/App.jsx
react/src/main.jsx
react/src/index.css
react/package.json
react/vite.config.js
react/index.html
docker-compose.yml
scripts/seed-woocommerce.php
scripts/agent_csv_runner.py
scripts/agentflow.py
tasks.csv
README.md
docs/agentwp-prd.md
docs/ARCHITECTURE.md
docker/wordpress/Dockerfile
setup.sh
file update:
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Verifying environment and setup details**

I'm carefully checking the environment variables needed for Docker Compose and Node, ensuring `.env.example` covers them all. I’m reviewing the seed script’s logic for product and order counts to avoid errors when `wc_get_products` returns unexpected values. I’m also validating the setup script’s reliance on WP-CLI commands and Docker Compose usage, noting the use of `depends_on` without conditions for compatibility with different Compose versions, and considering removing the `condition` property to prevent errors with older Compose tools. Finally, I’m assessing potential setup risks and confirming that needed tools like `curl` and mail configurations are properly handled. This thorough review aims to ensure smooth container orchestration and WordPress setup with minimal compatibility issues.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docker-compose.yml
@@ -25,4 +25,3 @@
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
apply_patch(auto_approved=true) exited 0 in 30ms:
Success. Updated the following files:
M docker-compose.yml
file update:
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..bcf467794ab47f4d0bab3d566ac24fde7c7b2f10
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -23,8 +23,7 @@
     build:
       context: ./docker/wordpress
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
       - "${WORDPRESS_PORT}:80"
     environment:
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then

file update:
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..bcf467794ab47f4d0bab3d566ac24fde7c7b2f10
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -23,8 +23,7 @@
     build:
       context: ./docker/wordpress
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
       - "${WORDPRESS_PORT}:80"
     environment:
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Reviewing setup and font usage**
exec
/bin/zsh -lc 'cat setup.sh' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 61ms:
#!/usr/bin/env bash
set -euo pipefail

if [ -z "${COMPOSE_CMD:-}" ]; then
  if command -v docker-compose >/dev/null 2>&1; then
    COMPOSE_CMD=docker-compose
  else
    COMPOSE_CMD="docker compose"
  fi
fi
ENV_FILE=${ENV_FILE:-.env}

if [ ! -f "$ENV_FILE" ]; then
  if [ -f .env.example ]; then
    cp .env.example "$ENV_FILE"
    echo "Created $ENV_FILE from .env.example. Update values as needed."
  else
    echo "Missing $ENV_FILE and .env.example." >&2
    exit 1
  fi
file update:
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..bcf467794ab47f4d0bab3d566ac24fde7c7b2f10
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -23,8 +23,7 @@
     build:
       context: ./docker/wordpress
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
       - "${WORDPRESS_PORT}:80"
     environment:
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Analyzing Docker-compose and setup integration**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docker/wordpress/Dockerfile
@@ -2,5 +2,7 @@
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
@@ -10,2 +12,5 @@
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
apply_patch(auto_approved=true) exited 0 in 37ms:
Success. Updated the following files:
M docker/wordpress/Dockerfile
file update:
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..bcf467794ab47f4d0bab3d566ac24fde7c7b2f10
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -23,8 +23,7 @@
     build:
       context: ./docker/wordpress
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
       - "${WORDPRESS_PORT}:80"
     environment:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then

file update:
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..bcf467794ab47f4d0bab3d566ac24fde7c7b2f10
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -23,8 +23,7 @@
     build:
       context: ./docker/wordpress
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
       - "${WORDPRESS_PORT}:80"
     environment:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Preparing WooCommerce version config**

I’m making sure the WooCommerce plugin is preinstalled in the Docker image and confirming that `setup.sh` will skip installing if it’s already present. I’m considering adding `WOOCOMMERCE_VERSION` as a build argument in `docker-compose.yml` and including it in `.env.example` to allow easy version customization, which fits with the requirement of listing all config variables. I'll update the compose file and `.env.example` accordingly.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docker-compose.yml
@@ -24,2 +24,4 @@
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION}
     depends_on:
apply_patch(auto_approved=true) exited 0 in 62ms:
Success. Updated the following files:
M docker-compose.yml
file update:
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..363cfbe806dd7d4168723e269f74f2b604f59307
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -22,9 +22,10 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
       - "${WORDPRESS_PORT}:80"
     environment:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then

file update:
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..363cfbe806dd7d4168723e269f74f2b604f59307
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -22,9 +22,10 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
       - "${WORDPRESS_PORT}:80"
     environment:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Updating environment example file**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/.env.example
@@ -5,2 +5,3 @@
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
apply_patch(auto_approved=true) exited 0 in 49ms:
Success. Updated the following files:
M .env.example
file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..363cfbe806dd7d4168723e269f74f2b604f59307
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -22,9 +22,10 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
       - "${WORDPRESS_PORT}:80"
     environment:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then

file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..363cfbe806dd7d4168723e269f74f2b604f59307
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -22,9 +22,10 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
       - "${WORDPRESS_PORT}:80"
     environment:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Adding default environment variable values to docker-compose.yml**

I'm looking to update docker-compose.yml to provide default values for key environment variables using the `${VAR:-default}` syntax; this way, users running `docker-compose up` without a `.env` file won’t see warnings or failures. This will cover WooCommerce version, database credentials, ports, and WordPress configs to ensure smooth out-of-the-box startup. I'll use patching to apply these multiple edits cleanly.
exec
/bin/zsh -lc 'cat docker-compose.yml' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 71ms:
version: "3.9"

services:
  db:
    image: mysql:8.0
    command: --default-authentication-plugin=mysql_native_password
    environment:
      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
      MYSQL_USER: ${WORDPRESS_DB_USER}
      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
    ports:
      - "${MYSQL_PORT}:3306"
    volumes:
      - db_data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
      interval: 5s
      timeout: 5s
      retries: 20
file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..363cfbe806dd7d4168723e269f74f2b604f59307
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -22,9 +22,10 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
       - "${WORDPRESS_PORT}:80"
     environment:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Setting default environment variables and handling substitutions**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docker-compose.yml
@@ -7,8 +7,8 @@
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
@@ -16,3 +16,3 @@
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
@@ -25,3 +25,3 @@
       args:
-        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION}
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
@@ -29,16 +29,16 @@
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
@@ -54,5 +54,5 @@
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
@@ -63,4 +63,4 @@
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
apply_patch(auto_approved=true) exited 0 in 78ms:
Success. Updated the following files:
M docker-compose.yml
file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..fd2d218283ba1c428c6a924f985617b90f95e249
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,24 +22,25 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
@@ -51,17 +52,17 @@
     command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then

file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..fd2d218283ba1c428c6a924f985617b90f95e249
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,24 +22,25 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
@@ -51,17 +52,17 @@
     command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Updating default port for React dev server**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docker-compose.yml
@@ -51,3 +51,3 @@
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
apply_patch(auto_approved=true) exited 0 in 75ms:
Success. Updated the following files:
M docker-compose.yml
file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..9c2552c4a1a535fd95e2c773a30af1f250076099
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,24 +22,25 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
@@ -48,20 +49,20 @@
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then

file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..9c2552c4a1a535fd95e2c773a30af1f250076099
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,24 +22,25 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
@@ -48,20 +49,20 @@
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then



thinking
**Evaluating setup.sh and wp_setup integration**

I’m weighing how to improve `setup.sh` and the Docker Compose setup to ensure sample data is seeded automatically on `docker-compose up`. To align with specs, I’m planning a new `wp_setup` service running a `wp-setup.sh` script inside the container that waits for WordPress readiness, installs WooCommerce, activates plugins, and seeds data idempotently, while updating `setup.sh` to orchestrate all this smoothly.
thinking
**Planning refactor for setup.sh and wp_setup service**

I’m organizing how to simplify `setup.sh` by moving WordPress setup logic into a new executable `scripts/wp-setup.sh` run inside the container, and adding a `wp_setup` service in `docker-compose.yml` that depends on `db` and `wordpress` and runs this script automatically on `docker-compose up`. This avoids duplication and ensures smooth, idempotent initialization and seeding.
exec
/bin/zsh -lc "cat <<'EOF' > scripts/wp-setup.sh
#"'!/usr/bin/env bash
set -euo pipefail

WP_PATH=${WP_PATH:-/var/www/html}

WORDPRESS_SITE_URL=${WORDPRESS_SITE_URL:-http://localhost:8080}
WORDPRESS_SITE_TITLE=${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
WORDPRESS_ADMIN_USER=${WORDPRESS_ADMIN_USER:-admin}
WORDPRESS_ADMIN_PASSWORD=${WORDPRESS_ADMIN_PASSWORD:-admin123}
WORDPRESS_ADMIN_EMAIL=${WORDPRESS_ADMIN_EMAIL:-admin@example.com}

WC_STORE_ADDRESS=${WC_STORE_ADDRESS:-100 Market St}
WC_STORE_CITY=${WC_STORE_CITY:-San Francisco}
WC_STORE_STATE=${WC_STORE_STATE:-CA}
WC_STORE_POSTCODE=${WC_STORE_POSTCODE:-94105}
WC_DEFAULT_COUNTRY=${WC_DEFAULT_COUNTRY:-US:CA}
WC_CURRENCY=${WC_CURRENCY:-USD}
WOOCOMMERCE_VERSION=${WOOCOMMERCE_VERSION:-8.4.0}

SEED_PRODUCTS=${SEED_PRODUCTS:-60}
SEED_ORDERS=${SEED_ORDERS:-120}

wait_for_wp() {
  echo "Waiting for WordPress config..."
  until [ -f "$WP_PATH/wp-config.php" ]; do
    sleep 2
  done

  echo "Waiting for database connection..."
  until wp db check --path="$WP_PATH" --allow-root >/dev/null 2>&1; do
    sleep 2
  done
}

wait_for_wp

if ! wp core is-installed --path="$WP_PATH" --allow-root >/dev/null 2>&1; then
  wp core install '"\\
    --path=\""'$WP_PATH" '"\\
    --url=\""'$WORDPRESS_SITE_URL" '"\\
    --title=\""'$WORDPRESS_SITE_TITLE" '"\\
    --admin_user=\""'$WORDPRESS_ADMIN_USER" '"\\
    --admin_password=\""'$WORDPRESS_ADMIN_PASSWORD" '"\\
    --admin_email=\""'$WORDPRESS_ADMIN_EMAIL" '"\\
    --skip-email \\
    --allow-root
fi

if "'! wp plugin is-installed woocommerce --path="$WP_PATH" --allow-root >/dev/null 2>&1; then
  wp plugin install woocommerce --version="$WOOCOMMERCE_VERSION" --activate --allow-root
else
  wp plugin activate woocommerce --path="$WP_PATH" --allow-root
fi

wp wc tool run install_pages --path="$WP_PATH" --allow-root || true

wp option update woocommerce_store_address "$WC_STORE_ADDRESS" --path="$WP_PATH" --allow-root
wp option update woocommerce_store_city "$WC_STORE_CITY" --path="$WP_PATH" --allow-root
wp option update woocommerce_store_state "$WC_STORE_STATE" --path="$WP_PATH" --allow-root
wp option update woocommerce_store_postcode "$WC_STORE_POSTCODE" --path="$WP_PATH" --allow-root
wp option update woocommerce_default_country "$WC_DEFAULT_COUNTRY" --path="$WP_PATH" --allow-root
wp option update woocommerce_currency "$WC_CURRENCY" --path="$WP_PATH" --allow-root

SEED_PRODUCTS="$SEED_PRODUCTS" SEED_ORDERS="$SEED_ORDERS" '"\\
  wp eval-file /scripts/seed-woocommerce.php --path=\""'$WP_PATH" --allow-root

EOF' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 54ms:

file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..9c2552c4a1a535fd95e2c773a30af1f250076099
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,24 +22,25 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
@@ -48,20 +49,20 @@
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Making code executable**
exec
/bin/zsh -lc 'chmod +x scripts/wp-setup.sh' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 55ms:

file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..9c2552c4a1a535fd95e2c773a30af1f250076099
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,24 +22,25 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
@@ -48,20 +49,20 @@
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Refactoring setup and docker-compose environment**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docker-compose.yml
@@ -36,2 +36,16 @@
       WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
@@ -48,2 +62,30 @@
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: [\"/bin/bash\", \"/scripts/wp-setup.sh\"]
+
   node:
apply_patch(auto_approved=true) exited 0 in 69ms:
Success. Updated the following files:
M docker-compose.yml
file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..ab2b65fddbe889b15feef5cf28eafe4bc7fa4b31
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,46 +22,89 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
       - ./scripts:/scripts
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: [\"/bin/bash\", \"/scripts/wp-setup.sh\"]
+
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then

file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..ab2b65fddbe889b15feef5cf28eafe4bc7fa4b31
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,46 +22,89 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
       - ./scripts:/scripts
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: [\"/bin/bash\", \"/scripts/wp-setup.sh\"]
+
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Correcting YAML entrypoint quoting**
exec
/bin/zsh -lc 'rg -n "entrypoint" docker-compose.yml' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 78ms:
89:    entrypoint: [\"/bin/bash\", \"/scripts/wp-setup.sh\"]
file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..ab2b65fddbe889b15feef5cf28eafe4bc7fa4b31
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,46 +22,89 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
       - ./scripts:/scripts
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: [\"/bin/bash\", \"/scripts/wp-setup.sh\"]
+
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Correcting quotation usage**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docker-compose.yml
@@ -88,3 +88,3 @@
       - ./scripts:/scripts
-    entrypoint: [\"/bin/bash\", \"/scripts/wp-setup.sh\"]
+    entrypoint: ["/bin/bash", "/scripts/wp-setup.sh"]
 
apply_patch(auto_approved=true) exited 0 in 67ms:
Success. Updated the following files:
M docker-compose.yml
file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..fa49f1b045e55a9a785e3c267dca3c4dfa4852f4
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,46 +22,89 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
       - ./scripts:/scripts
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: ["/bin/bash", "/scripts/wp-setup.sh"]
+
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then

file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..fa49f1b045e55a9a785e3c267dca3c4dfa4852f4
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,46 +22,89 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
       - ./scripts:/scripts
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: ["/bin/bash", "/scripts/wp-setup.sh"]
+
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..f981d77cd227f68f033a8d99cace54794ddb2002
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then


thinking
**Simplifying setup.sh script**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/setup.sh
@@ -22,47 +22,5 @@
 
-set -a
-# shellcheck source=/dev/null
-source "$ENV_FILE"
-set +a
-
 $COMPOSE_CMD up -d db wordpress mailhog node
 
-echo "Waiting for MySQL to be ready..."
-until $COMPOSE_CMD exec -T db mysqladmin ping -h "localhost" -p"${WORDPRESS_DB_ROOT_PASSWORD}" --silent; do
-  sleep 2
-done
-
-echo "Waiting for WordPress to be ready..."
-until $COMPOSE_CMD exec -T wordpress test -f /var/www/html/wp-config.php; do
-  sleep 2
-done
-
-if ! $COMPOSE_CMD exec -T wordpress wp core is-installed --path=/var/www/html --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp core install \
-    --path=/var/www/html \
-    --url="$WORDPRESS_SITE_URL" \
-    --title="$WORDPRESS_SITE_TITLE" \
-    --admin_user="$WORDPRESS_ADMIN_USER" \
-    --admin_password="$WORDPRESS_ADMIN_PASSWORD" \
-    --admin_email="$WORDPRESS_ADMIN_EMAIL" \
-    --skip-email \
-    --allow-root
-fi
-
-if ! $COMPOSE_CMD exec -T wordpress wp plugin is-installed woocommerce --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp plugin install woocommerce --activate --allow-root
-else
-  $COMPOSE_CMD exec -T wordpress wp plugin activate woocommerce --allow-root
-fi
-
-$COMPOSE_CMD exec -T wordpress wp wc tool run install_pages --allow-root || true
-
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_address "$WC_STORE_ADDRESS" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_city "$WC_STORE_CITY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_state "$WC_STORE_STATE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_postcode "$WC_STORE_POSTCODE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_default_country "$WC_DEFAULT_COUNTRY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_currency "$WC_CURRENCY" --allow-root
-
-$COMPOSE_CMD exec -T wordpress bash -c "SEED_PRODUCTS=${SEED_PRODUCTS:-60} SEED_ORDERS=${SEED_ORDERS:-120} wp eval-file /scripts/seed-woocommerce.php --path=/var/www/html --allow-root"
+$COMPOSE_CMD exec -T wordpress /scripts/wp-setup.sh
 
apply_patch(auto_approved=true) exited 0 in 47ms:
Success. Updated the following files:
M setup.sh
file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..fa49f1b045e55a9a785e3c267dca3c4dfa4852f4
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,46 +22,89 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
       - ./scripts:/scripts
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: ["/bin/bash", "/scripts/wp-setup.sh"]
+
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..1bd0ff415da80378840ce7016b66a948867345e7
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then
@@ -13,51 +19,9 @@
     exit 1
   fi
 fi
-
-set -a
-# shellcheck source=/dev/null
-source "$ENV_FILE"
-set +a
 
 $COMPOSE_CMD up -d db wordpress mailhog node
 
-echo "Waiting for MySQL to be ready..."
-until $COMPOSE_CMD exec -T db mysqladmin ping -h "localhost" -p"${WORDPRESS_DB_ROOT_PASSWORD}" --silent; do
-  sleep 2
-done
-
-echo "Waiting for WordPress to be ready..."
-until $COMPOSE_CMD exec -T wordpress test -f /var/www/html/wp-config.php; do
-  sleep 2
-done
-
-if ! $COMPOSE_CMD exec -T wordpress wp core is-installed --path=/var/www/html --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp core install \
-    --path=/var/www/html \
-    --url="$WORDPRESS_SITE_URL" \
-    --title="$WORDPRESS_SITE_TITLE" \
-    --admin_user="$WORDPRESS_ADMIN_USER" \
-    --admin_password="$WORDPRESS_ADMIN_PASSWORD" \
-    --admin_email="$WORDPRESS_ADMIN_EMAIL" \
-    --skip-email \
-    --allow-root
-fi
-
-if ! $COMPOSE_CMD exec -T wordpress wp plugin is-installed woocommerce --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp plugin install woocommerce --activate --allow-root
-else
-  $COMPOSE_CMD exec -T wordpress wp plugin activate woocommerce --allow-root
-fi
-
-$COMPOSE_CMD exec -T wordpress wp wc tool run install_pages --allow-root || true
-
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_address "$WC_STORE_ADDRESS" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_city "$WC_STORE_CITY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_state "$WC_STORE_STATE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_postcode "$WC_STORE_POSTCODE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_default_country "$WC_DEFAULT_COUNTRY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_currency "$WC_CURRENCY" --allow-root
-
-$COMPOSE_CMD exec -T wordpress bash -c "SEED_PRODUCTS=${SEED_PRODUCTS:-60} SEED_ORDERS=${SEED_ORDERS:-120} wp eval-file /scripts/seed-woocommerce.php --path=/var/www/html --allow-root"
+$COMPOSE_CMD exec -T wordpress /scripts/wp-setup.sh
 
 echo "Setup complete."

file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..fa49f1b045e55a9a785e3c267dca3c4dfa4852f4
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,46 +22,89 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
       - ./scripts:/scripts
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: ["/bin/bash", "/scripts/wp-setup.sh"]
+
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..1bd0ff415da80378840ce7016b66a948867345e7
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then
@@ -13,51 +19,9 @@
     exit 1
   fi
 fi
-
-set -a
-# shellcheck source=/dev/null
-source "$ENV_FILE"
-set +a
 
 $COMPOSE_CMD up -d db wordpress mailhog node
 
-echo "Waiting for MySQL to be ready..."
-until $COMPOSE_CMD exec -T db mysqladmin ping -h "localhost" -p"${WORDPRESS_DB_ROOT_PASSWORD}" --silent; do
-  sleep 2
-done
-
-echo "Waiting for WordPress to be ready..."
-until $COMPOSE_CMD exec -T wordpress test -f /var/www/html/wp-config.php; do
-  sleep 2
-done
-
-if ! $COMPOSE_CMD exec -T wordpress wp core is-installed --path=/var/www/html --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp core install \
-    --path=/var/www/html \
-    --url="$WORDPRESS_SITE_URL" \
-    --title="$WORDPRESS_SITE_TITLE" \
-    --admin_user="$WORDPRESS_ADMIN_USER" \
-    --admin_password="$WORDPRESS_ADMIN_PASSWORD" \
-    --admin_email="$WORDPRESS_ADMIN_EMAIL" \
-    --skip-email \
-    --allow-root
-fi
-
-if ! $COMPOSE_CMD exec -T wordpress wp plugin is-installed woocommerce --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp plugin install woocommerce --activate --allow-root
-else
-  $COMPOSE_CMD exec -T wordpress wp plugin activate woocommerce --allow-root
-fi
-
-$COMPOSE_CMD exec -T wordpress wp wc tool run install_pages --allow-root || true
-
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_address "$WC_STORE_ADDRESS" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_city "$WC_STORE_CITY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_state "$WC_STORE_STATE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_postcode "$WC_STORE_POSTCODE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_default_country "$WC_DEFAULT_COUNTRY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_currency "$WC_CURRENCY" --allow-root
-
-$COMPOSE_CMD exec -T wordpress bash -c "SEED_PRODUCTS=${SEED_PRODUCTS:-60} SEED_ORDERS=${SEED_ORDERS:-120} wp eval-file /scripts/seed-woocommerce.php --path=/var/www/html --allow-root"
+$COMPOSE_CMD exec -T wordpress /scripts/wp-setup.sh
 
 echo "Setup complete."


thinking
**Reviewing WordPress setup integration**

I'm tracing how the `setup.sh` and `wp-setup.sh` scripts interact with the Docker Compose services, ensuring `wp_setup` runs properly without conflicting starts or race conditions. There’s a lot of detail about timing around `wp-config.php` creation, environment variables synchronization, and service startup order, making sure seeding runs smoothly whether via `setup.sh` or `docker-compose up`. I'll keep verifying script calls, environment propagation, and Docker service configuration to maintain robustness.
exec
/bin/zsh -lc 'cat docker-compose.yml' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 50ms:
version: "3.9"

services:
  db:
    image: mysql:8.0
    command: --default-authentication-plugin=mysql_native_password
    environment:
      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
    ports:
      - "${MYSQL_PORT:-3306}:3306"
    volumes:
      - db_data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
      interval: 5s
      timeout: 5s
      retries: 20
file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..fa49f1b045e55a9a785e3c267dca3c4dfa4852f4
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,46 +22,89 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
       - ./scripts:/scripts
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: ["/bin/bash", "/scripts/wp-setup.sh"]
+
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..1bd0ff415da80378840ce7016b66a948867345e7
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then
@@ -13,51 +19,9 @@
     exit 1
   fi
 fi
-
-set -a
-# shellcheck source=/dev/null
-source "$ENV_FILE"
-set +a
 
 $COMPOSE_CMD up -d db wordpress mailhog node
 
-echo "Waiting for MySQL to be ready..."
-until $COMPOSE_CMD exec -T db mysqladmin ping -h "localhost" -p"${WORDPRESS_DB_ROOT_PASSWORD}" --silent; do
-  sleep 2
-done
-
-echo "Waiting for WordPress to be ready..."
-until $COMPOSE_CMD exec -T wordpress test -f /var/www/html/wp-config.php; do
-  sleep 2
-done
-
-if ! $COMPOSE_CMD exec -T wordpress wp core is-installed --path=/var/www/html --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp core install \
-    --path=/var/www/html \
-    --url="$WORDPRESS_SITE_URL" \
-    --title="$WORDPRESS_SITE_TITLE" \
-    --admin_user="$WORDPRESS_ADMIN_USER" \
-    --admin_password="$WORDPRESS_ADMIN_PASSWORD" \
-    --admin_email="$WORDPRESS_ADMIN_EMAIL" \
-    --skip-email \
-    --allow-root
-fi
-
-if ! $COMPOSE_CMD exec -T wordpress wp plugin is-installed woocommerce --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp plugin install woocommerce --activate --allow-root
-else
-  $COMPOSE_CMD exec -T wordpress wp plugin activate woocommerce --allow-root
-fi
-
-$COMPOSE_CMD exec -T wordpress wp wc tool run install_pages --allow-root || true
-
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_address "$WC_STORE_ADDRESS" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_city "$WC_STORE_CITY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_state "$WC_STORE_STATE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_postcode "$WC_STORE_POSTCODE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_default_country "$WC_DEFAULT_COUNTRY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_currency "$WC_CURRENCY" --allow-root
-
-$COMPOSE_CMD exec -T wordpress bash -c "SEED_PRODUCTS=${SEED_PRODUCTS:-60} SEED_ORDERS=${SEED_ORDERS:-120} wp eval-file /scripts/seed-woocommerce.php --path=/var/www/html --allow-root"
+$COMPOSE_CMD exec -T wordpress /scripts/wp-setup.sh
 
 echo "Setup complete."


thinking
**Improving setup script to wait for WordPress core files**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/scripts/wp-setup.sh
@@ -23,2 +23,7 @@
 wait_for_wp() {
+  echo "Waiting for WordPress files..."
+  until [ -f "$WP_PATH/wp-load.php" ]; do
+    sleep 2
+  done
+
   echo "Waiting for WordPress config..."
@@ -65,2 +70 @@
   wp eval-file /scripts/seed-woocommerce.php --path="$WP_PATH" --allow-root
-
apply_patch(auto_approved=true) exited 0 in 62ms:
Success. Updated the following files:
M scripts/wp-setup.sh
file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..fa49f1b045e55a9a785e3c267dca3c4dfa4852f4
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,46 +22,89 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
       - ./scripts:/scripts
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: ["/bin/bash", "/scripts/wp-setup.sh"]
+
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/scripts/wp-setup.sh b/scripts/wp-setup.sh
index 5072cd4c2d555bf27dc1658d9988eeecc3f5fb4a..31fa1d73f912b748c62a2615322cdeab76eaa1e3
--- a/scripts/wp-setup.sh
+++ b/scripts/wp-setup.sh
@@ -21,6 +21,11 @@
 SEED_ORDERS=${SEED_ORDERS:-120}
 
 wait_for_wp() {
+  echo "Waiting for WordPress files..."
+  until [ -f "$WP_PATH/wp-load.php" ]; do
+    sleep 2
+  done
+
   echo "Waiting for WordPress config..."
   until [ -f "$WP_PATH/wp-config.php" ]; do
     sleep 2
@@ -63,4 +68,3 @@
 
 SEED_PRODUCTS="$SEED_PRODUCTS" SEED_ORDERS="$SEED_ORDERS" \
   wp eval-file /scripts/seed-woocommerce.php --path="$WP_PATH" --allow-root
-
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..1bd0ff415da80378840ce7016b66a948867345e7
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then
@@ -13,51 +19,9 @@
     exit 1
   fi
 fi
-
-set -a
-# shellcheck source=/dev/null
-source "$ENV_FILE"
-set +a
 
 $COMPOSE_CMD up -d db wordpress mailhog node
 
-echo "Waiting for MySQL to be ready..."
-until $COMPOSE_CMD exec -T db mysqladmin ping -h "localhost" -p"${WORDPRESS_DB_ROOT_PASSWORD}" --silent; do
-  sleep 2
-done
-
-echo "Waiting for WordPress to be ready..."
-until $COMPOSE_CMD exec -T wordpress test -f /var/www/html/wp-config.php; do
-  sleep 2
-done
-
-if ! $COMPOSE_CMD exec -T wordpress wp core is-installed --path=/var/www/html --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp core install \
-    --path=/var/www/html \
-    --url="$WORDPRESS_SITE_URL" \
-    --title="$WORDPRESS_SITE_TITLE" \
-    --admin_user="$WORDPRESS_ADMIN_USER" \
-    --admin_password="$WORDPRESS_ADMIN_PASSWORD" \
-    --admin_email="$WORDPRESS_ADMIN_EMAIL" \
-    --skip-email \
-    --allow-root
-fi
-
-if ! $COMPOSE_CMD exec -T wordpress wp plugin is-installed woocommerce --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp plugin install woocommerce --activate --allow-root
-else
-  $COMPOSE_CMD exec -T wordpress wp plugin activate woocommerce --allow-root
-fi
-
-$COMPOSE_CMD exec -T wordpress wp wc tool run install_pages --allow-root || true
-
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_address "$WC_STORE_ADDRESS" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_city "$WC_STORE_CITY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_state "$WC_STORE_STATE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_postcode "$WC_STORE_POSTCODE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_default_country "$WC_DEFAULT_COUNTRY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_currency "$WC_CURRENCY" --allow-root
-
-$COMPOSE_CMD exec -T wordpress bash -c "SEED_PRODUCTS=${SEED_PRODUCTS:-60} SEED_ORDERS=${SEED_ORDERS:-120} wp eval-file /scripts/seed-woocommerce.php --path=/var/www/html --allow-root"
+$COMPOSE_CMD exec -T wordpress /scripts/wp-setup.sh
 
 echo "Setup complete."

file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..fa49f1b045e55a9a785e3c267dca3c4dfa4852f4
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,46 +22,89 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
       - ./scripts:/scripts
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: ["/bin/bash", "/scripts/wp-setup.sh"]
+
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/scripts/wp-setup.sh b/scripts/wp-setup.sh
index 5072cd4c2d555bf27dc1658d9988eeecc3f5fb4a..31fa1d73f912b748c62a2615322cdeab76eaa1e3
--- a/scripts/wp-setup.sh
+++ b/scripts/wp-setup.sh
@@ -21,6 +21,11 @@
 SEED_ORDERS=${SEED_ORDERS:-120}
 
 wait_for_wp() {
+  echo "Waiting for WordPress files..."
+  until [ -f "$WP_PATH/wp-load.php" ]; do
+    sleep 2
+  done
+
   echo "Waiting for WordPress config..."
   until [ -f "$WP_PATH/wp-config.php" ]; do
     sleep 2
@@ -63,4 +68,3 @@
 
 SEED_PRODUCTS="$SEED_PRODUCTS" SEED_ORDERS="$SEED_ORDERS" \
   wp eval-file /scripts/seed-woocommerce.php --path="$WP_PATH" --allow-root
-
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..1bd0ff415da80378840ce7016b66a948867345e7
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then
@@ -13,51 +19,9 @@
     exit 1
   fi
 fi
-
-set -a
-# shellcheck source=/dev/null
-source "$ENV_FILE"
-set +a
 
 $COMPOSE_CMD up -d db wordpress mailhog node
 
-echo "Waiting for MySQL to be ready..."
-until $COMPOSE_CMD exec -T db mysqladmin ping -h "localhost" -p"${WORDPRESS_DB_ROOT_PASSWORD}" --silent; do
-  sleep 2
-done
-
-echo "Waiting for WordPress to be ready..."
-until $COMPOSE_CMD exec -T wordpress test -f /var/www/html/wp-config.php; do
-  sleep 2
-done
-
-if ! $COMPOSE_CMD exec -T wordpress wp core is-installed --path=/var/www/html --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp core install \
-    --path=/var/www/html \
-    --url="$WORDPRESS_SITE_URL" \
-    --title="$WORDPRESS_SITE_TITLE" \
-    --admin_user="$WORDPRESS_ADMIN_USER" \
-    --admin_password="$WORDPRESS_ADMIN_PASSWORD" \
-    --admin_email="$WORDPRESS_ADMIN_EMAIL" \
-    --skip-email \
-    --allow-root
-fi
-
-if ! $COMPOSE_CMD exec -T wordpress wp plugin is-installed woocommerce --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp plugin install woocommerce --activate --allow-root
-else
-  $COMPOSE_CMD exec -T wordpress wp plugin activate woocommerce --allow-root
-fi
-
-$COMPOSE_CMD exec -T wordpress wp wc tool run install_pages --allow-root || true
-
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_address "$WC_STORE_ADDRESS" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_city "$WC_STORE_CITY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_state "$WC_STORE_STATE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_postcode "$WC_STORE_POSTCODE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_default_country "$WC_DEFAULT_COUNTRY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_currency "$WC_CURRENCY" --allow-root
-
-$COMPOSE_CMD exec -T wordpress bash -c "SEED_PRODUCTS=${SEED_PRODUCTS:-60} SEED_ORDERS=${SEED_ORDERS:-120} wp eval-file /scripts/seed-woocommerce.php --path=/var/www/html --allow-root"
+$COMPOSE_CMD exec -T wordpress /scripts/wp-setup.sh
 
 echo "Setup complete."


thinking
**Reviewing and refining WordPress setup scripts**

I'm checking the details of the WordPress setup process, especially the `wp-setup.sh` and `setup.sh` scripts, focusing on correct usage of `wp` CLI with `--path` for plugin commands, service dependencies in Docker Compose, environment variables, and script robustness with error handling flags. I'm ensuring the setup flow handles config and core files creation properly and considering minor enhancements like updating `.env.example` and script consistency.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/scripts/wp-setup.sh
@@ -54,3 +54,3 @@
 if ! wp plugin is-installed woocommerce --path="$WP_PATH" --allow-root >/dev/null 2>&1; then
-  wp plugin install woocommerce --version="$WOOCOMMERCE_VERSION" --activate --allow-root
+  wp plugin install woocommerce --version="$WOOCOMMERCE_VERSION" --activate --path="$WP_PATH" --allow-root
 else
apply_patch(auto_approved=true) exited 0 in 82ms:
Success. Updated the following files:
M scripts/wp-setup.sh
file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..fa49f1b045e55a9a785e3c267dca3c4dfa4852f4
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,46 +22,89 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
       - ./scripts:/scripts
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: ["/bin/bash", "/scripts/wp-setup.sh"]
+
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/scripts/wp-setup.sh b/scripts/wp-setup.sh
index 5072cd4c2d555bf27dc1658d9988eeecc3f5fb4a..ad698dd0be0245ed0483afc2485c780f3f420e75
--- a/scripts/wp-setup.sh
+++ b/scripts/wp-setup.sh
@@ -21,6 +21,11 @@
 SEED_ORDERS=${SEED_ORDERS:-120}
 
 wait_for_wp() {
+  echo "Waiting for WordPress files..."
+  until [ -f "$WP_PATH/wp-load.php" ]; do
+    sleep 2
+  done
+
   echo "Waiting for WordPress config..."
   until [ -f "$WP_PATH/wp-config.php" ]; do
     sleep 2
@@ -47,7 +52,7 @@
 fi
 
 if ! wp plugin is-installed woocommerce --path="$WP_PATH" --allow-root >/dev/null 2>&1; then
-  wp plugin install woocommerce --version="$WOOCOMMERCE_VERSION" --activate --allow-root
+  wp plugin install woocommerce --version="$WOOCOMMERCE_VERSION" --activate --path="$WP_PATH" --allow-root
 else
   wp plugin activate woocommerce --path="$WP_PATH" --allow-root
 fi
@@ -63,4 +68,3 @@
 
 SEED_PRODUCTS="$SEED_PRODUCTS" SEED_ORDERS="$SEED_ORDERS" \
   wp eval-file /scripts/seed-woocommerce.php --path="$WP_PATH" --allow-root
-
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..1bd0ff415da80378840ce7016b66a948867345e7
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then
@@ -13,51 +19,9 @@
     exit 1
   fi
 fi
-
-set -a
-# shellcheck source=/dev/null
-source "$ENV_FILE"
-set +a
 
 $COMPOSE_CMD up -d db wordpress mailhog node
 
-echo "Waiting for MySQL to be ready..."
-until $COMPOSE_CMD exec -T db mysqladmin ping -h "localhost" -p"${WORDPRESS_DB_ROOT_PASSWORD}" --silent; do
-  sleep 2
-done
-
-echo "Waiting for WordPress to be ready..."
-until $COMPOSE_CMD exec -T wordpress test -f /var/www/html/wp-config.php; do
-  sleep 2
-done
-
-if ! $COMPOSE_CMD exec -T wordpress wp core is-installed --path=/var/www/html --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp core install \
-    --path=/var/www/html \
-    --url="$WORDPRESS_SITE_URL" \
-    --title="$WORDPRESS_SITE_TITLE" \
-    --admin_user="$WORDPRESS_ADMIN_USER" \
-    --admin_password="$WORDPRESS_ADMIN_PASSWORD" \
-    --admin_email="$WORDPRESS_ADMIN_EMAIL" \
-    --skip-email \
-    --allow-root
-fi
-
-if ! $COMPOSE_CMD exec -T wordpress wp plugin is-installed woocommerce --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp plugin install woocommerce --activate --allow-root
-else
-  $COMPOSE_CMD exec -T wordpress wp plugin activate woocommerce --allow-root
-fi
-
-$COMPOSE_CMD exec -T wordpress wp wc tool run install_pages --allow-root || true
-
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_address "$WC_STORE_ADDRESS" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_city "$WC_STORE_CITY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_state "$WC_STORE_STATE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_postcode "$WC_STORE_POSTCODE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_default_country "$WC_DEFAULT_COUNTRY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_currency "$WC_CURRENCY" --allow-root
-
-$COMPOSE_CMD exec -T wordpress bash -c "SEED_PRODUCTS=${SEED_PRODUCTS:-60} SEED_ORDERS=${SEED_ORDERS:-120} wp eval-file /scripts/seed-woocommerce.php --path=/var/www/html --allow-root"
+$COMPOSE_CMD exec -T wordpress /scripts/wp-setup.sh
 
 echo "Setup complete."

file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..fa49f1b045e55a9a785e3c267dca3c4dfa4852f4
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,46 +22,89 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
       - ./scripts:/scripts
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: ["/bin/bash", "/scripts/wp-setup.sh"]
+
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/scripts/wp-setup.sh b/scripts/wp-setup.sh
index 5072cd4c2d555bf27dc1658d9988eeecc3f5fb4a..ad698dd0be0245ed0483afc2485c780f3f420e75
--- a/scripts/wp-setup.sh
+++ b/scripts/wp-setup.sh
@@ -21,6 +21,11 @@
 SEED_ORDERS=${SEED_ORDERS:-120}
 
 wait_for_wp() {
+  echo "Waiting for WordPress files..."
+  until [ -f "$WP_PATH/wp-load.php" ]; do
+    sleep 2
+  done
+
   echo "Waiting for WordPress config..."
   until [ -f "$WP_PATH/wp-config.php" ]; do
     sleep 2
@@ -47,7 +52,7 @@
 fi
 
 if ! wp plugin is-installed woocommerce --path="$WP_PATH" --allow-root >/dev/null 2>&1; then
-  wp plugin install woocommerce --version="$WOOCOMMERCE_VERSION" --activate --allow-root
+  wp plugin install woocommerce --version="$WOOCOMMERCE_VERSION" --activate --path="$WP_PATH" --allow-root
 else
   wp plugin activate woocommerce --path="$WP_PATH" --allow-root
 fi
@@ -63,4 +68,3 @@
 
 SEED_PRODUCTS="$SEED_PRODUCTS" SEED_ORDERS="$SEED_ORDERS" \
   wp eval-file /scripts/seed-woocommerce.php --path="$WP_PATH" --allow-root
-
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..1bd0ff415da80378840ce7016b66a948867345e7
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then
@@ -13,51 +19,9 @@
     exit 1
   fi
 fi
-
-set -a
-# shellcheck source=/dev/null
-source "$ENV_FILE"
-set +a
 
 $COMPOSE_CMD up -d db wordpress mailhog node
 
-echo "Waiting for MySQL to be ready..."
-until $COMPOSE_CMD exec -T db mysqladmin ping -h "localhost" -p"${WORDPRESS_DB_ROOT_PASSWORD}" --silent; do
-  sleep 2
-done
-
-echo "Waiting for WordPress to be ready..."
-until $COMPOSE_CMD exec -T wordpress test -f /var/www/html/wp-config.php; do
-  sleep 2
-done
-
-if ! $COMPOSE_CMD exec -T wordpress wp core is-installed --path=/var/www/html --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp core install \
-    --path=/var/www/html \
-    --url="$WORDPRESS_SITE_URL" \
-    --title="$WORDPRESS_SITE_TITLE" \
-    --admin_user="$WORDPRESS_ADMIN_USER" \
-    --admin_password="$WORDPRESS_ADMIN_PASSWORD" \
-    --admin_email="$WORDPRESS_ADMIN_EMAIL" \
-    --skip-email \
-    --allow-root
-fi
-
-if ! $COMPOSE_CMD exec -T wordpress wp plugin is-installed woocommerce --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp plugin install woocommerce --activate --allow-root
-else
-  $COMPOSE_CMD exec -T wordpress wp plugin activate woocommerce --allow-root
-fi
-
-$COMPOSE_CMD exec -T wordpress wp wc tool run install_pages --allow-root || true
-
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_address "$WC_STORE_ADDRESS" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_city "$WC_STORE_CITY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_state "$WC_STORE_STATE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_postcode "$WC_STORE_POSTCODE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_default_country "$WC_DEFAULT_COUNTRY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_currency "$WC_CURRENCY" --allow-root
-
-$COMPOSE_CMD exec -T wordpress bash -c "SEED_PRODUCTS=${SEED_PRODUCTS:-60} SEED_ORDERS=${SEED_ORDERS:-120} wp eval-file /scripts/seed-woocommerce.php --path=/var/www/html --allow-root"
+$COMPOSE_CMD exec -T wordpress /scripts/wp-setup.sh
 
 echo "Setup complete."


thinking
**Reviewing WP-CLI commands and setup details**
exec
/bin/zsh -lc 'cat .env.example' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 65ms:
WORDPRESS_DB_NAME=agentwp
WORDPRESS_DB_USER=agentwp
WORDPRESS_DB_PASSWORD=agentwp
WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
WORDPRESS_TABLE_PREFIX=wp_
WOOCOMMERCE_VERSION=8.4.0

WORDPRESS_SITE_URL=http://localhost:8080
WORDPRESS_SITE_TITLE=AgentWP Dev Store
WORDPRESS_ADMIN_USER=admin
WORDPRESS_ADMIN_PASSWORD=admin123
WORDPRESS_ADMIN_EMAIL=admin@example.com

WORDPRESS_PORT=8080
MYSQL_PORT=3306
MAILHOG_UI_PORT=8025
MAILHOG_SMTP_PORT=1025
REACT_DEV_PORT=5173

WORDPRESS_DEBUG=false
file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..fa49f1b045e55a9a785e3c267dca3c4dfa4852f4
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,46 +22,89 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
       - ./scripts:/scripts
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: ["/bin/bash", "/scripts/wp-setup.sh"]
+
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/scripts/wp-setup.sh b/scripts/wp-setup.sh
index 5072cd4c2d555bf27dc1658d9988eeecc3f5fb4a..ad698dd0be0245ed0483afc2485c780f3f420e75
--- a/scripts/wp-setup.sh
+++ b/scripts/wp-setup.sh
@@ -21,6 +21,11 @@
 SEED_ORDERS=${SEED_ORDERS:-120}
 
 wait_for_wp() {
+  echo "Waiting for WordPress files..."
+  until [ -f "$WP_PATH/wp-load.php" ]; do
+    sleep 2
+  done
+
   echo "Waiting for WordPress config..."
   until [ -f "$WP_PATH/wp-config.php" ]; do
     sleep 2
@@ -47,7 +52,7 @@
 fi
 
 if ! wp plugin is-installed woocommerce --path="$WP_PATH" --allow-root >/dev/null 2>&1; then
-  wp plugin install woocommerce --version="$WOOCOMMERCE_VERSION" --activate --allow-root
+  wp plugin install woocommerce --version="$WOOCOMMERCE_VERSION" --activate --path="$WP_PATH" --allow-root
 else
   wp plugin activate woocommerce --path="$WP_PATH" --allow-root
 fi
@@ -63,4 +68,3 @@
 
 SEED_PRODUCTS="$SEED_PRODUCTS" SEED_ORDERS="$SEED_ORDERS" \
   wp eval-file /scripts/seed-woocommerce.php --path="$WP_PATH" --allow-root
-
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..1bd0ff415da80378840ce7016b66a948867345e7
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then
@@ -13,51 +19,9 @@
     exit 1
   fi
 fi
-
-set -a
-# shellcheck source=/dev/null
-source "$ENV_FILE"
-set +a
 
 $COMPOSE_CMD up -d db wordpress mailhog node
 
-echo "Waiting for MySQL to be ready..."
-until $COMPOSE_CMD exec -T db mysqladmin ping -h "localhost" -p"${WORDPRESS_DB_ROOT_PASSWORD}" --silent; do
-  sleep 2
-done
-
-echo "Waiting for WordPress to be ready..."
-until $COMPOSE_CMD exec -T wordpress test -f /var/www/html/wp-config.php; do
-  sleep 2
-done
-
-if ! $COMPOSE_CMD exec -T wordpress wp core is-installed --path=/var/www/html --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp core install \
-    --path=/var/www/html \
-    --url="$WORDPRESS_SITE_URL" \
-    --title="$WORDPRESS_SITE_TITLE" \
-    --admin_user="$WORDPRESS_ADMIN_USER" \
-    --admin_password="$WORDPRESS_ADMIN_PASSWORD" \
-    --admin_email="$WORDPRESS_ADMIN_EMAIL" \
-    --skip-email \
-    --allow-root
-fi
-
-if ! $COMPOSE_CMD exec -T wordpress wp plugin is-installed woocommerce --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp plugin install woocommerce --activate --allow-root
-else
-  $COMPOSE_CMD exec -T wordpress wp plugin activate woocommerce --allow-root
-fi
-
-$COMPOSE_CMD exec -T wordpress wp wc tool run install_pages --allow-root || true
-
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_address "$WC_STORE_ADDRESS" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_city "$WC_STORE_CITY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_state "$WC_STORE_STATE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_postcode "$WC_STORE_POSTCODE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_default_country "$WC_DEFAULT_COUNTRY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_currency "$WC_CURRENCY" --allow-root
-
-$COMPOSE_CMD exec -T wordpress bash -c "SEED_PRODUCTS=${SEED_PRODUCTS:-60} SEED_ORDERS=${SEED_ORDERS:-120} wp eval-file /scripts/seed-woocommerce.php --path=/var/www/html --allow-root"
+$COMPOSE_CMD exec -T wordpress /scripts/wp-setup.sh
 
 echo "Setup complete."


thinking
**Summarizing final deployment and setup details**

I’m gathering all key points about the Docker compose setup, WordPress and WooCommerce customization, seeding scripts, React scaffold, and environment files. I’m also organizing clear verification steps and noting risks like network needs during build and seeding timing issues. This will give a solid overview of the entire implementation and usage instructions.
codex
Status: DONE

Summary of changes
- Built the dockerized stack with WordPress, MySQL, Node/Vite, Mailhog, and an auto-seeding init service in `docker-compose.yml`.
- Added a custom WordPress image that bundles WP-CLI, WooCommerce 8.4.x, and Mailhog sendmail config in `docker/wordpress/Dockerfile`.
- Added setup and seeding automation in `setup.sh`, `scripts/wp-setup.sh`, and `scripts/seed-woocommerce.php`.
- Added a minimal React dev scaffold under `react/` and a full config template in `.env.example`.

How to verify
```sh
cp .env.example .env
docker-compose up -d
docker-compose exec -T wordpress wp wc product list --path=/var/www/html --allow-root
docker-compose exec -T wordpress wp wc order list --path=/var/www/html --allow-root
```

Risks / follow-ups
- Docker build and the Node dev container require network access to fetch WP-CLI, WooCommerce, Mailhog sendmail, and npm dependencies.
- If the init run doesn’t seed as expected, rerun `./setup.sh` or inspect `docker-compose logs wp_setup`.
file update:
diff --git a/.env.example b/.env.example
index c2879ebbce03d4610a27aca3eff43f824c25e1f2..9bba758293bcb1c370039c15023cc8be6f5735f6
--- a/.env.example
+++ b/.env.example
@@ -3,6 +3,7 @@
 WORDPRESS_DB_PASSWORD=agentwp
 WORDPRESS_DB_ROOT_PASSWORD=agentwp_root
 WORDPRESS_TABLE_PREFIX=wp_
+WOOCOMMERCE_VERSION=8.4.0
 
 WORDPRESS_SITE_URL=http://localhost:8080
 WORDPRESS_SITE_TITLE=AgentWP Dev Store
diff --git a/docker-compose.yml b/docker-compose.yml
index 12a17da84ce1b8850f9597dea84d4a1e21488373..fa49f1b045e55a9a785e3c267dca3c4dfa4852f4
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -5,16 +5,16 @@
     image: mysql:8.0
     command: --default-authentication-plugin=mysql_native_password
     environment:
-      MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
-      MYSQL_USER: ${WORDPRESS_DB_USER}
-      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD}
+      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-agentwp}
+      MYSQL_USER: ${WORDPRESS_DB_USER:-agentwp}
+      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      MYSQL_ROOT_PASSWORD: ${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}
     ports:
-      - "${MYSQL_PORT}:3306"
+      - "${MYSQL_PORT:-3306}:3306"
     volumes:
       - db_data:/var/lib/mysql
     healthcheck:
-      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD}"]
+      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-p${WORDPRESS_DB_ROOT_PASSWORD:-agentwp_root}"]
       interval: 5s
       timeout: 5s
       retries: 20
@@ -22,46 +22,89 @@
   wordpress:
     build:
       context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
     depends_on:
-      db:
-        condition: service_healthy
+      - db
     ports:
-      - "${WORDPRESS_PORT}:80"
+      - "${WORDPRESS_PORT:-8080}:80"
     environment:
       WORDPRESS_DB_HOST: db:3306
-      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
-      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
-      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
-      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
+      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-agentwp}
+      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD:-agentwp}
+      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-agentwp}
+      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX:-wp_}
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
       WORDPRESS_CONFIG_EXTRA: |
-        define('WP_DEBUG', ${WORDPRESS_DEBUG});
-        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG});
-        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY});
+        define('WP_DEBUG', ${WORDPRESS_DEBUG:-false});
+        define('WP_DEBUG_LOG', ${WORDPRESS_DEBUG_LOG:-true});
+        define('WP_DEBUG_DISPLAY', ${WORDPRESS_DEBUG_DISPLAY:-false});
         define('WP_ENVIRONMENT_TYPE', 'development');
-        define('WP_HOME', '${WORDPRESS_SITE_URL}');
-        define('WP_SITEURL', '${WORDPRESS_SITE_URL}');
+        define('WP_HOME', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
+        define('WP_SITEURL', '${WORDPRESS_SITE_URL:-http://localhost:8080}');
         define('FS_METHOD', 'direct');
     volumes:
       - ./wp:/var/www/html
       - ./scripts:/scripts
 
+  wp_setup:
+    build:
+      context: ./docker/wordpress
+      args:
+        WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    depends_on:
+      - db
+      - wordpress
+    environment:
+      WORDPRESS_SITE_URL: ${WORDPRESS_SITE_URL:-http://localhost:8080}
+      WORDPRESS_SITE_TITLE: ${WORDPRESS_SITE_TITLE:-AgentWP Dev Store}
+      WORDPRESS_ADMIN_USER: ${WORDPRESS_ADMIN_USER:-admin}
+      WORDPRESS_ADMIN_PASSWORD: ${WORDPRESS_ADMIN_PASSWORD:-admin123}
+      WORDPRESS_ADMIN_EMAIL: ${WORDPRESS_ADMIN_EMAIL:-admin@example.com}
+      WC_STORE_ADDRESS: ${WC_STORE_ADDRESS:-100 Market St}
+      WC_STORE_CITY: ${WC_STORE_CITY:-San Francisco}
+      WC_STORE_STATE: ${WC_STORE_STATE:-CA}
+      WC_STORE_POSTCODE: ${WC_STORE_POSTCODE:-94105}
+      WC_DEFAULT_COUNTRY: ${WC_DEFAULT_COUNTRY:-US:CA}
+      WC_CURRENCY: ${WC_CURRENCY:-USD}
+      SEED_PRODUCTS: ${SEED_PRODUCTS:-60}
+      SEED_ORDERS: ${SEED_ORDERS:-120}
+      WOOCOMMERCE_VERSION: ${WOOCOMMERCE_VERSION:-8.4.0}
+    volumes:
+      - ./wp:/var/www/html
+      - ./scripts:/scripts
+    entrypoint: ["/bin/bash", "/scripts/wp-setup.sh"]
+
   node:
     image: node:20-alpine
     working_dir: /app
-    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT}"
+    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port ${REACT_DEV_PORT:-5173}"
     environment:
       CHOKIDAR_USEPOLLING: "true"
-      REACT_DEV_PORT: ${REACT_DEV_PORT}
+      REACT_DEV_PORT: ${REACT_DEV_PORT:-5173}
     ports:
-      - "${REACT_DEV_PORT}:${REACT_DEV_PORT}"
+      - "${REACT_DEV_PORT:-5173}:${REACT_DEV_PORT:-5173}"
     volumes:
       - ./react:/app
 
   mailhog:
     image: mailhog/mailhog:v1.0.1
     ports:
-      - "${MAILHOG_UI_PORT}:8025"
-      - "${MAILHOG_SMTP_PORT}:1025"
+      - "${MAILHOG_UI_PORT:-8025}:8025"
+      - "${MAILHOG_SMTP_PORT:-1025}:1025"
 
 volumes:
   db_data:
diff --git a/docker/wordpress/Dockerfile b/docker/wordpress/Dockerfile
index 6ca20917a87e758d77f08dc018ca1d2cd322ad15..e2315c4ee55b3e0b4d290864acd750eb8315d9d8
--- a/docker/wordpress/Dockerfile
+++ b/docker/wordpress/Dockerfile
@@ -1,12 +1,17 @@
 FROM wordpress:6.4.3-php8.1-apache
 
+ARG WOOCOMMERCE_VERSION=8.4.0
+
 RUN set -eux; \
   apt-get update; \
-  apt-get install -y --no-install-recommends ca-certificates curl less; \
+  apt-get install -y --no-install-recommends ca-certificates curl less unzip; \
   curl -L -o /usr/local/bin/wp https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar; \
   chmod +x /usr/local/bin/wp; \
   curl -L -o /usr/local/bin/mhsendmail https://github.com/mailhog/mhsendmail/releases/download/v0.2.0/mhsendmail_linux_amd64; \
   chmod +x /usr/local/bin/mhsendmail; \
   echo "sendmail_path = /usr/local/bin/mhsendmail --smtp-addr=mailhog:1025" > /usr/local/etc/php/conf.d/mailhog.ini; \
+  curl -L -o /tmp/woocommerce.zip https://downloads.wordpress.org/plugin/woocommerce.${WOOCOMMERCE_VERSION}.zip; \
+  unzip -q /tmp/woocommerce.zip -d /usr/src/wordpress/wp-content/plugins; \
+  rm -f /tmp/woocommerce.zip; \
   apt-get clean; \
   rm -rf /var/lib/apt/lists/*
diff --git a/scripts/wp-setup.sh b/scripts/wp-setup.sh
index 5072cd4c2d555bf27dc1658d9988eeecc3f5fb4a..ad698dd0be0245ed0483afc2485c780f3f420e75
--- a/scripts/wp-setup.sh
+++ b/scripts/wp-setup.sh
@@ -21,6 +21,11 @@
 SEED_ORDERS=${SEED_ORDERS:-120}
 
 wait_for_wp() {
+  echo "Waiting for WordPress files..."
+  until [ -f "$WP_PATH/wp-load.php" ]; do
+    sleep 2
+  done
+
   echo "Waiting for WordPress config..."
   until [ -f "$WP_PATH/wp-config.php" ]; do
     sleep 2
@@ -47,7 +52,7 @@
 fi
 
 if ! wp plugin is-installed woocommerce --path="$WP_PATH" --allow-root >/dev/null 2>&1; then
-  wp plugin install woocommerce --version="$WOOCOMMERCE_VERSION" --activate --allow-root
+  wp plugin install woocommerce --version="$WOOCOMMERCE_VERSION" --activate --path="$WP_PATH" --allow-root
 else
   wp plugin activate woocommerce --path="$WP_PATH" --allow-root
 fi
@@ -63,4 +68,3 @@
 
 SEED_PRODUCTS="$SEED_PRODUCTS" SEED_ORDERS="$SEED_ORDERS" \
   wp eval-file /scripts/seed-woocommerce.php --path="$WP_PATH" --allow-root
-
diff --git a/setup.sh b/setup.sh
index 7f847cf7df900cac4cf4f79c9133610f35da48f4..1bd0ff415da80378840ce7016b66a948867345e7
--- a/setup.sh
+++ b/setup.sh
@@ -1,7 +1,13 @@
 #!/usr/bin/env bash
 set -euo pipefail
 
-COMPOSE_CMD=${COMPOSE_CMD:-docker-compose}
+if [ -z "${COMPOSE_CMD:-}" ]; then
+  if command -v docker-compose >/dev/null 2>&1; then
+    COMPOSE_CMD=docker-compose
+  else
+    COMPOSE_CMD="docker compose"
+  fi
+fi
 ENV_FILE=${ENV_FILE:-.env}
 
 if [ ! -f "$ENV_FILE" ]; then
@@ -13,51 +19,9 @@
     exit 1
   fi
 fi
-
-set -a
-# shellcheck source=/dev/null
-source "$ENV_FILE"
-set +a
 
 $COMPOSE_CMD up -d db wordpress mailhog node
 
-echo "Waiting for MySQL to be ready..."
-until $COMPOSE_CMD exec -T db mysqladmin ping -h "localhost" -p"${WORDPRESS_DB_ROOT_PASSWORD}" --silent; do
-  sleep 2
-done
-
-echo "Waiting for WordPress to be ready..."
-until $COMPOSE_CMD exec -T wordpress test -f /var/www/html/wp-config.php; do
-  sleep 2
-done
-
-if ! $COMPOSE_CMD exec -T wordpress wp core is-installed --path=/var/www/html --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp core install \
-    --path=/var/www/html \
-    --url="$WORDPRESS_SITE_URL" \
-    --title="$WORDPRESS_SITE_TITLE" \
-    --admin_user="$WORDPRESS_ADMIN_USER" \
-    --admin_password="$WORDPRESS_ADMIN_PASSWORD" \
-    --admin_email="$WORDPRESS_ADMIN_EMAIL" \
-    --skip-email \
-    --allow-root
-fi
-
-if ! $COMPOSE_CMD exec -T wordpress wp plugin is-installed woocommerce --allow-root >/dev/null 2>&1; then
-  $COMPOSE_CMD exec -T wordpress wp plugin install woocommerce --activate --allow-root
-else
-  $COMPOSE_CMD exec -T wordpress wp plugin activate woocommerce --allow-root
-fi
-
-$COMPOSE_CMD exec -T wordpress wp wc tool run install_pages --allow-root || true
-
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_address "$WC_STORE_ADDRESS" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_city "$WC_STORE_CITY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_state "$WC_STORE_STATE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_store_postcode "$WC_STORE_POSTCODE" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_default_country "$WC_DEFAULT_COUNTRY" --allow-root
-$COMPOSE_CMD exec -T wordpress wp option update woocommerce_currency "$WC_CURRENCY" --allow-root
-
-$COMPOSE_CMD exec -T wordpress bash -c "SEED_PRODUCTS=${SEED_PRODUCTS:-60} SEED_ORDERS=${SEED_ORDERS:-120} wp eval-file /scripts/seed-woocommerce.php --path=/var/www/html --allow-root"
+$COMPOSE_CMD exec -T wordpress /scripts/wp-setup.sh
 
 echo "Setup complete."

tokens used
92,217
