---

## Status: DONE

## Summary of Changes

Aligned draft/preview payload structures across all intent handlers to ensure consistent frontend consumption without per-intent special casing.

### Backend (PHP)
1. **OrderRefundService** - Added `summary` field to preview, standardized response fields
2. **OrderStatusService** - Added `summary` to both single and bulk previews, enriched preview data
3. **ProductStockService** - Added `summary` field, enriched preview with product details
4. **EmailDraftService** - Refactored to return `ServiceResult`, added `summary` and consistent structure
5. **EmailDraftServiceInterface** - Updated return type to `ServiceResult`
6. **EmailDraftHandler** - Updated to use `toLegacyArray()` on service result

### Frontend (TypeScript)
- Added comprehensive type definitions in `react/src/types/index.ts`:
  - `DraftType`, `BaseDraftPreview`, `RefundPreview`, `StatusPreview`, `BulkStatusPreview`, `StockPreview`, `EmailContext`, `DraftPreview`, `DraftResponse`

### Documentation
- Added "Draft Payload Structures" section to `docs/API.md` documenting all draft types and their fields

## How to Verify

```bash
# PHP syntax checks
php -l src/Services/OrderRefundService.php
php -l src/Services/OrderStatusService.php
php -l src/Services/ProductStockService.php
php -l src/Services/EmailDraftService.php

# TypeScript compilation
cd react && npx tsc --noEmit

# Run unit tests
vendor/bin/phpunit --testsuite=unit
```

All 313 unit tests pass.

## Risks / Follow-ups

1. **No Breaking Changes** - The changes are additive; existing fields remain unchanged, only new fields (`summary`, `type`, `expires_at`, `ttl`) were added
2. **AI Integration** - The AI receives richer data (summaries) which can improve response quality
3. **Frontend Integration** - The TypeScript types are now available but the frontend would need to be updated to actually render draft cards/previews if that UI is desired in the future
