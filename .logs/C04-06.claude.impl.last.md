---

## Status: DONE

## Summary of changes

1. **SettingsManager** (`src/Plugin/SettingsManager.php`):
   - Added `OPTION_MEMORY_LIMIT` and `OPTION_MEMORY_TTL` constants
   - Added `DEFAULT_MEMORY_LIMIT` (5) and `DEFAULT_MEMORY_TTL` (1800 seconds) constants
   - Added `getMemoryLimit()` and `setMemoryLimit()` methods with min enforcement (≥1)
   - Added `getMemoryTtl()` and `setMemoryTtl()` methods with min enforcement (≥60 seconds)
   - Updated `initializeDefaults()` to set memory configuration on activation

2. **IntentServiceProvider** (`src/Providers/IntentServiceProvider.php`):
   - Updated `registerMemoryStore()` to read config from SettingsManager
   - Added WordPress filters `agentwp_memory_limit` and `agentwp_memory_ttl` for runtime customization
   - Graceful fallback to defaults if SettingsManager unavailable

3. **New test files**:
   - `tests/Fakes/FakeOptions.php` - In-memory options storage for testing
   - `tests/Unit/Plugin/SettingsManagerMemoryTest.php` - 17 tests for settings methods
   - `tests/Unit/Intent/MemoryStoreConfigTest.php` - 6 tests for provider wiring
   - `tests/Unit/Intent/MemoryStoreTest.php` - 10 tests for MemoryStore constructor

## How to verify

```bash
# Run all unit tests
./vendor/bin/phpunit tests/Unit/ --testdox

# Run just the new memory-related tests
./vendor/bin/phpunit tests/Unit/Plugin/SettingsManagerMemoryTest.php tests/Unit/Intent/MemoryStoreConfigTest.php tests/Unit/Intent/MemoryStoreTest.php --testdox
```

## Usage example

**Via WordPress Options** (persisted):
```php
$settings = $container->get(SettingsManager::class);
$settings->setMemoryLimit(10);  // Store up to 10 memory entries
$settings->setMemoryTtl(3600);  // 1 hour TTL
```

**Via WordPress Filters** (runtime override):
```php
add_filter('agentwp_memory_limit', fn() => 20);     // 20 entries max
add_filter('agentwp_memory_ttl', fn() => 7200);     // 2 hour TTL
```

## Risks / follow-ups

- **Low risk**: No breaking changes; defaults match previous hardcoded values (5 limit, 1800s TTL)
- **Follow-up consideration**: REST API endpoint to expose/update memory settings could be added if admin UI control is needed
- **Filter documentation**: Consider adding filter documentation to developer docs for third-party customization
