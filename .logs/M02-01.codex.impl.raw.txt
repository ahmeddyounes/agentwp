Status: DONE

Summary of changes
- Added intent engine core with classifier, context builder, session memory, function registry, and handlers in `src/Intent/Engine.php`, `src/Intent/IntentClassifier.php`, `src/Intent/ContextBuilder.php`, `src/Intent/MemoryStore.php`, `src/Intent/FunctionRegistry.php`, `src/Intent/Handler.php`, `src/Intent/Intent.php`, and `src/Intent/Handlers/*.php`
- Wired the engine into the REST intent endpoint, including prompt/input validation and handler responses in `src/Rest/IntentController.php`

How to verify
- No verification commands were provided.

Risks / follow-ups
- Rule-based intent matching in `src/Intent/IntentClassifier.php` may need tuning for edge cases.
- Session-based memory in `src/Intent/MemoryStore.php` depends on sessions being available in the hosting environment.

OpenAI Codex v0.77.0 (research preview)
--------
workdir: /Users/ahmedyounis/Documents/Projects/agentwp
model: gpt-5.2-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019b94c9-6163-7480-a352-91a43a7cea5d
--------
user
You are implementing task M02-01 in this git repository.

1) Read the spec: .plans/M02-01.md
2) Read handoff/context: .t2/handoff/M02-01.md

Implement the spec fully.

Verification commands (run if non-empty):
- format: 
- lint: 
- test: 

In your final response, include:
- Status: DONE or NEEDS-REVIEW
- Summary of changes
- How to verify (exact commands)
- Risks / follow-ups

mcp startup: no servers

thinking
**Preparing to read specifications**
exec
/bin/zsh -lc ls in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 31ms:
agentwp.php
assets
composer.json
docker
docker-compose.yml
docs
includes
languages
react
README.md
scripts
setup.sh
src
tasks.csv
uninstall.php

thinking
**Checking plan and handoff files**
exec
/bin/zsh -lc 'cat .plans/M02-01.md' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 42ms:
# M02-01 — Intent Engine Core

Build the intent classification and routing system in PHP: 1) AgentWP\Intent\Engine class that receives natural language input and routes to appropriate handler. 2) Define intent categories: ORDER_SEARCH, ORDER_REFUND, ORDER_STATUS, PRODUCT_STOCK, EMAIL_DRAFT, ANALYTICS_QUERY, CUSTOMER_LOOKUP. 3) Create AgentWP\Intent\Handler interface with methods: canHandle(string $intent): bool, handle(array $context): Response. 4) Context builder that enriches requests with: current user, recent orders (last 5), store timezone, currency. 5) Function registry mapping OpenAI function names to PHP handlers. 6) Implement conversation memory within session (last 5 exchanges). 7) Fallback handler for unrecognized intents with helpful suggestions. Acceptance Criteria: Correct intent identified >95% of test cases, context includes relevant store data, handlers receive properly structured input, unhandled intents suggest alternatives.

thinking
**Reading handoff note**
exec
/bin/zsh -lc 'cat .t2/handoff/M02-01.md' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
# Handoff: M02-01

Created: 2026-01-06T19:29:44.251038Z

Spec: .plans/M02-01.md

thinking
**Exploring repo structure for implementation**
exec
/bin/zsh -lc 'rg --files' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 58ms:
src/Rest/HealthController.php
src/Rest/SettingsController.php
src/Rest/IntentController.php
src/API/RestController.php
src/AI/Functions/GetSalesReport.php
src/AI/Functions/SearchOrders.php
src/AI/Functions/PrepareBulkStatusUpdate.php
src/AI/Functions/SelectOrders.php
src/AI/Functions/ConfirmRefund.php
src/AI/Functions/FunctionSchema.php
src/AI/Functions/SearchProduct.php
src/AI/Functions/GetCustomerProfile.php
src/AI/Functions/AbstractFunction.php
src/AI/Functions/PrepareStockUpdate.php
src/AI/Functions/PrepareRefund.php
src/AI/Functions/BulkUpdate.php
src/AI/Functions/DraftEmail.php
src/AI/Functions/PrepareStatusUpdate.php
src/AI/TokenCounter.php
src/AI/OpenAIClient.php

thinking
**Searching for intent-related code**
exec
/bin/zsh -lc 'rg -n "Intent|intent" src' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 56ms:
src/Plugin.php:188:		if ( class_exists( 'AgentWP\\Rest\\IntentController' ) ) {
src/Plugin.php:189:			$controller = new Rest\IntentController();
src/Rest/IntentController.php:3: * Intent REST controller.
src/Rest/IntentController.php:13:class IntentController extends RestController {
src/Rest/IntentController.php:22:			'/intent',
src/Rest/IntentController.php:25:				'callback'            => array( $this, 'create_intent' ),
src/Rest/IntentController.php:32:	 * Handle intent requests.
src/Rest/IntentController.php:37:	public function create_intent( $request ) {
src/Rest/IntentController.php:38:		$validation = $this->validate_request( $request, $this->get_intent_schema() );
src/Rest/IntentController.php:45:				'intent_id' => wp_generate_uuid4(),
src/Rest/IntentController.php:47:				'message'   => __( 'Intent received for processing.', 'agentwp' ),
src/Rest/IntentController.php:53:	 * Schema for intent payload.
src/Rest/IntentController.php:57:	private function get_intent_schema() {
src/AI/Functions/DraftEmail.php:16:		return 'Draft a customer email for a given order and intent.';
src/AI/Functions/DraftEmail.php:23:			'required'             => array( 'order_id', 'intent', 'tone' ),
src/AI/Functions/DraftEmail.php:29:				'intent'              => array(

thinking
**Opening IntentController file**
exec
/bin/zsh -lc 'cat src/Rest/IntentController.php' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 47ms:
<?php
/**
 * Intent REST controller.
 *
 * @package AgentWP
 */

namespace AgentWP\Rest;

use AgentWP\API\RestController;
use WP_REST_Server;

class IntentController extends RestController {
	/**
	 * Register REST routes.
	 *
	 * @return void
	 */
	public function register_routes() {
		register_rest_route(

thinking
**Investigating AI function implementation**
exec
/bin/zsh -lc "sed -n '1,200p' src/AI/Functions/AbstractFunction.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 32ms:
<?php
/**
 * Base class for tool definitions.
 *
 * @package AgentWP
 */

namespace AgentWP\AI\Functions;

abstract class AbstractFunction implements FunctionSchema {
	/**
	 * @return array
	 */
	public function to_tool_definition() {
		return array(
			'type'     => 'function',
			'function' => array(
				'name'        => $this->get_name(),
				'description' => $this->get_description(),
				'parameters'  => $this->get_parameters(),

thinking
**Inspecting function pattern**
exec
/bin/zsh -lc "sed -n '1,200p' src/AI/Functions/SearchOrders.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 54ms:
<?php
/**
 * Function schema for order search.
 *
 * @package AgentWP
 */

namespace AgentWP\AI\Functions;

class SearchOrders extends AbstractFunction {
	public function get_name() {
		return 'search_orders';
	}

	public function get_description() {
		return 'Search for orders by query, ID, customer email, status, or date range.';
	}

	public function get_parameters() {
		return array(

thinking
**Searching for OpenAI function handlers**
exec
/bin/zsh -lc "sed -n '1,240p' src/AI/OpenAIClient.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 48ms:
<?php
/**
 * OpenAI API client wrapper.
 *
 * @package AgentWP
 */

namespace AgentWP\AI;

use AgentWP\AI\Functions\FunctionSchema;

class OpenAIClient {
	const API_BASE = 'https://api.openai.com/v1';

	/**
	 * @var string
	 */
	private $api_key;

	/**

thinking
**Preparing to implement intent engine classes**
exec
/bin/zsh -lc 'cat composer.json' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 52ms:
{
  "name": "agentwp/agentwp",
  "description": "AgentWP WordPress plugin.",
  "type": "wordpress-plugin",
  "license": "GPL-2.0-or-later",
  "autoload": {
    "psr-4": {
      "AgentWP\\": "src/"
    }
  },
  "require": {
    "php": ">=7.4",
    "yethee/tiktoken": "^0.1.2"
  }
}

thinking
**Reviewing architecture documentation**
exec
/bin/zsh -lc "sed -n '1,220p' docs/ARCHITECTURE.md" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
# AgentWP Technical Architecture

## 1) System Overview

AgentWP is a WordPress plugin that provides a React-powered admin UI (Command Deck) and a PHP backend that integrates with WooCommerce and the OpenAI API. The plugin exposes REST endpoints under `/wp-json/agentwp/v1` and uses standard WooCommerce tables plus `wp_options` for settings and encrypted BYOK storage.

```mermaid
flowchart LR
  subgraph WP[WordPress + WooCommerce]
    WPCore[WordPress Core]
    WC[WooCommerce]
    DB[(MySQL: wp_* tables)]
    WPCore --> WC
    WPCore --> DB
    WC --> DB
  end

  subgraph AgentWP[AgentWP Plugin]
    PHP[PHP Backend (AgentWP\*)]
    REST[REST API /wp-json/agentwp/v1/*]

thinking
**Planning integration with RestController**
exec
/bin/zsh -lc "sed -n '1,200p' src/API/RestController.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 40ms:
<?php
/**
 * Base REST controller.
 *
 * @package AgentWP
 */

namespace AgentWP\API;

use AgentWP\Plugin;
use WP_Error;
use WP_REST_Controller;
use WP_REST_Response;

abstract class RestController extends WP_REST_Controller {
	const REST_NAMESPACE = 'agentwp/v1';
	const RATE_LIMIT     = 60;
	const RATE_WINDOW    = 60;
	const LOG_LIMIT      = 50;


thinking
**Checking for Response class**
exec
/bin/zsh -lc "sed -n '1,200p' src/AI/Response.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
<?php
/**
 * OpenAI response wrapper.
 *
 * @package AgentWP
 */

namespace AgentWP\AI;

class Response {
	/**
	 * @var bool
	 */
	private $success;

	/**
	 * @var int
	 */
	private $status;


thinking
**Considering use of Response class**
exec
/bin/zsh -lc 'rg -n "session|Session" src' in /Users/ahmedyounis/Documents/Projects/agentwp exited 1 in 56ms:


thinking
**Planning WordPress session handling**
exec
/bin/zsh -lc "sed -n '1,240p' src/Plugin.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
<?php
/**
 * Core plugin bootstrap.
 *
 * @package AgentWP
 */

namespace AgentWP;

class Plugin {
	const OPTION_SETTINGS     = 'agentwp_settings';
	const OPTION_API_KEY      = 'agentwp_api_key';
	const OPTION_API_KEY_LAST4 = 'agentwp_api_key_last4';
	const OPTION_BUDGET_LIMIT = 'agentwp_budget_limit';
	const OPTION_DRAFT_TTL    = 'agentwp_draft_ttl_minutes';
	const OPTION_USAGE_STATS  = 'agentwp_usage_stats';
	const TRANSIENT_PREFIX    = 'agentwp_';

	/**
	 * @var Plugin|null

thinking
**Checking for existing AI tools**
exec
/bin/zsh -lc 'rg -n "OpenAIClient|Functions" src' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 59ms:
src/AI/Functions/GetSalesReport.php:8:namespace AgentWP\AI\Functions;
src/AI/Functions/SearchOrders.php:8:namespace AgentWP\AI\Functions;
src/AI/Functions/PrepareBulkStatusUpdate.php:8:namespace AgentWP\AI\Functions;
src/AI/Functions/SelectOrders.php:8:namespace AgentWP\AI\Functions;
src/AI/Functions/ConfirmRefund.php:8:namespace AgentWP\AI\Functions;
src/AI/Functions/FunctionSchema.php:8:namespace AgentWP\AI\Functions;
src/AI/Functions/SearchProduct.php:8:namespace AgentWP\AI\Functions;
src/AI/Functions/GetCustomerProfile.php:8:namespace AgentWP\AI\Functions;
src/AI/Functions/AbstractFunction.php:8:namespace AgentWP\AI\Functions;
src/AI/Functions/PrepareStockUpdate.php:8:namespace AgentWP\AI\Functions;
src/AI/Functions/PrepareRefund.php:8:namespace AgentWP\AI\Functions;
src/AI/Functions/BulkUpdate.php:8:namespace AgentWP\AI\Functions;
src/AI/Functions/DraftEmail.php:8:namespace AgentWP\AI\Functions;
src/AI/Functions/PrepareStatusUpdate.php:8:namespace AgentWP\AI\Functions;
src/AI/OpenAIClient.php:10:use AgentWP\AI\Functions\FunctionSchema;
src/AI/OpenAIClient.php:12:class OpenAIClient {

thinking
**Designing intent classification system**

I'm figuring out how to build a PHP intent engine that routes natural language input to handlers with context like user and orders, using heuristics for intent classification, session memory for conversation, and a function registry linking OpenAI function names to handlers, plus fallback for unknown intents. I'm also planning a modular code structure and careful integration with WordPress and WooCommerce.
exec
/bin/zsh -lc 'rg -n "get_name" src/AI/Functions' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 52ms:
src/AI/Functions/GetSalesReport.php:11:	public function get_name() {
src/AI/Functions/SearchOrders.php:11:	public function get_name() {
src/AI/Functions/PrepareBulkStatusUpdate.php:11:	public function get_name() {
src/AI/Functions/SelectOrders.php:11:	public function get_name() {
src/AI/Functions/ConfirmRefund.php:11:	public function get_name() {
src/AI/Functions/FunctionSchema.php:14:	public function get_name();
src/AI/Functions/SearchProduct.php:11:	public function get_name() {
src/AI/Functions/GetCustomerProfile.php:11:	public function get_name() {
src/AI/Functions/AbstractFunction.php:18:				'name'        => $this->get_name(),
src/AI/Functions/PrepareStockUpdate.php:11:	public function get_name() {
src/AI/Functions/PrepareRefund.php:11:	public function get_name() {
src/AI/Functions/BulkUpdate.php:11:	public function get_name() {
src/AI/Functions/DraftEmail.php:11:	public function get_name() {
src/AI/Functions/PrepareStatusUpdate.php:11:	public function get_name() {

thinking
**Mapping intents to functions**
exec
/bin/zsh -lc "sed -n '1,200p' src/AI/Functions/PrepareRefund.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 56ms:
<?php
/**
 * Function schema for refund preparation.
 *
 * @package AgentWP
 */

namespace AgentWP\AI\Functions;

class PrepareRefund extends AbstractFunction {
	public function get_name() {
		return 'prepare_refund';
	}

	public function get_description() {
		return 'Prepare a draft refund for an order without executing it.';
	}

	public function get_parameters() {
		return array(

thinking
**Outlining intent handling architecture**
exec
/bin/zsh -lc "sed -n '1,120p' src/AI/Functions/PrepareBulkStatusUpdate.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 49ms:
<?php
/**
 * Function schema for bulk order status updates.
 *
 * @package AgentWP
 */

namespace AgentWP\AI\Functions;

class PrepareBulkStatusUpdate extends AbstractFunction {
	public function get_name() {
		return 'prepare_bulk_status_update';
	}

	public function get_description() {
		return 'Prepare a draft bulk status update for multiple orders.';
	}

	public function get_parameters() {
		return array(

thinking
**Designing context and intent handling**

I’m gathering information on WordPress and WooCommerce functions to build context like store timezone, currency, recent orders, and current user data. I’m planning how to implement a memory store for session intents and update the IntentController to interact properly with the engine, handling requests with prompt or input fields. I’m outlining the structure of intent handlers, context builders, and response formats, balancing useful context inclusion in responses with avoiding excessive or sensitive data exposure. This will help create a flexible, minimal, and spec-compliant intent engine core.
exec
/bin/zsh -lc 'rg -n "intent" react/src' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 45ms:
react/src/App.jsx:10:const REST_PATH = '/agentwp/v1/intent';
exec
/bin/zsh -lc "sed -n '1,200p' react/src/App.jsx" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 108ms:
import { useCallback, useEffect, useRef, useState } from 'react';
import ReactMarkdown from 'react-markdown';

const OPEN_STATE_KEY = 'agentwp-command-deck-open';
const ADMIN_TRIGGER_SELECTORS = [
  '#wp-admin-bar-agentwp',
  '[data-agentwp-command-deck]',
  '#agentwp-command-deck',
];
const REST_PATH = '/agentwp/v1/intent';
const FOCUSABLE_SELECTORS = [
  'a[href]',
  'button:not([disabled])',
  'textarea:not([disabled])',
  'input:not([disabled])',
  'select:not([disabled])',
  '[tabindex]:not([tabindex="-1"])',
];

const getInitialOpenState = () => {

thinking
**Noticing REST path usage**
exec
/bin/zsh -lc 'rg -n "prompt" react/src/App.jsx' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 47ms:
81:  const [prompt, setPrompt] = useState('');
256:    const trimmedPrompt = prompt.trim();
284:        body: JSON.stringify({ prompt: trimmedPrompt }),
341:            <h2 className="text-lg font-semibold text-white">Try a sample prompt</h2>
410:                <label htmlFor="agentwp-prompt" className="sr-only">
415:                    id="agentwp-prompt"
418:                    value={prompt}
425:                    disabled={loading || !prompt.trim()}

thinking
**Checking prompt handling in schema**
exec
/bin/zsh -lc "sed -n '240,330p' react/src/App.jsx" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 54ms:
        first.focus();
      }
    };

    document.addEventListener('keydown', handleKeydown);
    return () => document.removeEventListener('keydown', handleKeydown);
  }, [closeModal, isOpen]);

  useEffect(() => {
    return () => {
      abortActiveRequest();
    };
  }, [abortActiveRequest]);

  const handleSubmit = async (event) => {
    event.preventDefault();
    const trimmedPrompt = prompt.trim();
    if (!trimmedPrompt || loading) {
      return;
    }

thinking
**Structuring intent response data**
exec
/bin/zsh -lc "sed -n '1,160p' src/AI/TokenCounter.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 52ms:
<?php
/**
 * Token counting helpers using tiktoken-php.
 *
 * @package AgentWP
 */

namespace AgentWP\AI;

class TokenCounter {
	/**
	 * @var array<string, mixed>
	 */
	private $encoders = array();

	/**
	 * Count tokens for a chat request payload.
	 *
	 * @param array  $messages Chat messages.
	 * @param array  $tools Tool definitions.

thinking
**Planning patch application with style guidelines**
Plan update
Implement intent engine core with context building, handlers, and REST integration.
  ✓ Review existing REST intent flow and AI function definitions to align intent categories and response shape.
  → Add intent engine core classes (intent constants, classifier, context builder, memory, handlers, function registry).
  • Wire the engine into the REST intent controller and ensure responses include messages and fallback suggestions.

thinking
**Designing intent classification system**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Intent.php
<?php
/**
 * Intent categories.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

class Intent {
	const ORDER_SEARCH    = 'ORDER_SEARCH';
	const ORDER_REFUND    = 'ORDER_REFUND';
	const ORDER_STATUS    = 'ORDER_STATUS';
	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
	const UNKNOWN         = 'UNKNOWN';

	/**
	 * @return array
	 */
	public static function all() {
		return array(
			self::ORDER_SEARCH,
			self::ORDER_REFUND,
			self::ORDER_STATUS,
			self::PRODUCT_STOCK,
			self::EMAIL_DRAFT,
			self::ANALYTICS_QUERY,
			self::CUSTOMER_LOOKUP,
		);
	}

	/**
	 * @return array
	 */
	public static function labels() {
		return array(
			self::ORDER_SEARCH    => 'Order search',
			self::ORDER_REFUND    => 'Order refund',
			self::ORDER_STATUS    => 'Order status',
			self::PRODUCT_STOCK   => 'Product stock',
			self::EMAIL_DRAFT     => 'Email draft',
			self::ANALYTICS_QUERY => 'Analytics query',
			self::CUSTOMER_LOOKUP => 'Customer lookup',
		);
	}

	/**
	 * @return array
	 */
	public static function suggestions() {
		return array(
			array(
				'intent'  => self::ORDER_SEARCH,
				'label'   => 'Search for an order',
				'example' => 'Find the last order from jane@example.com.',
			),
			array(
				'intent'  => self::ORDER_REFUND,
				'label'   => 'Prepare a refund',
				'example' => 'Refund order 1452 for $25.',
			),
			array(
				'intent'  => self::ORDER_STATUS,
				'label'   => 'Check or update order status',
				'example' => 'What is the status of order 1452?',
			),
			array(
				'intent'  => self::PRODUCT_STOCK,
				'label'   => 'Check product stock',
				'example' => 'How many units of the blue hoodie are in stock?',
			),
			array(
				'intent'  => self::EMAIL_DRAFT,
				'label'   => 'Draft a customer email',
				'example' => 'Draft an apology email for order 1452.',
			),
			array(
				'intent'  => self::ANALYTICS_QUERY,
				'label'   => 'Run an analytics report',
				'example' => 'Show sales performance for last week.',
			),
			array(
				'intent'  => self::CUSTOMER_LOOKUP,
				'label'   => 'Look up a customer profile',
				'example' => 'Pull the profile for mary@example.com.',
			),
		);
	}

	/**
	 * @param string $intent Intent value.
	 * @return string
	 */
	public static function normalize( $intent ) {
		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
		if ( in_array( $intent, self::all(), true ) ) {
			return $intent;
		}

		return self::UNKNOWN;
	}
}
apply_patch(auto_approved=true) exited 0 in 31ms:
Success. Updated the following files:
A src/Intent/Intent.php
file update:
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}

file update:
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}


thinking
**Examining next Handler interface**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Handler.php
<?php
/**
 * Intent handler contract.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

use AgentWP\AI\Response;

interface Handler {
	/**
	 * @param string $intent Intent identifier.
	 * @return bool
	 */
	public function canHandle( string $intent ): bool;

	/**
	 * @param array $context Enriched request context.
	 * @return Response
	 */
	public function handle( array $context ): Response;
}
apply_patch(auto_approved=true) exited 0 in 42ms:
Success. Updated the following files:
A src/Intent/Handler.php
file update:
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}

file update:
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}


thinking
**Examining ContextBuilder**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/ContextBuilder.php
<?php
/**
 * Build enriched intent context.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

class ContextBuilder {
	/**
	 * Build context with store and user data.
	 *
	 * @param array $context Request context.
	 * @param array $metadata Request metadata.
	 * @return array
	 */
	public function build( array $context = array(), array $metadata = array() ) {
		return array(
			'request'       => $context,
			'metadata'      => $metadata,
			'user'          => $this->get_user_context(),
			'recent_orders' => $this->get_recent_orders(),
			'store'         => $this->get_store_context(),
		);
	}

	/**
	 * @return array
	 */
	private function get_user_context() {
		if ( ! function_exists( 'wp_get_current_user' ) ) {
			return array();
		}

		$user = wp_get_current_user();
		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
			return array();
		}

		return array(
			'id'           => intval( $user->ID ),
			'display_name' => sanitize_text_field( $user->display_name ),
			'email'        => sanitize_email( $user->user_email ),
			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
		);
	}

	/**
	 * @return array
	 */
	private function get_recent_orders() {
		if ( ! function_exists( 'wc_get_orders' ) ) {
			return array();
		}

		$orders = wc_get_orders(
			array(
				'limit'   => 5,
				'orderby' => 'date',
				'order'   => 'DESC',
			)
		);

		if ( ! is_array( $orders ) ) {
			return array();
		}

		$summary = array();
		foreach ( $orders as $order ) {
			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
				continue;
			}

			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;

			$summary[] = array(
				'id'           => intval( $order->get_id() ),
				'status'       => sanitize_text_field( $order->get_status() ),
				'total'        => $order->get_total(),
				'currency'     => sanitize_text_field( $order->get_currency() ),
				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
			);
		}

		return $summary;
	}

	/**
	 * @return array
	 */
	private function get_store_context() {
		$timezone = '';

		if ( function_exists( 'wp_timezone_string' ) ) {
			$timezone = wp_timezone_string();
		}

		if ( '' === $timezone && function_exists( 'get_option' ) ) {
			$timezone = (string) get_option( 'timezone_string' );
		}

		if ( '' === $timezone && function_exists( 'get_option' ) ) {
			$offset   = (float) get_option( 'gmt_offset' );
			$sign     = $offset >= 0 ? '+' : '-';
			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
		}

		$currency = '';
		if ( function_exists( 'get_woocommerce_currency' ) ) {
			$currency = get_woocommerce_currency();
		} elseif ( function_exists( 'get_option' ) ) {
			$currency = (string) get_option( 'woocommerce_currency' );
		}

		return array(
			'timezone' => sanitize_text_field( $timezone ),
			'currency' => sanitize_text_field( $currency ),
		);
	}
}
apply_patch(auto_approved=true) exited 0 in 45ms:
Success. Updated the following files:
A src/Intent/ContextBuilder.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}


thinking
**Proceeding to MemoryStore**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/MemoryStore.php
<?php
/**
 * Conversation memory stored in session.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

class MemoryStore {
	const SESSION_KEY = 'agentwp_intent_memory';

	/**
	 * @var int
	 */
	private $limit;

	/**
	 * @param int $limit Max memory entries.
	 */
	public function __construct( $limit = 5 ) {
		$this->limit = max( 1, (int) $limit );
	}

	/**
	 * @return array
	 */
	public function get() {
		$this->ensure_session();

		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
			return array();
		}

		return array_values( $_SESSION[ self::SESSION_KEY ] );
	}

	/**
	 * @param array $entry Exchange entry.
	 * @return void
	 */
	public function add_exchange( array $entry ) {
		$this->ensure_session();

		$memory   = $this->get();
		$memory[] = $entry;

		if ( count( $memory ) > $this->limit ) {
			$memory = array_slice( $memory, -1 * $this->limit );
		}

		$_SESSION[ self::SESSION_KEY ] = $memory;
	}

	/**
	 * @return void
	 */
	private function ensure_session() {
		if ( headers_sent() ) {
			return;
		}

		if ( function_exists( 'session_status' ) ) {
			if ( PHP_SESSION_NONE === session_status() ) {
				session_start();
			}

			return;
		}

		if ( ! isset( $_SESSION ) ) {
			session_start();
		}
	}
}
apply_patch(auto_approved=true) exited 0 in 47ms:
Success. Updated the following files:
A src/Intent/MemoryStore.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Exploring FunctionRegistry**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/FunctionRegistry.php
<?php
/**
 * OpenAI function registry for intent handlers.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

class FunctionRegistry {
	/**
	 * @var array<string, Handler>
	 */
	private $map = array();

	/**
	 * @param string  $function_name OpenAI function name.
	 * @param Handler $handler Handler instance.
	 * @return void
	 */
	public function register( $function_name, Handler $handler ) {
		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
		if ( '' === $function_name ) {
			return;
		}

		$this->map[ $function_name ] = $handler;
	}

	/**
	 * @param string $function_name OpenAI function name.
	 * @return Handler|null
	 */
	public function get_handler( $function_name ) {
		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
		if ( '' === $function_name ) {
			return null;
		}

		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
	}

	/**
	 * @param string $intent Intent identifier.
	 * @return array
	 */
	public function get_functions_for_intent( $intent ) {
		$intent = Intent::normalize( $intent );
		$names  = array();

		foreach ( $this->map as $function_name => $handler ) {
			if ( $handler->canHandle( $intent ) ) {
				$names[] = $function_name;
			}
		}

		sort( $names );

		return $names;
	}

	/**
	 * @return array
	 */
	public function all() {
		return $this->map;
	}
}
apply_patch(auto_approved=true) exited 0 in 50ms:
Success. Updated the following files:
A src/Intent/FunctionRegistry.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Examining IntentClassifier**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/IntentClassifier.php
<?php
/**
 * Rule-based intent classifier.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

class IntentClassifier {
	/**
	 * @param string $input User input.
	 * @param array  $context Enriched context.
	 * @return string
	 */
	public function classify( $input, array $context = array() ) {
		if ( isset( $context['intent'] ) ) {
			$override = Intent::normalize( $context['intent'] );
			if ( Intent::UNKNOWN !== $override ) {
				return $override;
			}
		}

		$text = strtolower( trim( (string) $input ) );
		if ( '' === $text ) {
			return Intent::UNKNOWN;
		}

		$scores = array(
			Intent::ORDER_REFUND    => $this->score_refund( $text ),
			Intent::ORDER_STATUS    => $this->score_status( $text ),
			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
			Intent::ORDER_SEARCH    => $this->score_search( $text ),
		);

		$best_intent = Intent::UNKNOWN;
		$best_score  = 0;

		foreach ( $scores as $intent => $score ) {
			if ( $score > $best_score ) {
				$best_score  = $score;
				$best_intent = $intent;
			}
		}

		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
	}

	/**
	 * @param string $text Normalized text.
	 * @return int
	 */
	private function score_refund( $text ) {
		return $this->match_score(
			$text,
			array(
				'refund',
				'return',
				'chargeback',
				'money back',
				'reimburse',
			)
		);
	}

	/**
	 * @param string $text Normalized text.
	 * @return int
	 */
	private function score_status( $text ) {
		return $this->match_score(
			$text,
			array(
				'status',
				'tracking',
				'track',
				'shipment',
				'shipping',
				'delivery',
				'where is',
				'eta',
			)
		);
	}

	/**
	 * @param string $text Normalized text.
	 * @return int
	 */
	private function score_stock( $text ) {
		return $this->match_score(
			$text,
			array(
				'stock',
				'inventory',
				'available',
				'availability',
				'out of stock',
				'restock',
			)
		);
	}

	/**
	 * @param string $text Normalized text.
	 * @return int
	 */
	private function score_email( $text ) {
		$score = $this->match_score(
			$text,
			array(
				'email',
				'message',
				'compose',
				'draft',
				'write',
				'response',
			)
		);

		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
			$score++;
		}

		return $score;
	}

	/**
	 * @param string $text Normalized text.
	 * @return int
	 */
	private function score_analytics( $text ) {
		return $this->match_score(
			$text,
			array(
				'analytics',
				'report',
				'sales',
				'revenue',
				'performance',
				'conversion',
				'aov',
				'average order',
			)
		);
	}

	/**
	 * @param string $text Normalized text.
	 * @return int
	 */
	private function score_customer( $text ) {
		return $this->match_score(
			$text,
			array(
				'customer',
				'profile',
				'buyer',
				'account',
				'loyalty',
			)
		);
	}

	/**
	 * @param string $text Normalized text.
	 * @return int
	 */
	private function score_search( $text ) {
		return $this->match_score(
			$text,
			array(
				'search',
				'find',
				'lookup',
				'last order',
				'order id',
				'order #',
			)
		);
	}

	/**
	 * @param string $text Normalized text.
	 * @param array  $phrases Phrases to match.
	 * @return int
	 */
	private function match_score( $text, array $phrases ) {
		$score = 0;
		foreach ( $phrases as $phrase ) {
			if ( $this->contains_phrase( $text, $phrase ) ) {
				$score++;
			}
		}

		return $score;
	}

	/**
	 * @param string $text Normalized text.
	 * @param string $phrase Phrase to match.
	 * @return bool
	 */
	private function contains_phrase( $text, $phrase ) {
		$phrase = trim( $phrase );
		if ( '' === $phrase ) {
			return false;
		}

		return false !== strpos( $text, $phrase );
	}
}
apply_patch(auto_approved=true) exited 0 in 58ms:
Success. Updated the following files:
A src/Intent/IntentClassifier.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Creating base handler class**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Handlers/BaseHandler.php
<?php
/**
 * Base handler for intent responses.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Handler;
use AgentWP\Intent\Intent;

abstract class BaseHandler implements Handler {
	/**
	 * @var string
	 */
	protected $intent;

	/**
	 * @param string $intent Intent identifier.
	 */
	public function __construct( $intent ) {
		$this->intent = Intent::normalize( $intent );
	}

	/**
	 * @param string $intent Intent identifier.
	 * @return bool
	 */
	public function canHandle( string $intent ): bool {
		return Intent::normalize( $intent ) === $this->intent;
	}

	/**
	 * @param array  $context Context data.
	 * @param string $message Response message.
	 * @param array  $data Additional payload data.
	 * @return Response
	 */
	protected function build_response( array $context, $message, array $data = array() ) {
		$payload = array_merge(
			array(
				'intent'  => $this->intent,
				'message' => $message,
			),
			$data
		);

		if ( isset( $context['store'] ) ) {
			$payload['store'] = $context['store'];
		}

		if ( isset( $context['user'] ) ) {
			$payload['user'] = $context['user'];
		}

		if ( isset( $context['recent_orders'] ) ) {
			$payload['recent_orders'] = $context['recent_orders'];
		}

		if ( isset( $context['function_suggestions'] ) ) {
			$payload['function_suggestions'] = $context['function_suggestions'];
		}

		return Response::success( $payload );
	}
}
apply_patch(auto_approved=true) exited 0 in 78ms:
Success. Updated the following files:
A src/Intent/Handlers/BaseHandler.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Implementing handler classes**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Handlers/OrderSearchHandler.php
<?php
/**
 * Handle order search intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class OrderSearchHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::ORDER_SEARCH );
	}

	/**
	 * @param array $context Context data.
	 * @return Response
	 */
	public function handle( array $context ): Response {
		$message = 'I can search orders. Share an order ID, customer email, or date range.';
		return $this->build_response( $context, $message );
	}
}
apply_patch(auto_approved=true) exited 0 in 73ms:
Success. Updated the following files:
A src/Intent/Handlers/OrderSearchHandler.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Starting OrderRefundHandler**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Handlers/OrderRefundHandler.php
<?php
/**
 * Handle order refund intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class OrderRefundHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::ORDER_REFUND );
	}

	/**
	 * @param array $context Context data.
	 * @return Response
	 */
	public function handle( array $context ): Response {
		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
		return $this->build_response( $context, $message );
	}
}
apply_patch(auto_approved=true) exited 0 in 83ms:
Success. Updated the following files:
A src/Intent/Handlers/OrderRefundHandler.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Checking OrderStatusHandler**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Handlers/OrderStatusHandler.php
<?php
/**
 * Handle order status intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class OrderStatusHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::ORDER_STATUS );
	}

	/**
	 * @param array $context Context data.
	 * @return Response
	 */
	public function handle( array $context ): Response {
		$message = 'I can check or update order status. Tell me the order ID or customer.';
		return $this->build_response( $context, $message );
	}
}
apply_patch(auto_approved=true) exited 0 in 93ms:
Success. Updated the following files:
A src/Intent/Handlers/OrderStatusHandler.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Identifying ProductStockHandler**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Handlers/ProductStockHandler.php
<?php
/**
 * Handle product stock intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class ProductStockHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::PRODUCT_STOCK );
	}

	/**
	 * @param array $context Context data.
	 * @return Response
	 */
	public function handle( array $context ): Response {
		$message = 'I can check product stock. Share a product name or SKU.';
		return $this->build_response( $context, $message );
	}
}
apply_patch(auto_approved=true) exited 0 in 110ms:
Success. Updated the following files:
A src/Intent/Handlers/ProductStockHandler.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Identifying EmailDraftHandler**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Handlers/EmailDraftHandler.php
<?php
/**
 * Handle email draft intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class EmailDraftHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::EMAIL_DRAFT );
	}

	/**
	 * @param array $context Context data.
	 * @return Response
	 */
	public function handle( array $context ): Response {
		$message = 'I can draft a customer email. Share the order ID and desired tone.';
		return $this->build_response( $context, $message );
	}
}
apply_patch(auto_approved=true) exited 0 in 102ms:
Success. Updated the following files:
A src/Intent/Handlers/EmailDraftHandler.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Noting AnalyticsQueryHandler**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Handlers/AnalyticsQueryHandler.php
<?php
/**
 * Handle analytics query intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class AnalyticsQueryHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::ANALYTICS_QUERY );
	}

	/**
	 * @param array $context Context data.
	 * @return Response
	 */
	public function handle( array $context ): Response {
		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
		return $this->build_response( $context, $message );
	}
}
apply_patch(auto_approved=true) exited 0 in 111ms:
Success. Updated the following files:
A src/Intent/Handlers/AnalyticsQueryHandler.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Locating CustomerLookupHandler**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Handlers/CustomerLookupHandler.php
<?php
/**
 * Handle customer lookup intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class CustomerLookupHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::CUSTOMER_LOOKUP );
	}

	/**
	 * @param array $context Context data.
	 * @return Response
	 */
	public function handle( array $context ): Response {
		$message = 'I can look up customer profiles. Share an email or name.';
		return $this->build_response( $context, $message );
	}
}
apply_patch(auto_approved=true) exited 0 in 117ms:
Success. Updated the following files:
A src/Intent/Handlers/CustomerLookupHandler.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Identifying fallback handler**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Handlers/FallbackHandler.php
<?php
/**
 * Handle unknown intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class FallbackHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::UNKNOWN );
	}

	/**
	 * @param array $context Context data.
	 * @return Response
	 */
	public function handle( array $context ): Response {
		$message = 'I did not recognize that request. Try one of these suggestions.';
		return $this->build_response(
			$context,
			$message,
			array(
				'suggestions' => Intent::suggestions(),
			)
		);
	}
}
apply_patch(auto_approved=true) exited 0 in 108ms:
Success. Updated the following files:
A src/Intent/Handlers/FallbackHandler.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/FallbackHandler.php b/src/Intent/Handlers/FallbackHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fef46905751badeb9af6103faec2569a96e87582
--- /dev/null
+++ b/src/Intent/Handlers/FallbackHandler.php
@@ -0,0 +1,32 @@
+<?php
+/**
+ * Handle unknown intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class FallbackHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::UNKNOWN );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I did not recognize that request. Try one of these suggestions.';
+		return $this->build_response(
+			$context,
+			$message,
+			array(
+				'suggestions' => Intent::suggestions(),
+			)
+		);
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/FallbackHandler.php b/src/Intent/Handlers/FallbackHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fef46905751badeb9af6103faec2569a96e87582
--- /dev/null
+++ b/src/Intent/Handlers/FallbackHandler.php
@@ -0,0 +1,32 @@
+<?php
+/**
+ * Handle unknown intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class FallbackHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::UNKNOWN );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I did not recognize that request. Try one of these suggestions.';
+		return $this->build_response(
+			$context,
+			$message,
+			array(
+				'suggestions' => Intent::suggestions(),
+			)
+		);
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Designing the Engine class structure**
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Engine.php
<?php
/**
 * Intent engine for routing requests.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

use AgentWP\AI\Response;
use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
use AgentWP\Intent\Handlers\CustomerLookupHandler;
use AgentWP\Intent\Handlers\EmailDraftHandler;
use AgentWP\Intent\Handlers\FallbackHandler;
use AgentWP\Intent\Handlers\OrderRefundHandler;
use AgentWP\Intent\Handlers\OrderSearchHandler;
use AgentWP\Intent\Handlers\OrderStatusHandler;
use AgentWP\Intent\Handlers\ProductStockHandler;

class Engine {
	/**
	 * @var IntentClassifier
	 */
	private $classifier;

	/**
	 * @var ContextBuilder
	 */
	private $context_builder;

	/**
	 * @var MemoryStore
	 */
	private $memory;

	/**
	 * @var FunctionRegistry
	 */
	private $function_registry;

	/**
	 * @var Handler[]
	 */
	private $handlers = array();

	/**
	 * @var Handler
	 */
	private $fallback_handler;

	/**
	 * @param array|null $handlers Optional handlers.
	 * @param FunctionRegistry|null $function_registry Optional registry.
	 * @param ContextBuilder|null $context_builder Optional context builder.
	 * @param IntentClassifier|null $classifier Optional classifier.
	 * @param MemoryStore|null $memory Optional memory store.
	 */
	public function __construct(
		array $handlers = null,
		FunctionRegistry $function_registry = null,
		ContextBuilder $context_builder = null,
		IntentClassifier $classifier = null,
		MemoryStore $memory = null
	) {
		$this->classifier      = $classifier ? $classifier : new IntentClassifier();
		$this->context_builder = $context_builder ? $context_builder : new ContextBuilder();
		$this->memory          = $memory ? $memory : new MemoryStore( 5 );
		$this->function_registry = $function_registry ? $function_registry : new FunctionRegistry();
		$this->fallback_handler  = new FallbackHandler();

		$this->handlers = is_array( $handlers ) ? $handlers : $this->default_handlers();
		$this->register_default_functions();
	}

	/**
	 * Handle a natural language input.
	 *
	 * @param string $input User input.
	 * @param array  $context Request context.
	 * @param array  $metadata Request metadata.
	 * @return Response
	 */
	public function handle( $input, array $context = array(), array $metadata = array() ) {
		$input = is_string( $input ) ? trim( $input ) : '';
		if ( '' === $input ) {
			return Response::error( 'Missing intent input.', 400 );
		}

		$enriched = $this->context_builder->build( $context, $metadata );
		$enriched['input']   = $input;
		$enriched['memory']  = $this->memory->get();
		$enriched['intent']  = $this->classifier->classify( $input, $enriched );
		$enriched['intent']  = Intent::normalize( $enriched['intent'] );
		$enriched['function_suggestions'] = $this->function_registry->get_functions_for_intent( $enriched['intent'] );

		$handler  = $this->resolve_handler( $enriched['intent'] );
		$response = $handler->handle( $enriched );

		$this->memory->add_exchange(
			array(
				'time'    => gmdate( 'c' ),
				'input'   => $input,
				'intent'  => $enriched['intent'],
				'message' => $this->response_message( $response ),
			)
		);

		return $response;
	}

	/**
	 * @return FunctionRegistry
	 */
	public function get_function_registry() {
		return $this->function_registry;
	}

	/**
	 * @return array
	 */
	public function get_memory() {
		return $this->memory->get();
	}

	/**
	 * @return array
	 */
	private function default_handlers() {
		return array(
			new OrderSearchHandler(),
			new OrderRefundHandler(),
			new OrderStatusHandler(),
			new ProductStockHandler(),
			new EmailDraftHandler(),
			new AnalyticsQueryHandler(),
			new CustomerLookupHandler(),
		);
	}

	/**
	 * @param string $intent Intent identifier.
	 * @return Handler
	 */
	private function resolve_handler( $intent ) {
		foreach ( $this->handlers as $handler ) {
			if ( $handler instanceof Handler && $handler->canHandle( $intent ) ) {
				return $handler;
			}
		}

		return $this->fallback_handler;
	}

	/**
	 * @param Response $response Response instance.
	 * @return string
	 */
	private function response_message( Response $response ) {
		if ( ! $response->is_success() ) {
			return $response->get_message();
		}

		$data = $response->get_data();
		if ( is_array( $data ) && isset( $data['message'] ) ) {
			return (string) $data['message'];
		}

		return '';
	}

	/**
	 * @return void
	 */
	private function register_default_functions() {
		$mapping = array(
			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
		);

		foreach ( $mapping as $intent => $functions ) {
			$handler = $this->resolve_handler( $intent );
			if ( ! $handler || ! $handler->canHandle( $intent ) ) {
				continue;
			}

			foreach ( $functions as $function_name ) {
				$this->function_registry->register( $function_name, $handler );
			}
		}
	}
}
apply_patch(auto_approved=true) exited 0 in 122ms:
Success. Updated the following files:
A src/Intent/Engine.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
new file mode 100644
index 0000000000000000000000000000000000000000..644e59feed368a631440afd28907d417ae9fec9b
--- /dev/null
+++ b/src/Intent/Engine.php
@@ -0,0 +1,196 @@
+<?php
+/**
+ * Intent engine for routing requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
+use AgentWP\Intent\Handlers\CustomerLookupHandler;
+use AgentWP\Intent\Handlers\EmailDraftHandler;
+use AgentWP\Intent\Handlers\FallbackHandler;
+use AgentWP\Intent\Handlers\OrderRefundHandler;
+use AgentWP\Intent\Handlers\OrderSearchHandler;
+use AgentWP\Intent\Handlers\OrderStatusHandler;
+use AgentWP\Intent\Handlers\ProductStockHandler;
+
+class Engine {
+	/**
+	 * @var IntentClassifier
+	 */
+	private $classifier;
+
+	/**
+	 * @var ContextBuilder
+	 */
+	private $context_builder;
+
+	/**
+	 * @var MemoryStore
+	 */
+	private $memory;
+
+	/**
+	 * @var FunctionRegistry
+	 */
+	private $function_registry;
+
+	/**
+	 * @var Handler[]
+	 */
+	private $handlers = array();
+
+	/**
+	 * @var Handler
+	 */
+	private $fallback_handler;
+
+	/**
+	 * @param array|null $handlers Optional handlers.
+	 * @param FunctionRegistry|null $function_registry Optional registry.
+	 * @param ContextBuilder|null $context_builder Optional context builder.
+	 * @param IntentClassifier|null $classifier Optional classifier.
+	 * @param MemoryStore|null $memory Optional memory store.
+	 */
+	public function __construct(
+		array $handlers = null,
+		FunctionRegistry $function_registry = null,
+		ContextBuilder $context_builder = null,
+		IntentClassifier $classifier = null,
+		MemoryStore $memory = null
+	) {
+		$this->classifier      = $classifier ? $classifier : new IntentClassifier();
+		$this->context_builder = $context_builder ? $context_builder : new ContextBuilder();
+		$this->memory          = $memory ? $memory : new MemoryStore( 5 );
+		$this->function_registry = $function_registry ? $function_registry : new FunctionRegistry();
+		$this->fallback_handler  = new FallbackHandler();
+
+		$this->handlers = is_array( $handlers ) ? $handlers : $this->default_handlers();
+		$this->register_default_functions();
+	}
+
+	/**
+	 * Handle a natural language input.
+	 *
+	 * @param string $input User input.
+	 * @param array  $context Request context.
+	 * @param array  $metadata Request metadata.
+	 * @return Response
+	 */
+	public function handle( $input, array $context = array(), array $metadata = array() ) {
+		$input = is_string( $input ) ? trim( $input ) : '';
+		if ( '' === $input ) {
+			return Response::error( 'Missing intent input.', 400 );
+		}
+
+		$enriched = $this->context_builder->build( $context, $metadata );
+		$enriched['input']   = $input;
+		$enriched['memory']  = $this->memory->get();
+		$enriched['intent']  = $this->classifier->classify( $input, $enriched );
+		$enriched['intent']  = Intent::normalize( $enriched['intent'] );
+		$enriched['function_suggestions'] = $this->function_registry->get_functions_for_intent( $enriched['intent'] );
+
+		$handler  = $this->resolve_handler( $enriched['intent'] );
+		$response = $handler->handle( $enriched );
+
+		$this->memory->add_exchange(
+			array(
+				'time'    => gmdate( 'c' ),
+				'input'   => $input,
+				'intent'  => $enriched['intent'],
+				'message' => $this->response_message( $response ),
+			)
+		);
+
+		return $response;
+	}
+
+	/**
+	 * @return FunctionRegistry
+	 */
+	public function get_function_registry() {
+		return $this->function_registry;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get_memory() {
+		return $this->memory->get();
+	}
+
+	/**
+	 * @return array
+	 */
+	private function default_handlers() {
+		return array(
+			new OrderSearchHandler(),
+			new OrderRefundHandler(),
+			new OrderStatusHandler(),
+			new ProductStockHandler(),
+			new EmailDraftHandler(),
+			new AnalyticsQueryHandler(),
+			new CustomerLookupHandler(),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return Handler
+	 */
+	private function resolve_handler( $intent ) {
+		foreach ( $this->handlers as $handler ) {
+			if ( $handler instanceof Handler && $handler->canHandle( $intent ) ) {
+				return $handler;
+			}
+		}
+
+		return $this->fallback_handler;
+	}
+
+	/**
+	 * @param Response $response Response instance.
+	 * @return string
+	 */
+	private function response_message( Response $response ) {
+		if ( ! $response->is_success() ) {
+			return $response->get_message();
+		}
+
+		$data = $response->get_data();
+		if ( is_array( $data ) && isset( $data['message'] ) ) {
+			return (string) $data['message'];
+		}
+
+		return '';
+	}
+
+	/**
+	 * @return void
+	 */
+	private function register_default_functions() {
+		$mapping = array(
+			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
+			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
+			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
+			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
+			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
+			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
+			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
+		);
+
+		foreach ( $mapping as $intent => $functions ) {
+			$handler = $this->resolve_handler( $intent );
+			if ( ! $handler || ! $handler->canHandle( $intent ) ) {
+				continue;
+			}
+
+			foreach ( $functions as $function_name ) {
+				$this->function_registry->register( $function_name, $handler );
+			}
+		}
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/FallbackHandler.php b/src/Intent/Handlers/FallbackHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fef46905751badeb9af6103faec2569a96e87582
--- /dev/null
+++ b/src/Intent/Handlers/FallbackHandler.php
@@ -0,0 +1,32 @@
+<?php
+/**
+ * Handle unknown intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class FallbackHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::UNKNOWN );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I did not recognize that request. Try one of these suggestions.';
+		return $this->build_response(
+			$context,
+			$message,
+			array(
+				'suggestions' => Intent::suggestions(),
+			)
+		);
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
new file mode 100644
index 0000000000000000000000000000000000000000..644e59feed368a631440afd28907d417ae9fec9b
--- /dev/null
+++ b/src/Intent/Engine.php
@@ -0,0 +1,196 @@
+<?php
+/**
+ * Intent engine for routing requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
+use AgentWP\Intent\Handlers\CustomerLookupHandler;
+use AgentWP\Intent\Handlers\EmailDraftHandler;
+use AgentWP\Intent\Handlers\FallbackHandler;
+use AgentWP\Intent\Handlers\OrderRefundHandler;
+use AgentWP\Intent\Handlers\OrderSearchHandler;
+use AgentWP\Intent\Handlers\OrderStatusHandler;
+use AgentWP\Intent\Handlers\ProductStockHandler;
+
+class Engine {
+	/**
+	 * @var IntentClassifier
+	 */
+	private $classifier;
+
+	/**
+	 * @var ContextBuilder
+	 */
+	private $context_builder;
+
+	/**
+	 * @var MemoryStore
+	 */
+	private $memory;
+
+	/**
+	 * @var FunctionRegistry
+	 */
+	private $function_registry;
+
+	/**
+	 * @var Handler[]
+	 */
+	private $handlers = array();
+
+	/**
+	 * @var Handler
+	 */
+	private $fallback_handler;
+
+	/**
+	 * @param array|null $handlers Optional handlers.
+	 * @param FunctionRegistry|null $function_registry Optional registry.
+	 * @param ContextBuilder|null $context_builder Optional context builder.
+	 * @param IntentClassifier|null $classifier Optional classifier.
+	 * @param MemoryStore|null $memory Optional memory store.
+	 */
+	public function __construct(
+		array $handlers = null,
+		FunctionRegistry $function_registry = null,
+		ContextBuilder $context_builder = null,
+		IntentClassifier $classifier = null,
+		MemoryStore $memory = null
+	) {
+		$this->classifier      = $classifier ? $classifier : new IntentClassifier();
+		$this->context_builder = $context_builder ? $context_builder : new ContextBuilder();
+		$this->memory          = $memory ? $memory : new MemoryStore( 5 );
+		$this->function_registry = $function_registry ? $function_registry : new FunctionRegistry();
+		$this->fallback_handler  = new FallbackHandler();
+
+		$this->handlers = is_array( $handlers ) ? $handlers : $this->default_handlers();
+		$this->register_default_functions();
+	}
+
+	/**
+	 * Handle a natural language input.
+	 *
+	 * @param string $input User input.
+	 * @param array  $context Request context.
+	 * @param array  $metadata Request metadata.
+	 * @return Response
+	 */
+	public function handle( $input, array $context = array(), array $metadata = array() ) {
+		$input = is_string( $input ) ? trim( $input ) : '';
+		if ( '' === $input ) {
+			return Response::error( 'Missing intent input.', 400 );
+		}
+
+		$enriched = $this->context_builder->build( $context, $metadata );
+		$enriched['input']   = $input;
+		$enriched['memory']  = $this->memory->get();
+		$enriched['intent']  = $this->classifier->classify( $input, $enriched );
+		$enriched['intent']  = Intent::normalize( $enriched['intent'] );
+		$enriched['function_suggestions'] = $this->function_registry->get_functions_for_intent( $enriched['intent'] );
+
+		$handler  = $this->resolve_handler( $enriched['intent'] );
+		$response = $handler->handle( $enriched );
+
+		$this->memory->add_exchange(
+			array(
+				'time'    => gmdate( 'c' ),
+				'input'   => $input,
+				'intent'  => $enriched['intent'],
+				'message' => $this->response_message( $response ),
+			)
+		);
+
+		return $response;
+	}
+
+	/**
+	 * @return FunctionRegistry
+	 */
+	public function get_function_registry() {
+		return $this->function_registry;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get_memory() {
+		return $this->memory->get();
+	}
+
+	/**
+	 * @return array
+	 */
+	private function default_handlers() {
+		return array(
+			new OrderSearchHandler(),
+			new OrderRefundHandler(),
+			new OrderStatusHandler(),
+			new ProductStockHandler(),
+			new EmailDraftHandler(),
+			new AnalyticsQueryHandler(),
+			new CustomerLookupHandler(),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return Handler
+	 */
+	private function resolve_handler( $intent ) {
+		foreach ( $this->handlers as $handler ) {
+			if ( $handler instanceof Handler && $handler->canHandle( $intent ) ) {
+				return $handler;
+			}
+		}
+
+		return $this->fallback_handler;
+	}
+
+	/**
+	 * @param Response $response Response instance.
+	 * @return string
+	 */
+	private function response_message( Response $response ) {
+		if ( ! $response->is_success() ) {
+			return $response->get_message();
+		}
+
+		$data = $response->get_data();
+		if ( is_array( $data ) && isset( $data['message'] ) ) {
+			return (string) $data['message'];
+		}
+
+		return '';
+	}
+
+	/**
+	 * @return void
+	 */
+	private function register_default_functions() {
+		$mapping = array(
+			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
+			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
+			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
+			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
+			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
+			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
+			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
+		);
+
+		foreach ( $mapping as $intent => $functions ) {
+			$handler = $this->resolve_handler( $intent );
+			if ( ! $handler || ! $handler->canHandle( $intent ) ) {
+				continue;
+			}
+
+			foreach ( $functions as $function_name ) {
+				$this->function_registry->register( $function_name, $handler );
+			}
+		}
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/FallbackHandler.php b/src/Intent/Handlers/FallbackHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fef46905751badeb9af6103faec2569a96e87582
--- /dev/null
+++ b/src/Intent/Handlers/FallbackHandler.php
@@ -0,0 +1,32 @@
+<?php
+/**
+ * Handle unknown intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class FallbackHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::UNKNOWN );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I did not recognize that request. Try one of these suggestions.';
+		return $this->build_response(
+			$context,
+			$message,
+			array(
+				'suggestions' => Intent::suggestions(),
+			)
+		);
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Clarifying PHP constructor parameter types**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Engine.php
@@ -58,3 +58,3 @@
 	public function __construct(
-		array $handlers = null,
+		array $handlers = array(),
 		FunctionRegistry $function_registry = null,
@@ -70,3 +70,3 @@
 
-		$this->handlers = is_array( $handlers ) ? $handlers : $this->default_handlers();
+		$this->handlers = ! empty( $handlers ) ? $handlers : $this->default_handlers();
 		$this->register_default_functions();
apply_patch(auto_approved=true) exited 0 in 93ms:
Success. Updated the following files:
M src/Intent/Engine.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
new file mode 100644
index 0000000000000000000000000000000000000000..7bd3172c7eb44f90876ab42bf4a40b8bf60a4ac9
--- /dev/null
+++ b/src/Intent/Engine.php
@@ -0,0 +1,196 @@
+<?php
+/**
+ * Intent engine for routing requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
+use AgentWP\Intent\Handlers\CustomerLookupHandler;
+use AgentWP\Intent\Handlers\EmailDraftHandler;
+use AgentWP\Intent\Handlers\FallbackHandler;
+use AgentWP\Intent\Handlers\OrderRefundHandler;
+use AgentWP\Intent\Handlers\OrderSearchHandler;
+use AgentWP\Intent\Handlers\OrderStatusHandler;
+use AgentWP\Intent\Handlers\ProductStockHandler;
+
+class Engine {
+	/**
+	 * @var IntentClassifier
+	 */
+	private $classifier;
+
+	/**
+	 * @var ContextBuilder
+	 */
+	private $context_builder;
+
+	/**
+	 * @var MemoryStore
+	 */
+	private $memory;
+
+	/**
+	 * @var FunctionRegistry
+	 */
+	private $function_registry;
+
+	/**
+	 * @var Handler[]
+	 */
+	private $handlers = array();
+
+	/**
+	 * @var Handler
+	 */
+	private $fallback_handler;
+
+	/**
+	 * @param array|null $handlers Optional handlers.
+	 * @param FunctionRegistry|null $function_registry Optional registry.
+	 * @param ContextBuilder|null $context_builder Optional context builder.
+	 * @param IntentClassifier|null $classifier Optional classifier.
+	 * @param MemoryStore|null $memory Optional memory store.
+	 */
+	public function __construct(
+		array $handlers = array(),
+		FunctionRegistry $function_registry = null,
+		ContextBuilder $context_builder = null,
+		IntentClassifier $classifier = null,
+		MemoryStore $memory = null
+	) {
+		$this->classifier      = $classifier ? $classifier : new IntentClassifier();
+		$this->context_builder = $context_builder ? $context_builder : new ContextBuilder();
+		$this->memory          = $memory ? $memory : new MemoryStore( 5 );
+		$this->function_registry = $function_registry ? $function_registry : new FunctionRegistry();
+		$this->fallback_handler  = new FallbackHandler();
+
+		$this->handlers = ! empty( $handlers ) ? $handlers : $this->default_handlers();
+		$this->register_default_functions();
+	}
+
+	/**
+	 * Handle a natural language input.
+	 *
+	 * @param string $input User input.
+	 * @param array  $context Request context.
+	 * @param array  $metadata Request metadata.
+	 * @return Response
+	 */
+	public function handle( $input, array $context = array(), array $metadata = array() ) {
+		$input = is_string( $input ) ? trim( $input ) : '';
+		if ( '' === $input ) {
+			return Response::error( 'Missing intent input.', 400 );
+		}
+
+		$enriched = $this->context_builder->build( $context, $metadata );
+		$enriched['input']   = $input;
+		$enriched['memory']  = $this->memory->get();
+		$enriched['intent']  = $this->classifier->classify( $input, $enriched );
+		$enriched['intent']  = Intent::normalize( $enriched['intent'] );
+		$enriched['function_suggestions'] = $this->function_registry->get_functions_for_intent( $enriched['intent'] );
+
+		$handler  = $this->resolve_handler( $enriched['intent'] );
+		$response = $handler->handle( $enriched );
+
+		$this->memory->add_exchange(
+			array(
+				'time'    => gmdate( 'c' ),
+				'input'   => $input,
+				'intent'  => $enriched['intent'],
+				'message' => $this->response_message( $response ),
+			)
+		);
+
+		return $response;
+	}
+
+	/**
+	 * @return FunctionRegistry
+	 */
+	public function get_function_registry() {
+		return $this->function_registry;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get_memory() {
+		return $this->memory->get();
+	}
+
+	/**
+	 * @return array
+	 */
+	private function default_handlers() {
+		return array(
+			new OrderSearchHandler(),
+			new OrderRefundHandler(),
+			new OrderStatusHandler(),
+			new ProductStockHandler(),
+			new EmailDraftHandler(),
+			new AnalyticsQueryHandler(),
+			new CustomerLookupHandler(),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return Handler
+	 */
+	private function resolve_handler( $intent ) {
+		foreach ( $this->handlers as $handler ) {
+			if ( $handler instanceof Handler && $handler->canHandle( $intent ) ) {
+				return $handler;
+			}
+		}
+
+		return $this->fallback_handler;
+	}
+
+	/**
+	 * @param Response $response Response instance.
+	 * @return string
+	 */
+	private function response_message( Response $response ) {
+		if ( ! $response->is_success() ) {
+			return $response->get_message();
+		}
+
+		$data = $response->get_data();
+		if ( is_array( $data ) && isset( $data['message'] ) ) {
+			return (string) $data['message'];
+		}
+
+		return '';
+	}
+
+	/**
+	 * @return void
+	 */
+	private function register_default_functions() {
+		$mapping = array(
+			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
+			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
+			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
+			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
+			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
+			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
+			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
+		);
+
+		foreach ( $mapping as $intent => $functions ) {
+			$handler = $this->resolve_handler( $intent );
+			if ( ! $handler || ! $handler->canHandle( $intent ) ) {
+				continue;
+			}
+
+			foreach ( $functions as $function_name ) {
+				$this->function_registry->register( $function_name, $handler );
+			}
+		}
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/FallbackHandler.php b/src/Intent/Handlers/FallbackHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fef46905751badeb9af6103faec2569a96e87582
--- /dev/null
+++ b/src/Intent/Handlers/FallbackHandler.php
@@ -0,0 +1,32 @@
+<?php
+/**
+ * Handle unknown intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class FallbackHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::UNKNOWN );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I did not recognize that request. Try one of these suggestions.';
+		return $this->build_response(
+			$context,
+			$message,
+			array(
+				'suggestions' => Intent::suggestions(),
+			)
+		);
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
new file mode 100644
index 0000000000000000000000000000000000000000..7bd3172c7eb44f90876ab42bf4a40b8bf60a4ac9
--- /dev/null
+++ b/src/Intent/Engine.php
@@ -0,0 +1,196 @@
+<?php
+/**
+ * Intent engine for routing requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
+use AgentWP\Intent\Handlers\CustomerLookupHandler;
+use AgentWP\Intent\Handlers\EmailDraftHandler;
+use AgentWP\Intent\Handlers\FallbackHandler;
+use AgentWP\Intent\Handlers\OrderRefundHandler;
+use AgentWP\Intent\Handlers\OrderSearchHandler;
+use AgentWP\Intent\Handlers\OrderStatusHandler;
+use AgentWP\Intent\Handlers\ProductStockHandler;
+
+class Engine {
+	/**
+	 * @var IntentClassifier
+	 */
+	private $classifier;
+
+	/**
+	 * @var ContextBuilder
+	 */
+	private $context_builder;
+
+	/**
+	 * @var MemoryStore
+	 */
+	private $memory;
+
+	/**
+	 * @var FunctionRegistry
+	 */
+	private $function_registry;
+
+	/**
+	 * @var Handler[]
+	 */
+	private $handlers = array();
+
+	/**
+	 * @var Handler
+	 */
+	private $fallback_handler;
+
+	/**
+	 * @param array|null $handlers Optional handlers.
+	 * @param FunctionRegistry|null $function_registry Optional registry.
+	 * @param ContextBuilder|null $context_builder Optional context builder.
+	 * @param IntentClassifier|null $classifier Optional classifier.
+	 * @param MemoryStore|null $memory Optional memory store.
+	 */
+	public function __construct(
+		array $handlers = array(),
+		FunctionRegistry $function_registry = null,
+		ContextBuilder $context_builder = null,
+		IntentClassifier $classifier = null,
+		MemoryStore $memory = null
+	) {
+		$this->classifier      = $classifier ? $classifier : new IntentClassifier();
+		$this->context_builder = $context_builder ? $context_builder : new ContextBuilder();
+		$this->memory          = $memory ? $memory : new MemoryStore( 5 );
+		$this->function_registry = $function_registry ? $function_registry : new FunctionRegistry();
+		$this->fallback_handler  = new FallbackHandler();
+
+		$this->handlers = ! empty( $handlers ) ? $handlers : $this->default_handlers();
+		$this->register_default_functions();
+	}
+
+	/**
+	 * Handle a natural language input.
+	 *
+	 * @param string $input User input.
+	 * @param array  $context Request context.
+	 * @param array  $metadata Request metadata.
+	 * @return Response
+	 */
+	public function handle( $input, array $context = array(), array $metadata = array() ) {
+		$input = is_string( $input ) ? trim( $input ) : '';
+		if ( '' === $input ) {
+			return Response::error( 'Missing intent input.', 400 );
+		}
+
+		$enriched = $this->context_builder->build( $context, $metadata );
+		$enriched['input']   = $input;
+		$enriched['memory']  = $this->memory->get();
+		$enriched['intent']  = $this->classifier->classify( $input, $enriched );
+		$enriched['intent']  = Intent::normalize( $enriched['intent'] );
+		$enriched['function_suggestions'] = $this->function_registry->get_functions_for_intent( $enriched['intent'] );
+
+		$handler  = $this->resolve_handler( $enriched['intent'] );
+		$response = $handler->handle( $enriched );
+
+		$this->memory->add_exchange(
+			array(
+				'time'    => gmdate( 'c' ),
+				'input'   => $input,
+				'intent'  => $enriched['intent'],
+				'message' => $this->response_message( $response ),
+			)
+		);
+
+		return $response;
+	}
+
+	/**
+	 * @return FunctionRegistry
+	 */
+	public function get_function_registry() {
+		return $this->function_registry;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get_memory() {
+		return $this->memory->get();
+	}
+
+	/**
+	 * @return array
+	 */
+	private function default_handlers() {
+		return array(
+			new OrderSearchHandler(),
+			new OrderRefundHandler(),
+			new OrderStatusHandler(),
+			new ProductStockHandler(),
+			new EmailDraftHandler(),
+			new AnalyticsQueryHandler(),
+			new CustomerLookupHandler(),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return Handler
+	 */
+	private function resolve_handler( $intent ) {
+		foreach ( $this->handlers as $handler ) {
+			if ( $handler instanceof Handler && $handler->canHandle( $intent ) ) {
+				return $handler;
+			}
+		}
+
+		return $this->fallback_handler;
+	}
+
+	/**
+	 * @param Response $response Response instance.
+	 * @return string
+	 */
+	private function response_message( Response $response ) {
+		if ( ! $response->is_success() ) {
+			return $response->get_message();
+		}
+
+		$data = $response->get_data();
+		if ( is_array( $data ) && isset( $data['message'] ) ) {
+			return (string) $data['message'];
+		}
+
+		return '';
+	}
+
+	/**
+	 * @return void
+	 */
+	private function register_default_functions() {
+		$mapping = array(
+			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
+			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
+			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
+			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
+			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
+			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
+			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
+		);
+
+		foreach ( $mapping as $intent => $functions ) {
+			$handler = $this->resolve_handler( $intent );
+			if ( ! $handler || ! $handler->canHandle( $intent ) ) {
+				continue;
+			}
+
+			foreach ( $functions as $function_name ) {
+				$this->function_registry->register( $function_name, $handler );
+			}
+		}
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/FallbackHandler.php b/src/Intent/Handlers/FallbackHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fef46905751badeb9af6103faec2569a96e87582
--- /dev/null
+++ b/src/Intent/Handlers/FallbackHandler.php
@@ -0,0 +1,32 @@
+<?php
+/**
+ * Handle unknown intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class FallbackHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::UNKNOWN );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I did not recognize that request. Try one of these suggestions.';
+		return $this->build_response(
+			$context,
+			$message,
+			array(
+				'suggestions' => Intent::suggestions(),
+			)
+		);
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Updating the plan tool**
Plan update
  ✓ Review existing REST intent flow and AI function definitions to align intent categories and response shape.
  ✓ Add intent engine core classes (intent constants, classifier, context builder, memory, handlers, function registry).
  → Wire the engine into the REST intent controller and ensure responses include messages and fallback suggestions.
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
new file mode 100644
index 0000000000000000000000000000000000000000..7bd3172c7eb44f90876ab42bf4a40b8bf60a4ac9
--- /dev/null
+++ b/src/Intent/Engine.php
@@ -0,0 +1,196 @@
+<?php
+/**
+ * Intent engine for routing requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
+use AgentWP\Intent\Handlers\CustomerLookupHandler;
+use AgentWP\Intent\Handlers\EmailDraftHandler;
+use AgentWP\Intent\Handlers\FallbackHandler;
+use AgentWP\Intent\Handlers\OrderRefundHandler;
+use AgentWP\Intent\Handlers\OrderSearchHandler;
+use AgentWP\Intent\Handlers\OrderStatusHandler;
+use AgentWP\Intent\Handlers\ProductStockHandler;
+
+class Engine {
+	/**
+	 * @var IntentClassifier
+	 */
+	private $classifier;
+
+	/**
+	 * @var ContextBuilder
+	 */
+	private $context_builder;
+
+	/**
+	 * @var MemoryStore
+	 */
+	private $memory;
+
+	/**
+	 * @var FunctionRegistry
+	 */
+	private $function_registry;
+
+	/**
+	 * @var Handler[]
+	 */
+	private $handlers = array();
+
+	/**
+	 * @var Handler
+	 */
+	private $fallback_handler;
+
+	/**
+	 * @param array|null $handlers Optional handlers.
+	 * @param FunctionRegistry|null $function_registry Optional registry.
+	 * @param ContextBuilder|null $context_builder Optional context builder.
+	 * @param IntentClassifier|null $classifier Optional classifier.
+	 * @param MemoryStore|null $memory Optional memory store.
+	 */
+	public function __construct(
+		array $handlers = array(),
+		FunctionRegistry $function_registry = null,
+		ContextBuilder $context_builder = null,
+		IntentClassifier $classifier = null,
+		MemoryStore $memory = null
+	) {
+		$this->classifier      = $classifier ? $classifier : new IntentClassifier();
+		$this->context_builder = $context_builder ? $context_builder : new ContextBuilder();
+		$this->memory          = $memory ? $memory : new MemoryStore( 5 );
+		$this->function_registry = $function_registry ? $function_registry : new FunctionRegistry();
+		$this->fallback_handler  = new FallbackHandler();
+
+		$this->handlers = ! empty( $handlers ) ? $handlers : $this->default_handlers();
+		$this->register_default_functions();
+	}
+
+	/**
+	 * Handle a natural language input.
+	 *
+	 * @param string $input User input.
+	 * @param array  $context Request context.
+	 * @param array  $metadata Request metadata.
+	 * @return Response
+	 */
+	public function handle( $input, array $context = array(), array $metadata = array() ) {
+		$input = is_string( $input ) ? trim( $input ) : '';
+		if ( '' === $input ) {
+			return Response::error( 'Missing intent input.', 400 );
+		}
+
+		$enriched = $this->context_builder->build( $context, $metadata );
+		$enriched['input']   = $input;
+		$enriched['memory']  = $this->memory->get();
+		$enriched['intent']  = $this->classifier->classify( $input, $enriched );
+		$enriched['intent']  = Intent::normalize( $enriched['intent'] );
+		$enriched['function_suggestions'] = $this->function_registry->get_functions_for_intent( $enriched['intent'] );
+
+		$handler  = $this->resolve_handler( $enriched['intent'] );
+		$response = $handler->handle( $enriched );
+
+		$this->memory->add_exchange(
+			array(
+				'time'    => gmdate( 'c' ),
+				'input'   => $input,
+				'intent'  => $enriched['intent'],
+				'message' => $this->response_message( $response ),
+			)
+		);
+
+		return $response;
+	}
+
+	/**
+	 * @return FunctionRegistry
+	 */
+	public function get_function_registry() {
+		return $this->function_registry;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get_memory() {
+		return $this->memory->get();
+	}
+
+	/**
+	 * @return array
+	 */
+	private function default_handlers() {
+		return array(
+			new OrderSearchHandler(),
+			new OrderRefundHandler(),
+			new OrderStatusHandler(),
+			new ProductStockHandler(),
+			new EmailDraftHandler(),
+			new AnalyticsQueryHandler(),
+			new CustomerLookupHandler(),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return Handler
+	 */
+	private function resolve_handler( $intent ) {
+		foreach ( $this->handlers as $handler ) {
+			if ( $handler instanceof Handler && $handler->canHandle( $intent ) ) {
+				return $handler;
+			}
+		}
+
+		return $this->fallback_handler;
+	}
+
+	/**
+	 * @param Response $response Response instance.
+	 * @return string
+	 */
+	private function response_message( Response $response ) {
+		if ( ! $response->is_success() ) {
+			return $response->get_message();
+		}
+
+		$data = $response->get_data();
+		if ( is_array( $data ) && isset( $data['message'] ) ) {
+			return (string) $data['message'];
+		}
+
+		return '';
+	}
+
+	/**
+	 * @return void
+	 */
+	private function register_default_functions() {
+		$mapping = array(
+			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
+			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
+			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
+			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
+			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
+			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
+			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
+		);
+
+		foreach ( $mapping as $intent => $functions ) {
+			$handler = $this->resolve_handler( $intent );
+			if ( ! $handler || ! $handler->canHandle( $intent ) ) {
+				continue;
+			}
+
+			foreach ( $functions as $function_name ) {
+				$this->function_registry->register( $function_name, $handler );
+			}
+		}
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/FallbackHandler.php b/src/Intent/Handlers/FallbackHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fef46905751badeb9af6103faec2569a96e87582
--- /dev/null
+++ b/src/Intent/Handlers/FallbackHandler.php
@@ -0,0 +1,32 @@
+<?php
+/**
+ * Handle unknown intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class FallbackHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::UNKNOWN );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I did not recognize that request. Try one of these suggestions.';
+		return $this->build_response(
+			$context,
+			$message,
+			array(
+				'suggestions' => Intent::suggestions(),
+			)
+		);
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}


thinking
**Updating IntentController to integrate Engine and enhance validation**

I’m planning to modify `IntentController` to instantiate and use the `Engine` class after validating input. I’ll check for `prompt` or `input` fields in the payload, reject if both are empty, and then invoke the engine’s handler. I also want to ensure consistent error handling with proper status codes and success responses including added fields like `intent_id` and `status`. To support this, I’ll update the input schema by making `prompt` optional and accepting `input` with a manual validation step to require at least one of them. This way, the RESTful interface stays robust and backward-compatible with UI expectations.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/src/Rest/IntentController.php
@@ -10,2 +10,3 @@
 use AgentWP\API\RestController;
+use AgentWP\Intent\Engine;
 use WP_REST_Server;
@@ -42,9 +43,35 @@
 
-		return $this->response_success(
-			array(
-				'intent_id' => wp_generate_uuid4(),
-				'status'    => 'received',
-				'message'   => __( 'Intent received for processing.', 'agentwp' ),
-			)
-		);
+		$prompt = '';
+		if ( isset( $validation['prompt'] ) ) {
+			$prompt = (string) $validation['prompt'];
+		}
+
+		if ( '' === $prompt && isset( $validation['input'] ) ) {
+			$prompt = (string) $validation['input'];
+		}
+
+		$prompt = trim( $prompt );
+		if ( '' === $prompt ) {
+			return $this->response_error( 'agentwp_missing_prompt', __( 'Please provide a prompt.', 'agentwp' ), 400 );
+		}
+
+		$context  = isset( $validation['context'] ) && is_array( $validation['context'] )
+			? $validation['context']
+			: array();
+		$metadata = isset( $validation['metadata'] ) && is_array( $validation['metadata'] )
+			? $validation['metadata']
+			: array();
+
+		$engine   = new Engine();
+		$response = $engine->handle( $prompt, $context, $metadata );
+
+		if ( ! $response->is_success() ) {
+			return $this->response_error( 'agentwp_intent_failed', $response->get_message(), $response->get_status() );
+		}
+
+		$data               = $response->get_data();
+		$data['intent_id']  = wp_generate_uuid4();
+		$data['status']     = 'handled';
+
+		return $this->response_success( $data );
 	}
@@ -59,3 +86,2 @@
 			'type'     => 'object',
-			'required'             => array( 'prompt' ),
 			'properties'           => array(
@@ -65,2 +91,6 @@
 				),
+				'input'    => array(
+					'type'      => 'string',
+					'minLength' => 1,
+				),
 				'context'  => array(
apply_patch(auto_approved=true) exited 0 in 114ms:
Success. Updated the following files:
M src/Rest/IntentController.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
new file mode 100644
index 0000000000000000000000000000000000000000..7bd3172c7eb44f90876ab42bf4a40b8bf60a4ac9
--- /dev/null
+++ b/src/Intent/Engine.php
@@ -0,0 +1,196 @@
+<?php
+/**
+ * Intent engine for routing requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
+use AgentWP\Intent\Handlers\CustomerLookupHandler;
+use AgentWP\Intent\Handlers\EmailDraftHandler;
+use AgentWP\Intent\Handlers\FallbackHandler;
+use AgentWP\Intent\Handlers\OrderRefundHandler;
+use AgentWP\Intent\Handlers\OrderSearchHandler;
+use AgentWP\Intent\Handlers\OrderStatusHandler;
+use AgentWP\Intent\Handlers\ProductStockHandler;
+
+class Engine {
+	/**
+	 * @var IntentClassifier
+	 */
+	private $classifier;
+
+	/**
+	 * @var ContextBuilder
+	 */
+	private $context_builder;
+
+	/**
+	 * @var MemoryStore
+	 */
+	private $memory;
+
+	/**
+	 * @var FunctionRegistry
+	 */
+	private $function_registry;
+
+	/**
+	 * @var Handler[]
+	 */
+	private $handlers = array();
+
+	/**
+	 * @var Handler
+	 */
+	private $fallback_handler;
+
+	/**
+	 * @param array|null $handlers Optional handlers.
+	 * @param FunctionRegistry|null $function_registry Optional registry.
+	 * @param ContextBuilder|null $context_builder Optional context builder.
+	 * @param IntentClassifier|null $classifier Optional classifier.
+	 * @param MemoryStore|null $memory Optional memory store.
+	 */
+	public function __construct(
+		array $handlers = array(),
+		FunctionRegistry $function_registry = null,
+		ContextBuilder $context_builder = null,
+		IntentClassifier $classifier = null,
+		MemoryStore $memory = null
+	) {
+		$this->classifier      = $classifier ? $classifier : new IntentClassifier();
+		$this->context_builder = $context_builder ? $context_builder : new ContextBuilder();
+		$this->memory          = $memory ? $memory : new MemoryStore( 5 );
+		$this->function_registry = $function_registry ? $function_registry : new FunctionRegistry();
+		$this->fallback_handler  = new FallbackHandler();
+
+		$this->handlers = ! empty( $handlers ) ? $handlers : $this->default_handlers();
+		$this->register_default_functions();
+	}
+
+	/**
+	 * Handle a natural language input.
+	 *
+	 * @param string $input User input.
+	 * @param array  $context Request context.
+	 * @param array  $metadata Request metadata.
+	 * @return Response
+	 */
+	public function handle( $input, array $context = array(), array $metadata = array() ) {
+		$input = is_string( $input ) ? trim( $input ) : '';
+		if ( '' === $input ) {
+			return Response::error( 'Missing intent input.', 400 );
+		}
+
+		$enriched = $this->context_builder->build( $context, $metadata );
+		$enriched['input']   = $input;
+		$enriched['memory']  = $this->memory->get();
+		$enriched['intent']  = $this->classifier->classify( $input, $enriched );
+		$enriched['intent']  = Intent::normalize( $enriched['intent'] );
+		$enriched['function_suggestions'] = $this->function_registry->get_functions_for_intent( $enriched['intent'] );
+
+		$handler  = $this->resolve_handler( $enriched['intent'] );
+		$response = $handler->handle( $enriched );
+
+		$this->memory->add_exchange(
+			array(
+				'time'    => gmdate( 'c' ),
+				'input'   => $input,
+				'intent'  => $enriched['intent'],
+				'message' => $this->response_message( $response ),
+			)
+		);
+
+		return $response;
+	}
+
+	/**
+	 * @return FunctionRegistry
+	 */
+	public function get_function_registry() {
+		return $this->function_registry;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get_memory() {
+		return $this->memory->get();
+	}
+
+	/**
+	 * @return array
+	 */
+	private function default_handlers() {
+		return array(
+			new OrderSearchHandler(),
+			new OrderRefundHandler(),
+			new OrderStatusHandler(),
+			new ProductStockHandler(),
+			new EmailDraftHandler(),
+			new AnalyticsQueryHandler(),
+			new CustomerLookupHandler(),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return Handler
+	 */
+	private function resolve_handler( $intent ) {
+		foreach ( $this->handlers as $handler ) {
+			if ( $handler instanceof Handler && $handler->canHandle( $intent ) ) {
+				return $handler;
+			}
+		}
+
+		return $this->fallback_handler;
+	}
+
+	/**
+	 * @param Response $response Response instance.
+	 * @return string
+	 */
+	private function response_message( Response $response ) {
+		if ( ! $response->is_success() ) {
+			return $response->get_message();
+		}
+
+		$data = $response->get_data();
+		if ( is_array( $data ) && isset( $data['message'] ) ) {
+			return (string) $data['message'];
+		}
+
+		return '';
+	}
+
+	/**
+	 * @return void
+	 */
+	private function register_default_functions() {
+		$mapping = array(
+			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
+			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
+			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
+			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
+			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
+			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
+			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
+		);
+
+		foreach ( $mapping as $intent => $functions ) {
+			$handler = $this->resolve_handler( $intent );
+			if ( ! $handler || ! $handler->canHandle( $intent ) ) {
+				continue;
+			}
+
+			foreach ( $functions as $function_name ) {
+				$this->function_registry->register( $function_name, $handler );
+			}
+		}
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/FallbackHandler.php b/src/Intent/Handlers/FallbackHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fef46905751badeb9af6103faec2569a96e87582
--- /dev/null
+++ b/src/Intent/Handlers/FallbackHandler.php
@@ -0,0 +1,32 @@
+<?php
+/**
+ * Handle unknown intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class FallbackHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::UNKNOWN );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I did not recognize that request. Try one of these suggestions.';
+		return $this->build_response(
+			$context,
+			$message,
+			array(
+				'suggestions' => Intent::suggestions(),
+			)
+		);
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}
diff --git a/src/Rest/IntentController.php b/src/Rest/IntentController.php
index 027bca1a35799ff06be0baeebaff07a26376a73f..2986f48acc3c64d115c62428b2e0e2e0c55dce04
--- a/src/Rest/IntentController.php
+++ b/src/Rest/IntentController.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Rest;
 
 use AgentWP\API\RestController;
+use AgentWP\Intent\Engine;
 use WP_REST_Server;
 
 class IntentController extends RestController {
@@ -40,13 +41,39 @@
 			return $this->response_error( 'agentwp_invalid_request', $validation->get_error_message(), 400 );
 		}
 
-		return $this->response_success(
-			array(
-				'intent_id' => wp_generate_uuid4(),
-				'status'    => 'received',
-				'message'   => __( 'Intent received for processing.', 'agentwp' ),
-			)
-		);
+		$prompt = '';
+		if ( isset( $validation['prompt'] ) ) {
+			$prompt = (string) $validation['prompt'];
+		}
+
+		if ( '' === $prompt && isset( $validation['input'] ) ) {
+			$prompt = (string) $validation['input'];
+		}
+
+		$prompt = trim( $prompt );
+		if ( '' === $prompt ) {
+			return $this->response_error( 'agentwp_missing_prompt', __( 'Please provide a prompt.', 'agentwp' ), 400 );
+		}
+
+		$context  = isset( $validation['context'] ) && is_array( $validation['context'] )
+			? $validation['context']
+			: array();
+		$metadata = isset( $validation['metadata'] ) && is_array( $validation['metadata'] )
+			? $validation['metadata']
+			: array();
+
+		$engine   = new Engine();
+		$response = $engine->handle( $prompt, $context, $metadata );
+
+		if ( ! $response->is_success() ) {
+			return $this->response_error( 'agentwp_intent_failed', $response->get_message(), $response->get_status() );
+		}
+
+		$data               = $response->get_data();
+		$data['intent_id']  = wp_generate_uuid4();
+		$data['status']     = 'handled';
+
+		return $this->response_success( $data );
 	}
 
 	/**
@@ -57,12 +84,15 @@
 	private function get_intent_schema() {
 		return array(
 			'type'     => 'object',
-			'required'             => array( 'prompt' ),
 			'properties'           => array(
 				'prompt'   => array(
 					'type'      => 'string',
 					'minLength' => 1,
 				),
+				'input'    => array(
+					'type'      => 'string',
+					'minLength' => 1,
+				),
 				'context'  => array(
 					'type' => 'object',
 				),

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
new file mode 100644
index 0000000000000000000000000000000000000000..7bd3172c7eb44f90876ab42bf4a40b8bf60a4ac9
--- /dev/null
+++ b/src/Intent/Engine.php
@@ -0,0 +1,196 @@
+<?php
+/**
+ * Intent engine for routing requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
+use AgentWP\Intent\Handlers\CustomerLookupHandler;
+use AgentWP\Intent\Handlers\EmailDraftHandler;
+use AgentWP\Intent\Handlers\FallbackHandler;
+use AgentWP\Intent\Handlers\OrderRefundHandler;
+use AgentWP\Intent\Handlers\OrderSearchHandler;
+use AgentWP\Intent\Handlers\OrderStatusHandler;
+use AgentWP\Intent\Handlers\ProductStockHandler;
+
+class Engine {
+	/**
+	 * @var IntentClassifier
+	 */
+	private $classifier;
+
+	/**
+	 * @var ContextBuilder
+	 */
+	private $context_builder;
+
+	/**
+	 * @var MemoryStore
+	 */
+	private $memory;
+
+	/**
+	 * @var FunctionRegistry
+	 */
+	private $function_registry;
+
+	/**
+	 * @var Handler[]
+	 */
+	private $handlers = array();
+
+	/**
+	 * @var Handler
+	 */
+	private $fallback_handler;
+
+	/**
+	 * @param array|null $handlers Optional handlers.
+	 * @param FunctionRegistry|null $function_registry Optional registry.
+	 * @param ContextBuilder|null $context_builder Optional context builder.
+	 * @param IntentClassifier|null $classifier Optional classifier.
+	 * @param MemoryStore|null $memory Optional memory store.
+	 */
+	public function __construct(
+		array $handlers = array(),
+		FunctionRegistry $function_registry = null,
+		ContextBuilder $context_builder = null,
+		IntentClassifier $classifier = null,
+		MemoryStore $memory = null
+	) {
+		$this->classifier      = $classifier ? $classifier : new IntentClassifier();
+		$this->context_builder = $context_builder ? $context_builder : new ContextBuilder();
+		$this->memory          = $memory ? $memory : new MemoryStore( 5 );
+		$this->function_registry = $function_registry ? $function_registry : new FunctionRegistry();
+		$this->fallback_handler  = new FallbackHandler();
+
+		$this->handlers = ! empty( $handlers ) ? $handlers : $this->default_handlers();
+		$this->register_default_functions();
+	}
+
+	/**
+	 * Handle a natural language input.
+	 *
+	 * @param string $input User input.
+	 * @param array  $context Request context.
+	 * @param array  $metadata Request metadata.
+	 * @return Response
+	 */
+	public function handle( $input, array $context = array(), array $metadata = array() ) {
+		$input = is_string( $input ) ? trim( $input ) : '';
+		if ( '' === $input ) {
+			return Response::error( 'Missing intent input.', 400 );
+		}
+
+		$enriched = $this->context_builder->build( $context, $metadata );
+		$enriched['input']   = $input;
+		$enriched['memory']  = $this->memory->get();
+		$enriched['intent']  = $this->classifier->classify( $input, $enriched );
+		$enriched['intent']  = Intent::normalize( $enriched['intent'] );
+		$enriched['function_suggestions'] = $this->function_registry->get_functions_for_intent( $enriched['intent'] );
+
+		$handler  = $this->resolve_handler( $enriched['intent'] );
+		$response = $handler->handle( $enriched );
+
+		$this->memory->add_exchange(
+			array(
+				'time'    => gmdate( 'c' ),
+				'input'   => $input,
+				'intent'  => $enriched['intent'],
+				'message' => $this->response_message( $response ),
+			)
+		);
+
+		return $response;
+	}
+
+	/**
+	 * @return FunctionRegistry
+	 */
+	public function get_function_registry() {
+		return $this->function_registry;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get_memory() {
+		return $this->memory->get();
+	}
+
+	/**
+	 * @return array
+	 */
+	private function default_handlers() {
+		return array(
+			new OrderSearchHandler(),
+			new OrderRefundHandler(),
+			new OrderStatusHandler(),
+			new ProductStockHandler(),
+			new EmailDraftHandler(),
+			new AnalyticsQueryHandler(),
+			new CustomerLookupHandler(),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return Handler
+	 */
+	private function resolve_handler( $intent ) {
+		foreach ( $this->handlers as $handler ) {
+			if ( $handler instanceof Handler && $handler->canHandle( $intent ) ) {
+				return $handler;
+			}
+		}
+
+		return $this->fallback_handler;
+	}
+
+	/**
+	 * @param Response $response Response instance.
+	 * @return string
+	 */
+	private function response_message( Response $response ) {
+		if ( ! $response->is_success() ) {
+			return $response->get_message();
+		}
+
+		$data = $response->get_data();
+		if ( is_array( $data ) && isset( $data['message'] ) ) {
+			return (string) $data['message'];
+		}
+
+		return '';
+	}
+
+	/**
+	 * @return void
+	 */
+	private function register_default_functions() {
+		$mapping = array(
+			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
+			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
+			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
+			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
+			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
+			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
+			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
+		);
+
+		foreach ( $mapping as $intent => $functions ) {
+			$handler = $this->resolve_handler( $intent );
+			if ( ! $handler || ! $handler->canHandle( $intent ) ) {
+				continue;
+			}
+
+			foreach ( $functions as $function_name ) {
+				$this->function_registry->register( $function_name, $handler );
+			}
+		}
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/FallbackHandler.php b/src/Intent/Handlers/FallbackHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fef46905751badeb9af6103faec2569a96e87582
--- /dev/null
+++ b/src/Intent/Handlers/FallbackHandler.php
@@ -0,0 +1,32 @@
+<?php
+/**
+ * Handle unknown intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class FallbackHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::UNKNOWN );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I did not recognize that request. Try one of these suggestions.';
+		return $this->build_response(
+			$context,
+			$message,
+			array(
+				'suggestions' => Intent::suggestions(),
+			)
+		);
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}
diff --git a/src/Rest/IntentController.php b/src/Rest/IntentController.php
index 027bca1a35799ff06be0baeebaff07a26376a73f..2986f48acc3c64d115c62428b2e0e2e0c55dce04
--- a/src/Rest/IntentController.php
+++ b/src/Rest/IntentController.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Rest;
 
 use AgentWP\API\RestController;
+use AgentWP\Intent\Engine;
 use WP_REST_Server;
 
 class IntentController extends RestController {
@@ -40,13 +41,39 @@
 			return $this->response_error( 'agentwp_invalid_request', $validation->get_error_message(), 400 );
 		}
 
-		return $this->response_success(
-			array(
-				'intent_id' => wp_generate_uuid4(),
-				'status'    => 'received',
-				'message'   => __( 'Intent received for processing.', 'agentwp' ),
-			)
-		);
+		$prompt = '';
+		if ( isset( $validation['prompt'] ) ) {
+			$prompt = (string) $validation['prompt'];
+		}
+
+		if ( '' === $prompt && isset( $validation['input'] ) ) {
+			$prompt = (string) $validation['input'];
+		}
+
+		$prompt = trim( $prompt );
+		if ( '' === $prompt ) {
+			return $this->response_error( 'agentwp_missing_prompt', __( 'Please provide a prompt.', 'agentwp' ), 400 );
+		}
+
+		$context  = isset( $validation['context'] ) && is_array( $validation['context'] )
+			? $validation['context']
+			: array();
+		$metadata = isset( $validation['metadata'] ) && is_array( $validation['metadata'] )
+			? $validation['metadata']
+			: array();
+
+		$engine   = new Engine();
+		$response = $engine->handle( $prompt, $context, $metadata );
+
+		if ( ! $response->is_success() ) {
+			return $this->response_error( 'agentwp_intent_failed', $response->get_message(), $response->get_status() );
+		}
+
+		$data               = $response->get_data();
+		$data['intent_id']  = wp_generate_uuid4();
+		$data['status']     = 'handled';
+
+		return $this->response_success( $data );
 	}
 
 	/**
@@ -57,12 +84,15 @@
 	private function get_intent_schema() {
 		return array(
 			'type'     => 'object',
-			'required'             => array( 'prompt' ),
 			'properties'           => array(
 				'prompt'   => array(
 					'type'      => 'string',
 					'minLength' => 1,
 				),
+				'input'    => array(
+					'type'      => 'string',
+					'minLength' => 1,
+				),
 				'context'  => array(
 					'type' => 'object',
 				),


thinking
**Reviewing plan updates and integration**
Plan update
  ✓ Review existing REST intent flow and AI function definitions to align intent categories and response shape.
  ✓ Add intent engine core classes (intent constants, classifier, context builder, memory, handlers, function registry).
  ✓ Wire the engine into the REST intent controller and ensure responses include messages and fallback suggestions.
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
new file mode 100644
index 0000000000000000000000000000000000000000..7bd3172c7eb44f90876ab42bf4a40b8bf60a4ac9
--- /dev/null
+++ b/src/Intent/Engine.php
@@ -0,0 +1,196 @@
+<?php
+/**
+ * Intent engine for routing requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
+use AgentWP\Intent\Handlers\CustomerLookupHandler;
+use AgentWP\Intent\Handlers\EmailDraftHandler;
+use AgentWP\Intent\Handlers\FallbackHandler;
+use AgentWP\Intent\Handlers\OrderRefundHandler;
+use AgentWP\Intent\Handlers\OrderSearchHandler;
+use AgentWP\Intent\Handlers\OrderStatusHandler;
+use AgentWP\Intent\Handlers\ProductStockHandler;
+
+class Engine {
+	/**
+	 * @var IntentClassifier
+	 */
+	private $classifier;
+
+	/**
+	 * @var ContextBuilder
+	 */
+	private $context_builder;
+
+	/**
+	 * @var MemoryStore
+	 */
+	private $memory;
+
+	/**
+	 * @var FunctionRegistry
+	 */
+	private $function_registry;
+
+	/**
+	 * @var Handler[]
+	 */
+	private $handlers = array();
+
+	/**
+	 * @var Handler
+	 */
+	private $fallback_handler;
+
+	/**
+	 * @param array|null $handlers Optional handlers.
+	 * @param FunctionRegistry|null $function_registry Optional registry.
+	 * @param ContextBuilder|null $context_builder Optional context builder.
+	 * @param IntentClassifier|null $classifier Optional classifier.
+	 * @param MemoryStore|null $memory Optional memory store.
+	 */
+	public function __construct(
+		array $handlers = array(),
+		FunctionRegistry $function_registry = null,
+		ContextBuilder $context_builder = null,
+		IntentClassifier $classifier = null,
+		MemoryStore $memory = null
+	) {
+		$this->classifier      = $classifier ? $classifier : new IntentClassifier();
+		$this->context_builder = $context_builder ? $context_builder : new ContextBuilder();
+		$this->memory          = $memory ? $memory : new MemoryStore( 5 );
+		$this->function_registry = $function_registry ? $function_registry : new FunctionRegistry();
+		$this->fallback_handler  = new FallbackHandler();
+
+		$this->handlers = ! empty( $handlers ) ? $handlers : $this->default_handlers();
+		$this->register_default_functions();
+	}
+
+	/**
+	 * Handle a natural language input.
+	 *
+	 * @param string $input User input.
+	 * @param array  $context Request context.
+	 * @param array  $metadata Request metadata.
+	 * @return Response
+	 */
+	public function handle( $input, array $context = array(), array $metadata = array() ) {
+		$input = is_string( $input ) ? trim( $input ) : '';
+		if ( '' === $input ) {
+			return Response::error( 'Missing intent input.', 400 );
+		}
+
+		$enriched = $this->context_builder->build( $context, $metadata );
+		$enriched['input']   = $input;
+		$enriched['memory']  = $this->memory->get();
+		$enriched['intent']  = $this->classifier->classify( $input, $enriched );
+		$enriched['intent']  = Intent::normalize( $enriched['intent'] );
+		$enriched['function_suggestions'] = $this->function_registry->get_functions_for_intent( $enriched['intent'] );
+
+		$handler  = $this->resolve_handler( $enriched['intent'] );
+		$response = $handler->handle( $enriched );
+
+		$this->memory->add_exchange(
+			array(
+				'time'    => gmdate( 'c' ),
+				'input'   => $input,
+				'intent'  => $enriched['intent'],
+				'message' => $this->response_message( $response ),
+			)
+		);
+
+		return $response;
+	}
+
+	/**
+	 * @return FunctionRegistry
+	 */
+	public function get_function_registry() {
+		return $this->function_registry;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get_memory() {
+		return $this->memory->get();
+	}
+
+	/**
+	 * @return array
+	 */
+	private function default_handlers() {
+		return array(
+			new OrderSearchHandler(),
+			new OrderRefundHandler(),
+			new OrderStatusHandler(),
+			new ProductStockHandler(),
+			new EmailDraftHandler(),
+			new AnalyticsQueryHandler(),
+			new CustomerLookupHandler(),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return Handler
+	 */
+	private function resolve_handler( $intent ) {
+		foreach ( $this->handlers as $handler ) {
+			if ( $handler instanceof Handler && $handler->canHandle( $intent ) ) {
+				return $handler;
+			}
+		}
+
+		return $this->fallback_handler;
+	}
+
+	/**
+	 * @param Response $response Response instance.
+	 * @return string
+	 */
+	private function response_message( Response $response ) {
+		if ( ! $response->is_success() ) {
+			return $response->get_message();
+		}
+
+		$data = $response->get_data();
+		if ( is_array( $data ) && isset( $data['message'] ) ) {
+			return (string) $data['message'];
+		}
+
+		return '';
+	}
+
+	/**
+	 * @return void
+	 */
+	private function register_default_functions() {
+		$mapping = array(
+			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
+			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
+			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
+			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
+			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
+			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
+			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
+		);
+
+		foreach ( $mapping as $intent => $functions ) {
+			$handler = $this->resolve_handler( $intent );
+			if ( ! $handler || ! $handler->canHandle( $intent ) ) {
+				continue;
+			}
+
+			foreach ( $functions as $function_name ) {
+				$this->function_registry->register( $function_name, $handler );
+			}
+		}
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/FallbackHandler.php b/src/Intent/Handlers/FallbackHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fef46905751badeb9af6103faec2569a96e87582
--- /dev/null
+++ b/src/Intent/Handlers/FallbackHandler.php
@@ -0,0 +1,32 @@
+<?php
+/**
+ * Handle unknown intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class FallbackHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::UNKNOWN );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I did not recognize that request. Try one of these suggestions.';
+		return $this->build_response(
+			$context,
+			$message,
+			array(
+				'suggestions' => Intent::suggestions(),
+			)
+		);
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..fe9072f26d8b269011e9146a06ff939c97fc252d
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$score = $this->match_score(
+			$text,
+			array(
+				'email',
+				'message',
+				'compose',
+				'draft',
+				'write',
+				'response',
+			)
+		);
+
+		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
+			$score++;
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}
diff --git a/src/Rest/IntentController.php b/src/Rest/IntentController.php
index 027bca1a35799ff06be0baeebaff07a26376a73f..2986f48acc3c64d115c62428b2e0e2e0c55dce04
--- a/src/Rest/IntentController.php
+++ b/src/Rest/IntentController.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Rest;
 
 use AgentWP\API\RestController;
+use AgentWP\Intent\Engine;
 use WP_REST_Server;
 
 class IntentController extends RestController {
@@ -40,13 +41,39 @@
 			return $this->response_error( 'agentwp_invalid_request', $validation->get_error_message(), 400 );
 		}
 
-		return $this->response_success(
-			array(
-				'intent_id' => wp_generate_uuid4(),
-				'status'    => 'received',
-				'message'   => __( 'Intent received for processing.', 'agentwp' ),
-			)
-		);
+		$prompt = '';
+		if ( isset( $validation['prompt'] ) ) {
+			$prompt = (string) $validation['prompt'];
+		}
+
+		if ( '' === $prompt && isset( $validation['input'] ) ) {
+			$prompt = (string) $validation['input'];
+		}
+
+		$prompt = trim( $prompt );
+		if ( '' === $prompt ) {
+			return $this->response_error( 'agentwp_missing_prompt', __( 'Please provide a prompt.', 'agentwp' ), 400 );
+		}
+
+		$context  = isset( $validation['context'] ) && is_array( $validation['context'] )
+			? $validation['context']
+			: array();
+		$metadata = isset( $validation['metadata'] ) && is_array( $validation['metadata'] )
+			? $validation['metadata']
+			: array();
+
+		$engine   = new Engine();
+		$response = $engine->handle( $prompt, $context, $metadata );
+
+		if ( ! $response->is_success() ) {
+			return $this->response_error( 'agentwp_intent_failed', $response->get_message(), $response->get_status() );
+		}
+
+		$data               = $response->get_data();
+		$data['intent_id']  = wp_generate_uuid4();
+		$data['status']     = 'handled';
+
+		return $this->response_success( $data );
 	}
 
 	/**
@@ -57,12 +84,15 @@
 	private function get_intent_schema() {
 		return array(
 			'type'     => 'object',
-			'required'             => array( 'prompt' ),
 			'properties'           => array(
 				'prompt'   => array(
 					'type'      => 'string',
 					'minLength' => 1,
 				),
+				'input'    => array(
+					'type'      => 'string',
+					'minLength' => 1,
+				),
 				'context'  => array(
 					'type' => 'object',
 				),


thinking
**Reviewing intent classification logic and session handling**

I'm going through the intent classifier's scoring details to refine phrase matches, especially around “order” and “email” cases, aiming to reduce misclassifications by adjusting scoring rules carefully. At the same time, I'm verifying session memory behavior to ensure it gracefully handles cases when sessions haven't started yet, keeping WordPress function dependencies in mind for robustness across environments.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/IntentClassifier.php
@@ -111,19 +111,18 @@
 	private function score_email( $text ) {
-		$score = $this->match_score(
-			$text,
-			array(
-				'email',
-				'message',
-				'compose',
-				'draft',
-				'write',
-				'response',
-			)
-		);
+		$has_email  = $this->contains_phrase( $text, 'email' ) || $this->contains_phrase( $text, 'message' );
+		$has_action = $this->contains_phrase( $text, 'compose' )
+			|| $this->contains_phrase( $text, 'draft' )
+			|| $this->contains_phrase( $text, 'write' )
+			|| $this->contains_phrase( $text, 'reply' )
+			|| $this->contains_phrase( $text, 'send' );
+
+		if ( $has_email && $has_action ) {
+			return 2;
+		}
 
-		if ( $this->contains_phrase( $text, 'email' ) && $this->contains_phrase( $text, 'customer' ) ) {
-			$score++;
+		if ( $has_action ) {
+			return 1;
 		}
 
-		return $score;
+		return 0;
 	}
@@ -175,2 +174,3 @@
 			array(
+				'order',
 				'search',
apply_patch(auto_approved=true) exited 0 in 131ms:
Success. Updated the following files:
M src/Intent/IntentClassifier.php
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
new file mode 100644
index 0000000000000000000000000000000000000000..7bd3172c7eb44f90876ab42bf4a40b8bf60a4ac9
--- /dev/null
+++ b/src/Intent/Engine.php
@@ -0,0 +1,196 @@
+<?php
+/**
+ * Intent engine for routing requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
+use AgentWP\Intent\Handlers\CustomerLookupHandler;
+use AgentWP\Intent\Handlers\EmailDraftHandler;
+use AgentWP\Intent\Handlers\FallbackHandler;
+use AgentWP\Intent\Handlers\OrderRefundHandler;
+use AgentWP\Intent\Handlers\OrderSearchHandler;
+use AgentWP\Intent\Handlers\OrderStatusHandler;
+use AgentWP\Intent\Handlers\ProductStockHandler;
+
+class Engine {
+	/**
+	 * @var IntentClassifier
+	 */
+	private $classifier;
+
+	/**
+	 * @var ContextBuilder
+	 */
+	private $context_builder;
+
+	/**
+	 * @var MemoryStore
+	 */
+	private $memory;
+
+	/**
+	 * @var FunctionRegistry
+	 */
+	private $function_registry;
+
+	/**
+	 * @var Handler[]
+	 */
+	private $handlers = array();
+
+	/**
+	 * @var Handler
+	 */
+	private $fallback_handler;
+
+	/**
+	 * @param array|null $handlers Optional handlers.
+	 * @param FunctionRegistry|null $function_registry Optional registry.
+	 * @param ContextBuilder|null $context_builder Optional context builder.
+	 * @param IntentClassifier|null $classifier Optional classifier.
+	 * @param MemoryStore|null $memory Optional memory store.
+	 */
+	public function __construct(
+		array $handlers = array(),
+		FunctionRegistry $function_registry = null,
+		ContextBuilder $context_builder = null,
+		IntentClassifier $classifier = null,
+		MemoryStore $memory = null
+	) {
+		$this->classifier      = $classifier ? $classifier : new IntentClassifier();
+		$this->context_builder = $context_builder ? $context_builder : new ContextBuilder();
+		$this->memory          = $memory ? $memory : new MemoryStore( 5 );
+		$this->function_registry = $function_registry ? $function_registry : new FunctionRegistry();
+		$this->fallback_handler  = new FallbackHandler();
+
+		$this->handlers = ! empty( $handlers ) ? $handlers : $this->default_handlers();
+		$this->register_default_functions();
+	}
+
+	/**
+	 * Handle a natural language input.
+	 *
+	 * @param string $input User input.
+	 * @param array  $context Request context.
+	 * @param array  $metadata Request metadata.
+	 * @return Response
+	 */
+	public function handle( $input, array $context = array(), array $metadata = array() ) {
+		$input = is_string( $input ) ? trim( $input ) : '';
+		if ( '' === $input ) {
+			return Response::error( 'Missing intent input.', 400 );
+		}
+
+		$enriched = $this->context_builder->build( $context, $metadata );
+		$enriched['input']   = $input;
+		$enriched['memory']  = $this->memory->get();
+		$enriched['intent']  = $this->classifier->classify( $input, $enriched );
+		$enriched['intent']  = Intent::normalize( $enriched['intent'] );
+		$enriched['function_suggestions'] = $this->function_registry->get_functions_for_intent( $enriched['intent'] );
+
+		$handler  = $this->resolve_handler( $enriched['intent'] );
+		$response = $handler->handle( $enriched );
+
+		$this->memory->add_exchange(
+			array(
+				'time'    => gmdate( 'c' ),
+				'input'   => $input,
+				'intent'  => $enriched['intent'],
+				'message' => $this->response_message( $response ),
+			)
+		);
+
+		return $response;
+	}
+
+	/**
+	 * @return FunctionRegistry
+	 */
+	public function get_function_registry() {
+		return $this->function_registry;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get_memory() {
+		return $this->memory->get();
+	}
+
+	/**
+	 * @return array
+	 */
+	private function default_handlers() {
+		return array(
+			new OrderSearchHandler(),
+			new OrderRefundHandler(),
+			new OrderStatusHandler(),
+			new ProductStockHandler(),
+			new EmailDraftHandler(),
+			new AnalyticsQueryHandler(),
+			new CustomerLookupHandler(),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return Handler
+	 */
+	private function resolve_handler( $intent ) {
+		foreach ( $this->handlers as $handler ) {
+			if ( $handler instanceof Handler && $handler->canHandle( $intent ) ) {
+				return $handler;
+			}
+		}
+
+		return $this->fallback_handler;
+	}
+
+	/**
+	 * @param Response $response Response instance.
+	 * @return string
+	 */
+	private function response_message( Response $response ) {
+		if ( ! $response->is_success() ) {
+			return $response->get_message();
+		}
+
+		$data = $response->get_data();
+		if ( is_array( $data ) && isset( $data['message'] ) ) {
+			return (string) $data['message'];
+		}
+
+		return '';
+	}
+
+	/**
+	 * @return void
+	 */
+	private function register_default_functions() {
+		$mapping = array(
+			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
+			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
+			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
+			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
+			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
+			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
+			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
+		);
+
+		foreach ( $mapping as $intent => $functions ) {
+			$handler = $this->resolve_handler( $intent );
+			if ( ! $handler || ! $handler->canHandle( $intent ) ) {
+				continue;
+			}
+
+			foreach ( $functions as $function_name ) {
+				$this->function_registry->register( $function_name, $handler );
+			}
+		}
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/FallbackHandler.php b/src/Intent/Handlers/FallbackHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fef46905751badeb9af6103faec2569a96e87582
--- /dev/null
+++ b/src/Intent/Handlers/FallbackHandler.php
@@ -0,0 +1,32 @@
+<?php
+/**
+ * Handle unknown intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class FallbackHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::UNKNOWN );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I did not recognize that request. Try one of these suggestions.';
+		return $this->build_response(
+			$context,
+			$message,
+			array(
+				'suggestions' => Intent::suggestions(),
+			)
+		);
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..a23168409a4745e57feb3cec7dbcf2482026e32e
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$has_email  = $this->contains_phrase( $text, 'email' ) || $this->contains_phrase( $text, 'message' );
+		$has_action = $this->contains_phrase( $text, 'compose' )
+			|| $this->contains_phrase( $text, 'draft' )
+			|| $this->contains_phrase( $text, 'write' )
+			|| $this->contains_phrase( $text, 'reply' )
+			|| $this->contains_phrase( $text, 'send' );
+
+		if ( $has_email && $has_action ) {
+			return 2;
+		}
+
+		if ( $has_action ) {
+			return 1;
+		}
+
+		return 0;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'order',
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}
diff --git a/src/Rest/IntentController.php b/src/Rest/IntentController.php
index 027bca1a35799ff06be0baeebaff07a26376a73f..2986f48acc3c64d115c62428b2e0e2e0c55dce04
--- a/src/Rest/IntentController.php
+++ b/src/Rest/IntentController.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Rest;
 
 use AgentWP\API\RestController;
+use AgentWP\Intent\Engine;
 use WP_REST_Server;
 
 class IntentController extends RestController {
@@ -40,13 +41,39 @@
 			return $this->response_error( 'agentwp_invalid_request', $validation->get_error_message(), 400 );
 		}
 
-		return $this->response_success(
-			array(
-				'intent_id' => wp_generate_uuid4(),
-				'status'    => 'received',
-				'message'   => __( 'Intent received for processing.', 'agentwp' ),
-			)
-		);
+		$prompt = '';
+		if ( isset( $validation['prompt'] ) ) {
+			$prompt = (string) $validation['prompt'];
+		}
+
+		if ( '' === $prompt && isset( $validation['input'] ) ) {
+			$prompt = (string) $validation['input'];
+		}
+
+		$prompt = trim( $prompt );
+		if ( '' === $prompt ) {
+			return $this->response_error( 'agentwp_missing_prompt', __( 'Please provide a prompt.', 'agentwp' ), 400 );
+		}
+
+		$context  = isset( $validation['context'] ) && is_array( $validation['context'] )
+			? $validation['context']
+			: array();
+		$metadata = isset( $validation['metadata'] ) && is_array( $validation['metadata'] )
+			? $validation['metadata']
+			: array();
+
+		$engine   = new Engine();
+		$response = $engine->handle( $prompt, $context, $metadata );
+
+		if ( ! $response->is_success() ) {
+			return $this->response_error( 'agentwp_intent_failed', $response->get_message(), $response->get_status() );
+		}
+
+		$data               = $response->get_data();
+		$data['intent_id']  = wp_generate_uuid4();
+		$data['status']     = 'handled';
+
+		return $this->response_success( $data );
 	}
 
 	/**
@@ -57,12 +84,15 @@
 	private function get_intent_schema() {
 		return array(
 			'type'     => 'object',
-			'required'             => array( 'prompt' ),
 			'properties'           => array(
 				'prompt'   => array(
 					'type'      => 'string',
 					'minLength' => 1,
 				),
+				'input'    => array(
+					'type'      => 'string',
+					'minLength' => 1,
+				),
 				'context'  => array(
 					'type' => 'object',
 				),

file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
new file mode 100644
index 0000000000000000000000000000000000000000..7bd3172c7eb44f90876ab42bf4a40b8bf60a4ac9
--- /dev/null
+++ b/src/Intent/Engine.php
@@ -0,0 +1,196 @@
+<?php
+/**
+ * Intent engine for routing requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
+use AgentWP\Intent\Handlers\CustomerLookupHandler;
+use AgentWP\Intent\Handlers\EmailDraftHandler;
+use AgentWP\Intent\Handlers\FallbackHandler;
+use AgentWP\Intent\Handlers\OrderRefundHandler;
+use AgentWP\Intent\Handlers\OrderSearchHandler;
+use AgentWP\Intent\Handlers\OrderStatusHandler;
+use AgentWP\Intent\Handlers\ProductStockHandler;
+
+class Engine {
+	/**
+	 * @var IntentClassifier
+	 */
+	private $classifier;
+
+	/**
+	 * @var ContextBuilder
+	 */
+	private $context_builder;
+
+	/**
+	 * @var MemoryStore
+	 */
+	private $memory;
+
+	/**
+	 * @var FunctionRegistry
+	 */
+	private $function_registry;
+
+	/**
+	 * @var Handler[]
+	 */
+	private $handlers = array();
+
+	/**
+	 * @var Handler
+	 */
+	private $fallback_handler;
+
+	/**
+	 * @param array|null $handlers Optional handlers.
+	 * @param FunctionRegistry|null $function_registry Optional registry.
+	 * @param ContextBuilder|null $context_builder Optional context builder.
+	 * @param IntentClassifier|null $classifier Optional classifier.
+	 * @param MemoryStore|null $memory Optional memory store.
+	 */
+	public function __construct(
+		array $handlers = array(),
+		FunctionRegistry $function_registry = null,
+		ContextBuilder $context_builder = null,
+		IntentClassifier $classifier = null,
+		MemoryStore $memory = null
+	) {
+		$this->classifier      = $classifier ? $classifier : new IntentClassifier();
+		$this->context_builder = $context_builder ? $context_builder : new ContextBuilder();
+		$this->memory          = $memory ? $memory : new MemoryStore( 5 );
+		$this->function_registry = $function_registry ? $function_registry : new FunctionRegistry();
+		$this->fallback_handler  = new FallbackHandler();
+
+		$this->handlers = ! empty( $handlers ) ? $handlers : $this->default_handlers();
+		$this->register_default_functions();
+	}
+
+	/**
+	 * Handle a natural language input.
+	 *
+	 * @param string $input User input.
+	 * @param array  $context Request context.
+	 * @param array  $metadata Request metadata.
+	 * @return Response
+	 */
+	public function handle( $input, array $context = array(), array $metadata = array() ) {
+		$input = is_string( $input ) ? trim( $input ) : '';
+		if ( '' === $input ) {
+			return Response::error( 'Missing intent input.', 400 );
+		}
+
+		$enriched = $this->context_builder->build( $context, $metadata );
+		$enriched['input']   = $input;
+		$enriched['memory']  = $this->memory->get();
+		$enriched['intent']  = $this->classifier->classify( $input, $enriched );
+		$enriched['intent']  = Intent::normalize( $enriched['intent'] );
+		$enriched['function_suggestions'] = $this->function_registry->get_functions_for_intent( $enriched['intent'] );
+
+		$handler  = $this->resolve_handler( $enriched['intent'] );
+		$response = $handler->handle( $enriched );
+
+		$this->memory->add_exchange(
+			array(
+				'time'    => gmdate( 'c' ),
+				'input'   => $input,
+				'intent'  => $enriched['intent'],
+				'message' => $this->response_message( $response ),
+			)
+		);
+
+		return $response;
+	}
+
+	/**
+	 * @return FunctionRegistry
+	 */
+	public function get_function_registry() {
+		return $this->function_registry;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get_memory() {
+		return $this->memory->get();
+	}
+
+	/**
+	 * @return array
+	 */
+	private function default_handlers() {
+		return array(
+			new OrderSearchHandler(),
+			new OrderRefundHandler(),
+			new OrderStatusHandler(),
+			new ProductStockHandler(),
+			new EmailDraftHandler(),
+			new AnalyticsQueryHandler(),
+			new CustomerLookupHandler(),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return Handler
+	 */
+	private function resolve_handler( $intent ) {
+		foreach ( $this->handlers as $handler ) {
+			if ( $handler instanceof Handler && $handler->canHandle( $intent ) ) {
+				return $handler;
+			}
+		}
+
+		return $this->fallback_handler;
+	}
+
+	/**
+	 * @param Response $response Response instance.
+	 * @return string
+	 */
+	private function response_message( Response $response ) {
+		if ( ! $response->is_success() ) {
+			return $response->get_message();
+		}
+
+		$data = $response->get_data();
+		if ( is_array( $data ) && isset( $data['message'] ) ) {
+			return (string) $data['message'];
+		}
+
+		return '';
+	}
+
+	/**
+	 * @return void
+	 */
+	private function register_default_functions() {
+		$mapping = array(
+			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
+			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
+			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
+			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
+			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
+			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
+			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
+		);
+
+		foreach ( $mapping as $intent => $functions ) {
+			$handler = $this->resolve_handler( $intent );
+			if ( ! $handler || ! $handler->canHandle( $intent ) ) {
+				continue;
+			}
+
+			foreach ( $functions as $function_name ) {
+				$this->function_registry->register( $function_name, $handler );
+			}
+		}
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/FallbackHandler.php b/src/Intent/Handlers/FallbackHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fef46905751badeb9af6103faec2569a96e87582
--- /dev/null
+++ b/src/Intent/Handlers/FallbackHandler.php
@@ -0,0 +1,32 @@
+<?php
+/**
+ * Handle unknown intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class FallbackHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::UNKNOWN );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I did not recognize that request. Try one of these suggestions.';
+		return $this->build_response(
+			$context,
+			$message,
+			array(
+				'suggestions' => Intent::suggestions(),
+			)
+		);
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..a23168409a4745e57feb3cec7dbcf2482026e32e
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$has_email  = $this->contains_phrase( $text, 'email' ) || $this->contains_phrase( $text, 'message' );
+		$has_action = $this->contains_phrase( $text, 'compose' )
+			|| $this->contains_phrase( $text, 'draft' )
+			|| $this->contains_phrase( $text, 'write' )
+			|| $this->contains_phrase( $text, 'reply' )
+			|| $this->contains_phrase( $text, 'send' );
+
+		if ( $has_email && $has_action ) {
+			return 2;
+		}
+
+		if ( $has_action ) {
+			return 1;
+		}
+
+		return 0;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'order',
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}
diff --git a/src/Rest/IntentController.php b/src/Rest/IntentController.php
index 027bca1a35799ff06be0baeebaff07a26376a73f..2986f48acc3c64d115c62428b2e0e2e0c55dce04
--- a/src/Rest/IntentController.php
+++ b/src/Rest/IntentController.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Rest;
 
 use AgentWP\API\RestController;
+use AgentWP\Intent\Engine;
 use WP_REST_Server;
 
 class IntentController extends RestController {
@@ -40,13 +41,39 @@
 			return $this->response_error( 'agentwp_invalid_request', $validation->get_error_message(), 400 );
 		}
 
-		return $this->response_success(
-			array(
-				'intent_id' => wp_generate_uuid4(),
-				'status'    => 'received',
-				'message'   => __( 'Intent received for processing.', 'agentwp' ),
-			)
-		);
+		$prompt = '';
+		if ( isset( $validation['prompt'] ) ) {
+			$prompt = (string) $validation['prompt'];
+		}
+
+		if ( '' === $prompt && isset( $validation['input'] ) ) {
+			$prompt = (string) $validation['input'];
+		}
+
+		$prompt = trim( $prompt );
+		if ( '' === $prompt ) {
+			return $this->response_error( 'agentwp_missing_prompt', __( 'Please provide a prompt.', 'agentwp' ), 400 );
+		}
+
+		$context  = isset( $validation['context'] ) && is_array( $validation['context'] )
+			? $validation['context']
+			: array();
+		$metadata = isset( $validation['metadata'] ) && is_array( $validation['metadata'] )
+			? $validation['metadata']
+			: array();
+
+		$engine   = new Engine();
+		$response = $engine->handle( $prompt, $context, $metadata );
+
+		if ( ! $response->is_success() ) {
+			return $this->response_error( 'agentwp_intent_failed', $response->get_message(), $response->get_status() );
+		}
+
+		$data               = $response->get_data();
+		$data['intent_id']  = wp_generate_uuid4();
+		$data['status']     = 'handled';
+
+		return $this->response_success( $data );
 	}
 
 	/**
@@ -57,12 +84,15 @@
 	private function get_intent_schema() {
 		return array(
 			'type'     => 'object',
-			'required'             => array( 'prompt' ),
 			'properties'           => array(
 				'prompt'   => array(
 					'type'      => 'string',
 					'minLength' => 1,
 				),
+				'input'    => array(
+					'type'      => 'string',
+					'minLength' => 1,
+				),
 				'context'  => array(
 					'type' => 'object',
 				),


thinking
**Summarizing final review and response plan**

I’m wrapping up by outlining the status as DONE, summarizing key changes across intent engine classes, REST controller, and session memory store, and noting verification is manual since no commands were given. I’ll also highlight potential risks like rule-based classification limits and session dependencies, then finalize the plain-text response with clear sections covering status, summary, verification, and risks.
codex
Status: DONE

Summary of changes
- Added intent engine core with classifier, context builder, session memory, function registry, and handlers in `src/Intent/Engine.php`, `src/Intent/IntentClassifier.php`, `src/Intent/ContextBuilder.php`, `src/Intent/MemoryStore.php`, `src/Intent/FunctionRegistry.php`, `src/Intent/Handler.php`, `src/Intent/Intent.php`, and `src/Intent/Handlers/*.php`
- Wired the engine into the REST intent endpoint, including prompt/input validation and handler responses in `src/Rest/IntentController.php`

How to verify
- No verification commands were provided.

Risks / follow-ups
- Rule-based intent matching in `src/Intent/IntentClassifier.php` may need tuning for edge cases.
- Session-based memory in `src/Intent/MemoryStore.php` depends on sessions being available in the hosting environment.
file update:
diff --git a/src/Intent/ContextBuilder.php b/src/Intent/ContextBuilder.php
new file mode 100644
index 0000000000000000000000000000000000000000..ecc257626521bba5456a9f0bafa409d6f0f9fd92
--- /dev/null
+++ b/src/Intent/ContextBuilder.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * Build enriched intent context.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class ContextBuilder {
+	/**
+	 * Build context with store and user data.
+	 *
+	 * @param array $context Request context.
+	 * @param array $metadata Request metadata.
+	 * @return array
+	 */
+	public function build( array $context = array(), array $metadata = array() ) {
+		return array(
+			'request'       => $context,
+			'metadata'      => $metadata,
+			'user'          => $this->get_user_context(),
+			'recent_orders' => $this->get_recent_orders(),
+			'store'         => $this->get_store_context(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_user_context() {
+		if ( ! function_exists( 'wp_get_current_user' ) ) {
+			return array();
+		}
+
+		$user = wp_get_current_user();
+		if ( ! $user || ! isset( $user->ID ) || 0 === intval( $user->ID ) ) {
+			return array();
+		}
+
+		return array(
+			'id'           => intval( $user->ID ),
+			'display_name' => sanitize_text_field( $user->display_name ),
+			'email'        => sanitize_email( $user->user_email ),
+			'roles'        => is_array( $user->roles ) ? array_values( $user->roles ) : array(),
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_recent_orders() {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$orders = wc_get_orders(
+			array(
+				'limit'   => 5,
+				'orderby' => 'date',
+				'order'   => 'DESC',
+			)
+		);
+
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+
+			$summary[] = array(
+				'id'           => intval( $order->get_id() ),
+				'status'       => sanitize_text_field( $order->get_status() ),
+				'total'        => $order->get_total(),
+				'currency'     => sanitize_text_field( $order->get_currency() ),
+				'date_created' => $date_created ? $date_created->date( 'c' ) : '',
+				'customer_id'  => method_exists( $order, 'get_customer_id' ) ? intval( $order->get_customer_id() ) : 0,
+				'email'        => method_exists( $order, 'get_billing_email' ) ? sanitize_email( $order->get_billing_email() ) : '',
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_store_context() {
+		$timezone = '';
+
+		if ( function_exists( 'wp_timezone_string' ) ) {
+			$timezone = wp_timezone_string();
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$timezone = (string) get_option( 'timezone_string' );
+		}
+
+		if ( '' === $timezone && function_exists( 'get_option' ) ) {
+			$offset   = (float) get_option( 'gmt_offset' );
+			$sign     = $offset >= 0 ? '+' : '-';
+			$timezone = sprintf( 'UTC%s%s', $sign, abs( $offset ) );
+		}
+
+		$currency = '';
+		if ( function_exists( 'get_woocommerce_currency' ) ) {
+			$currency = get_woocommerce_currency();
+		} elseif ( function_exists( 'get_option' ) ) {
+			$currency = (string) get_option( 'woocommerce_currency' );
+		}
+
+		return array(
+			'timezone' => sanitize_text_field( $timezone ),
+			'currency' => sanitize_text_field( $currency ),
+		);
+	}
+}
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
new file mode 100644
index 0000000000000000000000000000000000000000..7bd3172c7eb44f90876ab42bf4a40b8bf60a4ac9
--- /dev/null
+++ b/src/Intent/Engine.php
@@ -0,0 +1,196 @@
+<?php
+/**
+ * Intent engine for routing requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
+use AgentWP\Intent\Handlers\CustomerLookupHandler;
+use AgentWP\Intent\Handlers\EmailDraftHandler;
+use AgentWP\Intent\Handlers\FallbackHandler;
+use AgentWP\Intent\Handlers\OrderRefundHandler;
+use AgentWP\Intent\Handlers\OrderSearchHandler;
+use AgentWP\Intent\Handlers\OrderStatusHandler;
+use AgentWP\Intent\Handlers\ProductStockHandler;
+
+class Engine {
+	/**
+	 * @var IntentClassifier
+	 */
+	private $classifier;
+
+	/**
+	 * @var ContextBuilder
+	 */
+	private $context_builder;
+
+	/**
+	 * @var MemoryStore
+	 */
+	private $memory;
+
+	/**
+	 * @var FunctionRegistry
+	 */
+	private $function_registry;
+
+	/**
+	 * @var Handler[]
+	 */
+	private $handlers = array();
+
+	/**
+	 * @var Handler
+	 */
+	private $fallback_handler;
+
+	/**
+	 * @param array|null $handlers Optional handlers.
+	 * @param FunctionRegistry|null $function_registry Optional registry.
+	 * @param ContextBuilder|null $context_builder Optional context builder.
+	 * @param IntentClassifier|null $classifier Optional classifier.
+	 * @param MemoryStore|null $memory Optional memory store.
+	 */
+	public function __construct(
+		array $handlers = array(),
+		FunctionRegistry $function_registry = null,
+		ContextBuilder $context_builder = null,
+		IntentClassifier $classifier = null,
+		MemoryStore $memory = null
+	) {
+		$this->classifier      = $classifier ? $classifier : new IntentClassifier();
+		$this->context_builder = $context_builder ? $context_builder : new ContextBuilder();
+		$this->memory          = $memory ? $memory : new MemoryStore( 5 );
+		$this->function_registry = $function_registry ? $function_registry : new FunctionRegistry();
+		$this->fallback_handler  = new FallbackHandler();
+
+		$this->handlers = ! empty( $handlers ) ? $handlers : $this->default_handlers();
+		$this->register_default_functions();
+	}
+
+	/**
+	 * Handle a natural language input.
+	 *
+	 * @param string $input User input.
+	 * @param array  $context Request context.
+	 * @param array  $metadata Request metadata.
+	 * @return Response
+	 */
+	public function handle( $input, array $context = array(), array $metadata = array() ) {
+		$input = is_string( $input ) ? trim( $input ) : '';
+		if ( '' === $input ) {
+			return Response::error( 'Missing intent input.', 400 );
+		}
+
+		$enriched = $this->context_builder->build( $context, $metadata );
+		$enriched['input']   = $input;
+		$enriched['memory']  = $this->memory->get();
+		$enriched['intent']  = $this->classifier->classify( $input, $enriched );
+		$enriched['intent']  = Intent::normalize( $enriched['intent'] );
+		$enriched['function_suggestions'] = $this->function_registry->get_functions_for_intent( $enriched['intent'] );
+
+		$handler  = $this->resolve_handler( $enriched['intent'] );
+		$response = $handler->handle( $enriched );
+
+		$this->memory->add_exchange(
+			array(
+				'time'    => gmdate( 'c' ),
+				'input'   => $input,
+				'intent'  => $enriched['intent'],
+				'message' => $this->response_message( $response ),
+			)
+		);
+
+		return $response;
+	}
+
+	/**
+	 * @return FunctionRegistry
+	 */
+	public function get_function_registry() {
+		return $this->function_registry;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get_memory() {
+		return $this->memory->get();
+	}
+
+	/**
+	 * @return array
+	 */
+	private function default_handlers() {
+		return array(
+			new OrderSearchHandler(),
+			new OrderRefundHandler(),
+			new OrderStatusHandler(),
+			new ProductStockHandler(),
+			new EmailDraftHandler(),
+			new AnalyticsQueryHandler(),
+			new CustomerLookupHandler(),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return Handler
+	 */
+	private function resolve_handler( $intent ) {
+		foreach ( $this->handlers as $handler ) {
+			if ( $handler instanceof Handler && $handler->canHandle( $intent ) ) {
+				return $handler;
+			}
+		}
+
+		return $this->fallback_handler;
+	}
+
+	/**
+	 * @param Response $response Response instance.
+	 * @return string
+	 */
+	private function response_message( Response $response ) {
+		if ( ! $response->is_success() ) {
+			return $response->get_message();
+		}
+
+		$data = $response->get_data();
+		if ( is_array( $data ) && isset( $data['message'] ) ) {
+			return (string) $data['message'];
+		}
+
+		return '';
+	}
+
+	/**
+	 * @return void
+	 */
+	private function register_default_functions() {
+		$mapping = array(
+			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
+			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
+			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
+			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
+			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
+			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
+			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
+		);
+
+		foreach ( $mapping as $intent => $functions ) {
+			$handler = $this->resolve_handler( $intent );
+			if ( ! $handler || ! $handler->canHandle( $intent ) ) {
+				continue;
+			}
+
+			foreach ( $functions as $function_name ) {
+				$this->function_registry->register( $function_name, $handler );
+			}
+		}
+	}
+}
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
new file mode 100644
index 0000000000000000000000000000000000000000..d2e4c0bf51de63a744706175ab664e50423e62a0
--- /dev/null
+++ b/src/Intent/FunctionRegistry.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * OpenAI function registry for intent handlers.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class FunctionRegistry {
+	/**
+	 * @var array<string, Handler>
+	 */
+	private $map = array();
+
+	/**
+	 * @param string  $function_name OpenAI function name.
+	 * @param Handler $handler Handler instance.
+	 * @return void
+	 */
+	public function register( $function_name, Handler $handler ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return;
+		}
+
+		$this->map[ $function_name ] = $handler;
+	}
+
+	/**
+	 * @param string $function_name OpenAI function name.
+	 * @return Handler|null
+	 */
+	public function get_handler( $function_name ) {
+		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
+		if ( '' === $function_name ) {
+			return null;
+		}
+
+		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return array
+	 */
+	public function get_functions_for_intent( $intent ) {
+		$intent = Intent::normalize( $intent );
+		$names  = array();
+
+		foreach ( $this->map as $function_name => $handler ) {
+			if ( $handler->canHandle( $intent ) ) {
+				$names[] = $function_name;
+			}
+		}
+
+		sort( $names );
+
+		return $names;
+	}
+
+	/**
+	 * @return array
+	 */
+	public function all() {
+		return $this->map;
+	}
+}
diff --git a/src/Intent/Handler.php b/src/Intent/Handler.php
new file mode 100644
index 0000000000000000000000000000000000000000..3ef3d8b54525a88ad77da3c1e6e9dc007de2ea31
--- /dev/null
+++ b/src/Intent/Handler.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Intent handler contract.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+use AgentWP\AI\Response;
+
+interface Handler {
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool;
+
+	/**
+	 * @param array $context Enriched request context.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response;
+}
diff --git a/src/Intent/Handlers/AnalyticsQueryHandler.php b/src/Intent/Handlers/AnalyticsQueryHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e8b456e417cd305020043bac2ed42d3111c52b65
--- /dev/null
+++ b/src/Intent/Handlers/AnalyticsQueryHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle analytics query intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class AnalyticsQueryHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ANALYTICS_QUERY );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can pull analytics. Specify a timeframe or metric you need.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/BaseHandler.php b/src/Intent/Handlers/BaseHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2ba8da24597e5f9b2c28a88df24b73e6ad7ffcd
--- /dev/null
+++ b/src/Intent/Handlers/BaseHandler.php
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Base handler for intent responses.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Handler;
+use AgentWP\Intent\Intent;
+
+abstract class BaseHandler implements Handler {
+	/**
+	 * @var string
+	 */
+	protected $intent;
+
+	/**
+	 * @param string $intent Intent identifier.
+	 */
+	public function __construct( $intent ) {
+		$this->intent = Intent::normalize( $intent );
+	}
+
+	/**
+	 * @param string $intent Intent identifier.
+	 * @return bool
+	 */
+	public function canHandle( string $intent ): bool {
+		return Intent::normalize( $intent ) === $this->intent;
+	}
+
+	/**
+	 * @param array  $context Context data.
+	 * @param string $message Response message.
+	 * @param array  $data Additional payload data.
+	 * @return Response
+	 */
+	protected function build_response( array $context, $message, array $data = array() ) {
+		$payload = array_merge(
+			array(
+				'intent'  => $this->intent,
+				'message' => $message,
+			),
+			$data
+		);
+
+		if ( isset( $context['store'] ) ) {
+			$payload['store'] = $context['store'];
+		}
+
+		if ( isset( $context['user'] ) ) {
+			$payload['user'] = $context['user'];
+		}
+
+		if ( isset( $context['recent_orders'] ) ) {
+			$payload['recent_orders'] = $context['recent_orders'];
+		}
+
+		if ( isset( $context['function_suggestions'] ) ) {
+			$payload['function_suggestions'] = $context['function_suggestions'];
+		}
+
+		return Response::success( $payload );
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..8d0c36e9b634b18599d5e317f273cafb58dea92a
--- /dev/null
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle customer lookup intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class CustomerLookupHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::CUSTOMER_LOOKUP );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can look up customer profiles. Share an email or name.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/EmailDraftHandler.php b/src/Intent/Handlers/EmailDraftHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..b9aeb9c589d2bc406bcbbc07624a7d7031f45b9a
--- /dev/null
+++ b/src/Intent/Handlers/EmailDraftHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle email draft intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class EmailDraftHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::EMAIL_DRAFT );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can draft a customer email. Share the order ID and desired tone.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/FallbackHandler.php b/src/Intent/Handlers/FallbackHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fef46905751badeb9af6103faec2569a96e87582
--- /dev/null
+++ b/src/Intent/Handlers/FallbackHandler.php
@@ -0,0 +1,32 @@
+<?php
+/**
+ * Handle unknown intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class FallbackHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::UNKNOWN );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I did not recognize that request. Try one of these suggestions.';
+		return $this->build_response(
+			$context,
+			$message,
+			array(
+				'suggestions' => Intent::suggestions(),
+			)
+		);
+	}
+}
diff --git a/src/Intent/Handlers/OrderRefundHandler.php b/src/Intent/Handlers/OrderRefundHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..edf6bbe2fe0a22ffe0e5afbc63186e592a1adc1a
--- /dev/null
+++ b/src/Intent/Handlers/OrderRefundHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order refund intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderRefundHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_REFUND );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can prepare a refund draft. Provide the order ID and refund amount if needed.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderSearchHandler.php b/src/Intent/Handlers/OrderSearchHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..9311b7eaa83edab2ffe20b11b5bd6af2b0ef62f2
--- /dev/null
+++ b/src/Intent/Handlers/OrderSearchHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order search intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderSearchHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_SEARCH );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can search orders. Share an order ID, customer email, or date range.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/OrderStatusHandler.php b/src/Intent/Handlers/OrderStatusHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..a2d4e193f36458f4d841318612af05d51e2a5fde
--- /dev/null
+++ b/src/Intent/Handlers/OrderStatusHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle order status intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class OrderStatusHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::ORDER_STATUS );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check or update order status. Tell me the order ID or customer.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Handlers/ProductStockHandler.php b/src/Intent/Handlers/ProductStockHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..f9fa36278962b3b0fcaf7863daa9f10077e5b33c
--- /dev/null
+++ b/src/Intent/Handlers/ProductStockHandler.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Handle product stock intents.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent\Handlers;
+
+use AgentWP\AI\Response;
+use AgentWP\Intent\Intent;
+
+class ProductStockHandler extends BaseHandler {
+	public function __construct() {
+		parent::__construct( Intent::PRODUCT_STOCK );
+	}
+
+	/**
+	 * @param array $context Context data.
+	 * @return Response
+	 */
+	public function handle( array $context ): Response {
+		$message = 'I can check product stock. Share a product name or SKU.';
+		return $this->build_response( $context, $message );
+	}
+}
diff --git a/src/Intent/Intent.php b/src/Intent/Intent.php
new file mode 100644
index 0000000000000000000000000000000000000000..819de2a8f0cb8e7a0bc4c857051743b99edfa3d2
--- /dev/null
+++ b/src/Intent/Intent.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Intent categories.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class Intent {
+	const ORDER_SEARCH    = 'ORDER_SEARCH';
+	const ORDER_REFUND    = 'ORDER_REFUND';
+	const ORDER_STATUS    = 'ORDER_STATUS';
+	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
+	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
+	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
+	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
+	const UNKNOWN         = 'UNKNOWN';
+
+	/**
+	 * @return array
+	 */
+	public static function all() {
+		return array(
+			self::ORDER_SEARCH,
+			self::ORDER_REFUND,
+			self::ORDER_STATUS,
+			self::PRODUCT_STOCK,
+			self::EMAIL_DRAFT,
+			self::ANALYTICS_QUERY,
+			self::CUSTOMER_LOOKUP,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function labels() {
+		return array(
+			self::ORDER_SEARCH    => 'Order search',
+			self::ORDER_REFUND    => 'Order refund',
+			self::ORDER_STATUS    => 'Order status',
+			self::PRODUCT_STOCK   => 'Product stock',
+			self::EMAIL_DRAFT     => 'Email draft',
+			self::ANALYTICS_QUERY => 'Analytics query',
+			self::CUSTOMER_LOOKUP => 'Customer lookup',
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	public static function suggestions() {
+		return array(
+			array(
+				'intent'  => self::ORDER_SEARCH,
+				'label'   => 'Search for an order',
+				'example' => 'Find the last order from jane@example.com.',
+			),
+			array(
+				'intent'  => self::ORDER_REFUND,
+				'label'   => 'Prepare a refund',
+				'example' => 'Refund order 1452 for $25.',
+			),
+			array(
+				'intent'  => self::ORDER_STATUS,
+				'label'   => 'Check or update order status',
+				'example' => 'What is the status of order 1452?',
+			),
+			array(
+				'intent'  => self::PRODUCT_STOCK,
+				'label'   => 'Check product stock',
+				'example' => 'How many units of the blue hoodie are in stock?',
+			),
+			array(
+				'intent'  => self::EMAIL_DRAFT,
+				'label'   => 'Draft a customer email',
+				'example' => 'Draft an apology email for order 1452.',
+			),
+			array(
+				'intent'  => self::ANALYTICS_QUERY,
+				'label'   => 'Run an analytics report',
+				'example' => 'Show sales performance for last week.',
+			),
+			array(
+				'intent'  => self::CUSTOMER_LOOKUP,
+				'label'   => 'Look up a customer profile',
+				'example' => 'Pull the profile for mary@example.com.',
+			),
+		);
+	}
+
+	/**
+	 * @param string $intent Intent value.
+	 * @return string
+	 */
+	public static function normalize( $intent ) {
+		$intent = is_string( $intent ) ? strtoupper( trim( $intent ) ) : '';
+		if ( in_array( $intent, self::all(), true ) ) {
+			return $intent;
+		}
+
+		return self::UNKNOWN;
+	}
+}
diff --git a/src/Intent/IntentClassifier.php b/src/Intent/IntentClassifier.php
new file mode 100644
index 0000000000000000000000000000000000000000..a23168409a4745e57feb3cec7dbcf2482026e32e
--- /dev/null
+++ b/src/Intent/IntentClassifier.php
@@ -0,0 +1,215 @@
+<?php
+/**
+ * Rule-based intent classifier.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class IntentClassifier {
+	/**
+	 * @param string $input User input.
+	 * @param array  $context Enriched context.
+	 * @return string
+	 */
+	public function classify( $input, array $context = array() ) {
+		if ( isset( $context['intent'] ) ) {
+			$override = Intent::normalize( $context['intent'] );
+			if ( Intent::UNKNOWN !== $override ) {
+				return $override;
+			}
+		}
+
+		$text = strtolower( trim( (string) $input ) );
+		if ( '' === $text ) {
+			return Intent::UNKNOWN;
+		}
+
+		$scores = array(
+			Intent::ORDER_REFUND    => $this->score_refund( $text ),
+			Intent::ORDER_STATUS    => $this->score_status( $text ),
+			Intent::PRODUCT_STOCK   => $this->score_stock( $text ),
+			Intent::EMAIL_DRAFT     => $this->score_email( $text ),
+			Intent::ANALYTICS_QUERY => $this->score_analytics( $text ),
+			Intent::CUSTOMER_LOOKUP => $this->score_customer( $text ),
+			Intent::ORDER_SEARCH    => $this->score_search( $text ),
+		);
+
+		$best_intent = Intent::UNKNOWN;
+		$best_score  = 0;
+
+		foreach ( $scores as $intent => $score ) {
+			if ( $score > $best_score ) {
+				$best_score  = $score;
+				$best_intent = $intent;
+			}
+		}
+
+		return $best_score > 0 ? $best_intent : Intent::UNKNOWN;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_refund( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'refund',
+				'return',
+				'chargeback',
+				'money back',
+				'reimburse',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_status( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'status',
+				'tracking',
+				'track',
+				'shipment',
+				'shipping',
+				'delivery',
+				'where is',
+				'eta',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_stock( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'stock',
+				'inventory',
+				'available',
+				'availability',
+				'out of stock',
+				'restock',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_email( $text ) {
+		$has_email  = $this->contains_phrase( $text, 'email' ) || $this->contains_phrase( $text, 'message' );
+		$has_action = $this->contains_phrase( $text, 'compose' )
+			|| $this->contains_phrase( $text, 'draft' )
+			|| $this->contains_phrase( $text, 'write' )
+			|| $this->contains_phrase( $text, 'reply' )
+			|| $this->contains_phrase( $text, 'send' );
+
+		if ( $has_email && $has_action ) {
+			return 2;
+		}
+
+		if ( $has_action ) {
+			return 1;
+		}
+
+		return 0;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_analytics( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'analytics',
+				'report',
+				'sales',
+				'revenue',
+				'performance',
+				'conversion',
+				'aov',
+				'average order',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_customer( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'customer',
+				'profile',
+				'buyer',
+				'account',
+				'loyalty',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @return int
+	 */
+	private function score_search( $text ) {
+		return $this->match_score(
+			$text,
+			array(
+				'order',
+				'search',
+				'find',
+				'lookup',
+				'last order',
+				'order id',
+				'order #',
+			)
+		);
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param array  $phrases Phrases to match.
+	 * @return int
+	 */
+	private function match_score( $text, array $phrases ) {
+		$score = 0;
+		foreach ( $phrases as $phrase ) {
+			if ( $this->contains_phrase( $text, $phrase ) ) {
+				$score++;
+			}
+		}
+
+		return $score;
+	}
+
+	/**
+	 * @param string $text Normalized text.
+	 * @param string $phrase Phrase to match.
+	 * @return bool
+	 */
+	private function contains_phrase( $text, $phrase ) {
+		$phrase = trim( $phrase );
+		if ( '' === $phrase ) {
+			return false;
+		}
+
+		return false !== strpos( $text, $phrase );
+	}
+}
diff --git a/src/Intent/MemoryStore.php b/src/Intent/MemoryStore.php
new file mode 100644
index 0000000000000000000000000000000000000000..b410a7c925ac4e94ccc4f13509826784a2965371
--- /dev/null
+++ b/src/Intent/MemoryStore.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Conversation memory stored in session.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Intent;
+
+class MemoryStore {
+	const SESSION_KEY = 'agentwp_intent_memory';
+
+	/**
+	 * @var int
+	 */
+	private $limit;
+
+	/**
+	 * @param int $limit Max memory entries.
+	 */
+	public function __construct( $limit = 5 ) {
+		$this->limit = max( 1, (int) $limit );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function get() {
+		$this->ensure_session();
+
+		if ( ! isset( $_SESSION[ self::SESSION_KEY ] ) || ! is_array( $_SESSION[ self::SESSION_KEY ] ) ) {
+			return array();
+		}
+
+		return array_values( $_SESSION[ self::SESSION_KEY ] );
+	}
+
+	/**
+	 * @param array $entry Exchange entry.
+	 * @return void
+	 */
+	public function add_exchange( array $entry ) {
+		$this->ensure_session();
+
+		$memory   = $this->get();
+		$memory[] = $entry;
+
+		if ( count( $memory ) > $this->limit ) {
+			$memory = array_slice( $memory, -1 * $this->limit );
+		}
+
+		$_SESSION[ self::SESSION_KEY ] = $memory;
+	}
+
+	/**
+	 * @return void
+	 */
+	private function ensure_session() {
+		if ( headers_sent() ) {
+			return;
+		}
+
+		if ( function_exists( 'session_status' ) ) {
+			if ( PHP_SESSION_NONE === session_status() ) {
+				session_start();
+			}
+
+			return;
+		}
+
+		if ( ! isset( $_SESSION ) ) {
+			session_start();
+		}
+	}
+}
diff --git a/src/Rest/IntentController.php b/src/Rest/IntentController.php
index 027bca1a35799ff06be0baeebaff07a26376a73f..2986f48acc3c64d115c62428b2e0e2e0c55dce04
--- a/src/Rest/IntentController.php
+++ b/src/Rest/IntentController.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Rest;
 
 use AgentWP\API\RestController;
+use AgentWP\Intent\Engine;
 use WP_REST_Server;
 
 class IntentController extends RestController {
@@ -40,13 +41,39 @@
 			return $this->response_error( 'agentwp_invalid_request', $validation->get_error_message(), 400 );
 		}
 
-		return $this->response_success(
-			array(
-				'intent_id' => wp_generate_uuid4(),
-				'status'    => 'received',
-				'message'   => __( 'Intent received for processing.', 'agentwp' ),
-			)
-		);
+		$prompt = '';
+		if ( isset( $validation['prompt'] ) ) {
+			$prompt = (string) $validation['prompt'];
+		}
+
+		if ( '' === $prompt && isset( $validation['input'] ) ) {
+			$prompt = (string) $validation['input'];
+		}
+
+		$prompt = trim( $prompt );
+		if ( '' === $prompt ) {
+			return $this->response_error( 'agentwp_missing_prompt', __( 'Please provide a prompt.', 'agentwp' ), 400 );
+		}
+
+		$context  = isset( $validation['context'] ) && is_array( $validation['context'] )
+			? $validation['context']
+			: array();
+		$metadata = isset( $validation['metadata'] ) && is_array( $validation['metadata'] )
+			? $validation['metadata']
+			: array();
+
+		$engine   = new Engine();
+		$response = $engine->handle( $prompt, $context, $metadata );
+
+		if ( ! $response->is_success() ) {
+			return $this->response_error( 'agentwp_intent_failed', $response->get_message(), $response->get_status() );
+		}
+
+		$data               = $response->get_data();
+		$data['intent_id']  = wp_generate_uuid4();
+		$data['status']     = 'handled';
+
+		return $this->response_success( $data );
 	}
 
 	/**
@@ -57,12 +84,15 @@
 	private function get_intent_schema() {
 		return array(
 			'type'     => 'object',
-			'required'             => array( 'prompt' ),
 			'properties'           => array(
 				'prompt'   => array(
 					'type'      => 'string',
 					'minLength' => 1,
 				),
+				'input'    => array(
+					'type'      => 'string',
+					'minLength' => 1,
+				),
 				'context'  => array(
 					'type' => 'object',
 				),

tokens used
91,169
