---

**Status: DONE**

## Summary of Changes

1. **Updated `docs/openapi.json`** (v0.1.0 â†’ v0.2.0):
   - Added new typed schemas: `UsageBreakdownItem`, `UsageDailyTrend`, `SearchResultItem`, `SearchResultsGrouped`
   - Changed `UsageResponseData.breakdown_by_intent` from generic object to array of typed `UsageBreakdownItem`
   - Changed `UsageResponseData.daily_trend` from generic array to typed `UsageDailyTrend[]`
   - Renamed `SearchResult` to `SearchResultItem` with proper type enum (`products | orders | customers`)
   - Added `SearchResultsGrouped` with explicit typed arrays for products/orders/customers
   - Added format and constraint annotations (date formats, additionalProperties: false, etc.)

2. **Regenerated `react/src/types/api.ts`**:
   - Types now reflect the updated OpenAPI schemas

3. **Fixed `react/src/hooks/useSearch.ts`**:
   - Updated type alias to use `SearchResultItem` instead of removed `SearchResult`

4. **Added CI drift prevention in `.github/workflows/ci.yml`**:
   - New step "Check OpenAPI types are up to date" that regenerates types and fails if they differ from committed version
   - This prevents OpenAPI spec changes from drifting out of sync with TypeScript types

## How to Verify

```bash
# Validate OpenAPI spec matches PHP controllers
php scripts/openapi-validate.php

# Regenerate types and verify they compile
cd react && npm run generate:types && npm run typecheck

# Check for drift (should show no changes)
git diff react/src/types/api.ts
```

## Risks / Follow-ups

- **Breaking change in types**: The rename of `SearchResult` to `SearchResultItem` could affect other code that imports this type. The fix was applied to `useSearch.ts` but other files should be checked if they directly reference this schema.
- **CI runs on Node 20**: Ensure the generate:types script works with Node 20 in CI environment (it should, as openapi-typescript 7.x supports Node 18+).
