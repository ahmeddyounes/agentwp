Implemented customer LTV profiling with batched order aggregation and wired the customer lookup intent to return those profiles.

Status: DONE

Summary of changes:
- Added `src/Handlers/CustomerHandler.php` to compute totals, AOV, favorites, LTV projection, health status (via `agentwp_customer_health_thresholds`), and recent order summaries with guest email lookup.
- Updated `src/Intent/Handlers/CustomerLookupHandler.php` to extract email/ID from prompts and return CustomerHandler results.

How to verify:
- Not provided (no format/lint/test commands listed).

Risks / follow-ups:
- LTV is a simple 12‑month projection based on order frequency and AOV; adjust the formula or included statuses if you want a different horizon.
- Customer ID + email inputs prioritize ID; merge both if you want guest and registered orders combined.

OpenAI Codex v0.77.0 (research preview)
--------
workdir: /Users/ahmedyounis/Documents/Projects/agentwp
model: gpt-5.2-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019b9702-1c29-70f1-b525-5352cfde3399
--------
user
You are implementing task M03-05 in this git repository.

1) Read the spec: .plans/M03-05.md
2) Read handoff/context: .t2/handoff/M03-05.md

Implement the spec fully.

Verification commands (run if non-empty):
- format: 
- lint: 
- test: 

In your final response, include:
- Status: DONE or NEEDS-REVIEW
- Summary of changes
- How to verify (exact commands)
- Risks / follow-ups

mcp startup: no servers

thinking
**Planning command approach**
exec
/bin/zsh -lc ls in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 42ms:
agentwp.php
assets
composer.json
docker
docker-compose.yml
docs
includes
languages
react
README.md
scripts
setup.sh
src
tasks.csv
uninstall.php
exec
/bin/zsh -lc "sed -n '1,200p' .plans/M03-05.md" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 47ms:
# M03-05 — Customer LTV Calculator

Implement customer lifetime value calculation: 1) Create AgentWP\Handlers\CustomerHandler class. 2) OpenAI function schema: get_customer_profile(email?: string, customer_id?: int). 3) Calculate and return: total_orders, total_spent, average_order_value, first_order_date, last_order_date, days_since_last_order, favorite_products (most purchased), favorite_categories, estimated_ltv (simple projection based on order frequency and AOV). 4) Customer health indicators: 'active' (ordered in last 60 days), 'at_risk' (61-180 days), 'churned' (180+ days). 5) Return recent_orders summary (last 5). 6) Handle guest customers by email lookup. Acceptance Criteria: LTV calculation documented and reproducible, handles customers with 500+ orders, guest lookup works by billing email, health status thresholds configurable via filter.
exec
/bin/zsh -lc "sed -n '1,200p' .t2/handoff/M03-05.md" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 49ms:
# Handoff: M03-05

Created: 2026-01-07T05:50:56.518388Z

Spec: .plans/M03-05.md

thinking
**Searching existing structure for implementation**
exec
/bin/zsh -lc 'rg -n "CustomerHandler|customer profile|get_customer_profile|LTV|lifetime" -S src includes' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 49ms:
src/Intent/Handlers/CustomerLookupHandler.php:23:		$message = 'I can look up customer profiles. Share an email or name.';
src/AI/Functions/GetCustomerProfile.php:3: * Function schema for customer profile lookup.
src/AI/Functions/GetCustomerProfile.php:12:		return 'get_customer_profile';
src/AI/Functions/GetCustomerProfile.php:16:		return 'Retrieve a customer profile by email or customer ID.';
src/Intent/Intent.php:87:				'label'   => 'Look up a customer profile',
src/Intent/Engine.php:182:			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
exec
/bin/zsh -lc "sed -n '1,200p' src/AI/Functions/GetCustomerProfile.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 32ms:
<?php
/**
 * Function schema for customer profile lookup.
 *
 * @package AgentWP
 */

namespace AgentWP\AI\Functions;

class GetCustomerProfile extends AbstractFunction {
	public function get_name() {
		return 'get_customer_profile';
	}

	public function get_description() {
		return 'Retrieve a customer profile by email or customer ID.';
	}

	public function get_parameters() {
		return array(

thinking
**Checking for CustomerHandler implementation**
exec
/bin/zsh -lc "sed -n '1,220p' src/Intent/Handlers/CustomerLookupHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 37ms:
<?php
/**
 * Handle customer lookup intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class CustomerLookupHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::CUSTOMER_LOOKUP );
	}

	/**
	 * @param array $context Context data.
	 * @return Response

thinking
**Searching for handler classes**
exec
/bin/zsh -lc "rg -n \"Handlers\\\\\" -S src" in /Users/ahmedyounis/Documents/Projects/agentwp exited 2 in 47ms:
rg: regex parse error:
    (?:Handlers\)
    ^
error: unclosed group

thinking
**Adjusting search query to fix error**
exec
/bin/zsh -lc 'rg -n "Handler" -S src includes' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 50ms:
src/Handlers/RefundHandler.php:8:namespace AgentWP\Handlers;
src/Handlers/RefundHandler.php:13:class RefundHandler {
src/Handlers/StockHandler.php:8:namespace AgentWP\Handlers;
src/Handlers/StockHandler.php:13:class StockHandler {
src/Handlers/AnalyticsHandler.php:8:namespace AgentWP\Handlers;
src/Handlers/AnalyticsHandler.php:16:class AnalyticsHandler {
src/Handlers/OrderSearchHandler.php:8:namespace AgentWP\Handlers;
src/Handlers/OrderSearchHandler.php:16:class OrderSearchHandler {
src/Handlers/EmailDraftHandler.php:8:namespace AgentWP\Handlers;
src/Handlers/EmailDraftHandler.php:17:class EmailDraftHandler {
src/Handlers/OrderStatusHandler.php:8:namespace AgentWP\Handlers;
src/Handlers/OrderStatusHandler.php:13:class OrderStatusHandler {
src/Intent/Handlers/FallbackHandler.php:8:namespace AgentWP\Intent\Handlers;
src/Intent/Handlers/FallbackHandler.php:13:class FallbackHandler extends BaseHandler {
src/Intent/Handlers/CustomerLookupHandler.php:8:namespace AgentWP\Intent\Handlers;
src/Intent/Handlers/CustomerLookupHandler.php:13:class CustomerLookupHandler extends BaseHandler {
src/Intent/Handlers/OrderRefundHandler.php:8:namespace AgentWP\Intent\Handlers;
src/Intent/Handlers/OrderRefundHandler.php:13:class OrderRefundHandler extends BaseHandler {
src/Intent/Handlers/ProductStockHandler.php:8:namespace AgentWP\Intent\Handlers;
src/Intent/Handlers/ProductStockHandler.php:11:use AgentWP\Handlers\StockHandler;

thinking
**Checking for function call handlers**
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/FunctionRegistry.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 49ms:
<?php
/**
 * OpenAI function registry for intent handlers.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

class FunctionRegistry {
	/**
	 * @var array<string, Handler>
	 */
	private $map = array();

	/**
	 * @param string  $function_name OpenAI function name.
	 * @param Handler $handler Handler instance.
	 * @return void
	 */

thinking
**Checking other handlers for function calls**
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/Handlers/OrderStatusHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 42ms:
<?php
/**
 * Handle order status intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class OrderStatusHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::ORDER_STATUS );
	}

	/**
	 * @param array $context Context data.
	 * @return Response

thinking
**Identifying location for new function calling handler**
exec
/bin/zsh -lc "sed -n '1,240p' src/Handlers/AnalyticsHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 42ms:
<?php
/**
 * Handle sales analytics reports.
 *
 * @package AgentWP
 */

namespace AgentWP\Handlers;

use AgentWP\AI\Response;
use AgentWP\Plugin;
use DateTimeImmutable;
use DateTimeZone;
use Exception;

class AnalyticsHandler {
	const CACHE_TTL_TODAY   = 300;
	const CACHE_TTL_DEFAULT = 3600;
	const TOP_LIMIT         = 5;


thinking
**Analyzing analytics handler and exploring Response class**
exec
/bin/zsh -lc "sed -n '1,200p' src/AI/Response.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 33ms:
<?php
/**
 * OpenAI response wrapper.
 *
 * @package AgentWP
 */

namespace AgentWP\AI;

class Response {
	/**
	 * @var bool
	 */
	private $success;

	/**
	 * @var int
	 */
	private $status;


thinking
**Checking Intent handlers for function calls**
exec
/bin/zsh -lc 'rg -n "get_" src/Handlers src/Intent -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 43ms:
src/Handlers/RefundHandler.php:37:		if ( ! function_exists( 'wc_get_order' ) ) {
src/Handlers/RefundHandler.php:46:		$order = wc_get_order( $order_id );
src/Handlers/RefundHandler.php:56:		$order_total    = $this->normalize_amount( $order->get_total() );
src/Handlers/RefundHandler.php:57:		$total_refunded = $this->normalize_amount( $order->get_total_refunded() );
src/Handlers/RefundHandler.php:81:		$payment_method = $this->get_payment_method_label( $order );
src/Handlers/RefundHandler.php:82:		$gateway        = $this->get_payment_gateway( $order );
src/Handlers/RefundHandler.php:91:			'customer_email'         => $this->get_customer_email( $order ),
src/Handlers/RefundHandler.php:97:		$ttl        = $this->get_draft_ttl_seconds();
src/Handlers/RefundHandler.php:130:		if ( ! function_exists( 'wc_get_order' ) || ! function_exists( 'wc_create_refund' ) ) {
src/Handlers/RefundHandler.php:154:		$order = wc_get_order( $order_id );
src/Handlers/RefundHandler.php:164:		$order_total    = $this->normalize_amount( $order->get_total() );
src/Handlers/RefundHandler.php:165:		$total_refunded = $this->normalize_amount( $order->get_total_refunded() );
src/Handlers/RefundHandler.php:195:			return Response::error( $refund->get_error_message(), 400 );
src/Handlers/RefundHandler.php:198:		$refund_id = is_object( $refund ) && method_exists( $refund, 'get_id' ) ? $refund->get_id() : 0;
src/Handlers/RefundHandler.php:236:		$decimals = $this->get_price_decimals();
src/Handlers/RefundHandler.php:248:	private function get_price_decimals() {
src/Handlers/RefundHandler.php:249:		if ( function_exists( 'wc_get_price_decimals' ) ) {
src/Handlers/RefundHandler.php:250:			return wc_get_price_decimals();
src/Handlers/RefundHandler.php:260:		$decimals = $this->get_price_decimals();
src/Handlers/RefundHandler.php:280:		if ( ! $order || ! method_exists( $order, 'get_items' ) ) {

thinking
**Searching for handler registrations**
exec
/bin/zsh -lc 'rg -n "get_sales_report|Sales" -S src' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 43ms:
src/AI/Functions/GetSalesReport.php:10:class GetSalesReport extends AbstractFunction {
src/AI/Functions/GetSalesReport.php:12:		return 'get_sales_report';
src/Intent/Engine.php:181:			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),

thinking
**Searching for FunctionRegistry usage**
exec
/bin/zsh -lc 'rg -n "FunctionRegistry" -S src includes' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 47ms:
src/Intent/FunctionRegistry.php:10:class FunctionRegistry {
src/Intent/Engine.php:37:	 * @var FunctionRegistry
src/Intent/Engine.php:53:	 * @param FunctionRegistry|null $function_registry Optional registry.
src/Intent/Engine.php:60:		FunctionRegistry $function_registry = null,
src/Intent/Engine.php:68:		$this->function_registry = $function_registry ? $function_registry : new FunctionRegistry();
src/Intent/Engine.php:112:	 * @return FunctionRegistry

thinking
**Searching for function registry population**
exec
/bin/zsh -lc "rg -n \"register\\(\" src -S" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 44ms:
src/Intent/FunctionRegistry.php:21:	public function register( $function_name, Handler $handler ) {
src/Intent/Engine.php:192:				$this->function_registry->register( $function_name, $handler );
exec
/bin/zsh -lc "sed -n '160,240p' src/Intent/Engine.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 46ms:
			return $response->get_message();
		}

		$data = $response->get_data();
		if ( is_array( $data ) && isset( $data['message'] ) ) {
			return (string) $data['message'];
		}

		return '';
	}

	/**
	 * @return void
	 */
	private function register_default_functions() {
		$mapping = array(
			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),

thinking
**Investigating function call handling**
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/Handlers/AnalyticsQueryHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 44ms:
<?php
/**
 * Handle analytics query intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class AnalyticsQueryHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::ANALYTICS_QUERY );
	}

	/**
	 * @param array $context Context data.
	 * @return Response

thinking
**Searching for function call handlers**
exec
/bin/zsh -lc 'rg -n "function call|function_name|call" src/AI src/Intent -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
src/Intent/FunctionRegistry.php:17:	 * @param string  $function_name OpenAI function name.
src/Intent/FunctionRegistry.php:21:	public function register( $function_name, Handler $handler ) {
src/Intent/FunctionRegistry.php:22:		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
src/Intent/FunctionRegistry.php:23:		if ( '' === $function_name ) {
src/Intent/FunctionRegistry.php:27:		$this->map[ $function_name ] = $handler;
src/Intent/FunctionRegistry.php:31:	 * @param string $function_name OpenAI function name.
src/Intent/FunctionRegistry.php:34:	public function get_handler( $function_name ) {
src/Intent/FunctionRegistry.php:35:		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
src/Intent/FunctionRegistry.php:36:		if ( '' === $function_name ) {
src/Intent/FunctionRegistry.php:40:		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
src/Intent/FunctionRegistry.php:51:		foreach ( $this->map as $function_name => $handler ) {
src/Intent/FunctionRegistry.php:53:				$names[] = $function_name;
src/AI/OpenAIClient.php:36:	 * @var callable|null
src/AI/OpenAIClient.php:75:		$this->on_stream     = isset( $options['on_stream'] ) && is_callable( $options['on_stream'] ) ? $options['on_stream'] : null;
src/AI/OpenAIClient.php:167:				'tool_calls' => $parsed['tool_calls'],
src/AI/OpenAIClient.php:389:				'tool_calls' => array(),
src/AI/OpenAIClient.php:400:		$tool_calls = isset( $message['tool_calls'] ) && is_array( $message['tool_calls'] ) ? $message['tool_calls'] : array();
src/AI/OpenAIClient.php:402:		if ( empty( $tool_calls ) && isset( $message['function_call'] ) && is_array( $message['function_call'] ) ) {
src/AI/OpenAIClient.php:403:			$tool_calls = array(
src/AI/OpenAIClient.php:407:					'function' => $message['function_call'],

thinking
**Searching for tool call locations**
exec
/bin/zsh -lc 'rg -n "tool_calls|function_registry|FunctionRegistry" src -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 43ms:
src/AI/OpenAIClient.php:167:				'tool_calls' => $parsed['tool_calls'],
src/AI/OpenAIClient.php:389:				'tool_calls' => array(),
src/AI/OpenAIClient.php:400:		$tool_calls = isset( $message['tool_calls'] ) && is_array( $message['tool_calls'] ) ? $message['tool_calls'] : array();
src/AI/OpenAIClient.php:402:		if ( empty( $tool_calls ) && isset( $message['function_call'] ) && is_array( $message['function_call'] ) ) {
src/AI/OpenAIClient.php:403:			$tool_calls = array(
src/AI/OpenAIClient.php:416:			'tool_calls' => $tool_calls,
src/AI/OpenAIClient.php:430:		$tool_calls = array();
src/AI/OpenAIClient.php:476:			if ( isset( $delta['tool_calls'] ) && is_array( $delta['tool_calls'] ) ) {
src/AI/OpenAIClient.php:477:				$tool_calls = $this->merge_tool_call_deltas( $tool_calls, $delta['tool_calls'] );
src/AI/OpenAIClient.php:481:				$tool_calls = $this->merge_tool_call_deltas(
src/AI/OpenAIClient.php:482:					$tool_calls,
src/AI/OpenAIClient.php:498:			'tool_calls' => array_values( $tool_calls ),
src/AI/OpenAIClient.php:506:	 * @param array $tool_calls Existing tool calls.
src/AI/OpenAIClient.php:510:	private function merge_tool_call_deltas( array $tool_calls, array $deltas ) {
src/AI/OpenAIClient.php:514:			if ( ! isset( $tool_calls[ $index ] ) ) {
src/AI/OpenAIClient.php:515:				$tool_calls[ $index ] = array(
src/AI/OpenAIClient.php:526:				$tool_calls[ $index ]['id'] = $delta['id'];
src/AI/OpenAIClient.php:530:				$tool_calls[ $index ]['type'] = $delta['type'];
src/AI/OpenAIClient.php:535:					$tool_calls[ $index ]['function']['name'] = $delta['function']['name'];
src/AI/OpenAIClient.php:539:					$tool_calls[ $index ]['function']['arguments'] .= $delta['function']['arguments'];

thinking
**Searching for tool call locations**
exec
/bin/zsh -lc 'rg -n "tool_calls|function_call|function" src -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 37ms:
src/Rest/HealthController.php:19:	public function register_routes() {
src/Rest/HealthController.php:37:	public function get_health( $request ) {
src/Rest/SettingsController.php:23:	public function register_routes() {
src/Rest/SettingsController.php:68:	public function get_settings( $request ) {
src/Rest/SettingsController.php:91:	public function update_settings( $request ) {
src/Rest/SettingsController.php:118:	public function update_api_key( $request ) {
src/Rest/SettingsController.php:173:	public function get_usage( $request ) {
src/Rest/SettingsController.php:207:	private function read_settings() {
src/Rest/SettingsController.php:221:	private function apply_settings_updates( array $settings, array $payload ) {
src/Rest/SettingsController.php:271:	private function validate_openai_api_key( $api_key ) {
src/Rest/SettingsController.php:301:	private function encrypt_api_key( $api_key ) {
src/Rest/SettingsController.php:317:	private function maybe_rotate_api_key() {
src/Rest/SettingsController.php:338:	private function get_settings_update_schema() {
src/Rest/SettingsController.php:374:	private function get_api_key_schema() {
src/Rest/SettingsController.php:391:	private function get_usage_schema() {
src/Rest/IntentController.php:20:	public function register_routes() {
src/Rest/IntentController.php:38:	public function create_intent( $request ) {
src/Rest/IntentController.php:84:	private function get_intent_schema() {
src/Handlers/RefundHandler.php:22:	public function handle( array $args ): Response {
src/Handlers/RefundHandler.php:36:	public function prepare_refund( array $args ): Response {

thinking
**Checking REST function handling**
exec
/bin/zsh -lc "sed -n '1,200p' src/Rest/IntentController.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 44ms:
<?php
/**
 * Intent REST controller.
 *
 * @package AgentWP
 */

namespace AgentWP\Rest;

use AgentWP\API\RestController;
use AgentWP\Intent\Engine;
use WP_REST_Server;

class IntentController extends RestController {
	/**
	 * Register REST routes.
	 *
	 * @return void
	 */
	public function register_routes() {

thinking
**Searching for tool-related endpoints**
exec
/bin/zsh -lc 'rg -n "tool|function" src/Rest -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 50ms:
src/Rest/HealthController.php:19:	public function register_routes() {
src/Rest/HealthController.php:37:	public function get_health( $request ) {
src/Rest/SettingsController.php:23:	public function register_routes() {
src/Rest/SettingsController.php:68:	public function get_settings( $request ) {
src/Rest/SettingsController.php:91:	public function update_settings( $request ) {
src/Rest/SettingsController.php:118:	public function update_api_key( $request ) {
src/Rest/SettingsController.php:173:	public function get_usage( $request ) {
src/Rest/SettingsController.php:207:	private function read_settings() {
src/Rest/SettingsController.php:221:	private function apply_settings_updates( array $settings, array $payload ) {
src/Rest/SettingsController.php:271:	private function validate_openai_api_key( $api_key ) {
src/Rest/SettingsController.php:301:	private function encrypt_api_key( $api_key ) {
src/Rest/SettingsController.php:317:	private function maybe_rotate_api_key() {
src/Rest/SettingsController.php:338:	private function get_settings_update_schema() {
src/Rest/SettingsController.php:374:	private function get_api_key_schema() {
src/Rest/SettingsController.php:391:	private function get_usage_schema() {
src/Rest/IntentController.php:20:	public function register_routes() {
src/Rest/IntentController.php:38:	public function create_intent( $request ) {
src/Rest/IntentController.php:84:	private function get_intent_schema() {

thinking
**Searching for function call handler**
exec
/bin/zsh -lc 'rg -n "handle_tool|tool" src react -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 51ms:
src/AI/Functions/FunctionSchema.php:29:	public function to_tool_definition();
src/AI/TokenCounter.php:20:	 * @param array  $tools Tool definitions.
src/AI/TokenCounter.php:24:	public function count_request_tokens( array $messages, array $tools, $model ) {
src/AI/TokenCounter.php:28:			+ $this->count_tool_tokens( $tools, $model );
src/AI/TokenCounter.php:67:	 * Count tokens for tool definitions.
src/AI/TokenCounter.php:69:	 * @param array  $tools Tool definitions.
src/AI/TokenCounter.php:73:	public function count_tool_tokens( array $tools, $model ) {
src/AI/TokenCounter.php:74:		if ( empty( $tools ) ) {
src/AI/TokenCounter.php:78:		$payload = wp_json_encode( $tools );
src/AI/Functions/AbstractFunction.php:3: * Base class for tool definitions.
src/AI/Functions/AbstractFunction.php:14:	public function to_tool_definition() {
src/AI/OpenAIClient.php:91:	 * @param array $functions Tool definitions or FunctionSchema instances.
src/AI/OpenAIClient.php:99:		$tools = $this->normalize_tools( $functions );
src/AI/OpenAIClient.php:106:		if ( ! empty( $tools ) ) {
src/AI/OpenAIClient.php:107:			$payload['tools']       = $tools;
src/AI/OpenAIClient.php:108:			$payload['tool_choice'] = 'auto';
src/AI/OpenAIClient.php:116:		$input_tokens = $this->token_counter->count_request_tokens( $messages, $tools, $this->model );
src/AI/OpenAIClient.php:167:				'tool_calls' => $parsed['tool_calls'],
src/AI/OpenAIClient.php:296:	private function normalize_tools( array $functions ) {
src/AI/OpenAIClient.php:297:		$tools = array();

thinking
**Checking for function tool calls in React**
exec
/bin/zsh -lc 'rg -n "tool_calls|function_call|get_sales_report|get_customer_profile" react src -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 51ms:
src/AI/Functions/GetSalesReport.php:12:		return 'get_sales_report';
src/AI/OpenAIClient.php:167:				'tool_calls' => $parsed['tool_calls'],
src/AI/OpenAIClient.php:389:				'tool_calls' => array(),
src/AI/OpenAIClient.php:400:		$tool_calls = isset( $message['tool_calls'] ) && is_array( $message['tool_calls'] ) ? $message['tool_calls'] : array();
src/AI/OpenAIClient.php:402:		if ( empty( $tool_calls ) && isset( $message['function_call'] ) && is_array( $message['function_call'] ) ) {
src/AI/OpenAIClient.php:403:			$tool_calls = array(
src/AI/OpenAIClient.php:407:					'function' => $message['function_call'],
src/AI/OpenAIClient.php:416:			'tool_calls' => $tool_calls,
src/AI/OpenAIClient.php:430:		$tool_calls = array();
src/AI/OpenAIClient.php:476:			if ( isset( $delta['tool_calls'] ) && is_array( $delta['tool_calls'] ) ) {
src/AI/OpenAIClient.php:477:				$tool_calls = $this->merge_tool_call_deltas( $tool_calls, $delta['tool_calls'] );
src/AI/OpenAIClient.php:480:			if ( isset( $delta['function_call'] ) && is_array( $delta['function_call'] ) ) {
src/AI/OpenAIClient.php:481:				$tool_calls = $this->merge_tool_call_deltas(
src/AI/OpenAIClient.php:482:					$tool_calls,
src/AI/OpenAIClient.php:487:							'function' => $delta['function_call'],
src/AI/OpenAIClient.php:498:			'tool_calls' => array_values( $tool_calls ),
src/AI/OpenAIClient.php:506:	 * @param array $tool_calls Existing tool calls.
src/AI/OpenAIClient.php:510:	private function merge_tool_call_deltas( array $tool_calls, array $deltas ) {
src/AI/OpenAIClient.php:514:			if ( ! isset( $tool_calls[ $index ] ) ) {
src/AI/OpenAIClient.php:515:				$tool_calls[ $index ] = array(

thinking
**Searching for function call locations**
exec
/bin/zsh -lc 'rg -n "tool_calls|function_call|function" react -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 43ms:
react/src/App.jsx:69:  if (typeof performance !== 'undefined' && typeof performance.now === 'function') {
react/src/App.jsx:142:    if (activeElement && typeof activeElement.focus === 'function') {
react/src/App.jsx:147:  if (html && selection && typeof document.createRange === 'function') {
react/src/App.jsx:267:export default function App() {
react/src/App.jsx:415:    if (lastActive && typeof lastActive.focus === 'function') {
react/components/cards/ErrorCard.jsx:18:export default function ErrorCard({
react/components/cards/DangerousActionCard.jsx:18:export default function DangerousActionCard({
react/components/cards/InfoCard.jsx:18:export default function InfoCard({
react/components/cards/DataTableCard.jsx:29:export default function DataTableCard({
react/components/cards/SuccessCard.jsx:18:export default function SuccessCard({
react/components/cards/ChartCard.jsx:18:export default function ChartCard({
react/components/cards/BaseCard.jsx:4:export default function BaseCard({

thinking
**Inspecting backend intent handler interface**
exec
/bin/zsh -lc "sed -n '1,120p' src/Intent/Handler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 47ms:
<?php
/**
 * Intent handler contract.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

use AgentWP\AI\Response;

interface Handler {
	/**
	 * @param string $intent Intent identifier.
	 * @return bool
	 */
	public function canHandle( string $intent ): bool;

	/**
	 * @param array $context Enriched request context.

thinking
**Distinguishing intent handlers from tool handlers**
exec
/bin/zsh -lc 'rg -n "search_orders|prepare_refund|prepare_status_update|prepare_stock_update|draft_email|get_sales_report" -S src' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
src/Handlers/RefundHandler.php:27:		return $this->prepare_refund( $args );
src/Handlers/RefundHandler.php:36:	public function prepare_refund( array $args ): Response {
src/Handlers/EmailDraftHandler.php:53:		return $this->draft_email( $args );
src/Handlers/EmailDraftHandler.php:62:	public function draft_email( array $args ): Response {
src/Handlers/OrderStatusHandler.php:32:		return $this->prepare_status_update( $args );
src/Handlers/OrderStatusHandler.php:41:	public function prepare_status_update( array $args ): Response {
src/Handlers/StockHandler.php:32:		return $this->prepare_stock_update( $args );
src/Handlers/StockHandler.php:73:	public function prepare_stock_update( array $args ): Response {
src/AI/Functions/GetSalesReport.php:12:		return 'get_sales_report';
src/AI/Functions/SearchOrders.php:12:		return 'search_orders';
src/AI/Functions/PrepareStockUpdate.php:12:		return 'prepare_stock_update';
src/AI/Functions/PrepareRefund.php:12:		return 'prepare_refund';
src/AI/Functions/DraftEmail.php:12:		return 'draft_email';
src/AI/Functions/PrepareStatusUpdate.php:12:		return 'prepare_status_update';
src/Intent/Engine.php:176:			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
src/Intent/Engine.php:177:			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
src/Intent/Engine.php:178:			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
src/Intent/Engine.php:179:			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
src/Intent/Engine.php:180:			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
src/Intent/Engine.php:181:			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),

thinking
**Inspecting example handlers**
exec
/bin/zsh -lc "sed -n '1,220p' src/Handlers/OrderSearchHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 47ms:
<?php
/**
 * Handle order search requests.
 *
 * @package AgentWP
 */

namespace AgentWP\Handlers;

use AgentWP\AI\Response;
use AgentWP\Plugin;
use DateTimeImmutable;
use DateTimeZone;
use Exception;

class OrderSearchHandler {
	const DEFAULT_LIMIT = 10;
	const CACHE_TTL     = 3600;

	/**

thinking
**Investigating tool call handling**
exec
/bin/zsh -lc 'rg -n "get_sales_report|prepare_refund|search_orders|draft_email|prepare_status_update|prepare_stock_update|get_customer_profile" -S .' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
./src/Handlers/RefundHandler.php:27:		return $this->prepare_refund( $args );
./src/Handlers/RefundHandler.php:36:	public function prepare_refund( array $args ): Response {
./src/Handlers/EmailDraftHandler.php:53:		return $this->draft_email( $args );
./src/Handlers/EmailDraftHandler.php:62:	public function draft_email( array $args ): Response {
./src/Handlers/OrderStatusHandler.php:32:		return $this->prepare_status_update( $args );
./src/Handlers/OrderStatusHandler.php:41:	public function prepare_status_update( array $args ): Response {
./src/Handlers/StockHandler.php:32:		return $this->prepare_stock_update( $args );
./src/Handlers/StockHandler.php:73:	public function prepare_stock_update( array $args ): Response {
./src/AI/Functions/GetSalesReport.php:12:		return 'get_sales_report';
./src/AI/Functions/SearchOrders.php:12:		return 'search_orders';
./src/AI/Functions/GetCustomerProfile.php:12:		return 'get_customer_profile';
./src/AI/Functions/PrepareStockUpdate.php:12:		return 'prepare_stock_update';
./src/AI/Functions/PrepareRefund.php:12:		return 'prepare_refund';
./src/AI/Functions/DraftEmail.php:12:		return 'draft_email';
./src/AI/Functions/PrepareStatusUpdate.php:12:		return 'prepare_status_update';
./src/Intent/Engine.php:176:			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
./src/Intent/Engine.php:177:			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
./src/Intent/Engine.php:178:			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
./src/Intent/Engine.php:179:			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
./src/Intent/Engine.php:180:			Intent::EMAIL_DRAFT     => array( 'draft_email' ),

thinking
**Investigating tool call handling**
exec
/bin/zsh -lc "sed -n '1,220p' src/Intent/Engine.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 44ms:
<?php
/**
 * Intent engine for routing requests.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

use AgentWP\AI\Response;
use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
use AgentWP\Intent\Handlers\CustomerLookupHandler;
use AgentWP\Intent\Handlers\EmailDraftHandler;
use AgentWP\Intent\Handlers\FallbackHandler;
use AgentWP\Intent\Handlers\OrderRefundHandler;
use AgentWP\Intent\Handlers\OrderSearchHandler;
use AgentWP\Intent\Handlers\OrderStatusHandler;
use AgentWP\Intent\Handlers\ProductStockHandler;

class Engine {

thinking
**Investigating function call locations**
exec
/bin/zsh -lc 'rg -n "tool|function" src/API src/Rest src -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 52ms:
src/Rest/HealthController.php:19:	public function register_routes() {
src/Rest/HealthController.php:37:	public function get_health( $request ) {
src/API/RestController.php:21:	public function __construct() {
src/API/RestController.php:31:	public function permissions_check( $request ) {
src/API/RestController.php:56:	protected function validate_request( $request, array $schema, $source = 'json' ) {
src/API/RestController.php:77:	protected function response_success( $data, $status = 200 ) {
src/API/RestController.php:100:	protected function response_error( $code, $message, $status = 400 ) {
src/API/RestController.php:125:	public static function check_rate_limit( $request ) {
src/API/RestController.php:180:	public static function log_request( $request, $status, $error_code = '' ) {
src/Rest/HealthController.php:19:	public function register_routes() {
src/Rest/HealthController.php:37:	public function get_health( $request ) {
src/Rest/SettingsController.php:23:	public function register_routes() {
src/Rest/SettingsController.php:68:	public function get_settings( $request ) {
src/Rest/SettingsController.php:91:	public function update_settings( $request ) {
src/Rest/SettingsController.php:118:	public function update_api_key( $request ) {
src/Rest/SettingsController.php:173:	public function get_usage( $request ) {
src/Rest/SettingsController.php:207:	private function read_settings() {
src/Rest/SettingsController.php:221:	private function apply_settings_updates( array $settings, array $payload ) {
src/Rest/SettingsController.php:271:	private function validate_openai_api_key( $api_key ) {
src/Rest/SettingsController.php:301:	private function encrypt_api_key( $api_key ) {

thinking
**Investigating function call handling**
exec
/bin/zsh -lc "sed -n '1,200p' agentwp.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 48ms:
<?php
/**
 * Plugin Name: AgentWP
 * Plugin URI: https://agentwp.example
 * Description: React-powered admin UI for WooCommerce automation.
 * Version: 0.1.0
 * Requires at least: 6.4
 * Requires PHP: 7.4
 * WC requires at least: 8.0
 * Author: AgentWP
 * Text Domain: agentwp
 * Domain Path: /languages
 */

if ( ! defined( 'ABSPATH' ) ) {
	exit;
}

define( 'AGENTWP_VERSION', '0.1.0' );
define( 'AGENTWP_PLUGIN_FILE', __FILE__ );

thinking
**Checking handler usage in plugins**
exec
/bin/zsh -lc "sed -n '1,260p' src/Plugin.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 33ms:
<?php
/**
 * Core plugin bootstrap.
 *
 * @package AgentWP
 */

namespace AgentWP;

class Plugin {
	const OPTION_SETTINGS     = 'agentwp_settings';
	const OPTION_API_KEY      = 'agentwp_api_key';
	const OPTION_API_KEY_LAST4 = 'agentwp_api_key_last4';
	const OPTION_BUDGET_LIMIT = 'agentwp_budget_limit';
	const OPTION_DRAFT_TTL    = 'agentwp_draft_ttl_minutes';
	const OPTION_USAGE_STATS  = 'agentwp_usage_stats';
	const TRANSIENT_PREFIX    = 'agentwp_';

	/**
	 * @var Plugin|null

thinking
**Investigating function call usage**
exec
/bin/zsh -lc 'rg -n "agentwp" react/src -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 54ms:
react/src/App.jsx:5:const OPEN_STATE_KEY = 'agentwp-command-deck-open';
react/src/App.jsx:6:const DRAFT_HISTORY_KEY = 'agentwp-draft-history';
react/src/App.jsx:11:  '#wp-admin-bar-agentwp',
react/src/App.jsx:12:  '[data-agentwp-command-deck]',
react/src/App.jsx:13:  '#agentwp-command-deck',
react/src/App.jsx:15:const REST_PATH = '/agentwp/v1/intent';
react/src/App.jsx:54:  const root = window.agentwpSettings?.root || window.wpApiSettings?.root;
react/src/App.jsx:65:  return window.agentwpSettings?.nonce || window.wpApiSettings?.nonce || null;
react/src/App.jsx:336:      setDraftSubject(draft.subject || draft.prompt || 'AgentWP Draft');
react/src/App.jsx:565:        const errorMessage = data?.error?.message || data?.message || 'Unable to reach AgentWP.';
react/src/App.jsx:572:        'Intent received. AgentWP is preparing the next step.';
react/src/App.jsx:574:      const subjectLine = trimmedPrompt || 'AgentWP Draft';
react/src/App.jsx:592:      setErrorMessage(error?.message || 'Unable to reach AgentWP.');
react/src/App.jsx:615:      link.download = 'agentwp-analytics.png';
react/src/App.jsx:647:            AgentWP
react/src/App.jsx:774:            aria-labelledby="agentwp-command-deck-title"
react/src/App.jsx:780:                  AgentWP
react/src/App.jsx:782:                <h2 id="agentwp-command-deck-title" className="text-lg font-semibold text-white">
react/src/App.jsx:798:                <label htmlFor="agentwp-prompt" className="sr-only">
react/src/App.jsx:799:                  Ask AgentWP anything

thinking
**Investigating function call handlers**
exec
/bin/zsh -lc 'rg -n "OrderSearchHandler" -S src' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 49ms:
src/Handlers/OrderSearchHandler.php:16:class OrderSearchHandler {
src/Intent/Handlers/OrderSearchHandler.php:11:use AgentWP\Handlers\OrderSearchHandler as OrderSearchService;
src/Intent/Handlers/OrderSearchHandler.php:14:class OrderSearchHandler extends BaseHandler {
src/Intent/Engine.php:16:use AgentWP\Intent\Handlers\OrderSearchHandler;
src/Intent/Engine.php:130:			new OrderSearchHandler(),

thinking
**Checking OrderSearchService usage**
exec
/bin/zsh -lc "sed -n '1,140p' src/Intent/Handlers/OrderSearchHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 44ms:
<?php
/**
 * Handle order search intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Handlers\OrderSearchHandler as OrderSearchService;
use AgentWP\Intent\Intent;

class OrderSearchHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::ORDER_SEARCH );
	}

	/**
	 * @param array $context Context data.

thinking
**Analyzing intent and service handler connections**
exec
/bin/zsh -lc "sed -n '1,140p' src/Intent/Handlers/ProductStockHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 44ms:
<?php
/**
 * Handle product stock intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Handlers\StockHandler;
use AgentWP\Intent\Intent;

class ProductStockHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::PRODUCT_STOCK );
	}

	/**
	 * @param array $context Context data.

thinking
**Checking AnalyticsQueryHandler behavior**
exec
/bin/zsh -lc "sed -n '1,120p' src/Intent/Handlers/AnalyticsQueryHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 31ms:
<?php
/**
 * Handle analytics query intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Intent;

class AnalyticsQueryHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::ANALYTICS_QUERY );
	}

	/**
	 * @param array $context Context data.
	 * @return Response

thinking
**Analyzing service and handler usage patterns**
exec
/bin/zsh -lc "sed -n '500,700p' react/src/App.jsx" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 47ms:
          last.focus();
        }
      } else if (activeElement === last) {
        event.preventDefault();
        first.focus();
      }
    };

    document.addEventListener('keydown', handleKeydown);
    return () => document.removeEventListener('keydown', handleKeydown);
  }, [closeModal, isOpen]);

  useEffect(() => {
    return () => {
      abortActiveRequest();
    };
  }, [abortActiveRequest]);

  useEffect(() => {
    return () => {

thinking
**Evaluating handler usage and LTV calculation integration**
exec
/bin/zsh -lc 'rg -n "AnalyticsHandler" -S src' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 49ms:
src/Handlers/AnalyticsHandler.php:16:class AnalyticsHandler {

thinking
**Investigating handler usage and integration**
exec
/bin/zsh -lc 'ls scripts' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 36ms:
agent_csv_runner.py
agentflow.py
audit_to_sarif.py
seed-woocommerce.php
wp-setup.sh

thinking
**Investigating use of apply_filters in handlers**
exec
/bin/zsh -lc "rg -n \"apply_filters\\(\" src/Handlers -S" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 51ms:
src/Handlers/RefundHandler.php:538:		$notify = apply_filters( 'agentwp_refund_notify_customer', false, $refund, $order, $payload );
src/Handlers/OrderStatusHandler.php:420:		$notify_customer = apply_filters( 'agentwp_status_notify_customer', $notify_customer, $order, $new_status );




thinking
**Analyzing WooCommerce order data handling**
thinking
**Detailing customer lookup and data aggregation**

I'm mapping out how to handle customer lookups by ID or email, supporting guests via billing email. I plan batch queries to handle 500+ orders efficiently, combining results from customer ID and email to avoid missing guest orders. I'll compute totals, order dates, health status with configurable thresholds, recent orders summary, and favorite products/categories by aggregating order items, while caching category lookups for performance. The approach balances SQL queries and WooCommerce functions carefully to keep memory use reasonable.
thinking
**Clarifying order status filtering and data calculations**

I'm refining how to filter orders by paid statuses for LTV and health metrics, handling combined queries for customer ID and email to include guest orders without double counting. I'll process order data carefully to compute order counts, totals, averages, dates, health indicators, favorite products/categories, and recent orders summaries, ensuring consistent formatting and performance optimizations like batching and caching category lookups.
thinking
**Ensuring input sanitization and refining calculations**

I'm focusing on sanitizing inputs like email and customer ID carefully while setting constants for batching. I'll add clear comments around the LTV formula and implement a customizable health threshold filter. I want to handle edge cases like no orders gracefully with consistent defaults, ensure date and amount formatting is robust, and carefully choose WooCommerce query parameters—leaning toward separate use of customer_id and billing_email to reliably include both registered and guest orders.
exec
/bin/zsh -lc "sed -n '830,920p' src/Context/EmailContextBuilder.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 52ms:
		}

		$numbers = array();
		foreach ( $list as $entry ) {
			$entry = trim( (string) $entry );
			if ( '' === $entry ) {
				continue;
			}

			$numbers[ $entry ] = true;
		}

		return array_keys( $numbers );
	}

	/**
	 * @param int    $customer_id Customer ID.
	 * @param string $email Customer email.
	 * @return int
	 */

thinking
**Designing customer order data response**

I'm figuring out how to align order queries using the `customer` parameter and how to handle guests by their billing email. I want to carefully decide which order statuses to include for different metrics like total spent and recent orders, leaning toward using paid statuses for consistency. Also, I’m planning a detailed final response structure including customer info, totals, favorite products, LTV projections with included statuses, health status, and recent orders, aiming for clarity and reproducibility. Now I’m ready to start implementation step by step.
file update
A /Users/ahmedyounis/Documents/Projects/agentwp/src/Handlers/CustomerHandler.php
<?php
/**
 * Handle customer profile requests.
 *
 * @package AgentWP
 */

namespace AgentWP\Handlers;

use AgentWP\AI\Response;

class CustomerHandler {
	const RECENT_LIMIT = 5;
	const TOP_LIMIT    = 5;
	const ORDER_BATCH  = 200;

	/**
	 * Handle a customer profile request.
	 *
	 * @param array $args Request arguments.
	 * @return Response
	 */
	public function handle( array $args ): Response {
		if ( ! function_exists( 'wc_get_orders' ) ) {
			return Response::error( 'WooCommerce is required to fetch customer profiles.', 400 );
		}

		$normalized = $this->normalize_args( $args );
		if ( 0 === $normalized['customer_id'] && '' === $normalized['email'] ) {
			return Response::error( 'Provide a customer ID or email address.', 400 );
		}

		$paid_statuses = $this->get_paid_statuses();
		$order_ids     = $this->collect_order_ids( $normalized, $paid_statuses );
		$metrics       = $this->build_metrics( $order_ids );
		$recent_orders = $this->get_recent_orders( $normalized, $paid_statuses );

		$payload = array_merge(
			$metrics,
			array(
				'customer'          => $this->build_customer_summary( $normalized, $recent_orders ),
				'health_thresholds' => $this->get_health_thresholds(),
				'recent_orders'     => $recent_orders,
			)
		);

		return Response::success( $payload );
	}

	/**
	 * @param array $args Request args.
	 * @return array
	 */
	private function normalize_args( array $args ) {
		$email       = isset( $args['email'] ) ? sanitize_email( $args['email'] ) : '';
		$customer_id = isset( $args['customer_id'] ) ? absint( $args['customer_id'] ) : 0;

		if ( '' === $email && $customer_id > 0 && function_exists( 'get_userdata' ) ) {
			$user = get_userdata( $customer_id );
			if ( $user && isset( $user->user_email ) ) {
				$email = sanitize_email( $user->user_email );
			}
		}

		return array(
			'email'       => $email,
			'customer_id' => $customer_id,
		);
	}

	/**
	 * @param array $normalized Normalized request args.
	 * @param array $statuses Paid statuses.
	 * @return array
	 */
	private function collect_order_ids( array $normalized, array $statuses ) {
		$order_ids = array();

		if ( $normalized['customer_id'] > 0 ) {
			$order_ids = array_merge(
				$order_ids,
				$this->query_order_ids(
					array(
						'customer' => $normalized['customer_id'],
						'status'   => $statuses,
					)
				)
			);
		}

		if ( '' !== $normalized['email'] && 0 === $normalized['customer_id'] ) {
			$order_ids = array_merge(
				$order_ids,
				$this->query_order_ids(
					array(
						'billing_email' => $normalized['email'],
						'status'        => $statuses,
					)
				)
			);
		}

		$order_ids = array_map( 'absint', $order_ids );
		$order_ids = array_filter( array_unique( $order_ids ) );
		sort( $order_ids );

		return $order_ids;
	}

	/**
	 * @param array $query_args Query arguments.
	 * @return array
	 */
	private function query_order_ids( array $query_args ) {
		$ids   = array();
		$page  = 1;
		$limit = self::ORDER_BATCH;

		while ( true ) {
			$args = array_merge(
				$query_args,
				array(
					'limit'  => $limit,
					'paged'  => $page,
					'return' => 'ids',
				)
			);

			$batch = wc_get_orders( $args );
			if ( ! is_array( $batch ) || empty( $batch ) ) {
				break;
			}

			$ids = array_merge( $ids, $batch );

			if ( count( $batch ) < $limit ) {
				break;
			}

			$page++;
		}

		return $ids;
	}

	/**
	 * @param array $order_ids Order IDs to summarize.
	 * @return array
	 */
	private function build_metrics( array $order_ids ) {
		$total_orders = count( $order_ids );
		$total_spent  = 0.0;
		$first_ts     = null;
		$last_ts      = null;
		$first_date   = '';
		$last_date    = '';

		$product_totals  = array();
		$category_totals = array();
		$category_cache  = array();

		foreach ( $order_ids as $order_id ) {
			$order = function_exists( 'wc_get_order' ) ? wc_get_order( $order_id ) : null;
			if ( ! $order || ! method_exists( $order, 'get_total' ) ) {
				continue;
			}

			$total_spent += $this->normalize_amount( $order->get_total() );

			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
			if ( $date_created ) {
				$timestamp = $date_created->getTimestamp();
				if ( null === $first_ts || $timestamp < $first_ts ) {
					$first_ts   = $timestamp;
					$first_date = $this->format_datetime( $date_created );
				}

				if ( null === $last_ts || $timestamp > $last_ts ) {
					$last_ts   = $timestamp;
					$last_date = $this->format_datetime( $date_created );
				}
			}

			$this->accumulate_item_totals( $order, $product_totals, $category_totals, $category_cache );
		}

		$average_order_value = 0.0;
		if ( $total_orders > 0 ) {
			$average_order_value = $this->normalize_amount( $total_spent / $total_orders );
		}

		$days_since_last_order = $this->calculate_days_since( $last_ts );
		$health_status         = $this->determine_health_status( $days_since_last_order, $total_orders );
		$ltv_projection         = $this->calculate_ltv_projection( $total_orders, $average_order_value, $first_ts );

		return array(
			'total_orders'                  => $total_orders,
			'total_spent'                   => $this->normalize_amount( $total_spent ),
			'total_spent_formatted'         => $this->format_currency( $total_spent ),
			'average_order_value'           => $average_order_value,
			'average_order_value_formatted' => $this->format_currency( $average_order_value ),
			'first_order_date'              => $first_date,
			'last_order_date'               => $last_date,
			'days_since_last_order'         => $days_since_last_order,
			'favorite_products'             => $this->format_top_products( $product_totals ),
			'favorite_categories'           => $this->format_top_categories( $category_totals ),
			'estimated_ltv'                 => $ltv_projection['estimated_ltv'],
			'estimated_ltv_formatted'       => $this->format_currency( $ltv_projection['estimated_ltv'] ),
			'ltv_projection'                => $ltv_projection['projection'],
			'health_status'                 => $health_status,
		);
	}

	/**
	 * @param array $normalized Normalized args.
	 * @param array $recent_orders Recent order summaries.
	 * @return array
	 */
	private function build_customer_summary( array $normalized, array $recent_orders ) {
		$name  = '';
		$email = $normalized['email'];

		if ( $normalized['customer_id'] > 0 && function_exists( 'get_userdata' ) ) {
			$user = get_userdata( $normalized['customer_id'] );
			if ( $user ) {
				$first = isset( $user->first_name ) ? $user->first_name : '';
				$last  = isset( $user->last_name ) ? $user->last_name : '';
				$name  = trim( $first . ' ' . $last );
				if ( '' === $name && isset( $user->display_name ) ) {
					$name = (string) $user->display_name;
				}
				if ( '' === $email && isset( $user->user_email ) ) {
					$email = sanitize_email( $user->user_email );
				}
			}
		}

		if ( '' === $name && ! empty( $recent_orders ) && isset( $recent_orders[0]['customer_name'] ) ) {
			$name = sanitize_text_field( $recent_orders[0]['customer_name'] );
		}

		return array(
			'customer_id' => $normalized['customer_id'],
			'email'       => $email,
			'name'        => $name,
			'is_guest'    => 0 === $normalized['customer_id'],
		);
	}

	/**
	 * @param array $normalized Normalized args.
	 * @param array $statuses Status list.
	 * @return array
	 */
	private function get_recent_orders( array $normalized, array $statuses ) {
		if ( ! function_exists( 'wc_get_orders' ) ) {
			return array();
		}

		$args = array(
			'limit'   => self::RECENT_LIMIT,
			'orderby' => 'date',
			'order'   => 'DESC',
			'status'  => $statuses,
		);

		if ( $normalized['customer_id'] > 0 ) {
			$args['customer'] = $normalized['customer_id'];
		} elseif ( '' !== $normalized['email'] ) {
			$args['billing_email'] = $normalized['email'];
		}

		$orders = wc_get_orders( $args );
		if ( ! is_array( $orders ) ) {
			return array();
		}

		$recent = array();
		foreach ( $orders as $order ) {
			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
				continue;
			}

			$recent[] = $this->format_order_summary( $order );
		}

		return $recent;
	}

	/**
	 * @param object $order Order instance.
	 * @return array
	 */
	private function format_order_summary( $order ) {
		$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
		$total        = method_exists( $order, 'get_total' ) ? $this->normalize_amount( $order->get_total() ) : 0.0;

		return array(
			'id'              => intval( $order->get_id() ),
			'status'          => sanitize_text_field( $order->get_status() ),
			'total'           => $total,
			'total_formatted' => $this->format_currency( $total ),
			'currency'        => sanitize_text_field( $order->get_currency() ),
			'date_created'    => $this->format_datetime( $date_created ),
			'customer_name'   => $this->get_customer_name( $order ),
			'customer_email'  => $this->get_customer_email( $order ),
			'items_summary'   => $this->format_items_summary( $order ),
		);
	}

	/**
	 * @param object $order Order instance.
	 * @return string
	 */
	private function get_customer_name( $order ) {
		$first = method_exists( $order, 'get_billing_first_name' ) ? $order->get_billing_first_name() : '';
		$last  = method_exists( $order, 'get_billing_last_name' ) ? $order->get_billing_last_name() : '';
		$name  = trim( $first . ' ' . $last );

		if ( '' === $name && method_exists( $order, 'get_shipping_first_name' ) ) {
			$first = $order->get_shipping_first_name();
			$last  = method_exists( $order, 'get_shipping_last_name' ) ? $order->get_shipping_last_name() : '';
			$name  = trim( $first . ' ' . $last );
		}

		return sanitize_text_field( $name );
	}

	/**
	 * @param object $order Order instance.
	 * @return string
	 */
	private function get_customer_email( $order ) {
		$email = method_exists( $order, 'get_billing_email' ) ? $order->get_billing_email() : '';
		if ( '' === $email && method_exists( $order, 'get_meta' ) ) {
			$email = $order->get_meta( '_shipping_email' );
		}

		return sanitize_email( $email );
	}

	/**
	 * @param object $order Order instance.
	 * @return array
	 */
	private function format_items_summary( $order ) {
		if ( ! method_exists( $order, 'get_items' ) ) {
			return array();
		}

		$items = $order->get_items();
		if ( ! is_array( $items ) ) {
			return array();
		}

		$summary = array();
		foreach ( $items as $item ) {
			if ( ! is_object( $item ) || ! method_exists( $item, 'get_name' ) ) {
				continue;
			}

			$name = sanitize_text_field( $item->get_name() );
			$qty  = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;

			if ( '' === $name ) {
				continue;
			}

			$summary[] = array(
				'name'     => $name,
				'quantity' => $qty,
			);
		}

		return $summary;
	}

	/**
	 * @param object $order Order instance.
	 * @param array  $product_totals Product totals accumulator.
	 * @param array  $category_totals Category totals accumulator.
	 * @param array  $category_cache Category cache.
	 * @return void
	 */
	private function accumulate_item_totals( $order, array &$product_totals, array &$category_totals, array &$category_cache ) {
		if ( ! method_exists( $order, 'get_items' ) ) {
			return;
		}

		$items = $order->get_items( 'line_item' );
		if ( ! is_array( $items ) ) {
			return;
		}

		foreach ( $items as $item ) {
			if ( ! is_object( $item ) || ! method_exists( $item, 'get_product_id' ) ) {
				continue;
			}

			$product_id = absint( $item->get_product_id() );
			if ( 0 === $product_id ) {
				continue;
			}

			$quantity = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
			if ( $quantity < 1 ) {
				continue;
			}

			if ( ! isset( $product_totals[ $product_id ] ) ) {
				$product_totals[ $product_id ] = array(
					'product_id' => $product_id,
					'name'       => sanitize_text_field( $item->get_name() ),
					'quantity'   => 0,
				);
			}

			$product_totals[ $product_id ]['quantity'] += $quantity;

			$categories = $this->get_product_categories( $product_id, $category_cache );
			foreach ( $categories as $term_id => $name ) {
				if ( ! isset( $category_totals[ $term_id ] ) ) {
					$category_totals[ $term_id ] = array(
						'category_id' => $term_id,
						'name'        => $name,
						'quantity'    => 0,
					);
				}

				$category_totals[ $term_id ]['quantity'] += $quantity;
			}
		}
	}

	/**
	 * @param int   $product_id Product ID.
	 * @param array $cache Category cache.
	 * @return array
	 */
	private function get_product_categories( $product_id, array &$cache ) {
		$product_id = absint( $product_id );
		if ( 0 === $product_id ) {
			return array();
		}

		if ( isset( $cache[ $product_id ] ) ) {
			return $cache[ $product_id ];
		}

		$categories = array();
		if ( function_exists( 'wc_get_product_terms' ) ) {
			$terms = wc_get_product_terms( $product_id, 'product_cat', array( 'fields' => 'all' ) );
			if ( is_array( $terms ) ) {
				foreach ( $terms as $term ) {
					if ( ! is_object( $term ) || ! isset( $term->term_id ) ) {
						continue;
					}
					$categories[ (int) $term->term_id ] = sanitize_text_field( $term->name );
				}
			}
		}

		$cache[ $product_id ] = $categories;

		return $categories;
	}

	/**
	 * @param array $totals Product totals.
	 * @return array
	 */
	private function format_top_products( array $totals ) {
		if ( empty( $totals ) ) {
			return array();
		}

		usort(
			$totals,
			function ( $left, $right ) {
				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
				if ( $left_qty === $right_qty ) {
					return 0;
				}

				return ( $left_qty > $right_qty ) ? -1 : 1;
			}
		);

		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
	}

	/**
	 * @param array $totals Category totals.
	 * @return array
	 */
	private function format_top_categories( array $totals ) {
		if ( empty( $totals ) ) {
			return array();
		}

		usort(
			$totals,
			function ( $left, $right ) {
				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
				if ( $left_qty === $right_qty ) {
					return 0;
				}

				return ( $left_qty > $right_qty ) ? -1 : 1;
			}
		);

		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
	}

	/**
	 * @param int|null $last_ts Last order timestamp.
	 * @return int|null
	 */
	private function calculate_days_since( $last_ts ) {
		if ( null === $last_ts ) {
			return null;
		}

		$now_ts  = $this->get_now_timestamp();
		$diff    = max( 0, $now_ts - $last_ts );
		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;

		return (int) floor( $diff / $seconds );
	}

	/**
	 * Simple 12-month projection based on orders per month and average order value.
	 *
	 * @param int      $total_orders Order count.
	 * @param float    $average_order_value Average order value.
	 * @param int|null $first_ts First order timestamp.
	 * @return array
	 */
	private function calculate_ltv_projection( $total_orders, $average_order_value, $first_ts ) {
		$orders_per_month = 0.0;
		$days_since_first = 0;

		if ( $total_orders > 0 && null !== $first_ts ) {
			$now_ts  = $this->get_now_timestamp();
			$diff    = max( 0, $now_ts - $first_ts );
			$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
			$days_since_first = (int) max( 1, floor( $diff / $seconds ) );
			$orders_per_month = $total_orders / ( $days_since_first / 30 );
		}

		$orders_per_month = round( $orders_per_month, 2 );
		$projection_months = 12;
		$estimated_ltv = $this->normalize_amount( $average_order_value * $orders_per_month * $projection_months );

		return array(
			'estimated_ltv' => $estimated_ltv,
			'projection'    => array(
				'projection_months'     => $projection_months,
				'orders_per_month'      => $orders_per_month,
				'days_since_first_order' => $days_since_first,
			),
		);
	}

	/**
	 * @param int|null $days_since_last Order recency in days.
	 * @param int      $total_orders Total orders.
	 * @return string
	 */
	private function determine_health_status( $days_since_last, $total_orders ) {
		if ( null === $days_since_last || 0 === $total_orders ) {
			return 'churned';
		}

		$thresholds = $this->get_health_thresholds();

		if ( $days_since_last <= $thresholds['active'] ) {
			return 'active';
		}

		if ( $days_since_last <= $thresholds['at_risk'] ) {
			return 'at_risk';
		}

		return 'churned';
	}

	/**
	 * @return array
	 */
	private function get_health_thresholds() {
		$thresholds = array(
			'active'  => 60,
			'at_risk' => 180,
		);

		if ( function_exists( 'apply_filters' ) ) {
			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
		}

		$active  = isset( $thresholds['active'] ) ? absint( $thresholds['active'] ) : 60;
		$at_risk = isset( $thresholds['at_risk'] ) ? absint( $thresholds['at_risk'] ) : 180;

		if ( $active <= 0 ) {
			$active = 60;
		}

		if ( $at_risk <= $active ) {
			$at_risk = $active + 1;
		}

		return array(
			'active'  => $active,
			'at_risk' => $at_risk,
		);
	}

	/**
	 * @return array
	 */
	private function get_paid_statuses() {
		$statuses = function_exists( 'wc_get_is_paid_statuses' )
			? wc_get_is_paid_statuses()
			: array( 'processing', 'completed', 'on-hold' );

		$statuses = array_filter( array_map( 'sanitize_text_field', (array) $statuses ) );
		if ( empty( $statuses ) ) {
			return array( 'processing', 'completed', 'on-hold' );
		}

		return array_values( array_unique( $statuses ) );
	}

	/**
	 * @param mixed $amount Amount input.
	 * @return float
	 */
	private function normalize_amount( $amount ) {
		if ( function_exists( 'wc_format_decimal' ) ) {
			return (float) wc_format_decimal( $amount, $this->get_price_decimals() );
		}

		return (float) $amount;
	}

	/**
	 * @return int
	 */
	private function get_price_decimals() {
		if ( function_exists( 'wc_get_price_decimals' ) ) {
			return (int) wc_get_price_decimals();
		}

		return 2;
	}

	/**
	 * @param float $value Currency amount.
	 * @return string
	 */
	private function format_currency( $value ) {
		$amount = $this->normalize_amount( $value );
		if ( function_exists( 'wc_price' ) ) {
			return wc_price( $amount );
		}

		return number_format( $amount, $this->get_price_decimals(), '.', '' );
	}

	/**
	 * @param mixed $date Date instance.
	 * @return string
	 */
	private function format_datetime( $date ) {
		if ( ! $date || ! method_exists( $date, 'format' ) ) {
			return '';
		}

		return $date->format( 'c' );
	}

	/**
	 * @return int
	 */
	private function get_now_timestamp() {
		if ( function_exists( 'current_time' ) ) {
			return (int) current_time( 'timestamp' );
		}

		return time();
	}
}
apply_patch(auto_approved=true) exited 0 in 30ms:
Success. Updated the following files:
A src/Handlers/CustomerHandler.php
file update:
diff --git a/src/Handlers/CustomerHandler.php b/src/Handlers/CustomerHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e040c4e825ca046e730fbb88d834c2de063be608
--- /dev/null
+++ b/src/Handlers/CustomerHandler.php
@@ -0,0 +1,695 @@
+<?php
+/**
+ * Handle customer profile requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Handlers;
+
+use AgentWP\AI\Response;
+
+class CustomerHandler {
+	const RECENT_LIMIT = 5;
+	const TOP_LIMIT    = 5;
+	const ORDER_BATCH  = 200;
+
+	/**
+	 * Handle a customer profile request.
+	 *
+	 * @param array $args Request arguments.
+	 * @return Response
+	 */
+	public function handle( array $args ): Response {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return Response::error( 'WooCommerce is required to fetch customer profiles.', 400 );
+		}
+
+		$normalized = $this->normalize_args( $args );
+		if ( 0 === $normalized['customer_id'] && '' === $normalized['email'] ) {
+			return Response::error( 'Provide a customer ID or email address.', 400 );
+		}
+
+		$paid_statuses = $this->get_paid_statuses();
+		$order_ids     = $this->collect_order_ids( $normalized, $paid_statuses );
+		$metrics       = $this->build_metrics( $order_ids );
+		$recent_orders = $this->get_recent_orders( $normalized, $paid_statuses );
+
+		$payload = array_merge(
+			$metrics,
+			array(
+				'customer'          => $this->build_customer_summary( $normalized, $recent_orders ),
+				'health_thresholds' => $this->get_health_thresholds(),
+				'recent_orders'     => $recent_orders,
+			)
+		);
+
+		return Response::success( $payload );
+	}
+
+	/**
+	 * @param array $args Request args.
+	 * @return array
+	 */
+	private function normalize_args( array $args ) {
+		$email       = isset( $args['email'] ) ? sanitize_email( $args['email'] ) : '';
+		$customer_id = isset( $args['customer_id'] ) ? absint( $args['customer_id'] ) : 0;
+
+		if ( '' === $email && $customer_id > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $customer_id );
+			if ( $user && isset( $user->user_email ) ) {
+				$email = sanitize_email( $user->user_email );
+			}
+		}
+
+		return array(
+			'email'       => $email,
+			'customer_id' => $customer_id,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized request args.
+	 * @param array $statuses Paid statuses.
+	 * @return array
+	 */
+	private function collect_order_ids( array $normalized, array $statuses ) {
+		$order_ids = array();
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'customer' => $normalized['customer_id'],
+						'status'   => $statuses,
+					)
+				)
+			);
+		}
+
+		if ( '' !== $normalized['email'] && 0 === $normalized['customer_id'] ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'billing_email' => $normalized['email'],
+						'status'        => $statuses,
+					)
+				)
+			);
+		}
+
+		$order_ids = array_map( 'absint', $order_ids );
+		$order_ids = array_filter( array_unique( $order_ids ) );
+		sort( $order_ids );
+
+		return $order_ids;
+	}
+
+	/**
+	 * @param array $query_args Query arguments.
+	 * @return array
+	 */
+	private function query_order_ids( array $query_args ) {
+		$ids   = array();
+		$page  = 1;
+		$limit = self::ORDER_BATCH;
+
+		while ( true ) {
+			$args = array_merge(
+				$query_args,
+				array(
+					'limit'  => $limit,
+					'paged'  => $page,
+					'return' => 'ids',
+				)
+			);
+
+			$batch = wc_get_orders( $args );
+			if ( ! is_array( $batch ) || empty( $batch ) ) {
+				break;
+			}
+
+			$ids = array_merge( $ids, $batch );
+
+			if ( count( $batch ) < $limit ) {
+				break;
+			}
+
+			$page++;
+		}
+
+		return $ids;
+	}
+
+	/**
+	 * @param array $order_ids Order IDs to summarize.
+	 * @return array
+	 */
+	private function build_metrics( array $order_ids ) {
+		$total_orders = count( $order_ids );
+		$total_spent  = 0.0;
+		$first_ts     = null;
+		$last_ts      = null;
+		$first_date   = '';
+		$last_date    = '';
+
+		$product_totals  = array();
+		$category_totals = array();
+		$category_cache  = array();
+
+		foreach ( $order_ids as $order_id ) {
+			$order = function_exists( 'wc_get_order' ) ? wc_get_order( $order_id ) : null;
+			if ( ! $order || ! method_exists( $order, 'get_total' ) ) {
+				continue;
+			}
+
+			$total_spent += $this->normalize_amount( $order->get_total() );
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+			if ( $date_created ) {
+				$timestamp = $date_created->getTimestamp();
+				if ( null === $first_ts || $timestamp < $first_ts ) {
+					$first_ts   = $timestamp;
+					$first_date = $this->format_datetime( $date_created );
+				}
+
+				if ( null === $last_ts || $timestamp > $last_ts ) {
+					$last_ts   = $timestamp;
+					$last_date = $this->format_datetime( $date_created );
+				}
+			}
+
+			$this->accumulate_item_totals( $order, $product_totals, $category_totals, $category_cache );
+		}
+
+		$average_order_value = 0.0;
+		if ( $total_orders > 0 ) {
+			$average_order_value = $this->normalize_amount( $total_spent / $total_orders );
+		}
+
+		$days_since_last_order = $this->calculate_days_since( $last_ts );
+		$health_status         = $this->determine_health_status( $days_since_last_order, $total_orders );
+		$ltv_projection         = $this->calculate_ltv_projection( $total_orders, $average_order_value, $first_ts );
+
+		return array(
+			'total_orders'                  => $total_orders,
+			'total_spent'                   => $this->normalize_amount( $total_spent ),
+			'total_spent_formatted'         => $this->format_currency( $total_spent ),
+			'average_order_value'           => $average_order_value,
+			'average_order_value_formatted' => $this->format_currency( $average_order_value ),
+			'first_order_date'              => $first_date,
+			'last_order_date'               => $last_date,
+			'days_since_last_order'         => $days_since_last_order,
+			'favorite_products'             => $this->format_top_products( $product_totals ),
+			'favorite_categories'           => $this->format_top_categories( $category_totals ),
+			'estimated_ltv'                 => $ltv_projection['estimated_ltv'],
+			'estimated_ltv_formatted'       => $this->format_currency( $ltv_projection['estimated_ltv'] ),
+			'ltv_projection'                => $ltv_projection['projection'],
+			'health_status'                 => $health_status,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $recent_orders Recent order summaries.
+	 * @return array
+	 */
+	private function build_customer_summary( array $normalized, array $recent_orders ) {
+		$name  = '';
+		$email = $normalized['email'];
+
+		if ( $normalized['customer_id'] > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $normalized['customer_id'] );
+			if ( $user ) {
+				$first = isset( $user->first_name ) ? $user->first_name : '';
+				$last  = isset( $user->last_name ) ? $user->last_name : '';
+				$name  = trim( $first . ' ' . $last );
+				if ( '' === $name && isset( $user->display_name ) ) {
+					$name = (string) $user->display_name;
+				}
+				if ( '' === $email && isset( $user->user_email ) ) {
+					$email = sanitize_email( $user->user_email );
+				}
+			}
+		}
+
+		if ( '' === $name && ! empty( $recent_orders ) && isset( $recent_orders[0]['customer_name'] ) ) {
+			$name = sanitize_text_field( $recent_orders[0]['customer_name'] );
+		}
+
+		return array(
+			'customer_id' => $normalized['customer_id'],
+			'email'       => $email,
+			'name'        => $name,
+			'is_guest'    => 0 === $normalized['customer_id'],
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $statuses Status list.
+	 * @return array
+	 */
+	private function get_recent_orders( array $normalized, array $statuses ) {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$args = array(
+			'limit'   => self::RECENT_LIMIT,
+			'orderby' => 'date',
+			'order'   => 'DESC',
+			'status'  => $statuses,
+		);
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$args['customer'] = $normalized['customer_id'];
+		} elseif ( '' !== $normalized['email'] ) {
+			$args['billing_email'] = $normalized['email'];
+		}
+
+		$orders = wc_get_orders( $args );
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$recent = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$recent[] = $this->format_order_summary( $order );
+		}
+
+		return $recent;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_order_summary( $order ) {
+		$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+		$total        = method_exists( $order, 'get_total' ) ? $this->normalize_amount( $order->get_total() ) : 0.0;
+
+		return array(
+			'id'              => intval( $order->get_id() ),
+			'status'          => sanitize_text_field( $order->get_status() ),
+			'total'           => $total,
+			'total_formatted' => $this->format_currency( $total ),
+			'currency'        => sanitize_text_field( $order->get_currency() ),
+			'date_created'    => $this->format_datetime( $date_created ),
+			'customer_name'   => $this->get_customer_name( $order ),
+			'customer_email'  => $this->get_customer_email( $order ),
+			'items_summary'   => $this->format_items_summary( $order ),
+		);
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_name( $order ) {
+		$first = method_exists( $order, 'get_billing_first_name' ) ? $order->get_billing_first_name() : '';
+		$last  = method_exists( $order, 'get_billing_last_name' ) ? $order->get_billing_last_name() : '';
+		$name  = trim( $first . ' ' . $last );
+
+		if ( '' === $name && method_exists( $order, 'get_shipping_first_name' ) ) {
+			$first = $order->get_shipping_first_name();
+			$last  = method_exists( $order, 'get_shipping_last_name' ) ? $order->get_shipping_last_name() : '';
+			$name  = trim( $first . ' ' . $last );
+		}
+
+		return sanitize_text_field( $name );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_email( $order ) {
+		$email = method_exists( $order, 'get_billing_email' ) ? $order->get_billing_email() : '';
+		if ( '' === $email && method_exists( $order, 'get_meta' ) ) {
+			$email = $order->get_meta( '_shipping_email' );
+		}
+
+		return sanitize_email( $email );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_items_summary( $order ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return array();
+		}
+
+		$items = $order->get_items();
+		if ( ! is_array( $items ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_name' ) ) {
+				continue;
+			}
+
+			$name = sanitize_text_field( $item->get_name() );
+			$qty  = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+
+			if ( '' === $name ) {
+				continue;
+			}
+
+			$summary[] = array(
+				'name'     => $name,
+				'quantity' => $qty,
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @param array  $product_totals Product totals accumulator.
+	 * @param array  $category_totals Category totals accumulator.
+	 * @param array  $category_cache Category cache.
+	 * @return void
+	 */
+	private function accumulate_item_totals( $order, array &$product_totals, array &$category_totals, array &$category_cache ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return;
+		}
+
+		$items = $order->get_items( 'line_item' );
+		if ( ! is_array( $items ) ) {
+			return;
+		}
+
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_product_id' ) ) {
+				continue;
+			}
+
+			$product_id = absint( $item->get_product_id() );
+			if ( 0 === $product_id ) {
+				continue;
+			}
+
+			$quantity = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+			if ( $quantity < 1 ) {
+				continue;
+			}
+
+			if ( ! isset( $product_totals[ $product_id ] ) ) {
+				$product_totals[ $product_id ] = array(
+					'product_id' => $product_id,
+					'name'       => sanitize_text_field( $item->get_name() ),
+					'quantity'   => 0,
+				);
+			}
+
+			$product_totals[ $product_id ]['quantity'] += $quantity;
+
+			$categories = $this->get_product_categories( $product_id, $category_cache );
+			foreach ( $categories as $term_id => $name ) {
+				if ( ! isset( $category_totals[ $term_id ] ) ) {
+					$category_totals[ $term_id ] = array(
+						'category_id' => $term_id,
+						'name'        => $name,
+						'quantity'    => 0,
+					);
+				}
+
+				$category_totals[ $term_id ]['quantity'] += $quantity;
+			}
+		}
+	}
+
+	/**
+	 * @param int   $product_id Product ID.
+	 * @param array $cache Category cache.
+	 * @return array
+	 */
+	private function get_product_categories( $product_id, array &$cache ) {
+		$product_id = absint( $product_id );
+		if ( 0 === $product_id ) {
+			return array();
+		}
+
+		if ( isset( $cache[ $product_id ] ) ) {
+			return $cache[ $product_id ];
+		}
+
+		$categories = array();
+		if ( function_exists( 'wc_get_product_terms' ) ) {
+			$terms = wc_get_product_terms( $product_id, 'product_cat', array( 'fields' => 'all' ) );
+			if ( is_array( $terms ) ) {
+				foreach ( $terms as $term ) {
+					if ( ! is_object( $term ) || ! isset( $term->term_id ) ) {
+						continue;
+					}
+					$categories[ (int) $term->term_id ] = sanitize_text_field( $term->name );
+				}
+			}
+		}
+
+		$cache[ $product_id ] = $categories;
+
+		return $categories;
+	}
+
+	/**
+	 * @param array $totals Product totals.
+	 * @return array
+	 */
+	private function format_top_products( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param array $totals Category totals.
+	 * @return array
+	 */
+	private function format_top_categories( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param int|null $last_ts Last order timestamp.
+	 * @return int|null
+	 */
+	private function calculate_days_since( $last_ts ) {
+		if ( null === $last_ts ) {
+			return null;
+		}
+
+		$now_ts  = $this->get_now_timestamp();
+		$diff    = max( 0, $now_ts - $last_ts );
+		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+
+		return (int) floor( $diff / $seconds );
+	}
+
+	/**
+	 * Simple 12-month projection based on orders per month and average order value.
+	 *
+	 * @param int      $total_orders Order count.
+	 * @param float    $average_order_value Average order value.
+	 * @param int|null $first_ts First order timestamp.
+	 * @return array
+	 */
+	private function calculate_ltv_projection( $total_orders, $average_order_value, $first_ts ) {
+		$orders_per_month = 0.0;
+		$days_since_first = 0;
+
+		if ( $total_orders > 0 && null !== $first_ts ) {
+			$now_ts  = $this->get_now_timestamp();
+			$diff    = max( 0, $now_ts - $first_ts );
+			$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+			$days_since_first = (int) max( 1, floor( $diff / $seconds ) );
+			$orders_per_month = $total_orders / ( $days_since_first / 30 );
+		}
+
+		$orders_per_month = round( $orders_per_month, 2 );
+		$projection_months = 12;
+		$estimated_ltv = $this->normalize_amount( $average_order_value * $orders_per_month * $projection_months );
+
+		return array(
+			'estimated_ltv' => $estimated_ltv,
+			'projection'    => array(
+				'projection_months'     => $projection_months,
+				'orders_per_month'      => $orders_per_month,
+				'days_since_first_order' => $days_since_first,
+			),
+		);
+	}
+
+	/**
+	 * @param int|null $days_since_last Order recency in days.
+	 * @param int      $total_orders Total orders.
+	 * @return string
+	 */
+	private function determine_health_status( $days_since_last, $total_orders ) {
+		if ( null === $days_since_last || 0 === $total_orders ) {
+			return 'churned';
+		}
+
+		$thresholds = $this->get_health_thresholds();
+
+		if ( $days_since_last <= $thresholds['active'] ) {
+			return 'active';
+		}
+
+		if ( $days_since_last <= $thresholds['at_risk'] ) {
+			return 'at_risk';
+		}
+
+		return 'churned';
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_health_thresholds() {
+		$thresholds = array(
+			'active'  => 60,
+			'at_risk' => 180,
+		);
+
+		if ( function_exists( 'apply_filters' ) ) {
+			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
+		}
+
+		$active  = isset( $thresholds['active'] ) ? absint( $thresholds['active'] ) : 60;
+		$at_risk = isset( $thresholds['at_risk'] ) ? absint( $thresholds['at_risk'] ) : 180;
+
+		if ( $active <= 0 ) {
+			$active = 60;
+		}
+
+		if ( $at_risk <= $active ) {
+			$at_risk = $active + 1;
+		}
+
+		return array(
+			'active'  => $active,
+			'at_risk' => $at_risk,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_paid_statuses() {
+		$statuses = function_exists( 'wc_get_is_paid_statuses' )
+			? wc_get_is_paid_statuses()
+			: array( 'processing', 'completed', 'on-hold' );
+
+		$statuses = array_filter( array_map( 'sanitize_text_field', (array) $statuses ) );
+		if ( empty( $statuses ) ) {
+			return array( 'processing', 'completed', 'on-hold' );
+		}
+
+		return array_values( array_unique( $statuses ) );
+	}
+
+	/**
+	 * @param mixed $amount Amount input.
+	 * @return float
+	 */
+	private function normalize_amount( $amount ) {
+		if ( function_exists( 'wc_format_decimal' ) ) {
+			return (float) wc_format_decimal( $amount, $this->get_price_decimals() );
+		}
+
+		return (float) $amount;
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_price_decimals() {
+		if ( function_exists( 'wc_get_price_decimals' ) ) {
+			return (int) wc_get_price_decimals();
+		}
+
+		return 2;
+	}
+
+	/**
+	 * @param float $value Currency amount.
+	 * @return string
+	 */
+	private function format_currency( $value ) {
+		$amount = $this->normalize_amount( $value );
+		if ( function_exists( 'wc_price' ) ) {
+			return wc_price( $amount );
+		}
+
+		return number_format( $amount, $this->get_price_decimals(), '.', '' );
+	}
+
+	/**
+	 * @param mixed $date Date instance.
+	 * @return string
+	 */
+	private function format_datetime( $date ) {
+		if ( ! $date || ! method_exists( $date, 'format' ) ) {
+			return '';
+		}
+
+		return $date->format( 'c' );
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_now_timestamp() {
+		if ( function_exists( 'current_time' ) ) {
+			return (int) current_time( 'timestamp' );
+		}
+
+		return time();
+	}
+}

file update:
diff --git a/src/Handlers/CustomerHandler.php b/src/Handlers/CustomerHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e040c4e825ca046e730fbb88d834c2de063be608
--- /dev/null
+++ b/src/Handlers/CustomerHandler.php
@@ -0,0 +1,695 @@
+<?php
+/**
+ * Handle customer profile requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Handlers;
+
+use AgentWP\AI\Response;
+
+class CustomerHandler {
+	const RECENT_LIMIT = 5;
+	const TOP_LIMIT    = 5;
+	const ORDER_BATCH  = 200;
+
+	/**
+	 * Handle a customer profile request.
+	 *
+	 * @param array $args Request arguments.
+	 * @return Response
+	 */
+	public function handle( array $args ): Response {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return Response::error( 'WooCommerce is required to fetch customer profiles.', 400 );
+		}
+
+		$normalized = $this->normalize_args( $args );
+		if ( 0 === $normalized['customer_id'] && '' === $normalized['email'] ) {
+			return Response::error( 'Provide a customer ID or email address.', 400 );
+		}
+
+		$paid_statuses = $this->get_paid_statuses();
+		$order_ids     = $this->collect_order_ids( $normalized, $paid_statuses );
+		$metrics       = $this->build_metrics( $order_ids );
+		$recent_orders = $this->get_recent_orders( $normalized, $paid_statuses );
+
+		$payload = array_merge(
+			$metrics,
+			array(
+				'customer'          => $this->build_customer_summary( $normalized, $recent_orders ),
+				'health_thresholds' => $this->get_health_thresholds(),
+				'recent_orders'     => $recent_orders,
+			)
+		);
+
+		return Response::success( $payload );
+	}
+
+	/**
+	 * @param array $args Request args.
+	 * @return array
+	 */
+	private function normalize_args( array $args ) {
+		$email       = isset( $args['email'] ) ? sanitize_email( $args['email'] ) : '';
+		$customer_id = isset( $args['customer_id'] ) ? absint( $args['customer_id'] ) : 0;
+
+		if ( '' === $email && $customer_id > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $customer_id );
+			if ( $user && isset( $user->user_email ) ) {
+				$email = sanitize_email( $user->user_email );
+			}
+		}
+
+		return array(
+			'email'       => $email,
+			'customer_id' => $customer_id,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized request args.
+	 * @param array $statuses Paid statuses.
+	 * @return array
+	 */
+	private function collect_order_ids( array $normalized, array $statuses ) {
+		$order_ids = array();
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'customer' => $normalized['customer_id'],
+						'status'   => $statuses,
+					)
+				)
+			);
+		}
+
+		if ( '' !== $normalized['email'] && 0 === $normalized['customer_id'] ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'billing_email' => $normalized['email'],
+						'status'        => $statuses,
+					)
+				)
+			);
+		}
+
+		$order_ids = array_map( 'absint', $order_ids );
+		$order_ids = array_filter( array_unique( $order_ids ) );
+		sort( $order_ids );
+
+		return $order_ids;
+	}
+
+	/**
+	 * @param array $query_args Query arguments.
+	 * @return array
+	 */
+	private function query_order_ids( array $query_args ) {
+		$ids   = array();
+		$page  = 1;
+		$limit = self::ORDER_BATCH;
+
+		while ( true ) {
+			$args = array_merge(
+				$query_args,
+				array(
+					'limit'  => $limit,
+					'paged'  => $page,
+					'return' => 'ids',
+				)
+			);
+
+			$batch = wc_get_orders( $args );
+			if ( ! is_array( $batch ) || empty( $batch ) ) {
+				break;
+			}
+
+			$ids = array_merge( $ids, $batch );
+
+			if ( count( $batch ) < $limit ) {
+				break;
+			}
+
+			$page++;
+		}
+
+		return $ids;
+	}
+
+	/**
+	 * @param array $order_ids Order IDs to summarize.
+	 * @return array
+	 */
+	private function build_metrics( array $order_ids ) {
+		$total_orders = count( $order_ids );
+		$total_spent  = 0.0;
+		$first_ts     = null;
+		$last_ts      = null;
+		$first_date   = '';
+		$last_date    = '';
+
+		$product_totals  = array();
+		$category_totals = array();
+		$category_cache  = array();
+
+		foreach ( $order_ids as $order_id ) {
+			$order = function_exists( 'wc_get_order' ) ? wc_get_order( $order_id ) : null;
+			if ( ! $order || ! method_exists( $order, 'get_total' ) ) {
+				continue;
+			}
+
+			$total_spent += $this->normalize_amount( $order->get_total() );
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+			if ( $date_created ) {
+				$timestamp = $date_created->getTimestamp();
+				if ( null === $first_ts || $timestamp < $first_ts ) {
+					$first_ts   = $timestamp;
+					$first_date = $this->format_datetime( $date_created );
+				}
+
+				if ( null === $last_ts || $timestamp > $last_ts ) {
+					$last_ts   = $timestamp;
+					$last_date = $this->format_datetime( $date_created );
+				}
+			}
+
+			$this->accumulate_item_totals( $order, $product_totals, $category_totals, $category_cache );
+		}
+
+		$average_order_value = 0.0;
+		if ( $total_orders > 0 ) {
+			$average_order_value = $this->normalize_amount( $total_spent / $total_orders );
+		}
+
+		$days_since_last_order = $this->calculate_days_since( $last_ts );
+		$health_status         = $this->determine_health_status( $days_since_last_order, $total_orders );
+		$ltv_projection         = $this->calculate_ltv_projection( $total_orders, $average_order_value, $first_ts );
+
+		return array(
+			'total_orders'                  => $total_orders,
+			'total_spent'                   => $this->normalize_amount( $total_spent ),
+			'total_spent_formatted'         => $this->format_currency( $total_spent ),
+			'average_order_value'           => $average_order_value,
+			'average_order_value_formatted' => $this->format_currency( $average_order_value ),
+			'first_order_date'              => $first_date,
+			'last_order_date'               => $last_date,
+			'days_since_last_order'         => $days_since_last_order,
+			'favorite_products'             => $this->format_top_products( $product_totals ),
+			'favorite_categories'           => $this->format_top_categories( $category_totals ),
+			'estimated_ltv'                 => $ltv_projection['estimated_ltv'],
+			'estimated_ltv_formatted'       => $this->format_currency( $ltv_projection['estimated_ltv'] ),
+			'ltv_projection'                => $ltv_projection['projection'],
+			'health_status'                 => $health_status,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $recent_orders Recent order summaries.
+	 * @return array
+	 */
+	private function build_customer_summary( array $normalized, array $recent_orders ) {
+		$name  = '';
+		$email = $normalized['email'];
+
+		if ( $normalized['customer_id'] > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $normalized['customer_id'] );
+			if ( $user ) {
+				$first = isset( $user->first_name ) ? $user->first_name : '';
+				$last  = isset( $user->last_name ) ? $user->last_name : '';
+				$name  = trim( $first . ' ' . $last );
+				if ( '' === $name && isset( $user->display_name ) ) {
+					$name = (string) $user->display_name;
+				}
+				if ( '' === $email && isset( $user->user_email ) ) {
+					$email = sanitize_email( $user->user_email );
+				}
+			}
+		}
+
+		if ( '' === $name && ! empty( $recent_orders ) && isset( $recent_orders[0]['customer_name'] ) ) {
+			$name = sanitize_text_field( $recent_orders[0]['customer_name'] );
+		}
+
+		return array(
+			'customer_id' => $normalized['customer_id'],
+			'email'       => $email,
+			'name'        => $name,
+			'is_guest'    => 0 === $normalized['customer_id'],
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $statuses Status list.
+	 * @return array
+	 */
+	private function get_recent_orders( array $normalized, array $statuses ) {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$args = array(
+			'limit'   => self::RECENT_LIMIT,
+			'orderby' => 'date',
+			'order'   => 'DESC',
+			'status'  => $statuses,
+		);
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$args['customer'] = $normalized['customer_id'];
+		} elseif ( '' !== $normalized['email'] ) {
+			$args['billing_email'] = $normalized['email'];
+		}
+
+		$orders = wc_get_orders( $args );
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$recent = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$recent[] = $this->format_order_summary( $order );
+		}
+
+		return $recent;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_order_summary( $order ) {
+		$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+		$total        = method_exists( $order, 'get_total' ) ? $this->normalize_amount( $order->get_total() ) : 0.0;
+
+		return array(
+			'id'              => intval( $order->get_id() ),
+			'status'          => sanitize_text_field( $order->get_status() ),
+			'total'           => $total,
+			'total_formatted' => $this->format_currency( $total ),
+			'currency'        => sanitize_text_field( $order->get_currency() ),
+			'date_created'    => $this->format_datetime( $date_created ),
+			'customer_name'   => $this->get_customer_name( $order ),
+			'customer_email'  => $this->get_customer_email( $order ),
+			'items_summary'   => $this->format_items_summary( $order ),
+		);
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_name( $order ) {
+		$first = method_exists( $order, 'get_billing_first_name' ) ? $order->get_billing_first_name() : '';
+		$last  = method_exists( $order, 'get_billing_last_name' ) ? $order->get_billing_last_name() : '';
+		$name  = trim( $first . ' ' . $last );
+
+		if ( '' === $name && method_exists( $order, 'get_shipping_first_name' ) ) {
+			$first = $order->get_shipping_first_name();
+			$last  = method_exists( $order, 'get_shipping_last_name' ) ? $order->get_shipping_last_name() : '';
+			$name  = trim( $first . ' ' . $last );
+		}
+
+		return sanitize_text_field( $name );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_email( $order ) {
+		$email = method_exists( $order, 'get_billing_email' ) ? $order->get_billing_email() : '';
+		if ( '' === $email && method_exists( $order, 'get_meta' ) ) {
+			$email = $order->get_meta( '_shipping_email' );
+		}
+
+		return sanitize_email( $email );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_items_summary( $order ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return array();
+		}
+
+		$items = $order->get_items();
+		if ( ! is_array( $items ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_name' ) ) {
+				continue;
+			}
+
+			$name = sanitize_text_field( $item->get_name() );
+			$qty  = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+
+			if ( '' === $name ) {
+				continue;
+			}
+
+			$summary[] = array(
+				'name'     => $name,
+				'quantity' => $qty,
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @param array  $product_totals Product totals accumulator.
+	 * @param array  $category_totals Category totals accumulator.
+	 * @param array  $category_cache Category cache.
+	 * @return void
+	 */
+	private function accumulate_item_totals( $order, array &$product_totals, array &$category_totals, array &$category_cache ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return;
+		}
+
+		$items = $order->get_items( 'line_item' );
+		if ( ! is_array( $items ) ) {
+			return;
+		}
+
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_product_id' ) ) {
+				continue;
+			}
+
+			$product_id = absint( $item->get_product_id() );
+			if ( 0 === $product_id ) {
+				continue;
+			}
+
+			$quantity = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+			if ( $quantity < 1 ) {
+				continue;
+			}
+
+			if ( ! isset( $product_totals[ $product_id ] ) ) {
+				$product_totals[ $product_id ] = array(
+					'product_id' => $product_id,
+					'name'       => sanitize_text_field( $item->get_name() ),
+					'quantity'   => 0,
+				);
+			}
+
+			$product_totals[ $product_id ]['quantity'] += $quantity;
+
+			$categories = $this->get_product_categories( $product_id, $category_cache );
+			foreach ( $categories as $term_id => $name ) {
+				if ( ! isset( $category_totals[ $term_id ] ) ) {
+					$category_totals[ $term_id ] = array(
+						'category_id' => $term_id,
+						'name'        => $name,
+						'quantity'    => 0,
+					);
+				}
+
+				$category_totals[ $term_id ]['quantity'] += $quantity;
+			}
+		}
+	}
+
+	/**
+	 * @param int   $product_id Product ID.
+	 * @param array $cache Category cache.
+	 * @return array
+	 */
+	private function get_product_categories( $product_id, array &$cache ) {
+		$product_id = absint( $product_id );
+		if ( 0 === $product_id ) {
+			return array();
+		}
+
+		if ( isset( $cache[ $product_id ] ) ) {
+			return $cache[ $product_id ];
+		}
+
+		$categories = array();
+		if ( function_exists( 'wc_get_product_terms' ) ) {
+			$terms = wc_get_product_terms( $product_id, 'product_cat', array( 'fields' => 'all' ) );
+			if ( is_array( $terms ) ) {
+				foreach ( $terms as $term ) {
+					if ( ! is_object( $term ) || ! isset( $term->term_id ) ) {
+						continue;
+					}
+					$categories[ (int) $term->term_id ] = sanitize_text_field( $term->name );
+				}
+			}
+		}
+
+		$cache[ $product_id ] = $categories;
+
+		return $categories;
+	}
+
+	/**
+	 * @param array $totals Product totals.
+	 * @return array
+	 */
+	private function format_top_products( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param array $totals Category totals.
+	 * @return array
+	 */
+	private function format_top_categories( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param int|null $last_ts Last order timestamp.
+	 * @return int|null
+	 */
+	private function calculate_days_since( $last_ts ) {
+		if ( null === $last_ts ) {
+			return null;
+		}
+
+		$now_ts  = $this->get_now_timestamp();
+		$diff    = max( 0, $now_ts - $last_ts );
+		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+
+		return (int) floor( $diff / $seconds );
+	}
+
+	/**
+	 * Simple 12-month projection based on orders per month and average order value.
+	 *
+	 * @param int      $total_orders Order count.
+	 * @param float    $average_order_value Average order value.
+	 * @param int|null $first_ts First order timestamp.
+	 * @return array
+	 */
+	private function calculate_ltv_projection( $total_orders, $average_order_value, $first_ts ) {
+		$orders_per_month = 0.0;
+		$days_since_first = 0;
+
+		if ( $total_orders > 0 && null !== $first_ts ) {
+			$now_ts  = $this->get_now_timestamp();
+			$diff    = max( 0, $now_ts - $first_ts );
+			$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+			$days_since_first = (int) max( 1, floor( $diff / $seconds ) );
+			$orders_per_month = $total_orders / ( $days_since_first / 30 );
+		}
+
+		$orders_per_month = round( $orders_per_month, 2 );
+		$projection_months = 12;
+		$estimated_ltv = $this->normalize_amount( $average_order_value * $orders_per_month * $projection_months );
+
+		return array(
+			'estimated_ltv' => $estimated_ltv,
+			'projection'    => array(
+				'projection_months'     => $projection_months,
+				'orders_per_month'      => $orders_per_month,
+				'days_since_first_order' => $days_since_first,
+			),
+		);
+	}
+
+	/**
+	 * @param int|null $days_since_last Order recency in days.
+	 * @param int      $total_orders Total orders.
+	 * @return string
+	 */
+	private function determine_health_status( $days_since_last, $total_orders ) {
+		if ( null === $days_since_last || 0 === $total_orders ) {
+			return 'churned';
+		}
+
+		$thresholds = $this->get_health_thresholds();
+
+		if ( $days_since_last <= $thresholds['active'] ) {
+			return 'active';
+		}
+
+		if ( $days_since_last <= $thresholds['at_risk'] ) {
+			return 'at_risk';
+		}
+
+		return 'churned';
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_health_thresholds() {
+		$thresholds = array(
+			'active'  => 60,
+			'at_risk' => 180,
+		);
+
+		if ( function_exists( 'apply_filters' ) ) {
+			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
+		}
+
+		$active  = isset( $thresholds['active'] ) ? absint( $thresholds['active'] ) : 60;
+		$at_risk = isset( $thresholds['at_risk'] ) ? absint( $thresholds['at_risk'] ) : 180;
+
+		if ( $active <= 0 ) {
+			$active = 60;
+		}
+
+		if ( $at_risk <= $active ) {
+			$at_risk = $active + 1;
+		}
+
+		return array(
+			'active'  => $active,
+			'at_risk' => $at_risk,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_paid_statuses() {
+		$statuses = function_exists( 'wc_get_is_paid_statuses' )
+			? wc_get_is_paid_statuses()
+			: array( 'processing', 'completed', 'on-hold' );
+
+		$statuses = array_filter( array_map( 'sanitize_text_field', (array) $statuses ) );
+		if ( empty( $statuses ) ) {
+			return array( 'processing', 'completed', 'on-hold' );
+		}
+
+		return array_values( array_unique( $statuses ) );
+	}
+
+	/**
+	 * @param mixed $amount Amount input.
+	 * @return float
+	 */
+	private function normalize_amount( $amount ) {
+		if ( function_exists( 'wc_format_decimal' ) ) {
+			return (float) wc_format_decimal( $amount, $this->get_price_decimals() );
+		}
+
+		return (float) $amount;
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_price_decimals() {
+		if ( function_exists( 'wc_get_price_decimals' ) ) {
+			return (int) wc_get_price_decimals();
+		}
+
+		return 2;
+	}
+
+	/**
+	 * @param float $value Currency amount.
+	 * @return string
+	 */
+	private function format_currency( $value ) {
+		$amount = $this->normalize_amount( $value );
+		if ( function_exists( 'wc_price' ) ) {
+			return wc_price( $amount );
+		}
+
+		return number_format( $amount, $this->get_price_decimals(), '.', '' );
+	}
+
+	/**
+	 * @param mixed $date Date instance.
+	 * @return string
+	 */
+	private function format_datetime( $date ) {
+		if ( ! $date || ! method_exists( $date, 'format' ) ) {
+			return '';
+		}
+
+		return $date->format( 'c' );
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_now_timestamp() {
+		if ( function_exists( 'current_time' ) ) {
+			return (int) current_time( 'timestamp' );
+		}
+
+		return time();
+	}
+}


thinking
**Updating CustomerLookupHandler to new CustomerHandler**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Handlers/CustomerLookupHandler.php
@@ -10,2 +10,3 @@
 use AgentWP\AI\Response;
+use AgentWP\Handlers\CustomerHandler;
 use AgentWP\Intent\Intent;
@@ -22,4 +23,75 @@
 	public function handle( array $context ): Response {
-		$message = 'I can look up customer profiles. Share an email or name.';
-		return $this->build_response( $context, $message );
+		$query = isset( $context['input'] ) ? (string) $context['input'] : '';
+		$query = trim( $query );
+
+		if ( '' === $query ) {
+			$message = 'I can look up customer profiles. Share an email or customer ID.';
+			return $this->build_response( $context, $message );
+		}
+
+		$email       = $this->extract_email( $query );
+		$customer_id = $this->extract_customer_id( $query );
+
+		if ( '' === $email && 0 === $customer_id ) {
+			$message = 'Share an email address or customer ID to look up their profile.';
+			return $this->build_response( $context, $message );
+		}
+
+		$customer = new CustomerHandler();
+		$result   = $customer->handle(
+			array(
+				'email'       => $email,
+				'customer_id' => $customer_id,
+			)
+		);
+
+		if ( ! $result->is_success() ) {
+			return $result;
+		}
+
+		$data         = $result->get_data();
+		$total_orders = isset( $data['total_orders'] ) ? intval( $data['total_orders'] ) : 0;
+		$message      = 0 === $total_orders
+			? 'I could not find any orders for that customer.'
+			: sprintf( 'Found %d order%s for that customer.', $total_orders, 1 === $total_orders ? '' : 's' );
+
+		return $this->build_response( $context, $message, $data );
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return string
+	 */
+	private function extract_email( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return '';
+		}
+
+		if ( preg_match( '/[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}/i', $query, $matches ) ) {
+			return sanitize_email( $matches[0] );
+		}
+
+		return '';
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return int
+	 */
+	private function extract_customer_id( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return 0;
+		}
+
+		if ( ctype_digit( $query ) ) {
+			return absint( $query );
+		}
+
+		if ( preg_match( '/\b(\d+)\b/', $query, $matches ) ) {
+			return absint( $matches[1] );
+		}
+
+		return 0;
 	}
apply_patch(auto_approved=true) exited 0 in 23ms:
Success. Updated the following files:
M src/Intent/Handlers/CustomerLookupHandler.php
file update:
diff --git a/src/Handlers/CustomerHandler.php b/src/Handlers/CustomerHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e040c4e825ca046e730fbb88d834c2de063be608
--- /dev/null
+++ b/src/Handlers/CustomerHandler.php
@@ -0,0 +1,695 @@
+<?php
+/**
+ * Handle customer profile requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Handlers;
+
+use AgentWP\AI\Response;
+
+class CustomerHandler {
+	const RECENT_LIMIT = 5;
+	const TOP_LIMIT    = 5;
+	const ORDER_BATCH  = 200;
+
+	/**
+	 * Handle a customer profile request.
+	 *
+	 * @param array $args Request arguments.
+	 * @return Response
+	 */
+	public function handle( array $args ): Response {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return Response::error( 'WooCommerce is required to fetch customer profiles.', 400 );
+		}
+
+		$normalized = $this->normalize_args( $args );
+		if ( 0 === $normalized['customer_id'] && '' === $normalized['email'] ) {
+			return Response::error( 'Provide a customer ID or email address.', 400 );
+		}
+
+		$paid_statuses = $this->get_paid_statuses();
+		$order_ids     = $this->collect_order_ids( $normalized, $paid_statuses );
+		$metrics       = $this->build_metrics( $order_ids );
+		$recent_orders = $this->get_recent_orders( $normalized, $paid_statuses );
+
+		$payload = array_merge(
+			$metrics,
+			array(
+				'customer'          => $this->build_customer_summary( $normalized, $recent_orders ),
+				'health_thresholds' => $this->get_health_thresholds(),
+				'recent_orders'     => $recent_orders,
+			)
+		);
+
+		return Response::success( $payload );
+	}
+
+	/**
+	 * @param array $args Request args.
+	 * @return array
+	 */
+	private function normalize_args( array $args ) {
+		$email       = isset( $args['email'] ) ? sanitize_email( $args['email'] ) : '';
+		$customer_id = isset( $args['customer_id'] ) ? absint( $args['customer_id'] ) : 0;
+
+		if ( '' === $email && $customer_id > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $customer_id );
+			if ( $user && isset( $user->user_email ) ) {
+				$email = sanitize_email( $user->user_email );
+			}
+		}
+
+		return array(
+			'email'       => $email,
+			'customer_id' => $customer_id,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized request args.
+	 * @param array $statuses Paid statuses.
+	 * @return array
+	 */
+	private function collect_order_ids( array $normalized, array $statuses ) {
+		$order_ids = array();
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'customer' => $normalized['customer_id'],
+						'status'   => $statuses,
+					)
+				)
+			);
+		}
+
+		if ( '' !== $normalized['email'] && 0 === $normalized['customer_id'] ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'billing_email' => $normalized['email'],
+						'status'        => $statuses,
+					)
+				)
+			);
+		}
+
+		$order_ids = array_map( 'absint', $order_ids );
+		$order_ids = array_filter( array_unique( $order_ids ) );
+		sort( $order_ids );
+
+		return $order_ids;
+	}
+
+	/**
+	 * @param array $query_args Query arguments.
+	 * @return array
+	 */
+	private function query_order_ids( array $query_args ) {
+		$ids   = array();
+		$page  = 1;
+		$limit = self::ORDER_BATCH;
+
+		while ( true ) {
+			$args = array_merge(
+				$query_args,
+				array(
+					'limit'  => $limit,
+					'paged'  => $page,
+					'return' => 'ids',
+				)
+			);
+
+			$batch = wc_get_orders( $args );
+			if ( ! is_array( $batch ) || empty( $batch ) ) {
+				break;
+			}
+
+			$ids = array_merge( $ids, $batch );
+
+			if ( count( $batch ) < $limit ) {
+				break;
+			}
+
+			$page++;
+		}
+
+		return $ids;
+	}
+
+	/**
+	 * @param array $order_ids Order IDs to summarize.
+	 * @return array
+	 */
+	private function build_metrics( array $order_ids ) {
+		$total_orders = count( $order_ids );
+		$total_spent  = 0.0;
+		$first_ts     = null;
+		$last_ts      = null;
+		$first_date   = '';
+		$last_date    = '';
+
+		$product_totals  = array();
+		$category_totals = array();
+		$category_cache  = array();
+
+		foreach ( $order_ids as $order_id ) {
+			$order = function_exists( 'wc_get_order' ) ? wc_get_order( $order_id ) : null;
+			if ( ! $order || ! method_exists( $order, 'get_total' ) ) {
+				continue;
+			}
+
+			$total_spent += $this->normalize_amount( $order->get_total() );
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+			if ( $date_created ) {
+				$timestamp = $date_created->getTimestamp();
+				if ( null === $first_ts || $timestamp < $first_ts ) {
+					$first_ts   = $timestamp;
+					$first_date = $this->format_datetime( $date_created );
+				}
+
+				if ( null === $last_ts || $timestamp > $last_ts ) {
+					$last_ts   = $timestamp;
+					$last_date = $this->format_datetime( $date_created );
+				}
+			}
+
+			$this->accumulate_item_totals( $order, $product_totals, $category_totals, $category_cache );
+		}
+
+		$average_order_value = 0.0;
+		if ( $total_orders > 0 ) {
+			$average_order_value = $this->normalize_amount( $total_spent / $total_orders );
+		}
+
+		$days_since_last_order = $this->calculate_days_since( $last_ts );
+		$health_status         = $this->determine_health_status( $days_since_last_order, $total_orders );
+		$ltv_projection         = $this->calculate_ltv_projection( $total_orders, $average_order_value, $first_ts );
+
+		return array(
+			'total_orders'                  => $total_orders,
+			'total_spent'                   => $this->normalize_amount( $total_spent ),
+			'total_spent_formatted'         => $this->format_currency( $total_spent ),
+			'average_order_value'           => $average_order_value,
+			'average_order_value_formatted' => $this->format_currency( $average_order_value ),
+			'first_order_date'              => $first_date,
+			'last_order_date'               => $last_date,
+			'days_since_last_order'         => $days_since_last_order,
+			'favorite_products'             => $this->format_top_products( $product_totals ),
+			'favorite_categories'           => $this->format_top_categories( $category_totals ),
+			'estimated_ltv'                 => $ltv_projection['estimated_ltv'],
+			'estimated_ltv_formatted'       => $this->format_currency( $ltv_projection['estimated_ltv'] ),
+			'ltv_projection'                => $ltv_projection['projection'],
+			'health_status'                 => $health_status,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $recent_orders Recent order summaries.
+	 * @return array
+	 */
+	private function build_customer_summary( array $normalized, array $recent_orders ) {
+		$name  = '';
+		$email = $normalized['email'];
+
+		if ( $normalized['customer_id'] > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $normalized['customer_id'] );
+			if ( $user ) {
+				$first = isset( $user->first_name ) ? $user->first_name : '';
+				$last  = isset( $user->last_name ) ? $user->last_name : '';
+				$name  = trim( $first . ' ' . $last );
+				if ( '' === $name && isset( $user->display_name ) ) {
+					$name = (string) $user->display_name;
+				}
+				if ( '' === $email && isset( $user->user_email ) ) {
+					$email = sanitize_email( $user->user_email );
+				}
+			}
+		}
+
+		if ( '' === $name && ! empty( $recent_orders ) && isset( $recent_orders[0]['customer_name'] ) ) {
+			$name = sanitize_text_field( $recent_orders[0]['customer_name'] );
+		}
+
+		return array(
+			'customer_id' => $normalized['customer_id'],
+			'email'       => $email,
+			'name'        => $name,
+			'is_guest'    => 0 === $normalized['customer_id'],
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $statuses Status list.
+	 * @return array
+	 */
+	private function get_recent_orders( array $normalized, array $statuses ) {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$args = array(
+			'limit'   => self::RECENT_LIMIT,
+			'orderby' => 'date',
+			'order'   => 'DESC',
+			'status'  => $statuses,
+		);
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$args['customer'] = $normalized['customer_id'];
+		} elseif ( '' !== $normalized['email'] ) {
+			$args['billing_email'] = $normalized['email'];
+		}
+
+		$orders = wc_get_orders( $args );
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$recent = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$recent[] = $this->format_order_summary( $order );
+		}
+
+		return $recent;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_order_summary( $order ) {
+		$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+		$total        = method_exists( $order, 'get_total' ) ? $this->normalize_amount( $order->get_total() ) : 0.0;
+
+		return array(
+			'id'              => intval( $order->get_id() ),
+			'status'          => sanitize_text_field( $order->get_status() ),
+			'total'           => $total,
+			'total_formatted' => $this->format_currency( $total ),
+			'currency'        => sanitize_text_field( $order->get_currency() ),
+			'date_created'    => $this->format_datetime( $date_created ),
+			'customer_name'   => $this->get_customer_name( $order ),
+			'customer_email'  => $this->get_customer_email( $order ),
+			'items_summary'   => $this->format_items_summary( $order ),
+		);
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_name( $order ) {
+		$first = method_exists( $order, 'get_billing_first_name' ) ? $order->get_billing_first_name() : '';
+		$last  = method_exists( $order, 'get_billing_last_name' ) ? $order->get_billing_last_name() : '';
+		$name  = trim( $first . ' ' . $last );
+
+		if ( '' === $name && method_exists( $order, 'get_shipping_first_name' ) ) {
+			$first = $order->get_shipping_first_name();
+			$last  = method_exists( $order, 'get_shipping_last_name' ) ? $order->get_shipping_last_name() : '';
+			$name  = trim( $first . ' ' . $last );
+		}
+
+		return sanitize_text_field( $name );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_email( $order ) {
+		$email = method_exists( $order, 'get_billing_email' ) ? $order->get_billing_email() : '';
+		if ( '' === $email && method_exists( $order, 'get_meta' ) ) {
+			$email = $order->get_meta( '_shipping_email' );
+		}
+
+		return sanitize_email( $email );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_items_summary( $order ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return array();
+		}
+
+		$items = $order->get_items();
+		if ( ! is_array( $items ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_name' ) ) {
+				continue;
+			}
+
+			$name = sanitize_text_field( $item->get_name() );
+			$qty  = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+
+			if ( '' === $name ) {
+				continue;
+			}
+
+			$summary[] = array(
+				'name'     => $name,
+				'quantity' => $qty,
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @param array  $product_totals Product totals accumulator.
+	 * @param array  $category_totals Category totals accumulator.
+	 * @param array  $category_cache Category cache.
+	 * @return void
+	 */
+	private function accumulate_item_totals( $order, array &$product_totals, array &$category_totals, array &$category_cache ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return;
+		}
+
+		$items = $order->get_items( 'line_item' );
+		if ( ! is_array( $items ) ) {
+			return;
+		}
+
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_product_id' ) ) {
+				continue;
+			}
+
+			$product_id = absint( $item->get_product_id() );
+			if ( 0 === $product_id ) {
+				continue;
+			}
+
+			$quantity = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+			if ( $quantity < 1 ) {
+				continue;
+			}
+
+			if ( ! isset( $product_totals[ $product_id ] ) ) {
+				$product_totals[ $product_id ] = array(
+					'product_id' => $product_id,
+					'name'       => sanitize_text_field( $item->get_name() ),
+					'quantity'   => 0,
+				);
+			}
+
+			$product_totals[ $product_id ]['quantity'] += $quantity;
+
+			$categories = $this->get_product_categories( $product_id, $category_cache );
+			foreach ( $categories as $term_id => $name ) {
+				if ( ! isset( $category_totals[ $term_id ] ) ) {
+					$category_totals[ $term_id ] = array(
+						'category_id' => $term_id,
+						'name'        => $name,
+						'quantity'    => 0,
+					);
+				}
+
+				$category_totals[ $term_id ]['quantity'] += $quantity;
+			}
+		}
+	}
+
+	/**
+	 * @param int   $product_id Product ID.
+	 * @param array $cache Category cache.
+	 * @return array
+	 */
+	private function get_product_categories( $product_id, array &$cache ) {
+		$product_id = absint( $product_id );
+		if ( 0 === $product_id ) {
+			return array();
+		}
+
+		if ( isset( $cache[ $product_id ] ) ) {
+			return $cache[ $product_id ];
+		}
+
+		$categories = array();
+		if ( function_exists( 'wc_get_product_terms' ) ) {
+			$terms = wc_get_product_terms( $product_id, 'product_cat', array( 'fields' => 'all' ) );
+			if ( is_array( $terms ) ) {
+				foreach ( $terms as $term ) {
+					if ( ! is_object( $term ) || ! isset( $term->term_id ) ) {
+						continue;
+					}
+					$categories[ (int) $term->term_id ] = sanitize_text_field( $term->name );
+				}
+			}
+		}
+
+		$cache[ $product_id ] = $categories;
+
+		return $categories;
+	}
+
+	/**
+	 * @param array $totals Product totals.
+	 * @return array
+	 */
+	private function format_top_products( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param array $totals Category totals.
+	 * @return array
+	 */
+	private function format_top_categories( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param int|null $last_ts Last order timestamp.
+	 * @return int|null
+	 */
+	private function calculate_days_since( $last_ts ) {
+		if ( null === $last_ts ) {
+			return null;
+		}
+
+		$now_ts  = $this->get_now_timestamp();
+		$diff    = max( 0, $now_ts - $last_ts );
+		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+
+		return (int) floor( $diff / $seconds );
+	}
+
+	/**
+	 * Simple 12-month projection based on orders per month and average order value.
+	 *
+	 * @param int      $total_orders Order count.
+	 * @param float    $average_order_value Average order value.
+	 * @param int|null $first_ts First order timestamp.
+	 * @return array
+	 */
+	private function calculate_ltv_projection( $total_orders, $average_order_value, $first_ts ) {
+		$orders_per_month = 0.0;
+		$days_since_first = 0;
+
+		if ( $total_orders > 0 && null !== $first_ts ) {
+			$now_ts  = $this->get_now_timestamp();
+			$diff    = max( 0, $now_ts - $first_ts );
+			$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+			$days_since_first = (int) max( 1, floor( $diff / $seconds ) );
+			$orders_per_month = $total_orders / ( $days_since_first / 30 );
+		}
+
+		$orders_per_month = round( $orders_per_month, 2 );
+		$projection_months = 12;
+		$estimated_ltv = $this->normalize_amount( $average_order_value * $orders_per_month * $projection_months );
+
+		return array(
+			'estimated_ltv' => $estimated_ltv,
+			'projection'    => array(
+				'projection_months'     => $projection_months,
+				'orders_per_month'      => $orders_per_month,
+				'days_since_first_order' => $days_since_first,
+			),
+		);
+	}
+
+	/**
+	 * @param int|null $days_since_last Order recency in days.
+	 * @param int      $total_orders Total orders.
+	 * @return string
+	 */
+	private function determine_health_status( $days_since_last, $total_orders ) {
+		if ( null === $days_since_last || 0 === $total_orders ) {
+			return 'churned';
+		}
+
+		$thresholds = $this->get_health_thresholds();
+
+		if ( $days_since_last <= $thresholds['active'] ) {
+			return 'active';
+		}
+
+		if ( $days_since_last <= $thresholds['at_risk'] ) {
+			return 'at_risk';
+		}
+
+		return 'churned';
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_health_thresholds() {
+		$thresholds = array(
+			'active'  => 60,
+			'at_risk' => 180,
+		);
+
+		if ( function_exists( 'apply_filters' ) ) {
+			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
+		}
+
+		$active  = isset( $thresholds['active'] ) ? absint( $thresholds['active'] ) : 60;
+		$at_risk = isset( $thresholds['at_risk'] ) ? absint( $thresholds['at_risk'] ) : 180;
+
+		if ( $active <= 0 ) {
+			$active = 60;
+		}
+
+		if ( $at_risk <= $active ) {
+			$at_risk = $active + 1;
+		}
+
+		return array(
+			'active'  => $active,
+			'at_risk' => $at_risk,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_paid_statuses() {
+		$statuses = function_exists( 'wc_get_is_paid_statuses' )
+			? wc_get_is_paid_statuses()
+			: array( 'processing', 'completed', 'on-hold' );
+
+		$statuses = array_filter( array_map( 'sanitize_text_field', (array) $statuses ) );
+		if ( empty( $statuses ) ) {
+			return array( 'processing', 'completed', 'on-hold' );
+		}
+
+		return array_values( array_unique( $statuses ) );
+	}
+
+	/**
+	 * @param mixed $amount Amount input.
+	 * @return float
+	 */
+	private function normalize_amount( $amount ) {
+		if ( function_exists( 'wc_format_decimal' ) ) {
+			return (float) wc_format_decimal( $amount, $this->get_price_decimals() );
+		}
+
+		return (float) $amount;
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_price_decimals() {
+		if ( function_exists( 'wc_get_price_decimals' ) ) {
+			return (int) wc_get_price_decimals();
+		}
+
+		return 2;
+	}
+
+	/**
+	 * @param float $value Currency amount.
+	 * @return string
+	 */
+	private function format_currency( $value ) {
+		$amount = $this->normalize_amount( $value );
+		if ( function_exists( 'wc_price' ) ) {
+			return wc_price( $amount );
+		}
+
+		return number_format( $amount, $this->get_price_decimals(), '.', '' );
+	}
+
+	/**
+	 * @param mixed $date Date instance.
+	 * @return string
+	 */
+	private function format_datetime( $date ) {
+		if ( ! $date || ! method_exists( $date, 'format' ) ) {
+			return '';
+		}
+
+		return $date->format( 'c' );
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_now_timestamp() {
+		if ( function_exists( 'current_time' ) ) {
+			return (int) current_time( 'timestamp' );
+		}
+
+		return time();
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
index 8d0c36e9b634b18599d5e317f273cafb58dea92a..26d0f5cb41bb2e7f8b15d552762449dc0f0c5959
--- a/src/Intent/Handlers/CustomerLookupHandler.php
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Intent\Handlers;
 
 use AgentWP\AI\Response;
+use AgentWP\Handlers\CustomerHandler;
 use AgentWP\Intent\Intent;
 
 class CustomerLookupHandler extends BaseHandler {
@@ -20,7 +21,78 @@
 	 * @return Response
 	 */
 	public function handle( array $context ): Response {
-		$message = 'I can look up customer profiles. Share an email or name.';
-		return $this->build_response( $context, $message );
+		$query = isset( $context['input'] ) ? (string) $context['input'] : '';
+		$query = trim( $query );
+
+		if ( '' === $query ) {
+			$message = 'I can look up customer profiles. Share an email or customer ID.';
+			return $this->build_response( $context, $message );
+		}
+
+		$email       = $this->extract_email( $query );
+		$customer_id = $this->extract_customer_id( $query );
+
+		if ( '' === $email && 0 === $customer_id ) {
+			$message = 'Share an email address or customer ID to look up their profile.';
+			return $this->build_response( $context, $message );
+		}
+
+		$customer = new CustomerHandler();
+		$result   = $customer->handle(
+			array(
+				'email'       => $email,
+				'customer_id' => $customer_id,
+			)
+		);
+
+		if ( ! $result->is_success() ) {
+			return $result;
+		}
+
+		$data         = $result->get_data();
+		$total_orders = isset( $data['total_orders'] ) ? intval( $data['total_orders'] ) : 0;
+		$message      = 0 === $total_orders
+			? 'I could not find any orders for that customer.'
+			: sprintf( 'Found %d order%s for that customer.', $total_orders, 1 === $total_orders ? '' : 's' );
+
+		return $this->build_response( $context, $message, $data );
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return string
+	 */
+	private function extract_email( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return '';
+		}
+
+		if ( preg_match( '/[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}/i', $query, $matches ) ) {
+			return sanitize_email( $matches[0] );
+		}
+
+		return '';
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return int
+	 */
+	private function extract_customer_id( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return 0;
+		}
+
+		if ( ctype_digit( $query ) ) {
+			return absint( $query );
+		}
+
+		if ( preg_match( '/\b(\d+)\b/', $query, $matches ) ) {
+			return absint( $matches[1] );
+		}
+
+		return 0;
 	}
 }

file update:
diff --git a/src/Handlers/CustomerHandler.php b/src/Handlers/CustomerHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e040c4e825ca046e730fbb88d834c2de063be608
--- /dev/null
+++ b/src/Handlers/CustomerHandler.php
@@ -0,0 +1,695 @@
+<?php
+/**
+ * Handle customer profile requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Handlers;
+
+use AgentWP\AI\Response;
+
+class CustomerHandler {
+	const RECENT_LIMIT = 5;
+	const TOP_LIMIT    = 5;
+	const ORDER_BATCH  = 200;
+
+	/**
+	 * Handle a customer profile request.
+	 *
+	 * @param array $args Request arguments.
+	 * @return Response
+	 */
+	public function handle( array $args ): Response {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return Response::error( 'WooCommerce is required to fetch customer profiles.', 400 );
+		}
+
+		$normalized = $this->normalize_args( $args );
+		if ( 0 === $normalized['customer_id'] && '' === $normalized['email'] ) {
+			return Response::error( 'Provide a customer ID or email address.', 400 );
+		}
+
+		$paid_statuses = $this->get_paid_statuses();
+		$order_ids     = $this->collect_order_ids( $normalized, $paid_statuses );
+		$metrics       = $this->build_metrics( $order_ids );
+		$recent_orders = $this->get_recent_orders( $normalized, $paid_statuses );
+
+		$payload = array_merge(
+			$metrics,
+			array(
+				'customer'          => $this->build_customer_summary( $normalized, $recent_orders ),
+				'health_thresholds' => $this->get_health_thresholds(),
+				'recent_orders'     => $recent_orders,
+			)
+		);
+
+		return Response::success( $payload );
+	}
+
+	/**
+	 * @param array $args Request args.
+	 * @return array
+	 */
+	private function normalize_args( array $args ) {
+		$email       = isset( $args['email'] ) ? sanitize_email( $args['email'] ) : '';
+		$customer_id = isset( $args['customer_id'] ) ? absint( $args['customer_id'] ) : 0;
+
+		if ( '' === $email && $customer_id > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $customer_id );
+			if ( $user && isset( $user->user_email ) ) {
+				$email = sanitize_email( $user->user_email );
+			}
+		}
+
+		return array(
+			'email'       => $email,
+			'customer_id' => $customer_id,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized request args.
+	 * @param array $statuses Paid statuses.
+	 * @return array
+	 */
+	private function collect_order_ids( array $normalized, array $statuses ) {
+		$order_ids = array();
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'customer' => $normalized['customer_id'],
+						'status'   => $statuses,
+					)
+				)
+			);
+		}
+
+		if ( '' !== $normalized['email'] && 0 === $normalized['customer_id'] ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'billing_email' => $normalized['email'],
+						'status'        => $statuses,
+					)
+				)
+			);
+		}
+
+		$order_ids = array_map( 'absint', $order_ids );
+		$order_ids = array_filter( array_unique( $order_ids ) );
+		sort( $order_ids );
+
+		return $order_ids;
+	}
+
+	/**
+	 * @param array $query_args Query arguments.
+	 * @return array
+	 */
+	private function query_order_ids( array $query_args ) {
+		$ids   = array();
+		$page  = 1;
+		$limit = self::ORDER_BATCH;
+
+		while ( true ) {
+			$args = array_merge(
+				$query_args,
+				array(
+					'limit'  => $limit,
+					'paged'  => $page,
+					'return' => 'ids',
+				)
+			);
+
+			$batch = wc_get_orders( $args );
+			if ( ! is_array( $batch ) || empty( $batch ) ) {
+				break;
+			}
+
+			$ids = array_merge( $ids, $batch );
+
+			if ( count( $batch ) < $limit ) {
+				break;
+			}
+
+			$page++;
+		}
+
+		return $ids;
+	}
+
+	/**
+	 * @param array $order_ids Order IDs to summarize.
+	 * @return array
+	 */
+	private function build_metrics( array $order_ids ) {
+		$total_orders = count( $order_ids );
+		$total_spent  = 0.0;
+		$first_ts     = null;
+		$last_ts      = null;
+		$first_date   = '';
+		$last_date    = '';
+
+		$product_totals  = array();
+		$category_totals = array();
+		$category_cache  = array();
+
+		foreach ( $order_ids as $order_id ) {
+			$order = function_exists( 'wc_get_order' ) ? wc_get_order( $order_id ) : null;
+			if ( ! $order || ! method_exists( $order, 'get_total' ) ) {
+				continue;
+			}
+
+			$total_spent += $this->normalize_amount( $order->get_total() );
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+			if ( $date_created ) {
+				$timestamp = $date_created->getTimestamp();
+				if ( null === $first_ts || $timestamp < $first_ts ) {
+					$first_ts   = $timestamp;
+					$first_date = $this->format_datetime( $date_created );
+				}
+
+				if ( null === $last_ts || $timestamp > $last_ts ) {
+					$last_ts   = $timestamp;
+					$last_date = $this->format_datetime( $date_created );
+				}
+			}
+
+			$this->accumulate_item_totals( $order, $product_totals, $category_totals, $category_cache );
+		}
+
+		$average_order_value = 0.0;
+		if ( $total_orders > 0 ) {
+			$average_order_value = $this->normalize_amount( $total_spent / $total_orders );
+		}
+
+		$days_since_last_order = $this->calculate_days_since( $last_ts );
+		$health_status         = $this->determine_health_status( $days_since_last_order, $total_orders );
+		$ltv_projection         = $this->calculate_ltv_projection( $total_orders, $average_order_value, $first_ts );
+
+		return array(
+			'total_orders'                  => $total_orders,
+			'total_spent'                   => $this->normalize_amount( $total_spent ),
+			'total_spent_formatted'         => $this->format_currency( $total_spent ),
+			'average_order_value'           => $average_order_value,
+			'average_order_value_formatted' => $this->format_currency( $average_order_value ),
+			'first_order_date'              => $first_date,
+			'last_order_date'               => $last_date,
+			'days_since_last_order'         => $days_since_last_order,
+			'favorite_products'             => $this->format_top_products( $product_totals ),
+			'favorite_categories'           => $this->format_top_categories( $category_totals ),
+			'estimated_ltv'                 => $ltv_projection['estimated_ltv'],
+			'estimated_ltv_formatted'       => $this->format_currency( $ltv_projection['estimated_ltv'] ),
+			'ltv_projection'                => $ltv_projection['projection'],
+			'health_status'                 => $health_status,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $recent_orders Recent order summaries.
+	 * @return array
+	 */
+	private function build_customer_summary( array $normalized, array $recent_orders ) {
+		$name  = '';
+		$email = $normalized['email'];
+
+		if ( $normalized['customer_id'] > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $normalized['customer_id'] );
+			if ( $user ) {
+				$first = isset( $user->first_name ) ? $user->first_name : '';
+				$last  = isset( $user->last_name ) ? $user->last_name : '';
+				$name  = trim( $first . ' ' . $last );
+				if ( '' === $name && isset( $user->display_name ) ) {
+					$name = (string) $user->display_name;
+				}
+				if ( '' === $email && isset( $user->user_email ) ) {
+					$email = sanitize_email( $user->user_email );
+				}
+			}
+		}
+
+		if ( '' === $name && ! empty( $recent_orders ) && isset( $recent_orders[0]['customer_name'] ) ) {
+			$name = sanitize_text_field( $recent_orders[0]['customer_name'] );
+		}
+
+		return array(
+			'customer_id' => $normalized['customer_id'],
+			'email'       => $email,
+			'name'        => $name,
+			'is_guest'    => 0 === $normalized['customer_id'],
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $statuses Status list.
+	 * @return array
+	 */
+	private function get_recent_orders( array $normalized, array $statuses ) {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$args = array(
+			'limit'   => self::RECENT_LIMIT,
+			'orderby' => 'date',
+			'order'   => 'DESC',
+			'status'  => $statuses,
+		);
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$args['customer'] = $normalized['customer_id'];
+		} elseif ( '' !== $normalized['email'] ) {
+			$args['billing_email'] = $normalized['email'];
+		}
+
+		$orders = wc_get_orders( $args );
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$recent = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$recent[] = $this->format_order_summary( $order );
+		}
+
+		return $recent;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_order_summary( $order ) {
+		$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+		$total        = method_exists( $order, 'get_total' ) ? $this->normalize_amount( $order->get_total() ) : 0.0;
+
+		return array(
+			'id'              => intval( $order->get_id() ),
+			'status'          => sanitize_text_field( $order->get_status() ),
+			'total'           => $total,
+			'total_formatted' => $this->format_currency( $total ),
+			'currency'        => sanitize_text_field( $order->get_currency() ),
+			'date_created'    => $this->format_datetime( $date_created ),
+			'customer_name'   => $this->get_customer_name( $order ),
+			'customer_email'  => $this->get_customer_email( $order ),
+			'items_summary'   => $this->format_items_summary( $order ),
+		);
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_name( $order ) {
+		$first = method_exists( $order, 'get_billing_first_name' ) ? $order->get_billing_first_name() : '';
+		$last  = method_exists( $order, 'get_billing_last_name' ) ? $order->get_billing_last_name() : '';
+		$name  = trim( $first . ' ' . $last );
+
+		if ( '' === $name && method_exists( $order, 'get_shipping_first_name' ) ) {
+			$first = $order->get_shipping_first_name();
+			$last  = method_exists( $order, 'get_shipping_last_name' ) ? $order->get_shipping_last_name() : '';
+			$name  = trim( $first . ' ' . $last );
+		}
+
+		return sanitize_text_field( $name );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_email( $order ) {
+		$email = method_exists( $order, 'get_billing_email' ) ? $order->get_billing_email() : '';
+		if ( '' === $email && method_exists( $order, 'get_meta' ) ) {
+			$email = $order->get_meta( '_shipping_email' );
+		}
+
+		return sanitize_email( $email );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_items_summary( $order ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return array();
+		}
+
+		$items = $order->get_items();
+		if ( ! is_array( $items ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_name' ) ) {
+				continue;
+			}
+
+			$name = sanitize_text_field( $item->get_name() );
+			$qty  = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+
+			if ( '' === $name ) {
+				continue;
+			}
+
+			$summary[] = array(
+				'name'     => $name,
+				'quantity' => $qty,
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @param array  $product_totals Product totals accumulator.
+	 * @param array  $category_totals Category totals accumulator.
+	 * @param array  $category_cache Category cache.
+	 * @return void
+	 */
+	private function accumulate_item_totals( $order, array &$product_totals, array &$category_totals, array &$category_cache ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return;
+		}
+
+		$items = $order->get_items( 'line_item' );
+		if ( ! is_array( $items ) ) {
+			return;
+		}
+
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_product_id' ) ) {
+				continue;
+			}
+
+			$product_id = absint( $item->get_product_id() );
+			if ( 0 === $product_id ) {
+				continue;
+			}
+
+			$quantity = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+			if ( $quantity < 1 ) {
+				continue;
+			}
+
+			if ( ! isset( $product_totals[ $product_id ] ) ) {
+				$product_totals[ $product_id ] = array(
+					'product_id' => $product_id,
+					'name'       => sanitize_text_field( $item->get_name() ),
+					'quantity'   => 0,
+				);
+			}
+
+			$product_totals[ $product_id ]['quantity'] += $quantity;
+
+			$categories = $this->get_product_categories( $product_id, $category_cache );
+			foreach ( $categories as $term_id => $name ) {
+				if ( ! isset( $category_totals[ $term_id ] ) ) {
+					$category_totals[ $term_id ] = array(
+						'category_id' => $term_id,
+						'name'        => $name,
+						'quantity'    => 0,
+					);
+				}
+
+				$category_totals[ $term_id ]['quantity'] += $quantity;
+			}
+		}
+	}
+
+	/**
+	 * @param int   $product_id Product ID.
+	 * @param array $cache Category cache.
+	 * @return array
+	 */
+	private function get_product_categories( $product_id, array &$cache ) {
+		$product_id = absint( $product_id );
+		if ( 0 === $product_id ) {
+			return array();
+		}
+
+		if ( isset( $cache[ $product_id ] ) ) {
+			return $cache[ $product_id ];
+		}
+
+		$categories = array();
+		if ( function_exists( 'wc_get_product_terms' ) ) {
+			$terms = wc_get_product_terms( $product_id, 'product_cat', array( 'fields' => 'all' ) );
+			if ( is_array( $terms ) ) {
+				foreach ( $terms as $term ) {
+					if ( ! is_object( $term ) || ! isset( $term->term_id ) ) {
+						continue;
+					}
+					$categories[ (int) $term->term_id ] = sanitize_text_field( $term->name );
+				}
+			}
+		}
+
+		$cache[ $product_id ] = $categories;
+
+		return $categories;
+	}
+
+	/**
+	 * @param array $totals Product totals.
+	 * @return array
+	 */
+	private function format_top_products( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param array $totals Category totals.
+	 * @return array
+	 */
+	private function format_top_categories( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param int|null $last_ts Last order timestamp.
+	 * @return int|null
+	 */
+	private function calculate_days_since( $last_ts ) {
+		if ( null === $last_ts ) {
+			return null;
+		}
+
+		$now_ts  = $this->get_now_timestamp();
+		$diff    = max( 0, $now_ts - $last_ts );
+		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+
+		return (int) floor( $diff / $seconds );
+	}
+
+	/**
+	 * Simple 12-month projection based on orders per month and average order value.
+	 *
+	 * @param int      $total_orders Order count.
+	 * @param float    $average_order_value Average order value.
+	 * @param int|null $first_ts First order timestamp.
+	 * @return array
+	 */
+	private function calculate_ltv_projection( $total_orders, $average_order_value, $first_ts ) {
+		$orders_per_month = 0.0;
+		$days_since_first = 0;
+
+		if ( $total_orders > 0 && null !== $first_ts ) {
+			$now_ts  = $this->get_now_timestamp();
+			$diff    = max( 0, $now_ts - $first_ts );
+			$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+			$days_since_first = (int) max( 1, floor( $diff / $seconds ) );
+			$orders_per_month = $total_orders / ( $days_since_first / 30 );
+		}
+
+		$orders_per_month = round( $orders_per_month, 2 );
+		$projection_months = 12;
+		$estimated_ltv = $this->normalize_amount( $average_order_value * $orders_per_month * $projection_months );
+
+		return array(
+			'estimated_ltv' => $estimated_ltv,
+			'projection'    => array(
+				'projection_months'     => $projection_months,
+				'orders_per_month'      => $orders_per_month,
+				'days_since_first_order' => $days_since_first,
+			),
+		);
+	}
+
+	/**
+	 * @param int|null $days_since_last Order recency in days.
+	 * @param int      $total_orders Total orders.
+	 * @return string
+	 */
+	private function determine_health_status( $days_since_last, $total_orders ) {
+		if ( null === $days_since_last || 0 === $total_orders ) {
+			return 'churned';
+		}
+
+		$thresholds = $this->get_health_thresholds();
+
+		if ( $days_since_last <= $thresholds['active'] ) {
+			return 'active';
+		}
+
+		if ( $days_since_last <= $thresholds['at_risk'] ) {
+			return 'at_risk';
+		}
+
+		return 'churned';
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_health_thresholds() {
+		$thresholds = array(
+			'active'  => 60,
+			'at_risk' => 180,
+		);
+
+		if ( function_exists( 'apply_filters' ) ) {
+			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
+		}
+
+		$active  = isset( $thresholds['active'] ) ? absint( $thresholds['active'] ) : 60;
+		$at_risk = isset( $thresholds['at_risk'] ) ? absint( $thresholds['at_risk'] ) : 180;
+
+		if ( $active <= 0 ) {
+			$active = 60;
+		}
+
+		if ( $at_risk <= $active ) {
+			$at_risk = $active + 1;
+		}
+
+		return array(
+			'active'  => $active,
+			'at_risk' => $at_risk,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_paid_statuses() {
+		$statuses = function_exists( 'wc_get_is_paid_statuses' )
+			? wc_get_is_paid_statuses()
+			: array( 'processing', 'completed', 'on-hold' );
+
+		$statuses = array_filter( array_map( 'sanitize_text_field', (array) $statuses ) );
+		if ( empty( $statuses ) ) {
+			return array( 'processing', 'completed', 'on-hold' );
+		}
+
+		return array_values( array_unique( $statuses ) );
+	}
+
+	/**
+	 * @param mixed $amount Amount input.
+	 * @return float
+	 */
+	private function normalize_amount( $amount ) {
+		if ( function_exists( 'wc_format_decimal' ) ) {
+			return (float) wc_format_decimal( $amount, $this->get_price_decimals() );
+		}
+
+		return (float) $amount;
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_price_decimals() {
+		if ( function_exists( 'wc_get_price_decimals' ) ) {
+			return (int) wc_get_price_decimals();
+		}
+
+		return 2;
+	}
+
+	/**
+	 * @param float $value Currency amount.
+	 * @return string
+	 */
+	private function format_currency( $value ) {
+		$amount = $this->normalize_amount( $value );
+		if ( function_exists( 'wc_price' ) ) {
+			return wc_price( $amount );
+		}
+
+		return number_format( $amount, $this->get_price_decimals(), '.', '' );
+	}
+
+	/**
+	 * @param mixed $date Date instance.
+	 * @return string
+	 */
+	private function format_datetime( $date ) {
+		if ( ! $date || ! method_exists( $date, 'format' ) ) {
+			return '';
+		}
+
+		return $date->format( 'c' );
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_now_timestamp() {
+		if ( function_exists( 'current_time' ) ) {
+			return (int) current_time( 'timestamp' );
+		}
+
+		return time();
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
index 8d0c36e9b634b18599d5e317f273cafb58dea92a..26d0f5cb41bb2e7f8b15d552762449dc0f0c5959
--- a/src/Intent/Handlers/CustomerLookupHandler.php
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Intent\Handlers;
 
 use AgentWP\AI\Response;
+use AgentWP\Handlers\CustomerHandler;
 use AgentWP\Intent\Intent;
 
 class CustomerLookupHandler extends BaseHandler {
@@ -20,7 +21,78 @@
 	 * @return Response
 	 */
 	public function handle( array $context ): Response {
-		$message = 'I can look up customer profiles. Share an email or name.';
-		return $this->build_response( $context, $message );
+		$query = isset( $context['input'] ) ? (string) $context['input'] : '';
+		$query = trim( $query );
+
+		if ( '' === $query ) {
+			$message = 'I can look up customer profiles. Share an email or customer ID.';
+			return $this->build_response( $context, $message );
+		}
+
+		$email       = $this->extract_email( $query );
+		$customer_id = $this->extract_customer_id( $query );
+
+		if ( '' === $email && 0 === $customer_id ) {
+			$message = 'Share an email address or customer ID to look up their profile.';
+			return $this->build_response( $context, $message );
+		}
+
+		$customer = new CustomerHandler();
+		$result   = $customer->handle(
+			array(
+				'email'       => $email,
+				'customer_id' => $customer_id,
+			)
+		);
+
+		if ( ! $result->is_success() ) {
+			return $result;
+		}
+
+		$data         = $result->get_data();
+		$total_orders = isset( $data['total_orders'] ) ? intval( $data['total_orders'] ) : 0;
+		$message      = 0 === $total_orders
+			? 'I could not find any orders for that customer.'
+			: sprintf( 'Found %d order%s for that customer.', $total_orders, 1 === $total_orders ? '' : 's' );
+
+		return $this->build_response( $context, $message, $data );
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return string
+	 */
+	private function extract_email( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return '';
+		}
+
+		if ( preg_match( '/[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}/i', $query, $matches ) ) {
+			return sanitize_email( $matches[0] );
+		}
+
+		return '';
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return int
+	 */
+	private function extract_customer_id( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return 0;
+		}
+
+		if ( ctype_digit( $query ) ) {
+			return absint( $query );
+		}
+
+		if ( preg_match( '/\b(\d+)\b/', $query, $matches ) ) {
+			return absint( $matches[1] );
+		}
+
+		return 0;
 	}
 }


thinking
**Inspecting CustomerHandler spacing and syntax**
exec
/bin/zsh -lc "sed -n '1,240p' src/Handlers/CustomerHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 44ms:
<?php
/**
 * Handle customer profile requests.
 *
 * @package AgentWP
 */

namespace AgentWP\Handlers;

use AgentWP\AI\Response;

class CustomerHandler {
	const RECENT_LIMIT = 5;
	const TOP_LIMIT    = 5;
	const ORDER_BATCH  = 200;

	/**
	 * Handle a customer profile request.
	 *
	 * @param array $args Request arguments.
file update:
diff --git a/src/Handlers/CustomerHandler.php b/src/Handlers/CustomerHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e040c4e825ca046e730fbb88d834c2de063be608
--- /dev/null
+++ b/src/Handlers/CustomerHandler.php
@@ -0,0 +1,695 @@
+<?php
+/**
+ * Handle customer profile requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Handlers;
+
+use AgentWP\AI\Response;
+
+class CustomerHandler {
+	const RECENT_LIMIT = 5;
+	const TOP_LIMIT    = 5;
+	const ORDER_BATCH  = 200;
+
+	/**
+	 * Handle a customer profile request.
+	 *
+	 * @param array $args Request arguments.
+	 * @return Response
+	 */
+	public function handle( array $args ): Response {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return Response::error( 'WooCommerce is required to fetch customer profiles.', 400 );
+		}
+
+		$normalized = $this->normalize_args( $args );
+		if ( 0 === $normalized['customer_id'] && '' === $normalized['email'] ) {
+			return Response::error( 'Provide a customer ID or email address.', 400 );
+		}
+
+		$paid_statuses = $this->get_paid_statuses();
+		$order_ids     = $this->collect_order_ids( $normalized, $paid_statuses );
+		$metrics       = $this->build_metrics( $order_ids );
+		$recent_orders = $this->get_recent_orders( $normalized, $paid_statuses );
+
+		$payload = array_merge(
+			$metrics,
+			array(
+				'customer'          => $this->build_customer_summary( $normalized, $recent_orders ),
+				'health_thresholds' => $this->get_health_thresholds(),
+				'recent_orders'     => $recent_orders,
+			)
+		);
+
+		return Response::success( $payload );
+	}
+
+	/**
+	 * @param array $args Request args.
+	 * @return array
+	 */
+	private function normalize_args( array $args ) {
+		$email       = isset( $args['email'] ) ? sanitize_email( $args['email'] ) : '';
+		$customer_id = isset( $args['customer_id'] ) ? absint( $args['customer_id'] ) : 0;
+
+		if ( '' === $email && $customer_id > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $customer_id );
+			if ( $user && isset( $user->user_email ) ) {
+				$email = sanitize_email( $user->user_email );
+			}
+		}
+
+		return array(
+			'email'       => $email,
+			'customer_id' => $customer_id,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized request args.
+	 * @param array $statuses Paid statuses.
+	 * @return array
+	 */
+	private function collect_order_ids( array $normalized, array $statuses ) {
+		$order_ids = array();
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'customer' => $normalized['customer_id'],
+						'status'   => $statuses,
+					)
+				)
+			);
+		}
+
+		if ( '' !== $normalized['email'] && 0 === $normalized['customer_id'] ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'billing_email' => $normalized['email'],
+						'status'        => $statuses,
+					)
+				)
+			);
+		}
+
+		$order_ids = array_map( 'absint', $order_ids );
+		$order_ids = array_filter( array_unique( $order_ids ) );
+		sort( $order_ids );
+
+		return $order_ids;
+	}
+
+	/**
+	 * @param array $query_args Query arguments.
+	 * @return array
+	 */
+	private function query_order_ids( array $query_args ) {
+		$ids   = array();
+		$page  = 1;
+		$limit = self::ORDER_BATCH;
+
+		while ( true ) {
+			$args = array_merge(
+				$query_args,
+				array(
+					'limit'  => $limit,
+					'paged'  => $page,
+					'return' => 'ids',
+				)
+			);
+
+			$batch = wc_get_orders( $args );
+			if ( ! is_array( $batch ) || empty( $batch ) ) {
+				break;
+			}
+
+			$ids = array_merge( $ids, $batch );
+
+			if ( count( $batch ) < $limit ) {
+				break;
+			}
+
+			$page++;
+		}
+
+		return $ids;
+	}
+
+	/**
+	 * @param array $order_ids Order IDs to summarize.
+	 * @return array
+	 */
+	private function build_metrics( array $order_ids ) {
+		$total_orders = count( $order_ids );
+		$total_spent  = 0.0;
+		$first_ts     = null;
+		$last_ts      = null;
+		$first_date   = '';
+		$last_date    = '';
+
+		$product_totals  = array();
+		$category_totals = array();
+		$category_cache  = array();
+
+		foreach ( $order_ids as $order_id ) {
+			$order = function_exists( 'wc_get_order' ) ? wc_get_order( $order_id ) : null;
+			if ( ! $order || ! method_exists( $order, 'get_total' ) ) {
+				continue;
+			}
+
+			$total_spent += $this->normalize_amount( $order->get_total() );
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+			if ( $date_created ) {
+				$timestamp = $date_created->getTimestamp();
+				if ( null === $first_ts || $timestamp < $first_ts ) {
+					$first_ts   = $timestamp;
+					$first_date = $this->format_datetime( $date_created );
+				}
+
+				if ( null === $last_ts || $timestamp > $last_ts ) {
+					$last_ts   = $timestamp;
+					$last_date = $this->format_datetime( $date_created );
+				}
+			}
+
+			$this->accumulate_item_totals( $order, $product_totals, $category_totals, $category_cache );
+		}
+
+		$average_order_value = 0.0;
+		if ( $total_orders > 0 ) {
+			$average_order_value = $this->normalize_amount( $total_spent / $total_orders );
+		}
+
+		$days_since_last_order = $this->calculate_days_since( $last_ts );
+		$health_status         = $this->determine_health_status( $days_since_last_order, $total_orders );
+		$ltv_projection         = $this->calculate_ltv_projection( $total_orders, $average_order_value, $first_ts );
+
+		return array(
+			'total_orders'                  => $total_orders,
+			'total_spent'                   => $this->normalize_amount( $total_spent ),
+			'total_spent_formatted'         => $this->format_currency( $total_spent ),
+			'average_order_value'           => $average_order_value,
+			'average_order_value_formatted' => $this->format_currency( $average_order_value ),
+			'first_order_date'              => $first_date,
+			'last_order_date'               => $last_date,
+			'days_since_last_order'         => $days_since_last_order,
+			'favorite_products'             => $this->format_top_products( $product_totals ),
+			'favorite_categories'           => $this->format_top_categories( $category_totals ),
+			'estimated_ltv'                 => $ltv_projection['estimated_ltv'],
+			'estimated_ltv_formatted'       => $this->format_currency( $ltv_projection['estimated_ltv'] ),
+			'ltv_projection'                => $ltv_projection['projection'],
+			'health_status'                 => $health_status,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $recent_orders Recent order summaries.
+	 * @return array
+	 */
+	private function build_customer_summary( array $normalized, array $recent_orders ) {
+		$name  = '';
+		$email = $normalized['email'];
+
+		if ( $normalized['customer_id'] > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $normalized['customer_id'] );
+			if ( $user ) {
+				$first = isset( $user->first_name ) ? $user->first_name : '';
+				$last  = isset( $user->last_name ) ? $user->last_name : '';
+				$name  = trim( $first . ' ' . $last );
+				if ( '' === $name && isset( $user->display_name ) ) {
+					$name = (string) $user->display_name;
+				}
+				if ( '' === $email && isset( $user->user_email ) ) {
+					$email = sanitize_email( $user->user_email );
+				}
+			}
+		}
+
+		if ( '' === $name && ! empty( $recent_orders ) && isset( $recent_orders[0]['customer_name'] ) ) {
+			$name = sanitize_text_field( $recent_orders[0]['customer_name'] );
+		}
+
+		return array(
+			'customer_id' => $normalized['customer_id'],
+			'email'       => $email,
+			'name'        => $name,
+			'is_guest'    => 0 === $normalized['customer_id'],
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $statuses Status list.
+	 * @return array
+	 */
+	private function get_recent_orders( array $normalized, array $statuses ) {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$args = array(
+			'limit'   => self::RECENT_LIMIT,
+			'orderby' => 'date',
+			'order'   => 'DESC',
+			'status'  => $statuses,
+		);
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$args['customer'] = $normalized['customer_id'];
+		} elseif ( '' !== $normalized['email'] ) {
+			$args['billing_email'] = $normalized['email'];
+		}
+
+		$orders = wc_get_orders( $args );
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$recent = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$recent[] = $this->format_order_summary( $order );
+		}
+
+		return $recent;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_order_summary( $order ) {
+		$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+		$total        = method_exists( $order, 'get_total' ) ? $this->normalize_amount( $order->get_total() ) : 0.0;
+
+		return array(
+			'id'              => intval( $order->get_id() ),
+			'status'          => sanitize_text_field( $order->get_status() ),
+			'total'           => $total,
+			'total_formatted' => $this->format_currency( $total ),
+			'currency'        => sanitize_text_field( $order->get_currency() ),
+			'date_created'    => $this->format_datetime( $date_created ),
+			'customer_name'   => $this->get_customer_name( $order ),
+			'customer_email'  => $this->get_customer_email( $order ),
+			'items_summary'   => $this->format_items_summary( $order ),
+		);
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_name( $order ) {
+		$first = method_exists( $order, 'get_billing_first_name' ) ? $order->get_billing_first_name() : '';
+		$last  = method_exists( $order, 'get_billing_last_name' ) ? $order->get_billing_last_name() : '';
+		$name  = trim( $first . ' ' . $last );
+
+		if ( '' === $name && method_exists( $order, 'get_shipping_first_name' ) ) {
+			$first = $order->get_shipping_first_name();
+			$last  = method_exists( $order, 'get_shipping_last_name' ) ? $order->get_shipping_last_name() : '';
+			$name  = trim( $first . ' ' . $last );
+		}
+
+		return sanitize_text_field( $name );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_email( $order ) {
+		$email = method_exists( $order, 'get_billing_email' ) ? $order->get_billing_email() : '';
+		if ( '' === $email && method_exists( $order, 'get_meta' ) ) {
+			$email = $order->get_meta( '_shipping_email' );
+		}
+
+		return sanitize_email( $email );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_items_summary( $order ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return array();
+		}
+
+		$items = $order->get_items();
+		if ( ! is_array( $items ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_name' ) ) {
+				continue;
+			}
+
+			$name = sanitize_text_field( $item->get_name() );
+			$qty  = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+
+			if ( '' === $name ) {
+				continue;
+			}
+
+			$summary[] = array(
+				'name'     => $name,
+				'quantity' => $qty,
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @param array  $product_totals Product totals accumulator.
+	 * @param array  $category_totals Category totals accumulator.
+	 * @param array  $category_cache Category cache.
+	 * @return void
+	 */
+	private function accumulate_item_totals( $order, array &$product_totals, array &$category_totals, array &$category_cache ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return;
+		}
+
+		$items = $order->get_items( 'line_item' );
+		if ( ! is_array( $items ) ) {
+			return;
+		}
+
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_product_id' ) ) {
+				continue;
+			}
+
+			$product_id = absint( $item->get_product_id() );
+			if ( 0 === $product_id ) {
+				continue;
+			}
+
+			$quantity = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+			if ( $quantity < 1 ) {
+				continue;
+			}
+
+			if ( ! isset( $product_totals[ $product_id ] ) ) {
+				$product_totals[ $product_id ] = array(
+					'product_id' => $product_id,
+					'name'       => sanitize_text_field( $item->get_name() ),
+					'quantity'   => 0,
+				);
+			}
+
+			$product_totals[ $product_id ]['quantity'] += $quantity;
+
+			$categories = $this->get_product_categories( $product_id, $category_cache );
+			foreach ( $categories as $term_id => $name ) {
+				if ( ! isset( $category_totals[ $term_id ] ) ) {
+					$category_totals[ $term_id ] = array(
+						'category_id' => $term_id,
+						'name'        => $name,
+						'quantity'    => 0,
+					);
+				}
+
+				$category_totals[ $term_id ]['quantity'] += $quantity;
+			}
+		}
+	}
+
+	/**
+	 * @param int   $product_id Product ID.
+	 * @param array $cache Category cache.
+	 * @return array
+	 */
+	private function get_product_categories( $product_id, array &$cache ) {
+		$product_id = absint( $product_id );
+		if ( 0 === $product_id ) {
+			return array();
+		}
+
+		if ( isset( $cache[ $product_id ] ) ) {
+			return $cache[ $product_id ];
+		}
+
+		$categories = array();
+		if ( function_exists( 'wc_get_product_terms' ) ) {
+			$terms = wc_get_product_terms( $product_id, 'product_cat', array( 'fields' => 'all' ) );
+			if ( is_array( $terms ) ) {
+				foreach ( $terms as $term ) {
+					if ( ! is_object( $term ) || ! isset( $term->term_id ) ) {
+						continue;
+					}
+					$categories[ (int) $term->term_id ] = sanitize_text_field( $term->name );
+				}
+			}
+		}
+
+		$cache[ $product_id ] = $categories;
+
+		return $categories;
+	}
+
+	/**
+	 * @param array $totals Product totals.
+	 * @return array
+	 */
+	private function format_top_products( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param array $totals Category totals.
+	 * @return array
+	 */
+	private function format_top_categories( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param int|null $last_ts Last order timestamp.
+	 * @return int|null
+	 */
+	private function calculate_days_since( $last_ts ) {
+		if ( null === $last_ts ) {
+			return null;
+		}
+
+		$now_ts  = $this->get_now_timestamp();
+		$diff    = max( 0, $now_ts - $last_ts );
+		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+
+		return (int) floor( $diff / $seconds );
+	}
+
+	/**
+	 * Simple 12-month projection based on orders per month and average order value.
+	 *
+	 * @param int      $total_orders Order count.
+	 * @param float    $average_order_value Average order value.
+	 * @param int|null $first_ts First order timestamp.
+	 * @return array
+	 */
+	private function calculate_ltv_projection( $total_orders, $average_order_value, $first_ts ) {
+		$orders_per_month = 0.0;
+		$days_since_first = 0;
+
+		if ( $total_orders > 0 && null !== $first_ts ) {
+			$now_ts  = $this->get_now_timestamp();
+			$diff    = max( 0, $now_ts - $first_ts );
+			$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+			$days_since_first = (int) max( 1, floor( $diff / $seconds ) );
+			$orders_per_month = $total_orders / ( $days_since_first / 30 );
+		}
+
+		$orders_per_month = round( $orders_per_month, 2 );
+		$projection_months = 12;
+		$estimated_ltv = $this->normalize_amount( $average_order_value * $orders_per_month * $projection_months );
+
+		return array(
+			'estimated_ltv' => $estimated_ltv,
+			'projection'    => array(
+				'projection_months'     => $projection_months,
+				'orders_per_month'      => $orders_per_month,
+				'days_since_first_order' => $days_since_first,
+			),
+		);
+	}
+
+	/**
+	 * @param int|null $days_since_last Order recency in days.
+	 * @param int      $total_orders Total orders.
+	 * @return string
+	 */
+	private function determine_health_status( $days_since_last, $total_orders ) {
+		if ( null === $days_since_last || 0 === $total_orders ) {
+			return 'churned';
+		}
+
+		$thresholds = $this->get_health_thresholds();
+
+		if ( $days_since_last <= $thresholds['active'] ) {
+			return 'active';
+		}
+
+		if ( $days_since_last <= $thresholds['at_risk'] ) {
+			return 'at_risk';
+		}
+
+		return 'churned';
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_health_thresholds() {
+		$thresholds = array(
+			'active'  => 60,
+			'at_risk' => 180,
+		);
+
+		if ( function_exists( 'apply_filters' ) ) {
+			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
+		}
+
+		$active  = isset( $thresholds['active'] ) ? absint( $thresholds['active'] ) : 60;
+		$at_risk = isset( $thresholds['at_risk'] ) ? absint( $thresholds['at_risk'] ) : 180;
+
+		if ( $active <= 0 ) {
+			$active = 60;
+		}
+
+		if ( $at_risk <= $active ) {
+			$at_risk = $active + 1;
+		}
+
+		return array(
+			'active'  => $active,
+			'at_risk' => $at_risk,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_paid_statuses() {
+		$statuses = function_exists( 'wc_get_is_paid_statuses' )
+			? wc_get_is_paid_statuses()
+			: array( 'processing', 'completed', 'on-hold' );
+
+		$statuses = array_filter( array_map( 'sanitize_text_field', (array) $statuses ) );
+		if ( empty( $statuses ) ) {
+			return array( 'processing', 'completed', 'on-hold' );
+		}
+
+		return array_values( array_unique( $statuses ) );
+	}
+
+	/**
+	 * @param mixed $amount Amount input.
+	 * @return float
+	 */
+	private function normalize_amount( $amount ) {
+		if ( function_exists( 'wc_format_decimal' ) ) {
+			return (float) wc_format_decimal( $amount, $this->get_price_decimals() );
+		}
+
+		return (float) $amount;
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_price_decimals() {
+		if ( function_exists( 'wc_get_price_decimals' ) ) {
+			return (int) wc_get_price_decimals();
+		}
+
+		return 2;
+	}
+
+	/**
+	 * @param float $value Currency amount.
+	 * @return string
+	 */
+	private function format_currency( $value ) {
+		$amount = $this->normalize_amount( $value );
+		if ( function_exists( 'wc_price' ) ) {
+			return wc_price( $amount );
+		}
+
+		return number_format( $amount, $this->get_price_decimals(), '.', '' );
+	}
+
+	/**
+	 * @param mixed $date Date instance.
+	 * @return string
+	 */
+	private function format_datetime( $date ) {
+		if ( ! $date || ! method_exists( $date, 'format' ) ) {
+			return '';
+		}
+
+		return $date->format( 'c' );
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_now_timestamp() {
+		if ( function_exists( 'current_time' ) ) {
+			return (int) current_time( 'timestamp' );
+		}
+
+		return time();
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
index 8d0c36e9b634b18599d5e317f273cafb58dea92a..26d0f5cb41bb2e7f8b15d552762449dc0f0c5959
--- a/src/Intent/Handlers/CustomerLookupHandler.php
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Intent\Handlers;
 
 use AgentWP\AI\Response;
+use AgentWP\Handlers\CustomerHandler;
 use AgentWP\Intent\Intent;
 
 class CustomerLookupHandler extends BaseHandler {
@@ -20,7 +21,78 @@
 	 * @return Response
 	 */
 	public function handle( array $context ): Response {
-		$message = 'I can look up customer profiles. Share an email or name.';
-		return $this->build_response( $context, $message );
+		$query = isset( $context['input'] ) ? (string) $context['input'] : '';
+		$query = trim( $query );
+
+		if ( '' === $query ) {
+			$message = 'I can look up customer profiles. Share an email or customer ID.';
+			return $this->build_response( $context, $message );
+		}
+
+		$email       = $this->extract_email( $query );
+		$customer_id = $this->extract_customer_id( $query );
+
+		if ( '' === $email && 0 === $customer_id ) {
+			$message = 'Share an email address or customer ID to look up their profile.';
+			return $this->build_response( $context, $message );
+		}
+
+		$customer = new CustomerHandler();
+		$result   = $customer->handle(
+			array(
+				'email'       => $email,
+				'customer_id' => $customer_id,
+			)
+		);
+
+		if ( ! $result->is_success() ) {
+			return $result;
+		}
+
+		$data         = $result->get_data();
+		$total_orders = isset( $data['total_orders'] ) ? intval( $data['total_orders'] ) : 0;
+		$message      = 0 === $total_orders
+			? 'I could not find any orders for that customer.'
+			: sprintf( 'Found %d order%s for that customer.', $total_orders, 1 === $total_orders ? '' : 's' );
+
+		return $this->build_response( $context, $message, $data );
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return string
+	 */
+	private function extract_email( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return '';
+		}
+
+		if ( preg_match( '/[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}/i', $query, $matches ) ) {
+			return sanitize_email( $matches[0] );
+		}
+
+		return '';
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return int
+	 */
+	private function extract_customer_id( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return 0;
+		}
+
+		if ( ctype_digit( $query ) ) {
+			return absint( $query );
+		}
+
+		if ( preg_match( '/\b(\d+)\b/', $query, $matches ) ) {
+			return absint( $matches[1] );
+		}
+
+		return 0;
 	}
 }


thinking
**Checking spacing and trailing spaces**
exec
/bin/zsh -lc "sed -n '240,520p' src/Handlers/CustomerHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 54ms:
		}

		return array(
			'customer_id' => $normalized['customer_id'],
			'email'       => $email,
			'name'        => $name,
			'is_guest'    => 0 === $normalized['customer_id'],
		);
	}

	/**
	 * @param array $normalized Normalized args.
	 * @param array $statuses Status list.
	 * @return array
	 */
	private function get_recent_orders( array $normalized, array $statuses ) {
		if ( ! function_exists( 'wc_get_orders' ) ) {
			return array();
		}

file update:
diff --git a/src/Handlers/CustomerHandler.php b/src/Handlers/CustomerHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e040c4e825ca046e730fbb88d834c2de063be608
--- /dev/null
+++ b/src/Handlers/CustomerHandler.php
@@ -0,0 +1,695 @@
+<?php
+/**
+ * Handle customer profile requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Handlers;
+
+use AgentWP\AI\Response;
+
+class CustomerHandler {
+	const RECENT_LIMIT = 5;
+	const TOP_LIMIT    = 5;
+	const ORDER_BATCH  = 200;
+
+	/**
+	 * Handle a customer profile request.
+	 *
+	 * @param array $args Request arguments.
+	 * @return Response
+	 */
+	public function handle( array $args ): Response {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return Response::error( 'WooCommerce is required to fetch customer profiles.', 400 );
+		}
+
+		$normalized = $this->normalize_args( $args );
+		if ( 0 === $normalized['customer_id'] && '' === $normalized['email'] ) {
+			return Response::error( 'Provide a customer ID or email address.', 400 );
+		}
+
+		$paid_statuses = $this->get_paid_statuses();
+		$order_ids     = $this->collect_order_ids( $normalized, $paid_statuses );
+		$metrics       = $this->build_metrics( $order_ids );
+		$recent_orders = $this->get_recent_orders( $normalized, $paid_statuses );
+
+		$payload = array_merge(
+			$metrics,
+			array(
+				'customer'          => $this->build_customer_summary( $normalized, $recent_orders ),
+				'health_thresholds' => $this->get_health_thresholds(),
+				'recent_orders'     => $recent_orders,
+			)
+		);
+
+		return Response::success( $payload );
+	}
+
+	/**
+	 * @param array $args Request args.
+	 * @return array
+	 */
+	private function normalize_args( array $args ) {
+		$email       = isset( $args['email'] ) ? sanitize_email( $args['email'] ) : '';
+		$customer_id = isset( $args['customer_id'] ) ? absint( $args['customer_id'] ) : 0;
+
+		if ( '' === $email && $customer_id > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $customer_id );
+			if ( $user && isset( $user->user_email ) ) {
+				$email = sanitize_email( $user->user_email );
+			}
+		}
+
+		return array(
+			'email'       => $email,
+			'customer_id' => $customer_id,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized request args.
+	 * @param array $statuses Paid statuses.
+	 * @return array
+	 */
+	private function collect_order_ids( array $normalized, array $statuses ) {
+		$order_ids = array();
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'customer' => $normalized['customer_id'],
+						'status'   => $statuses,
+					)
+				)
+			);
+		}
+
+		if ( '' !== $normalized['email'] && 0 === $normalized['customer_id'] ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'billing_email' => $normalized['email'],
+						'status'        => $statuses,
+					)
+				)
+			);
+		}
+
+		$order_ids = array_map( 'absint', $order_ids );
+		$order_ids = array_filter( array_unique( $order_ids ) );
+		sort( $order_ids );
+
+		return $order_ids;
+	}
+
+	/**
+	 * @param array $query_args Query arguments.
+	 * @return array
+	 */
+	private function query_order_ids( array $query_args ) {
+		$ids   = array();
+		$page  = 1;
+		$limit = self::ORDER_BATCH;
+
+		while ( true ) {
+			$args = array_merge(
+				$query_args,
+				array(
+					'limit'  => $limit,
+					'paged'  => $page,
+					'return' => 'ids',
+				)
+			);
+
+			$batch = wc_get_orders( $args );
+			if ( ! is_array( $batch ) || empty( $batch ) ) {
+				break;
+			}
+
+			$ids = array_merge( $ids, $batch );
+
+			if ( count( $batch ) < $limit ) {
+				break;
+			}
+
+			$page++;
+		}
+
+		return $ids;
+	}
+
+	/**
+	 * @param array $order_ids Order IDs to summarize.
+	 * @return array
+	 */
+	private function build_metrics( array $order_ids ) {
+		$total_orders = count( $order_ids );
+		$total_spent  = 0.0;
+		$first_ts     = null;
+		$last_ts      = null;
+		$first_date   = '';
+		$last_date    = '';
+
+		$product_totals  = array();
+		$category_totals = array();
+		$category_cache  = array();
+
+		foreach ( $order_ids as $order_id ) {
+			$order = function_exists( 'wc_get_order' ) ? wc_get_order( $order_id ) : null;
+			if ( ! $order || ! method_exists( $order, 'get_total' ) ) {
+				continue;
+			}
+
+			$total_spent += $this->normalize_amount( $order->get_total() );
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+			if ( $date_created ) {
+				$timestamp = $date_created->getTimestamp();
+				if ( null === $first_ts || $timestamp < $first_ts ) {
+					$first_ts   = $timestamp;
+					$first_date = $this->format_datetime( $date_created );
+				}
+
+				if ( null === $last_ts || $timestamp > $last_ts ) {
+					$last_ts   = $timestamp;
+					$last_date = $this->format_datetime( $date_created );
+				}
+			}
+
+			$this->accumulate_item_totals( $order, $product_totals, $category_totals, $category_cache );
+		}
+
+		$average_order_value = 0.0;
+		if ( $total_orders > 0 ) {
+			$average_order_value = $this->normalize_amount( $total_spent / $total_orders );
+		}
+
+		$days_since_last_order = $this->calculate_days_since( $last_ts );
+		$health_status         = $this->determine_health_status( $days_since_last_order, $total_orders );
+		$ltv_projection         = $this->calculate_ltv_projection( $total_orders, $average_order_value, $first_ts );
+
+		return array(
+			'total_orders'                  => $total_orders,
+			'total_spent'                   => $this->normalize_amount( $total_spent ),
+			'total_spent_formatted'         => $this->format_currency( $total_spent ),
+			'average_order_value'           => $average_order_value,
+			'average_order_value_formatted' => $this->format_currency( $average_order_value ),
+			'first_order_date'              => $first_date,
+			'last_order_date'               => $last_date,
+			'days_since_last_order'         => $days_since_last_order,
+			'favorite_products'             => $this->format_top_products( $product_totals ),
+			'favorite_categories'           => $this->format_top_categories( $category_totals ),
+			'estimated_ltv'                 => $ltv_projection['estimated_ltv'],
+			'estimated_ltv_formatted'       => $this->format_currency( $ltv_projection['estimated_ltv'] ),
+			'ltv_projection'                => $ltv_projection['projection'],
+			'health_status'                 => $health_status,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $recent_orders Recent order summaries.
+	 * @return array
+	 */
+	private function build_customer_summary( array $normalized, array $recent_orders ) {
+		$name  = '';
+		$email = $normalized['email'];
+
+		if ( $normalized['customer_id'] > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $normalized['customer_id'] );
+			if ( $user ) {
+				$first = isset( $user->first_name ) ? $user->first_name : '';
+				$last  = isset( $user->last_name ) ? $user->last_name : '';
+				$name  = trim( $first . ' ' . $last );
+				if ( '' === $name && isset( $user->display_name ) ) {
+					$name = (string) $user->display_name;
+				}
+				if ( '' === $email && isset( $user->user_email ) ) {
+					$email = sanitize_email( $user->user_email );
+				}
+			}
+		}
+
+		if ( '' === $name && ! empty( $recent_orders ) && isset( $recent_orders[0]['customer_name'] ) ) {
+			$name = sanitize_text_field( $recent_orders[0]['customer_name'] );
+		}
+
+		return array(
+			'customer_id' => $normalized['customer_id'],
+			'email'       => $email,
+			'name'        => $name,
+			'is_guest'    => 0 === $normalized['customer_id'],
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $statuses Status list.
+	 * @return array
+	 */
+	private function get_recent_orders( array $normalized, array $statuses ) {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$args = array(
+			'limit'   => self::RECENT_LIMIT,
+			'orderby' => 'date',
+			'order'   => 'DESC',
+			'status'  => $statuses,
+		);
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$args['customer'] = $normalized['customer_id'];
+		} elseif ( '' !== $normalized['email'] ) {
+			$args['billing_email'] = $normalized['email'];
+		}
+
+		$orders = wc_get_orders( $args );
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$recent = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$recent[] = $this->format_order_summary( $order );
+		}
+
+		return $recent;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_order_summary( $order ) {
+		$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+		$total        = method_exists( $order, 'get_total' ) ? $this->normalize_amount( $order->get_total() ) : 0.0;
+
+		return array(
+			'id'              => intval( $order->get_id() ),
+			'status'          => sanitize_text_field( $order->get_status() ),
+			'total'           => $total,
+			'total_formatted' => $this->format_currency( $total ),
+			'currency'        => sanitize_text_field( $order->get_currency() ),
+			'date_created'    => $this->format_datetime( $date_created ),
+			'customer_name'   => $this->get_customer_name( $order ),
+			'customer_email'  => $this->get_customer_email( $order ),
+			'items_summary'   => $this->format_items_summary( $order ),
+		);
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_name( $order ) {
+		$first = method_exists( $order, 'get_billing_first_name' ) ? $order->get_billing_first_name() : '';
+		$last  = method_exists( $order, 'get_billing_last_name' ) ? $order->get_billing_last_name() : '';
+		$name  = trim( $first . ' ' . $last );
+
+		if ( '' === $name && method_exists( $order, 'get_shipping_first_name' ) ) {
+			$first = $order->get_shipping_first_name();
+			$last  = method_exists( $order, 'get_shipping_last_name' ) ? $order->get_shipping_last_name() : '';
+			$name  = trim( $first . ' ' . $last );
+		}
+
+		return sanitize_text_field( $name );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_email( $order ) {
+		$email = method_exists( $order, 'get_billing_email' ) ? $order->get_billing_email() : '';
+		if ( '' === $email && method_exists( $order, 'get_meta' ) ) {
+			$email = $order->get_meta( '_shipping_email' );
+		}
+
+		return sanitize_email( $email );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_items_summary( $order ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return array();
+		}
+
+		$items = $order->get_items();
+		if ( ! is_array( $items ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_name' ) ) {
+				continue;
+			}
+
+			$name = sanitize_text_field( $item->get_name() );
+			$qty  = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+
+			if ( '' === $name ) {
+				continue;
+			}
+
+			$summary[] = array(
+				'name'     => $name,
+				'quantity' => $qty,
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @param array  $product_totals Product totals accumulator.
+	 * @param array  $category_totals Category totals accumulator.
+	 * @param array  $category_cache Category cache.
+	 * @return void
+	 */
+	private function accumulate_item_totals( $order, array &$product_totals, array &$category_totals, array &$category_cache ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return;
+		}
+
+		$items = $order->get_items( 'line_item' );
+		if ( ! is_array( $items ) ) {
+			return;
+		}
+
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_product_id' ) ) {
+				continue;
+			}
+
+			$product_id = absint( $item->get_product_id() );
+			if ( 0 === $product_id ) {
+				continue;
+			}
+
+			$quantity = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+			if ( $quantity < 1 ) {
+				continue;
+			}
+
+			if ( ! isset( $product_totals[ $product_id ] ) ) {
+				$product_totals[ $product_id ] = array(
+					'product_id' => $product_id,
+					'name'       => sanitize_text_field( $item->get_name() ),
+					'quantity'   => 0,
+				);
+			}
+
+			$product_totals[ $product_id ]['quantity'] += $quantity;
+
+			$categories = $this->get_product_categories( $product_id, $category_cache );
+			foreach ( $categories as $term_id => $name ) {
+				if ( ! isset( $category_totals[ $term_id ] ) ) {
+					$category_totals[ $term_id ] = array(
+						'category_id' => $term_id,
+						'name'        => $name,
+						'quantity'    => 0,
+					);
+				}
+
+				$category_totals[ $term_id ]['quantity'] += $quantity;
+			}
+		}
+	}
+
+	/**
+	 * @param int   $product_id Product ID.
+	 * @param array $cache Category cache.
+	 * @return array
+	 */
+	private function get_product_categories( $product_id, array &$cache ) {
+		$product_id = absint( $product_id );
+		if ( 0 === $product_id ) {
+			return array();
+		}
+
+		if ( isset( $cache[ $product_id ] ) ) {
+			return $cache[ $product_id ];
+		}
+
+		$categories = array();
+		if ( function_exists( 'wc_get_product_terms' ) ) {
+			$terms = wc_get_product_terms( $product_id, 'product_cat', array( 'fields' => 'all' ) );
+			if ( is_array( $terms ) ) {
+				foreach ( $terms as $term ) {
+					if ( ! is_object( $term ) || ! isset( $term->term_id ) ) {
+						continue;
+					}
+					$categories[ (int) $term->term_id ] = sanitize_text_field( $term->name );
+				}
+			}
+		}
+
+		$cache[ $product_id ] = $categories;
+
+		return $categories;
+	}
+
+	/**
+	 * @param array $totals Product totals.
+	 * @return array
+	 */
+	private function format_top_products( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param array $totals Category totals.
+	 * @return array
+	 */
+	private function format_top_categories( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param int|null $last_ts Last order timestamp.
+	 * @return int|null
+	 */
+	private function calculate_days_since( $last_ts ) {
+		if ( null === $last_ts ) {
+			return null;
+		}
+
+		$now_ts  = $this->get_now_timestamp();
+		$diff    = max( 0, $now_ts - $last_ts );
+		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+
+		return (int) floor( $diff / $seconds );
+	}
+
+	/**
+	 * Simple 12-month projection based on orders per month and average order value.
+	 *
+	 * @param int      $total_orders Order count.
+	 * @param float    $average_order_value Average order value.
+	 * @param int|null $first_ts First order timestamp.
+	 * @return array
+	 */
+	private function calculate_ltv_projection( $total_orders, $average_order_value, $first_ts ) {
+		$orders_per_month = 0.0;
+		$days_since_first = 0;
+
+		if ( $total_orders > 0 && null !== $first_ts ) {
+			$now_ts  = $this->get_now_timestamp();
+			$diff    = max( 0, $now_ts - $first_ts );
+			$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+			$days_since_first = (int) max( 1, floor( $diff / $seconds ) );
+			$orders_per_month = $total_orders / ( $days_since_first / 30 );
+		}
+
+		$orders_per_month = round( $orders_per_month, 2 );
+		$projection_months = 12;
+		$estimated_ltv = $this->normalize_amount( $average_order_value * $orders_per_month * $projection_months );
+
+		return array(
+			'estimated_ltv' => $estimated_ltv,
+			'projection'    => array(
+				'projection_months'     => $projection_months,
+				'orders_per_month'      => $orders_per_month,
+				'days_since_first_order' => $days_since_first,
+			),
+		);
+	}
+
+	/**
+	 * @param int|null $days_since_last Order recency in days.
+	 * @param int      $total_orders Total orders.
+	 * @return string
+	 */
+	private function determine_health_status( $days_since_last, $total_orders ) {
+		if ( null === $days_since_last || 0 === $total_orders ) {
+			return 'churned';
+		}
+
+		$thresholds = $this->get_health_thresholds();
+
+		if ( $days_since_last <= $thresholds['active'] ) {
+			return 'active';
+		}
+
+		if ( $days_since_last <= $thresholds['at_risk'] ) {
+			return 'at_risk';
+		}
+
+		return 'churned';
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_health_thresholds() {
+		$thresholds = array(
+			'active'  => 60,
+			'at_risk' => 180,
+		);
+
+		if ( function_exists( 'apply_filters' ) ) {
+			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
+		}
+
+		$active  = isset( $thresholds['active'] ) ? absint( $thresholds['active'] ) : 60;
+		$at_risk = isset( $thresholds['at_risk'] ) ? absint( $thresholds['at_risk'] ) : 180;
+
+		if ( $active <= 0 ) {
+			$active = 60;
+		}
+
+		if ( $at_risk <= $active ) {
+			$at_risk = $active + 1;
+		}
+
+		return array(
+			'active'  => $active,
+			'at_risk' => $at_risk,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_paid_statuses() {
+		$statuses = function_exists( 'wc_get_is_paid_statuses' )
+			? wc_get_is_paid_statuses()
+			: array( 'processing', 'completed', 'on-hold' );
+
+		$statuses = array_filter( array_map( 'sanitize_text_field', (array) $statuses ) );
+		if ( empty( $statuses ) ) {
+			return array( 'processing', 'completed', 'on-hold' );
+		}
+
+		return array_values( array_unique( $statuses ) );
+	}
+
+	/**
+	 * @param mixed $amount Amount input.
+	 * @return float
+	 */
+	private function normalize_amount( $amount ) {
+		if ( function_exists( 'wc_format_decimal' ) ) {
+			return (float) wc_format_decimal( $amount, $this->get_price_decimals() );
+		}
+
+		return (float) $amount;
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_price_decimals() {
+		if ( function_exists( 'wc_get_price_decimals' ) ) {
+			return (int) wc_get_price_decimals();
+		}
+
+		return 2;
+	}
+
+	/**
+	 * @param float $value Currency amount.
+	 * @return string
+	 */
+	private function format_currency( $value ) {
+		$amount = $this->normalize_amount( $value );
+		if ( function_exists( 'wc_price' ) ) {
+			return wc_price( $amount );
+		}
+
+		return number_format( $amount, $this->get_price_decimals(), '.', '' );
+	}
+
+	/**
+	 * @param mixed $date Date instance.
+	 * @return string
+	 */
+	private function format_datetime( $date ) {
+		if ( ! $date || ! method_exists( $date, 'format' ) ) {
+			return '';
+		}
+
+		return $date->format( 'c' );
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_now_timestamp() {
+		if ( function_exists( 'current_time' ) ) {
+			return (int) current_time( 'timestamp' );
+		}
+
+		return time();
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
index 8d0c36e9b634b18599d5e317f273cafb58dea92a..26d0f5cb41bb2e7f8b15d552762449dc0f0c5959
--- a/src/Intent/Handlers/CustomerLookupHandler.php
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Intent\Handlers;
 
 use AgentWP\AI\Response;
+use AgentWP\Handlers\CustomerHandler;
 use AgentWP\Intent\Intent;
 
 class CustomerLookupHandler extends BaseHandler {
@@ -20,7 +21,78 @@
 	 * @return Response
 	 */
 	public function handle( array $context ): Response {
-		$message = 'I can look up customer profiles. Share an email or name.';
-		return $this->build_response( $context, $message );
+		$query = isset( $context['input'] ) ? (string) $context['input'] : '';
+		$query = trim( $query );
+
+		if ( '' === $query ) {
+			$message = 'I can look up customer profiles. Share an email or customer ID.';
+			return $this->build_response( $context, $message );
+		}
+
+		$email       = $this->extract_email( $query );
+		$customer_id = $this->extract_customer_id( $query );
+
+		if ( '' === $email && 0 === $customer_id ) {
+			$message = 'Share an email address or customer ID to look up their profile.';
+			return $this->build_response( $context, $message );
+		}
+
+		$customer = new CustomerHandler();
+		$result   = $customer->handle(
+			array(
+				'email'       => $email,
+				'customer_id' => $customer_id,
+			)
+		);
+
+		if ( ! $result->is_success() ) {
+			return $result;
+		}
+
+		$data         = $result->get_data();
+		$total_orders = isset( $data['total_orders'] ) ? intval( $data['total_orders'] ) : 0;
+		$message      = 0 === $total_orders
+			? 'I could not find any orders for that customer.'
+			: sprintf( 'Found %d order%s for that customer.', $total_orders, 1 === $total_orders ? '' : 's' );
+
+		return $this->build_response( $context, $message, $data );
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return string
+	 */
+	private function extract_email( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return '';
+		}
+
+		if ( preg_match( '/[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}/i', $query, $matches ) ) {
+			return sanitize_email( $matches[0] );
+		}
+
+		return '';
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return int
+	 */
+	private function extract_customer_id( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return 0;
+		}
+
+		if ( ctype_digit( $query ) ) {
+			return absint( $query );
+		}
+
+		if ( preg_match( '/\b(\d+)\b/', $query, $matches ) ) {
+			return absint( $matches[1] );
+		}
+
+		return 0;
 	}
 }


thinking
**Continuing process**
exec
/bin/zsh -lc "sed -n '520,880p' src/Handlers/CustomerHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 43ms:
	 * @return int|null
	 */
	private function calculate_days_since( $last_ts ) {
		if ( null === $last_ts ) {
			return null;
		}

		$now_ts  = $this->get_now_timestamp();
		$diff    = max( 0, $now_ts - $last_ts );
		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;

		return (int) floor( $diff / $seconds );
	}

	/**
	 * Simple 12-month projection based on orders per month and average order value.
	 *
	 * @param int      $total_orders Order count.
	 * @param float    $average_order_value Average order value.
	 * @param int|null $first_ts First order timestamp.
file update:
diff --git a/src/Handlers/CustomerHandler.php b/src/Handlers/CustomerHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e040c4e825ca046e730fbb88d834c2de063be608
--- /dev/null
+++ b/src/Handlers/CustomerHandler.php
@@ -0,0 +1,695 @@
+<?php
+/**
+ * Handle customer profile requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Handlers;
+
+use AgentWP\AI\Response;
+
+class CustomerHandler {
+	const RECENT_LIMIT = 5;
+	const TOP_LIMIT    = 5;
+	const ORDER_BATCH  = 200;
+
+	/**
+	 * Handle a customer profile request.
+	 *
+	 * @param array $args Request arguments.
+	 * @return Response
+	 */
+	public function handle( array $args ): Response {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return Response::error( 'WooCommerce is required to fetch customer profiles.', 400 );
+		}
+
+		$normalized = $this->normalize_args( $args );
+		if ( 0 === $normalized['customer_id'] && '' === $normalized['email'] ) {
+			return Response::error( 'Provide a customer ID or email address.', 400 );
+		}
+
+		$paid_statuses = $this->get_paid_statuses();
+		$order_ids     = $this->collect_order_ids( $normalized, $paid_statuses );
+		$metrics       = $this->build_metrics( $order_ids );
+		$recent_orders = $this->get_recent_orders( $normalized, $paid_statuses );
+
+		$payload = array_merge(
+			$metrics,
+			array(
+				'customer'          => $this->build_customer_summary( $normalized, $recent_orders ),
+				'health_thresholds' => $this->get_health_thresholds(),
+				'recent_orders'     => $recent_orders,
+			)
+		);
+
+		return Response::success( $payload );
+	}
+
+	/**
+	 * @param array $args Request args.
+	 * @return array
+	 */
+	private function normalize_args( array $args ) {
+		$email       = isset( $args['email'] ) ? sanitize_email( $args['email'] ) : '';
+		$customer_id = isset( $args['customer_id'] ) ? absint( $args['customer_id'] ) : 0;
+
+		if ( '' === $email && $customer_id > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $customer_id );
+			if ( $user && isset( $user->user_email ) ) {
+				$email = sanitize_email( $user->user_email );
+			}
+		}
+
+		return array(
+			'email'       => $email,
+			'customer_id' => $customer_id,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized request args.
+	 * @param array $statuses Paid statuses.
+	 * @return array
+	 */
+	private function collect_order_ids( array $normalized, array $statuses ) {
+		$order_ids = array();
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'customer' => $normalized['customer_id'],
+						'status'   => $statuses,
+					)
+				)
+			);
+		}
+
+		if ( '' !== $normalized['email'] && 0 === $normalized['customer_id'] ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'billing_email' => $normalized['email'],
+						'status'        => $statuses,
+					)
+				)
+			);
+		}
+
+		$order_ids = array_map( 'absint', $order_ids );
+		$order_ids = array_filter( array_unique( $order_ids ) );
+		sort( $order_ids );
+
+		return $order_ids;
+	}
+
+	/**
+	 * @param array $query_args Query arguments.
+	 * @return array
+	 */
+	private function query_order_ids( array $query_args ) {
+		$ids   = array();
+		$page  = 1;
+		$limit = self::ORDER_BATCH;
+
+		while ( true ) {
+			$args = array_merge(
+				$query_args,
+				array(
+					'limit'  => $limit,
+					'paged'  => $page,
+					'return' => 'ids',
+				)
+			);
+
+			$batch = wc_get_orders( $args );
+			if ( ! is_array( $batch ) || empty( $batch ) ) {
+				break;
+			}
+
+			$ids = array_merge( $ids, $batch );
+
+			if ( count( $batch ) < $limit ) {
+				break;
+			}
+
+			$page++;
+		}
+
+		return $ids;
+	}
+
+	/**
+	 * @param array $order_ids Order IDs to summarize.
+	 * @return array
+	 */
+	private function build_metrics( array $order_ids ) {
+		$total_orders = count( $order_ids );
+		$total_spent  = 0.0;
+		$first_ts     = null;
+		$last_ts      = null;
+		$first_date   = '';
+		$last_date    = '';
+
+		$product_totals  = array();
+		$category_totals = array();
+		$category_cache  = array();
+
+		foreach ( $order_ids as $order_id ) {
+			$order = function_exists( 'wc_get_order' ) ? wc_get_order( $order_id ) : null;
+			if ( ! $order || ! method_exists( $order, 'get_total' ) ) {
+				continue;
+			}
+
+			$total_spent += $this->normalize_amount( $order->get_total() );
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+			if ( $date_created ) {
+				$timestamp = $date_created->getTimestamp();
+				if ( null === $first_ts || $timestamp < $first_ts ) {
+					$first_ts   = $timestamp;
+					$first_date = $this->format_datetime( $date_created );
+				}
+
+				if ( null === $last_ts || $timestamp > $last_ts ) {
+					$last_ts   = $timestamp;
+					$last_date = $this->format_datetime( $date_created );
+				}
+			}
+
+			$this->accumulate_item_totals( $order, $product_totals, $category_totals, $category_cache );
+		}
+
+		$average_order_value = 0.0;
+		if ( $total_orders > 0 ) {
+			$average_order_value = $this->normalize_amount( $total_spent / $total_orders );
+		}
+
+		$days_since_last_order = $this->calculate_days_since( $last_ts );
+		$health_status         = $this->determine_health_status( $days_since_last_order, $total_orders );
+		$ltv_projection         = $this->calculate_ltv_projection( $total_orders, $average_order_value, $first_ts );
+
+		return array(
+			'total_orders'                  => $total_orders,
+			'total_spent'                   => $this->normalize_amount( $total_spent ),
+			'total_spent_formatted'         => $this->format_currency( $total_spent ),
+			'average_order_value'           => $average_order_value,
+			'average_order_value_formatted' => $this->format_currency( $average_order_value ),
+			'first_order_date'              => $first_date,
+			'last_order_date'               => $last_date,
+			'days_since_last_order'         => $days_since_last_order,
+			'favorite_products'             => $this->format_top_products( $product_totals ),
+			'favorite_categories'           => $this->format_top_categories( $category_totals ),
+			'estimated_ltv'                 => $ltv_projection['estimated_ltv'],
+			'estimated_ltv_formatted'       => $this->format_currency( $ltv_projection['estimated_ltv'] ),
+			'ltv_projection'                => $ltv_projection['projection'],
+			'health_status'                 => $health_status,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $recent_orders Recent order summaries.
+	 * @return array
+	 */
+	private function build_customer_summary( array $normalized, array $recent_orders ) {
+		$name  = '';
+		$email = $normalized['email'];
+
+		if ( $normalized['customer_id'] > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $normalized['customer_id'] );
+			if ( $user ) {
+				$first = isset( $user->first_name ) ? $user->first_name : '';
+				$last  = isset( $user->last_name ) ? $user->last_name : '';
+				$name  = trim( $first . ' ' . $last );
+				if ( '' === $name && isset( $user->display_name ) ) {
+					$name = (string) $user->display_name;
+				}
+				if ( '' === $email && isset( $user->user_email ) ) {
+					$email = sanitize_email( $user->user_email );
+				}
+			}
+		}
+
+		if ( '' === $name && ! empty( $recent_orders ) && isset( $recent_orders[0]['customer_name'] ) ) {
+			$name = sanitize_text_field( $recent_orders[0]['customer_name'] );
+		}
+
+		return array(
+			'customer_id' => $normalized['customer_id'],
+			'email'       => $email,
+			'name'        => $name,
+			'is_guest'    => 0 === $normalized['customer_id'],
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $statuses Status list.
+	 * @return array
+	 */
+	private function get_recent_orders( array $normalized, array $statuses ) {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$args = array(
+			'limit'   => self::RECENT_LIMIT,
+			'orderby' => 'date',
+			'order'   => 'DESC',
+			'status'  => $statuses,
+		);
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$args['customer'] = $normalized['customer_id'];
+		} elseif ( '' !== $normalized['email'] ) {
+			$args['billing_email'] = $normalized['email'];
+		}
+
+		$orders = wc_get_orders( $args );
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$recent = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$recent[] = $this->format_order_summary( $order );
+		}
+
+		return $recent;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_order_summary( $order ) {
+		$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+		$total        = method_exists( $order, 'get_total' ) ? $this->normalize_amount( $order->get_total() ) : 0.0;
+
+		return array(
+			'id'              => intval( $order->get_id() ),
+			'status'          => sanitize_text_field( $order->get_status() ),
+			'total'           => $total,
+			'total_formatted' => $this->format_currency( $total ),
+			'currency'        => sanitize_text_field( $order->get_currency() ),
+			'date_created'    => $this->format_datetime( $date_created ),
+			'customer_name'   => $this->get_customer_name( $order ),
+			'customer_email'  => $this->get_customer_email( $order ),
+			'items_summary'   => $this->format_items_summary( $order ),
+		);
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_name( $order ) {
+		$first = method_exists( $order, 'get_billing_first_name' ) ? $order->get_billing_first_name() : '';
+		$last  = method_exists( $order, 'get_billing_last_name' ) ? $order->get_billing_last_name() : '';
+		$name  = trim( $first . ' ' . $last );
+
+		if ( '' === $name && method_exists( $order, 'get_shipping_first_name' ) ) {
+			$first = $order->get_shipping_first_name();
+			$last  = method_exists( $order, 'get_shipping_last_name' ) ? $order->get_shipping_last_name() : '';
+			$name  = trim( $first . ' ' . $last );
+		}
+
+		return sanitize_text_field( $name );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_email( $order ) {
+		$email = method_exists( $order, 'get_billing_email' ) ? $order->get_billing_email() : '';
+		if ( '' === $email && method_exists( $order, 'get_meta' ) ) {
+			$email = $order->get_meta( '_shipping_email' );
+		}
+
+		return sanitize_email( $email );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_items_summary( $order ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return array();
+		}
+
+		$items = $order->get_items();
+		if ( ! is_array( $items ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_name' ) ) {
+				continue;
+			}
+
+			$name = sanitize_text_field( $item->get_name() );
+			$qty  = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+
+			if ( '' === $name ) {
+				continue;
+			}
+
+			$summary[] = array(
+				'name'     => $name,
+				'quantity' => $qty,
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @param array  $product_totals Product totals accumulator.
+	 * @param array  $category_totals Category totals accumulator.
+	 * @param array  $category_cache Category cache.
+	 * @return void
+	 */
+	private function accumulate_item_totals( $order, array &$product_totals, array &$category_totals, array &$category_cache ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return;
+		}
+
+		$items = $order->get_items( 'line_item' );
+		if ( ! is_array( $items ) ) {
+			return;
+		}
+
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_product_id' ) ) {
+				continue;
+			}
+
+			$product_id = absint( $item->get_product_id() );
+			if ( 0 === $product_id ) {
+				continue;
+			}
+
+			$quantity = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+			if ( $quantity < 1 ) {
+				continue;
+			}
+
+			if ( ! isset( $product_totals[ $product_id ] ) ) {
+				$product_totals[ $product_id ] = array(
+					'product_id' => $product_id,
+					'name'       => sanitize_text_field( $item->get_name() ),
+					'quantity'   => 0,
+				);
+			}
+
+			$product_totals[ $product_id ]['quantity'] += $quantity;
+
+			$categories = $this->get_product_categories( $product_id, $category_cache );
+			foreach ( $categories as $term_id => $name ) {
+				if ( ! isset( $category_totals[ $term_id ] ) ) {
+					$category_totals[ $term_id ] = array(
+						'category_id' => $term_id,
+						'name'        => $name,
+						'quantity'    => 0,
+					);
+				}
+
+				$category_totals[ $term_id ]['quantity'] += $quantity;
+			}
+		}
+	}
+
+	/**
+	 * @param int   $product_id Product ID.
+	 * @param array $cache Category cache.
+	 * @return array
+	 */
+	private function get_product_categories( $product_id, array &$cache ) {
+		$product_id = absint( $product_id );
+		if ( 0 === $product_id ) {
+			return array();
+		}
+
+		if ( isset( $cache[ $product_id ] ) ) {
+			return $cache[ $product_id ];
+		}
+
+		$categories = array();
+		if ( function_exists( 'wc_get_product_terms' ) ) {
+			$terms = wc_get_product_terms( $product_id, 'product_cat', array( 'fields' => 'all' ) );
+			if ( is_array( $terms ) ) {
+				foreach ( $terms as $term ) {
+					if ( ! is_object( $term ) || ! isset( $term->term_id ) ) {
+						continue;
+					}
+					$categories[ (int) $term->term_id ] = sanitize_text_field( $term->name );
+				}
+			}
+		}
+
+		$cache[ $product_id ] = $categories;
+
+		return $categories;
+	}
+
+	/**
+	 * @param array $totals Product totals.
+	 * @return array
+	 */
+	private function format_top_products( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param array $totals Category totals.
+	 * @return array
+	 */
+	private function format_top_categories( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param int|null $last_ts Last order timestamp.
+	 * @return int|null
+	 */
+	private function calculate_days_since( $last_ts ) {
+		if ( null === $last_ts ) {
+			return null;
+		}
+
+		$now_ts  = $this->get_now_timestamp();
+		$diff    = max( 0, $now_ts - $last_ts );
+		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+
+		return (int) floor( $diff / $seconds );
+	}
+
+	/**
+	 * Simple 12-month projection based on orders per month and average order value.
+	 *
+	 * @param int      $total_orders Order count.
+	 * @param float    $average_order_value Average order value.
+	 * @param int|null $first_ts First order timestamp.
+	 * @return array
+	 */
+	private function calculate_ltv_projection( $total_orders, $average_order_value, $first_ts ) {
+		$orders_per_month = 0.0;
+		$days_since_first = 0;
+
+		if ( $total_orders > 0 && null !== $first_ts ) {
+			$now_ts  = $this->get_now_timestamp();
+			$diff    = max( 0, $now_ts - $first_ts );
+			$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+			$days_since_first = (int) max( 1, floor( $diff / $seconds ) );
+			$orders_per_month = $total_orders / ( $days_since_first / 30 );
+		}
+
+		$orders_per_month = round( $orders_per_month, 2 );
+		$projection_months = 12;
+		$estimated_ltv = $this->normalize_amount( $average_order_value * $orders_per_month * $projection_months );
+
+		return array(
+			'estimated_ltv' => $estimated_ltv,
+			'projection'    => array(
+				'projection_months'     => $projection_months,
+				'orders_per_month'      => $orders_per_month,
+				'days_since_first_order' => $days_since_first,
+			),
+		);
+	}
+
+	/**
+	 * @param int|null $days_since_last Order recency in days.
+	 * @param int      $total_orders Total orders.
+	 * @return string
+	 */
+	private function determine_health_status( $days_since_last, $total_orders ) {
+		if ( null === $days_since_last || 0 === $total_orders ) {
+			return 'churned';
+		}
+
+		$thresholds = $this->get_health_thresholds();
+
+		if ( $days_since_last <= $thresholds['active'] ) {
+			return 'active';
+		}
+
+		if ( $days_since_last <= $thresholds['at_risk'] ) {
+			return 'at_risk';
+		}
+
+		return 'churned';
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_health_thresholds() {
+		$thresholds = array(
+			'active'  => 60,
+			'at_risk' => 180,
+		);
+
+		if ( function_exists( 'apply_filters' ) ) {
+			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
+		}
+
+		$active  = isset( $thresholds['active'] ) ? absint( $thresholds['active'] ) : 60;
+		$at_risk = isset( $thresholds['at_risk'] ) ? absint( $thresholds['at_risk'] ) : 180;
+
+		if ( $active <= 0 ) {
+			$active = 60;
+		}
+
+		if ( $at_risk <= $active ) {
+			$at_risk = $active + 1;
+		}
+
+		return array(
+			'active'  => $active,
+			'at_risk' => $at_risk,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_paid_statuses() {
+		$statuses = function_exists( 'wc_get_is_paid_statuses' )
+			? wc_get_is_paid_statuses()
+			: array( 'processing', 'completed', 'on-hold' );
+
+		$statuses = array_filter( array_map( 'sanitize_text_field', (array) $statuses ) );
+		if ( empty( $statuses ) ) {
+			return array( 'processing', 'completed', 'on-hold' );
+		}
+
+		return array_values( array_unique( $statuses ) );
+	}
+
+	/**
+	 * @param mixed $amount Amount input.
+	 * @return float
+	 */
+	private function normalize_amount( $amount ) {
+		if ( function_exists( 'wc_format_decimal' ) ) {
+			return (float) wc_format_decimal( $amount, $this->get_price_decimals() );
+		}
+
+		return (float) $amount;
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_price_decimals() {
+		if ( function_exists( 'wc_get_price_decimals' ) ) {
+			return (int) wc_get_price_decimals();
+		}
+
+		return 2;
+	}
+
+	/**
+	 * @param float $value Currency amount.
+	 * @return string
+	 */
+	private function format_currency( $value ) {
+		$amount = $this->normalize_amount( $value );
+		if ( function_exists( 'wc_price' ) ) {
+			return wc_price( $amount );
+		}
+
+		return number_format( $amount, $this->get_price_decimals(), '.', '' );
+	}
+
+	/**
+	 * @param mixed $date Date instance.
+	 * @return string
+	 */
+	private function format_datetime( $date ) {
+		if ( ! $date || ! method_exists( $date, 'format' ) ) {
+			return '';
+		}
+
+		return $date->format( 'c' );
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_now_timestamp() {
+		if ( function_exists( 'current_time' ) ) {
+			return (int) current_time( 'timestamp' );
+		}
+
+		return time();
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
index 8d0c36e9b634b18599d5e317f273cafb58dea92a..26d0f5cb41bb2e7f8b15d552762449dc0f0c5959
--- a/src/Intent/Handlers/CustomerLookupHandler.php
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Intent\Handlers;
 
 use AgentWP\AI\Response;
+use AgentWP\Handlers\CustomerHandler;
 use AgentWP\Intent\Intent;
 
 class CustomerLookupHandler extends BaseHandler {
@@ -20,7 +21,78 @@
 	 * @return Response
 	 */
 	public function handle( array $context ): Response {
-		$message = 'I can look up customer profiles. Share an email or name.';
-		return $this->build_response( $context, $message );
+		$query = isset( $context['input'] ) ? (string) $context['input'] : '';
+		$query = trim( $query );
+
+		if ( '' === $query ) {
+			$message = 'I can look up customer profiles. Share an email or customer ID.';
+			return $this->build_response( $context, $message );
+		}
+
+		$email       = $this->extract_email( $query );
+		$customer_id = $this->extract_customer_id( $query );
+
+		if ( '' === $email && 0 === $customer_id ) {
+			$message = 'Share an email address or customer ID to look up their profile.';
+			return $this->build_response( $context, $message );
+		}
+
+		$customer = new CustomerHandler();
+		$result   = $customer->handle(
+			array(
+				'email'       => $email,
+				'customer_id' => $customer_id,
+			)
+		);
+
+		if ( ! $result->is_success() ) {
+			return $result;
+		}
+
+		$data         = $result->get_data();
+		$total_orders = isset( $data['total_orders'] ) ? intval( $data['total_orders'] ) : 0;
+		$message      = 0 === $total_orders
+			? 'I could not find any orders for that customer.'
+			: sprintf( 'Found %d order%s for that customer.', $total_orders, 1 === $total_orders ? '' : 's' );
+
+		return $this->build_response( $context, $message, $data );
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return string
+	 */
+	private function extract_email( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return '';
+		}
+
+		if ( preg_match( '/[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}/i', $query, $matches ) ) {
+			return sanitize_email( $matches[0] );
+		}
+
+		return '';
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return int
+	 */
+	private function extract_customer_id( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return 0;
+		}
+
+		if ( ctype_digit( $query ) ) {
+			return absint( $query );
+		}
+
+		if ( preg_match( '/\b(\d+)\b/', $query, $matches ) ) {
+			return absint( $matches[1] );
+		}
+
+		return 0;
 	}
 }


thinking
**Analyzing customer ID and email parsing**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Handlers/CustomerLookupHandler.php
@@ -33,2 +33,5 @@
 		$customer_id = $this->extract_customer_id( $query );
+		if ( '' !== $email && ! ctype_digit( $query ) ) {
+			$customer_id = 0;
+		}
 
apply_patch(auto_approved=true) exited 0 in 75ms:
Success. Updated the following files:
M src/Intent/Handlers/CustomerLookupHandler.php
file update:
diff --git a/src/Handlers/CustomerHandler.php b/src/Handlers/CustomerHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e040c4e825ca046e730fbb88d834c2de063be608
--- /dev/null
+++ b/src/Handlers/CustomerHandler.php
@@ -0,0 +1,695 @@
+<?php
+/**
+ * Handle customer profile requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Handlers;
+
+use AgentWP\AI\Response;
+
+class CustomerHandler {
+	const RECENT_LIMIT = 5;
+	const TOP_LIMIT    = 5;
+	const ORDER_BATCH  = 200;
+
+	/**
+	 * Handle a customer profile request.
+	 *
+	 * @param array $args Request arguments.
+	 * @return Response
+	 */
+	public function handle( array $args ): Response {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return Response::error( 'WooCommerce is required to fetch customer profiles.', 400 );
+		}
+
+		$normalized = $this->normalize_args( $args );
+		if ( 0 === $normalized['customer_id'] && '' === $normalized['email'] ) {
+			return Response::error( 'Provide a customer ID or email address.', 400 );
+		}
+
+		$paid_statuses = $this->get_paid_statuses();
+		$order_ids     = $this->collect_order_ids( $normalized, $paid_statuses );
+		$metrics       = $this->build_metrics( $order_ids );
+		$recent_orders = $this->get_recent_orders( $normalized, $paid_statuses );
+
+		$payload = array_merge(
+			$metrics,
+			array(
+				'customer'          => $this->build_customer_summary( $normalized, $recent_orders ),
+				'health_thresholds' => $this->get_health_thresholds(),
+				'recent_orders'     => $recent_orders,
+			)
+		);
+
+		return Response::success( $payload );
+	}
+
+	/**
+	 * @param array $args Request args.
+	 * @return array
+	 */
+	private function normalize_args( array $args ) {
+		$email       = isset( $args['email'] ) ? sanitize_email( $args['email'] ) : '';
+		$customer_id = isset( $args['customer_id'] ) ? absint( $args['customer_id'] ) : 0;
+
+		if ( '' === $email && $customer_id > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $customer_id );
+			if ( $user && isset( $user->user_email ) ) {
+				$email = sanitize_email( $user->user_email );
+			}
+		}
+
+		return array(
+			'email'       => $email,
+			'customer_id' => $customer_id,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized request args.
+	 * @param array $statuses Paid statuses.
+	 * @return array
+	 */
+	private function collect_order_ids( array $normalized, array $statuses ) {
+		$order_ids = array();
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'customer' => $normalized['customer_id'],
+						'status'   => $statuses,
+					)
+				)
+			);
+		}
+
+		if ( '' !== $normalized['email'] && 0 === $normalized['customer_id'] ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'billing_email' => $normalized['email'],
+						'status'        => $statuses,
+					)
+				)
+			);
+		}
+
+		$order_ids = array_map( 'absint', $order_ids );
+		$order_ids = array_filter( array_unique( $order_ids ) );
+		sort( $order_ids );
+
+		return $order_ids;
+	}
+
+	/**
+	 * @param array $query_args Query arguments.
+	 * @return array
+	 */
+	private function query_order_ids( array $query_args ) {
+		$ids   = array();
+		$page  = 1;
+		$limit = self::ORDER_BATCH;
+
+		while ( true ) {
+			$args = array_merge(
+				$query_args,
+				array(
+					'limit'  => $limit,
+					'paged'  => $page,
+					'return' => 'ids',
+				)
+			);
+
+			$batch = wc_get_orders( $args );
+			if ( ! is_array( $batch ) || empty( $batch ) ) {
+				break;
+			}
+
+			$ids = array_merge( $ids, $batch );
+
+			if ( count( $batch ) < $limit ) {
+				break;
+			}
+
+			$page++;
+		}
+
+		return $ids;
+	}
+
+	/**
+	 * @param array $order_ids Order IDs to summarize.
+	 * @return array
+	 */
+	private function build_metrics( array $order_ids ) {
+		$total_orders = count( $order_ids );
+		$total_spent  = 0.0;
+		$first_ts     = null;
+		$last_ts      = null;
+		$first_date   = '';
+		$last_date    = '';
+
+		$product_totals  = array();
+		$category_totals = array();
+		$category_cache  = array();
+
+		foreach ( $order_ids as $order_id ) {
+			$order = function_exists( 'wc_get_order' ) ? wc_get_order( $order_id ) : null;
+			if ( ! $order || ! method_exists( $order, 'get_total' ) ) {
+				continue;
+			}
+
+			$total_spent += $this->normalize_amount( $order->get_total() );
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+			if ( $date_created ) {
+				$timestamp = $date_created->getTimestamp();
+				if ( null === $first_ts || $timestamp < $first_ts ) {
+					$first_ts   = $timestamp;
+					$first_date = $this->format_datetime( $date_created );
+				}
+
+				if ( null === $last_ts || $timestamp > $last_ts ) {
+					$last_ts   = $timestamp;
+					$last_date = $this->format_datetime( $date_created );
+				}
+			}
+
+			$this->accumulate_item_totals( $order, $product_totals, $category_totals, $category_cache );
+		}
+
+		$average_order_value = 0.0;
+		if ( $total_orders > 0 ) {
+			$average_order_value = $this->normalize_amount( $total_spent / $total_orders );
+		}
+
+		$days_since_last_order = $this->calculate_days_since( $last_ts );
+		$health_status         = $this->determine_health_status( $days_since_last_order, $total_orders );
+		$ltv_projection         = $this->calculate_ltv_projection( $total_orders, $average_order_value, $first_ts );
+
+		return array(
+			'total_orders'                  => $total_orders,
+			'total_spent'                   => $this->normalize_amount( $total_spent ),
+			'total_spent_formatted'         => $this->format_currency( $total_spent ),
+			'average_order_value'           => $average_order_value,
+			'average_order_value_formatted' => $this->format_currency( $average_order_value ),
+			'first_order_date'              => $first_date,
+			'last_order_date'               => $last_date,
+			'days_since_last_order'         => $days_since_last_order,
+			'favorite_products'             => $this->format_top_products( $product_totals ),
+			'favorite_categories'           => $this->format_top_categories( $category_totals ),
+			'estimated_ltv'                 => $ltv_projection['estimated_ltv'],
+			'estimated_ltv_formatted'       => $this->format_currency( $ltv_projection['estimated_ltv'] ),
+			'ltv_projection'                => $ltv_projection['projection'],
+			'health_status'                 => $health_status,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $recent_orders Recent order summaries.
+	 * @return array
+	 */
+	private function build_customer_summary( array $normalized, array $recent_orders ) {
+		$name  = '';
+		$email = $normalized['email'];
+
+		if ( $normalized['customer_id'] > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $normalized['customer_id'] );
+			if ( $user ) {
+				$first = isset( $user->first_name ) ? $user->first_name : '';
+				$last  = isset( $user->last_name ) ? $user->last_name : '';
+				$name  = trim( $first . ' ' . $last );
+				if ( '' === $name && isset( $user->display_name ) ) {
+					$name = (string) $user->display_name;
+				}
+				if ( '' === $email && isset( $user->user_email ) ) {
+					$email = sanitize_email( $user->user_email );
+				}
+			}
+		}
+
+		if ( '' === $name && ! empty( $recent_orders ) && isset( $recent_orders[0]['customer_name'] ) ) {
+			$name = sanitize_text_field( $recent_orders[0]['customer_name'] );
+		}
+
+		return array(
+			'customer_id' => $normalized['customer_id'],
+			'email'       => $email,
+			'name'        => $name,
+			'is_guest'    => 0 === $normalized['customer_id'],
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $statuses Status list.
+	 * @return array
+	 */
+	private function get_recent_orders( array $normalized, array $statuses ) {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$args = array(
+			'limit'   => self::RECENT_LIMIT,
+			'orderby' => 'date',
+			'order'   => 'DESC',
+			'status'  => $statuses,
+		);
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$args['customer'] = $normalized['customer_id'];
+		} elseif ( '' !== $normalized['email'] ) {
+			$args['billing_email'] = $normalized['email'];
+		}
+
+		$orders = wc_get_orders( $args );
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$recent = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$recent[] = $this->format_order_summary( $order );
+		}
+
+		return $recent;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_order_summary( $order ) {
+		$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+		$total        = method_exists( $order, 'get_total' ) ? $this->normalize_amount( $order->get_total() ) : 0.0;
+
+		return array(
+			'id'              => intval( $order->get_id() ),
+			'status'          => sanitize_text_field( $order->get_status() ),
+			'total'           => $total,
+			'total_formatted' => $this->format_currency( $total ),
+			'currency'        => sanitize_text_field( $order->get_currency() ),
+			'date_created'    => $this->format_datetime( $date_created ),
+			'customer_name'   => $this->get_customer_name( $order ),
+			'customer_email'  => $this->get_customer_email( $order ),
+			'items_summary'   => $this->format_items_summary( $order ),
+		);
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_name( $order ) {
+		$first = method_exists( $order, 'get_billing_first_name' ) ? $order->get_billing_first_name() : '';
+		$last  = method_exists( $order, 'get_billing_last_name' ) ? $order->get_billing_last_name() : '';
+		$name  = trim( $first . ' ' . $last );
+
+		if ( '' === $name && method_exists( $order, 'get_shipping_first_name' ) ) {
+			$first = $order->get_shipping_first_name();
+			$last  = method_exists( $order, 'get_shipping_last_name' ) ? $order->get_shipping_last_name() : '';
+			$name  = trim( $first . ' ' . $last );
+		}
+
+		return sanitize_text_field( $name );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_email( $order ) {
+		$email = method_exists( $order, 'get_billing_email' ) ? $order->get_billing_email() : '';
+		if ( '' === $email && method_exists( $order, 'get_meta' ) ) {
+			$email = $order->get_meta( '_shipping_email' );
+		}
+
+		return sanitize_email( $email );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_items_summary( $order ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return array();
+		}
+
+		$items = $order->get_items();
+		if ( ! is_array( $items ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_name' ) ) {
+				continue;
+			}
+
+			$name = sanitize_text_field( $item->get_name() );
+			$qty  = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+
+			if ( '' === $name ) {
+				continue;
+			}
+
+			$summary[] = array(
+				'name'     => $name,
+				'quantity' => $qty,
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @param array  $product_totals Product totals accumulator.
+	 * @param array  $category_totals Category totals accumulator.
+	 * @param array  $category_cache Category cache.
+	 * @return void
+	 */
+	private function accumulate_item_totals( $order, array &$product_totals, array &$category_totals, array &$category_cache ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return;
+		}
+
+		$items = $order->get_items( 'line_item' );
+		if ( ! is_array( $items ) ) {
+			return;
+		}
+
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_product_id' ) ) {
+				continue;
+			}
+
+			$product_id = absint( $item->get_product_id() );
+			if ( 0 === $product_id ) {
+				continue;
+			}
+
+			$quantity = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+			if ( $quantity < 1 ) {
+				continue;
+			}
+
+			if ( ! isset( $product_totals[ $product_id ] ) ) {
+				$product_totals[ $product_id ] = array(
+					'product_id' => $product_id,
+					'name'       => sanitize_text_field( $item->get_name() ),
+					'quantity'   => 0,
+				);
+			}
+
+			$product_totals[ $product_id ]['quantity'] += $quantity;
+
+			$categories = $this->get_product_categories( $product_id, $category_cache );
+			foreach ( $categories as $term_id => $name ) {
+				if ( ! isset( $category_totals[ $term_id ] ) ) {
+					$category_totals[ $term_id ] = array(
+						'category_id' => $term_id,
+						'name'        => $name,
+						'quantity'    => 0,
+					);
+				}
+
+				$category_totals[ $term_id ]['quantity'] += $quantity;
+			}
+		}
+	}
+
+	/**
+	 * @param int   $product_id Product ID.
+	 * @param array $cache Category cache.
+	 * @return array
+	 */
+	private function get_product_categories( $product_id, array &$cache ) {
+		$product_id = absint( $product_id );
+		if ( 0 === $product_id ) {
+			return array();
+		}
+
+		if ( isset( $cache[ $product_id ] ) ) {
+			return $cache[ $product_id ];
+		}
+
+		$categories = array();
+		if ( function_exists( 'wc_get_product_terms' ) ) {
+			$terms = wc_get_product_terms( $product_id, 'product_cat', array( 'fields' => 'all' ) );
+			if ( is_array( $terms ) ) {
+				foreach ( $terms as $term ) {
+					if ( ! is_object( $term ) || ! isset( $term->term_id ) ) {
+						continue;
+					}
+					$categories[ (int) $term->term_id ] = sanitize_text_field( $term->name );
+				}
+			}
+		}
+
+		$cache[ $product_id ] = $categories;
+
+		return $categories;
+	}
+
+	/**
+	 * @param array $totals Product totals.
+	 * @return array
+	 */
+	private function format_top_products( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param array $totals Category totals.
+	 * @return array
+	 */
+	private function format_top_categories( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param int|null $last_ts Last order timestamp.
+	 * @return int|null
+	 */
+	private function calculate_days_since( $last_ts ) {
+		if ( null === $last_ts ) {
+			return null;
+		}
+
+		$now_ts  = $this->get_now_timestamp();
+		$diff    = max( 0, $now_ts - $last_ts );
+		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+
+		return (int) floor( $diff / $seconds );
+	}
+
+	/**
+	 * Simple 12-month projection based on orders per month and average order value.
+	 *
+	 * @param int      $total_orders Order count.
+	 * @param float    $average_order_value Average order value.
+	 * @param int|null $first_ts First order timestamp.
+	 * @return array
+	 */
+	private function calculate_ltv_projection( $total_orders, $average_order_value, $first_ts ) {
+		$orders_per_month = 0.0;
+		$days_since_first = 0;
+
+		if ( $total_orders > 0 && null !== $first_ts ) {
+			$now_ts  = $this->get_now_timestamp();
+			$diff    = max( 0, $now_ts - $first_ts );
+			$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+			$days_since_first = (int) max( 1, floor( $diff / $seconds ) );
+			$orders_per_month = $total_orders / ( $days_since_first / 30 );
+		}
+
+		$orders_per_month = round( $orders_per_month, 2 );
+		$projection_months = 12;
+		$estimated_ltv = $this->normalize_amount( $average_order_value * $orders_per_month * $projection_months );
+
+		return array(
+			'estimated_ltv' => $estimated_ltv,
+			'projection'    => array(
+				'projection_months'     => $projection_months,
+				'orders_per_month'      => $orders_per_month,
+				'days_since_first_order' => $days_since_first,
+			),
+		);
+	}
+
+	/**
+	 * @param int|null $days_since_last Order recency in days.
+	 * @param int      $total_orders Total orders.
+	 * @return string
+	 */
+	private function determine_health_status( $days_since_last, $total_orders ) {
+		if ( null === $days_since_last || 0 === $total_orders ) {
+			return 'churned';
+		}
+
+		$thresholds = $this->get_health_thresholds();
+
+		if ( $days_since_last <= $thresholds['active'] ) {
+			return 'active';
+		}
+
+		if ( $days_since_last <= $thresholds['at_risk'] ) {
+			return 'at_risk';
+		}
+
+		return 'churned';
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_health_thresholds() {
+		$thresholds = array(
+			'active'  => 60,
+			'at_risk' => 180,
+		);
+
+		if ( function_exists( 'apply_filters' ) ) {
+			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
+		}
+
+		$active  = isset( $thresholds['active'] ) ? absint( $thresholds['active'] ) : 60;
+		$at_risk = isset( $thresholds['at_risk'] ) ? absint( $thresholds['at_risk'] ) : 180;
+
+		if ( $active <= 0 ) {
+			$active = 60;
+		}
+
+		if ( $at_risk <= $active ) {
+			$at_risk = $active + 1;
+		}
+
+		return array(
+			'active'  => $active,
+			'at_risk' => $at_risk,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_paid_statuses() {
+		$statuses = function_exists( 'wc_get_is_paid_statuses' )
+			? wc_get_is_paid_statuses()
+			: array( 'processing', 'completed', 'on-hold' );
+
+		$statuses = array_filter( array_map( 'sanitize_text_field', (array) $statuses ) );
+		if ( empty( $statuses ) ) {
+			return array( 'processing', 'completed', 'on-hold' );
+		}
+
+		return array_values( array_unique( $statuses ) );
+	}
+
+	/**
+	 * @param mixed $amount Amount input.
+	 * @return float
+	 */
+	private function normalize_amount( $amount ) {
+		if ( function_exists( 'wc_format_decimal' ) ) {
+			return (float) wc_format_decimal( $amount, $this->get_price_decimals() );
+		}
+
+		return (float) $amount;
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_price_decimals() {
+		if ( function_exists( 'wc_get_price_decimals' ) ) {
+			return (int) wc_get_price_decimals();
+		}
+
+		return 2;
+	}
+
+	/**
+	 * @param float $value Currency amount.
+	 * @return string
+	 */
+	private function format_currency( $value ) {
+		$amount = $this->normalize_amount( $value );
+		if ( function_exists( 'wc_price' ) ) {
+			return wc_price( $amount );
+		}
+
+		return number_format( $amount, $this->get_price_decimals(), '.', '' );
+	}
+
+	/**
+	 * @param mixed $date Date instance.
+	 * @return string
+	 */
+	private function format_datetime( $date ) {
+		if ( ! $date || ! method_exists( $date, 'format' ) ) {
+			return '';
+		}
+
+		return $date->format( 'c' );
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_now_timestamp() {
+		if ( function_exists( 'current_time' ) ) {
+			return (int) current_time( 'timestamp' );
+		}
+
+		return time();
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
index 8d0c36e9b634b18599d5e317f273cafb58dea92a..6147e223ae90a48f8a6042ca9e6285131b15174c
--- a/src/Intent/Handlers/CustomerLookupHandler.php
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Intent\Handlers;
 
 use AgentWP\AI\Response;
+use AgentWP\Handlers\CustomerHandler;
 use AgentWP\Intent\Intent;
 
 class CustomerLookupHandler extends BaseHandler {
@@ -20,7 +21,81 @@
 	 * @return Response
 	 */
 	public function handle( array $context ): Response {
-		$message = 'I can look up customer profiles. Share an email or name.';
-		return $this->build_response( $context, $message );
+		$query = isset( $context['input'] ) ? (string) $context['input'] : '';
+		$query = trim( $query );
+
+		if ( '' === $query ) {
+			$message = 'I can look up customer profiles. Share an email or customer ID.';
+			return $this->build_response( $context, $message );
+		}
+
+		$email       = $this->extract_email( $query );
+		$customer_id = $this->extract_customer_id( $query );
+		if ( '' !== $email && ! ctype_digit( $query ) ) {
+			$customer_id = 0;
+		}
+
+		if ( '' === $email && 0 === $customer_id ) {
+			$message = 'Share an email address or customer ID to look up their profile.';
+			return $this->build_response( $context, $message );
+		}
+
+		$customer = new CustomerHandler();
+		$result   = $customer->handle(
+			array(
+				'email'       => $email,
+				'customer_id' => $customer_id,
+			)
+		);
+
+		if ( ! $result->is_success() ) {
+			return $result;
+		}
+
+		$data         = $result->get_data();
+		$total_orders = isset( $data['total_orders'] ) ? intval( $data['total_orders'] ) : 0;
+		$message      = 0 === $total_orders
+			? 'I could not find any orders for that customer.'
+			: sprintf( 'Found %d order%s for that customer.', $total_orders, 1 === $total_orders ? '' : 's' );
+
+		return $this->build_response( $context, $message, $data );
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return string
+	 */
+	private function extract_email( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return '';
+		}
+
+		if ( preg_match( '/[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}/i', $query, $matches ) ) {
+			return sanitize_email( $matches[0] );
+		}
+
+		return '';
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return int
+	 */
+	private function extract_customer_id( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return 0;
+		}
+
+		if ( ctype_digit( $query ) ) {
+			return absint( $query );
+		}
+
+		if ( preg_match( '/\b(\d+)\b/', $query, $matches ) ) {
+			return absint( $matches[1] );
+		}
+
+		return 0;
 	}
 }

file update:
diff --git a/src/Handlers/CustomerHandler.php b/src/Handlers/CustomerHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..e040c4e825ca046e730fbb88d834c2de063be608
--- /dev/null
+++ b/src/Handlers/CustomerHandler.php
@@ -0,0 +1,695 @@
+<?php
+/**
+ * Handle customer profile requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Handlers;
+
+use AgentWP\AI\Response;
+
+class CustomerHandler {
+	const RECENT_LIMIT = 5;
+	const TOP_LIMIT    = 5;
+	const ORDER_BATCH  = 200;
+
+	/**
+	 * Handle a customer profile request.
+	 *
+	 * @param array $args Request arguments.
+	 * @return Response
+	 */
+	public function handle( array $args ): Response {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return Response::error( 'WooCommerce is required to fetch customer profiles.', 400 );
+		}
+
+		$normalized = $this->normalize_args( $args );
+		if ( 0 === $normalized['customer_id'] && '' === $normalized['email'] ) {
+			return Response::error( 'Provide a customer ID or email address.', 400 );
+		}
+
+		$paid_statuses = $this->get_paid_statuses();
+		$order_ids     = $this->collect_order_ids( $normalized, $paid_statuses );
+		$metrics       = $this->build_metrics( $order_ids );
+		$recent_orders = $this->get_recent_orders( $normalized, $paid_statuses );
+
+		$payload = array_merge(
+			$metrics,
+			array(
+				'customer'          => $this->build_customer_summary( $normalized, $recent_orders ),
+				'health_thresholds' => $this->get_health_thresholds(),
+				'recent_orders'     => $recent_orders,
+			)
+		);
+
+		return Response::success( $payload );
+	}
+
+	/**
+	 * @param array $args Request args.
+	 * @return array
+	 */
+	private function normalize_args( array $args ) {
+		$email       = isset( $args['email'] ) ? sanitize_email( $args['email'] ) : '';
+		$customer_id = isset( $args['customer_id'] ) ? absint( $args['customer_id'] ) : 0;
+
+		if ( '' === $email && $customer_id > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $customer_id );
+			if ( $user && isset( $user->user_email ) ) {
+				$email = sanitize_email( $user->user_email );
+			}
+		}
+
+		return array(
+			'email'       => $email,
+			'customer_id' => $customer_id,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized request args.
+	 * @param array $statuses Paid statuses.
+	 * @return array
+	 */
+	private function collect_order_ids( array $normalized, array $statuses ) {
+		$order_ids = array();
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'customer' => $normalized['customer_id'],
+						'status'   => $statuses,
+					)
+				)
+			);
+		}
+
+		if ( '' !== $normalized['email'] && 0 === $normalized['customer_id'] ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'billing_email' => $normalized['email'],
+						'status'        => $statuses,
+					)
+				)
+			);
+		}
+
+		$order_ids = array_map( 'absint', $order_ids );
+		$order_ids = array_filter( array_unique( $order_ids ) );
+		sort( $order_ids );
+
+		return $order_ids;
+	}
+
+	/**
+	 * @param array $query_args Query arguments.
+	 * @return array
+	 */
+	private function query_order_ids( array $query_args ) {
+		$ids   = array();
+		$page  = 1;
+		$limit = self::ORDER_BATCH;
+
+		while ( true ) {
+			$args = array_merge(
+				$query_args,
+				array(
+					'limit'  => $limit,
+					'paged'  => $page,
+					'return' => 'ids',
+				)
+			);
+
+			$batch = wc_get_orders( $args );
+			if ( ! is_array( $batch ) || empty( $batch ) ) {
+				break;
+			}
+
+			$ids = array_merge( $ids, $batch );
+
+			if ( count( $batch ) < $limit ) {
+				break;
+			}
+
+			$page++;
+		}
+
+		return $ids;
+	}
+
+	/**
+	 * @param array $order_ids Order IDs to summarize.
+	 * @return array
+	 */
+	private function build_metrics( array $order_ids ) {
+		$total_orders = count( $order_ids );
+		$total_spent  = 0.0;
+		$first_ts     = null;
+		$last_ts      = null;
+		$first_date   = '';
+		$last_date    = '';
+
+		$product_totals  = array();
+		$category_totals = array();
+		$category_cache  = array();
+
+		foreach ( $order_ids as $order_id ) {
+			$order = function_exists( 'wc_get_order' ) ? wc_get_order( $order_id ) : null;
+			if ( ! $order || ! method_exists( $order, 'get_total' ) ) {
+				continue;
+			}
+
+			$total_spent += $this->normalize_amount( $order->get_total() );
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+			if ( $date_created ) {
+				$timestamp = $date_created->getTimestamp();
+				if ( null === $first_ts || $timestamp < $first_ts ) {
+					$first_ts   = $timestamp;
+					$first_date = $this->format_datetime( $date_created );
+				}
+
+				if ( null === $last_ts || $timestamp > $last_ts ) {
+					$last_ts   = $timestamp;
+					$last_date = $this->format_datetime( $date_created );
+				}
+			}
+
+			$this->accumulate_item_totals( $order, $product_totals, $category_totals, $category_cache );
+		}
+
+		$average_order_value = 0.0;
+		if ( $total_orders > 0 ) {
+			$average_order_value = $this->normalize_amount( $total_spent / $total_orders );
+		}
+
+		$days_since_last_order = $this->calculate_days_since( $last_ts );
+		$health_status         = $this->determine_health_status( $days_since_last_order, $total_orders );
+		$ltv_projection         = $this->calculate_ltv_projection( $total_orders, $average_order_value, $first_ts );
+
+		return array(
+			'total_orders'                  => $total_orders,
+			'total_spent'                   => $this->normalize_amount( $total_spent ),
+			'total_spent_formatted'         => $this->format_currency( $total_spent ),
+			'average_order_value'           => $average_order_value,
+			'average_order_value_formatted' => $this->format_currency( $average_order_value ),
+			'first_order_date'              => $first_date,
+			'last_order_date'               => $last_date,
+			'days_since_last_order'         => $days_since_last_order,
+			'favorite_products'             => $this->format_top_products( $product_totals ),
+			'favorite_categories'           => $this->format_top_categories( $category_totals ),
+			'estimated_ltv'                 => $ltv_projection['estimated_ltv'],
+			'estimated_ltv_formatted'       => $this->format_currency( $ltv_projection['estimated_ltv'] ),
+			'ltv_projection'                => $ltv_projection['projection'],
+			'health_status'                 => $health_status,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $recent_orders Recent order summaries.
+	 * @return array
+	 */
+	private function build_customer_summary( array $normalized, array $recent_orders ) {
+		$name  = '';
+		$email = $normalized['email'];
+
+		if ( $normalized['customer_id'] > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $normalized['customer_id'] );
+			if ( $user ) {
+				$first = isset( $user->first_name ) ? $user->first_name : '';
+				$last  = isset( $user->last_name ) ? $user->last_name : '';
+				$name  = trim( $first . ' ' . $last );
+				if ( '' === $name && isset( $user->display_name ) ) {
+					$name = (string) $user->display_name;
+				}
+				if ( '' === $email && isset( $user->user_email ) ) {
+					$email = sanitize_email( $user->user_email );
+				}
+			}
+		}
+
+		if ( '' === $name && ! empty( $recent_orders ) && isset( $recent_orders[0]['customer_name'] ) ) {
+			$name = sanitize_text_field( $recent_orders[0]['customer_name'] );
+		}
+
+		return array(
+			'customer_id' => $normalized['customer_id'],
+			'email'       => $email,
+			'name'        => $name,
+			'is_guest'    => 0 === $normalized['customer_id'],
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $statuses Status list.
+	 * @return array
+	 */
+	private function get_recent_orders( array $normalized, array $statuses ) {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$args = array(
+			'limit'   => self::RECENT_LIMIT,
+			'orderby' => 'date',
+			'order'   => 'DESC',
+			'status'  => $statuses,
+		);
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$args['customer'] = $normalized['customer_id'];
+		} elseif ( '' !== $normalized['email'] ) {
+			$args['billing_email'] = $normalized['email'];
+		}
+
+		$orders = wc_get_orders( $args );
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$recent = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$recent[] = $this->format_order_summary( $order );
+		}
+
+		return $recent;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_order_summary( $order ) {
+		$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+		$total        = method_exists( $order, 'get_total' ) ? $this->normalize_amount( $order->get_total() ) : 0.0;
+
+		return array(
+			'id'              => intval( $order->get_id() ),
+			'status'          => sanitize_text_field( $order->get_status() ),
+			'total'           => $total,
+			'total_formatted' => $this->format_currency( $total ),
+			'currency'        => sanitize_text_field( $order->get_currency() ),
+			'date_created'    => $this->format_datetime( $date_created ),
+			'customer_name'   => $this->get_customer_name( $order ),
+			'customer_email'  => $this->get_customer_email( $order ),
+			'items_summary'   => $this->format_items_summary( $order ),
+		);
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_name( $order ) {
+		$first = method_exists( $order, 'get_billing_first_name' ) ? $order->get_billing_first_name() : '';
+		$last  = method_exists( $order, 'get_billing_last_name' ) ? $order->get_billing_last_name() : '';
+		$name  = trim( $first . ' ' . $last );
+
+		if ( '' === $name && method_exists( $order, 'get_shipping_first_name' ) ) {
+			$first = $order->get_shipping_first_name();
+			$last  = method_exists( $order, 'get_shipping_last_name' ) ? $order->get_shipping_last_name() : '';
+			$name  = trim( $first . ' ' . $last );
+		}
+
+		return sanitize_text_field( $name );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_email( $order ) {
+		$email = method_exists( $order, 'get_billing_email' ) ? $order->get_billing_email() : '';
+		if ( '' === $email && method_exists( $order, 'get_meta' ) ) {
+			$email = $order->get_meta( '_shipping_email' );
+		}
+
+		return sanitize_email( $email );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_items_summary( $order ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return array();
+		}
+
+		$items = $order->get_items();
+		if ( ! is_array( $items ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_name' ) ) {
+				continue;
+			}
+
+			$name = sanitize_text_field( $item->get_name() );
+			$qty  = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+
+			if ( '' === $name ) {
+				continue;
+			}
+
+			$summary[] = array(
+				'name'     => $name,
+				'quantity' => $qty,
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @param array  $product_totals Product totals accumulator.
+	 * @param array  $category_totals Category totals accumulator.
+	 * @param array  $category_cache Category cache.
+	 * @return void
+	 */
+	private function accumulate_item_totals( $order, array &$product_totals, array &$category_totals, array &$category_cache ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return;
+		}
+
+		$items = $order->get_items( 'line_item' );
+		if ( ! is_array( $items ) ) {
+			return;
+		}
+
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_product_id' ) ) {
+				continue;
+			}
+
+			$product_id = absint( $item->get_product_id() );
+			if ( 0 === $product_id ) {
+				continue;
+			}
+
+			$quantity = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+			if ( $quantity < 1 ) {
+				continue;
+			}
+
+			if ( ! isset( $product_totals[ $product_id ] ) ) {
+				$product_totals[ $product_id ] = array(
+					'product_id' => $product_id,
+					'name'       => sanitize_text_field( $item->get_name() ),
+					'quantity'   => 0,
+				);
+			}
+
+			$product_totals[ $product_id ]['quantity'] += $quantity;
+
+			$categories = $this->get_product_categories( $product_id, $category_cache );
+			foreach ( $categories as $term_id => $name ) {
+				if ( ! isset( $category_totals[ $term_id ] ) ) {
+					$category_totals[ $term_id ] = array(
+						'category_id' => $term_id,
+						'name'        => $name,
+						'quantity'    => 0,
+					);
+				}
+
+				$category_totals[ $term_id ]['quantity'] += $quantity;
+			}
+		}
+	}
+
+	/**
+	 * @param int   $product_id Product ID.
+	 * @param array $cache Category cache.
+	 * @return array
+	 */
+	private function get_product_categories( $product_id, array &$cache ) {
+		$product_id = absint( $product_id );
+		if ( 0 === $product_id ) {
+			return array();
+		}
+
+		if ( isset( $cache[ $product_id ] ) ) {
+			return $cache[ $product_id ];
+		}
+
+		$categories = array();
+		if ( function_exists( 'wc_get_product_terms' ) ) {
+			$terms = wc_get_product_terms( $product_id, 'product_cat', array( 'fields' => 'all' ) );
+			if ( is_array( $terms ) ) {
+				foreach ( $terms as $term ) {
+					if ( ! is_object( $term ) || ! isset( $term->term_id ) ) {
+						continue;
+					}
+					$categories[ (int) $term->term_id ] = sanitize_text_field( $term->name );
+				}
+			}
+		}
+
+		$cache[ $product_id ] = $categories;
+
+		return $categories;
+	}
+
+	/**
+	 * @param array $totals Product totals.
+	 * @return array
+	 */
+	private function format_top_products( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param array $totals Category totals.
+	 * @return array
+	 */
+	private function format_top_categories( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param int|null $last_ts Last order timestamp.
+	 * @return int|null
+	 */
+	private function calculate_days_since( $last_ts ) {
+		if ( null === $last_ts ) {
+			return null;
+		}
+
+		$now_ts  = $this->get_now_timestamp();
+		$diff    = max( 0, $now_ts - $last_ts );
+		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+
+		return (int) floor( $diff / $seconds );
+	}
+
+	/**
+	 * Simple 12-month projection based on orders per month and average order value.
+	 *
+	 * @param int      $total_orders Order count.
+	 * @param float    $average_order_value Average order value.
+	 * @param int|null $first_ts First order timestamp.
+	 * @return array
+	 */
+	private function calculate_ltv_projection( $total_orders, $average_order_value, $first_ts ) {
+		$orders_per_month = 0.0;
+		$days_since_first = 0;
+
+		if ( $total_orders > 0 && null !== $first_ts ) {
+			$now_ts  = $this->get_now_timestamp();
+			$diff    = max( 0, $now_ts - $first_ts );
+			$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+			$days_since_first = (int) max( 1, floor( $diff / $seconds ) );
+			$orders_per_month = $total_orders / ( $days_since_first / 30 );
+		}
+
+		$orders_per_month = round( $orders_per_month, 2 );
+		$projection_months = 12;
+		$estimated_ltv = $this->normalize_amount( $average_order_value * $orders_per_month * $projection_months );
+
+		return array(
+			'estimated_ltv' => $estimated_ltv,
+			'projection'    => array(
+				'projection_months'     => $projection_months,
+				'orders_per_month'      => $orders_per_month,
+				'days_since_first_order' => $days_since_first,
+			),
+		);
+	}
+
+	/**
+	 * @param int|null $days_since_last Order recency in days.
+	 * @param int      $total_orders Total orders.
+	 * @return string
+	 */
+	private function determine_health_status( $days_since_last, $total_orders ) {
+		if ( null === $days_since_last || 0 === $total_orders ) {
+			return 'churned';
+		}
+
+		$thresholds = $this->get_health_thresholds();
+
+		if ( $days_since_last <= $thresholds['active'] ) {
+			return 'active';
+		}
+
+		if ( $days_since_last <= $thresholds['at_risk'] ) {
+			return 'at_risk';
+		}
+
+		return 'churned';
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_health_thresholds() {
+		$thresholds = array(
+			'active'  => 60,
+			'at_risk' => 180,
+		);
+
+		if ( function_exists( 'apply_filters' ) ) {
+			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
+		}
+
+		$active  = isset( $thresholds['active'] ) ? absint( $thresholds['active'] ) : 60;
+		$at_risk = isset( $thresholds['at_risk'] ) ? absint( $thresholds['at_risk'] ) : 180;
+
+		if ( $active <= 0 ) {
+			$active = 60;
+		}
+
+		if ( $at_risk <= $active ) {
+			$at_risk = $active + 1;
+		}
+
+		return array(
+			'active'  => $active,
+			'at_risk' => $at_risk,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_paid_statuses() {
+		$statuses = function_exists( 'wc_get_is_paid_statuses' )
+			? wc_get_is_paid_statuses()
+			: array( 'processing', 'completed', 'on-hold' );
+
+		$statuses = array_filter( array_map( 'sanitize_text_field', (array) $statuses ) );
+		if ( empty( $statuses ) ) {
+			return array( 'processing', 'completed', 'on-hold' );
+		}
+
+		return array_values( array_unique( $statuses ) );
+	}
+
+	/**
+	 * @param mixed $amount Amount input.
+	 * @return float
+	 */
+	private function normalize_amount( $amount ) {
+		if ( function_exists( 'wc_format_decimal' ) ) {
+			return (float) wc_format_decimal( $amount, $this->get_price_decimals() );
+		}
+
+		return (float) $amount;
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_price_decimals() {
+		if ( function_exists( 'wc_get_price_decimals' ) ) {
+			return (int) wc_get_price_decimals();
+		}
+
+		return 2;
+	}
+
+	/**
+	 * @param float $value Currency amount.
+	 * @return string
+	 */
+	private function format_currency( $value ) {
+		$amount = $this->normalize_amount( $value );
+		if ( function_exists( 'wc_price' ) ) {
+			return wc_price( $amount );
+		}
+
+		return number_format( $amount, $this->get_price_decimals(), '.', '' );
+	}
+
+	/**
+	 * @param mixed $date Date instance.
+	 * @return string
+	 */
+	private function format_datetime( $date ) {
+		if ( ! $date || ! method_exists( $date, 'format' ) ) {
+			return '';
+		}
+
+		return $date->format( 'c' );
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_now_timestamp() {
+		if ( function_exists( 'current_time' ) ) {
+			return (int) current_time( 'timestamp' );
+		}
+
+		return time();
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
index 8d0c36e9b634b18599d5e317f273cafb58dea92a..6147e223ae90a48f8a6042ca9e6285131b15174c
--- a/src/Intent/Handlers/CustomerLookupHandler.php
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Intent\Handlers;
 
 use AgentWP\AI\Response;
+use AgentWP\Handlers\CustomerHandler;
 use AgentWP\Intent\Intent;
 
 class CustomerLookupHandler extends BaseHandler {
@@ -20,7 +21,81 @@
 	 * @return Response
 	 */
 	public function handle( array $context ): Response {
-		$message = 'I can look up customer profiles. Share an email or name.';
-		return $this->build_response( $context, $message );
+		$query = isset( $context['input'] ) ? (string) $context['input'] : '';
+		$query = trim( $query );
+
+		if ( '' === $query ) {
+			$message = 'I can look up customer profiles. Share an email or customer ID.';
+			return $this->build_response( $context, $message );
+		}
+
+		$email       = $this->extract_email( $query );
+		$customer_id = $this->extract_customer_id( $query );
+		if ( '' !== $email && ! ctype_digit( $query ) ) {
+			$customer_id = 0;
+		}
+
+		if ( '' === $email && 0 === $customer_id ) {
+			$message = 'Share an email address or customer ID to look up their profile.';
+			return $this->build_response( $context, $message );
+		}
+
+		$customer = new CustomerHandler();
+		$result   = $customer->handle(
+			array(
+				'email'       => $email,
+				'customer_id' => $customer_id,
+			)
+		);
+
+		if ( ! $result->is_success() ) {
+			return $result;
+		}
+
+		$data         = $result->get_data();
+		$total_orders = isset( $data['total_orders'] ) ? intval( $data['total_orders'] ) : 0;
+		$message      = 0 === $total_orders
+			? 'I could not find any orders for that customer.'
+			: sprintf( 'Found %d order%s for that customer.', $total_orders, 1 === $total_orders ? '' : 's' );
+
+		return $this->build_response( $context, $message, $data );
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return string
+	 */
+	private function extract_email( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return '';
+		}
+
+		if ( preg_match( '/[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}/i', $query, $matches ) ) {
+			return sanitize_email( $matches[0] );
+		}
+
+		return '';
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return int
+	 */
+	private function extract_customer_id( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return 0;
+		}
+
+		if ( ctype_digit( $query ) ) {
+			return absint( $query );
+		}
+
+		if ( preg_match( '/\b(\d+)\b/', $query, $matches ) ) {
+			return absint( $matches[1] );
+		}
+
+		return 0;
 	}
 }


thinking
**Reviewing customer handler and LTV projection details**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/src/Handlers/CustomerHandler.php
@@ -42,2 +42,3 @@
 				'health_thresholds' => $this->get_health_thresholds(),
+				'included_statuses' => $paid_statuses,
 				'recent_orders'     => $recent_orders,
apply_patch(auto_approved=true) exited 0 in 38ms:
Success. Updated the following files:
M src/Handlers/CustomerHandler.php
file update:
diff --git a/src/Handlers/CustomerHandler.php b/src/Handlers/CustomerHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fb972f8b8b964729a341a13cfba62d8fcb3236ce
--- /dev/null
+++ b/src/Handlers/CustomerHandler.php
@@ -0,0 +1,696 @@
+<?php
+/**
+ * Handle customer profile requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Handlers;
+
+use AgentWP\AI\Response;
+
+class CustomerHandler {
+	const RECENT_LIMIT = 5;
+	const TOP_LIMIT    = 5;
+	const ORDER_BATCH  = 200;
+
+	/**
+	 * Handle a customer profile request.
+	 *
+	 * @param array $args Request arguments.
+	 * @return Response
+	 */
+	public function handle( array $args ): Response {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return Response::error( 'WooCommerce is required to fetch customer profiles.', 400 );
+		}
+
+		$normalized = $this->normalize_args( $args );
+		if ( 0 === $normalized['customer_id'] && '' === $normalized['email'] ) {
+			return Response::error( 'Provide a customer ID or email address.', 400 );
+		}
+
+		$paid_statuses = $this->get_paid_statuses();
+		$order_ids     = $this->collect_order_ids( $normalized, $paid_statuses );
+		$metrics       = $this->build_metrics( $order_ids );
+		$recent_orders = $this->get_recent_orders( $normalized, $paid_statuses );
+
+		$payload = array_merge(
+			$metrics,
+			array(
+				'customer'          => $this->build_customer_summary( $normalized, $recent_orders ),
+				'health_thresholds' => $this->get_health_thresholds(),
+				'included_statuses' => $paid_statuses,
+				'recent_orders'     => $recent_orders,
+			)
+		);
+
+		return Response::success( $payload );
+	}
+
+	/**
+	 * @param array $args Request args.
+	 * @return array
+	 */
+	private function normalize_args( array $args ) {
+		$email       = isset( $args['email'] ) ? sanitize_email( $args['email'] ) : '';
+		$customer_id = isset( $args['customer_id'] ) ? absint( $args['customer_id'] ) : 0;
+
+		if ( '' === $email && $customer_id > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $customer_id );
+			if ( $user && isset( $user->user_email ) ) {
+				$email = sanitize_email( $user->user_email );
+			}
+		}
+
+		return array(
+			'email'       => $email,
+			'customer_id' => $customer_id,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized request args.
+	 * @param array $statuses Paid statuses.
+	 * @return array
+	 */
+	private function collect_order_ids( array $normalized, array $statuses ) {
+		$order_ids = array();
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'customer' => $normalized['customer_id'],
+						'status'   => $statuses,
+					)
+				)
+			);
+		}
+
+		if ( '' !== $normalized['email'] && 0 === $normalized['customer_id'] ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'billing_email' => $normalized['email'],
+						'status'        => $statuses,
+					)
+				)
+			);
+		}
+
+		$order_ids = array_map( 'absint', $order_ids );
+		$order_ids = array_filter( array_unique( $order_ids ) );
+		sort( $order_ids );
+
+		return $order_ids;
+	}
+
+	/**
+	 * @param array $query_args Query arguments.
+	 * @return array
+	 */
+	private function query_order_ids( array $query_args ) {
+		$ids   = array();
+		$page  = 1;
+		$limit = self::ORDER_BATCH;
+
+		while ( true ) {
+			$args = array_merge(
+				$query_args,
+				array(
+					'limit'  => $limit,
+					'paged'  => $page,
+					'return' => 'ids',
+				)
+			);
+
+			$batch = wc_get_orders( $args );
+			if ( ! is_array( $batch ) || empty( $batch ) ) {
+				break;
+			}
+
+			$ids = array_merge( $ids, $batch );
+
+			if ( count( $batch ) < $limit ) {
+				break;
+			}
+
+			$page++;
+		}
+
+		return $ids;
+	}
+
+	/**
+	 * @param array $order_ids Order IDs to summarize.
+	 * @return array
+	 */
+	private function build_metrics( array $order_ids ) {
+		$total_orders = count( $order_ids );
+		$total_spent  = 0.0;
+		$first_ts     = null;
+		$last_ts      = null;
+		$first_date   = '';
+		$last_date    = '';
+
+		$product_totals  = array();
+		$category_totals = array();
+		$category_cache  = array();
+
+		foreach ( $order_ids as $order_id ) {
+			$order = function_exists( 'wc_get_order' ) ? wc_get_order( $order_id ) : null;
+			if ( ! $order || ! method_exists( $order, 'get_total' ) ) {
+				continue;
+			}
+
+			$total_spent += $this->normalize_amount( $order->get_total() );
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+			if ( $date_created ) {
+				$timestamp = $date_created->getTimestamp();
+				if ( null === $first_ts || $timestamp < $first_ts ) {
+					$first_ts   = $timestamp;
+					$first_date = $this->format_datetime( $date_created );
+				}
+
+				if ( null === $last_ts || $timestamp > $last_ts ) {
+					$last_ts   = $timestamp;
+					$last_date = $this->format_datetime( $date_created );
+				}
+			}
+
+			$this->accumulate_item_totals( $order, $product_totals, $category_totals, $category_cache );
+		}
+
+		$average_order_value = 0.0;
+		if ( $total_orders > 0 ) {
+			$average_order_value = $this->normalize_amount( $total_spent / $total_orders );
+		}
+
+		$days_since_last_order = $this->calculate_days_since( $last_ts );
+		$health_status         = $this->determine_health_status( $days_since_last_order, $total_orders );
+		$ltv_projection         = $this->calculate_ltv_projection( $total_orders, $average_order_value, $first_ts );
+
+		return array(
+			'total_orders'                  => $total_orders,
+			'total_spent'                   => $this->normalize_amount( $total_spent ),
+			'total_spent_formatted'         => $this->format_currency( $total_spent ),
+			'average_order_value'           => $average_order_value,
+			'average_order_value_formatted' => $this->format_currency( $average_order_value ),
+			'first_order_date'              => $first_date,
+			'last_order_date'               => $last_date,
+			'days_since_last_order'         => $days_since_last_order,
+			'favorite_products'             => $this->format_top_products( $product_totals ),
+			'favorite_categories'           => $this->format_top_categories( $category_totals ),
+			'estimated_ltv'                 => $ltv_projection['estimated_ltv'],
+			'estimated_ltv_formatted'       => $this->format_currency( $ltv_projection['estimated_ltv'] ),
+			'ltv_projection'                => $ltv_projection['projection'],
+			'health_status'                 => $health_status,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $recent_orders Recent order summaries.
+	 * @return array
+	 */
+	private function build_customer_summary( array $normalized, array $recent_orders ) {
+		$name  = '';
+		$email = $normalized['email'];
+
+		if ( $normalized['customer_id'] > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $normalized['customer_id'] );
+			if ( $user ) {
+				$first = isset( $user->first_name ) ? $user->first_name : '';
+				$last  = isset( $user->last_name ) ? $user->last_name : '';
+				$name  = trim( $first . ' ' . $last );
+				if ( '' === $name && isset( $user->display_name ) ) {
+					$name = (string) $user->display_name;
+				}
+				if ( '' === $email && isset( $user->user_email ) ) {
+					$email = sanitize_email( $user->user_email );
+				}
+			}
+		}
+
+		if ( '' === $name && ! empty( $recent_orders ) && isset( $recent_orders[0]['customer_name'] ) ) {
+			$name = sanitize_text_field( $recent_orders[0]['customer_name'] );
+		}
+
+		return array(
+			'customer_id' => $normalized['customer_id'],
+			'email'       => $email,
+			'name'        => $name,
+			'is_guest'    => 0 === $normalized['customer_id'],
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $statuses Status list.
+	 * @return array
+	 */
+	private function get_recent_orders( array $normalized, array $statuses ) {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$args = array(
+			'limit'   => self::RECENT_LIMIT,
+			'orderby' => 'date',
+			'order'   => 'DESC',
+			'status'  => $statuses,
+		);
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$args['customer'] = $normalized['customer_id'];
+		} elseif ( '' !== $normalized['email'] ) {
+			$args['billing_email'] = $normalized['email'];
+		}
+
+		$orders = wc_get_orders( $args );
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$recent = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$recent[] = $this->format_order_summary( $order );
+		}
+
+		return $recent;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_order_summary( $order ) {
+		$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+		$total        = method_exists( $order, 'get_total' ) ? $this->normalize_amount( $order->get_total() ) : 0.0;
+
+		return array(
+			'id'              => intval( $order->get_id() ),
+			'status'          => sanitize_text_field( $order->get_status() ),
+			'total'           => $total,
+			'total_formatted' => $this->format_currency( $total ),
+			'currency'        => sanitize_text_field( $order->get_currency() ),
+			'date_created'    => $this->format_datetime( $date_created ),
+			'customer_name'   => $this->get_customer_name( $order ),
+			'customer_email'  => $this->get_customer_email( $order ),
+			'items_summary'   => $this->format_items_summary( $order ),
+		);
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_name( $order ) {
+		$first = method_exists( $order, 'get_billing_first_name' ) ? $order->get_billing_first_name() : '';
+		$last  = method_exists( $order, 'get_billing_last_name' ) ? $order->get_billing_last_name() : '';
+		$name  = trim( $first . ' ' . $last );
+
+		if ( '' === $name && method_exists( $order, 'get_shipping_first_name' ) ) {
+			$first = $order->get_shipping_first_name();
+			$last  = method_exists( $order, 'get_shipping_last_name' ) ? $order->get_shipping_last_name() : '';
+			$name  = trim( $first . ' ' . $last );
+		}
+
+		return sanitize_text_field( $name );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_email( $order ) {
+		$email = method_exists( $order, 'get_billing_email' ) ? $order->get_billing_email() : '';
+		if ( '' === $email && method_exists( $order, 'get_meta' ) ) {
+			$email = $order->get_meta( '_shipping_email' );
+		}
+
+		return sanitize_email( $email );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_items_summary( $order ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return array();
+		}
+
+		$items = $order->get_items();
+		if ( ! is_array( $items ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_name' ) ) {
+				continue;
+			}
+
+			$name = sanitize_text_field( $item->get_name() );
+			$qty  = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+
+			if ( '' === $name ) {
+				continue;
+			}
+
+			$summary[] = array(
+				'name'     => $name,
+				'quantity' => $qty,
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @param array  $product_totals Product totals accumulator.
+	 * @param array  $category_totals Category totals accumulator.
+	 * @param array  $category_cache Category cache.
+	 * @return void
+	 */
+	private function accumulate_item_totals( $order, array &$product_totals, array &$category_totals, array &$category_cache ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return;
+		}
+
+		$items = $order->get_items( 'line_item' );
+		if ( ! is_array( $items ) ) {
+			return;
+		}
+
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_product_id' ) ) {
+				continue;
+			}
+
+			$product_id = absint( $item->get_product_id() );
+			if ( 0 === $product_id ) {
+				continue;
+			}
+
+			$quantity = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+			if ( $quantity < 1 ) {
+				continue;
+			}
+
+			if ( ! isset( $product_totals[ $product_id ] ) ) {
+				$product_totals[ $product_id ] = array(
+					'product_id' => $product_id,
+					'name'       => sanitize_text_field( $item->get_name() ),
+					'quantity'   => 0,
+				);
+			}
+
+			$product_totals[ $product_id ]['quantity'] += $quantity;
+
+			$categories = $this->get_product_categories( $product_id, $category_cache );
+			foreach ( $categories as $term_id => $name ) {
+				if ( ! isset( $category_totals[ $term_id ] ) ) {
+					$category_totals[ $term_id ] = array(
+						'category_id' => $term_id,
+						'name'        => $name,
+						'quantity'    => 0,
+					);
+				}
+
+				$category_totals[ $term_id ]['quantity'] += $quantity;
+			}
+		}
+	}
+
+	/**
+	 * @param int   $product_id Product ID.
+	 * @param array $cache Category cache.
+	 * @return array
+	 */
+	private function get_product_categories( $product_id, array &$cache ) {
+		$product_id = absint( $product_id );
+		if ( 0 === $product_id ) {
+			return array();
+		}
+
+		if ( isset( $cache[ $product_id ] ) ) {
+			return $cache[ $product_id ];
+		}
+
+		$categories = array();
+		if ( function_exists( 'wc_get_product_terms' ) ) {
+			$terms = wc_get_product_terms( $product_id, 'product_cat', array( 'fields' => 'all' ) );
+			if ( is_array( $terms ) ) {
+				foreach ( $terms as $term ) {
+					if ( ! is_object( $term ) || ! isset( $term->term_id ) ) {
+						continue;
+					}
+					$categories[ (int) $term->term_id ] = sanitize_text_field( $term->name );
+				}
+			}
+		}
+
+		$cache[ $product_id ] = $categories;
+
+		return $categories;
+	}
+
+	/**
+	 * @param array $totals Product totals.
+	 * @return array
+	 */
+	private function format_top_products( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param array $totals Category totals.
+	 * @return array
+	 */
+	private function format_top_categories( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param int|null $last_ts Last order timestamp.
+	 * @return int|null
+	 */
+	private function calculate_days_since( $last_ts ) {
+		if ( null === $last_ts ) {
+			return null;
+		}
+
+		$now_ts  = $this->get_now_timestamp();
+		$diff    = max( 0, $now_ts - $last_ts );
+		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+
+		return (int) floor( $diff / $seconds );
+	}
+
+	/**
+	 * Simple 12-month projection based on orders per month and average order value.
+	 *
+	 * @param int      $total_orders Order count.
+	 * @param float    $average_order_value Average order value.
+	 * @param int|null $first_ts First order timestamp.
+	 * @return array
+	 */
+	private function calculate_ltv_projection( $total_orders, $average_order_value, $first_ts ) {
+		$orders_per_month = 0.0;
+		$days_since_first = 0;
+
+		if ( $total_orders > 0 && null !== $first_ts ) {
+			$now_ts  = $this->get_now_timestamp();
+			$diff    = max( 0, $now_ts - $first_ts );
+			$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+			$days_since_first = (int) max( 1, floor( $diff / $seconds ) );
+			$orders_per_month = $total_orders / ( $days_since_first / 30 );
+		}
+
+		$orders_per_month = round( $orders_per_month, 2 );
+		$projection_months = 12;
+		$estimated_ltv = $this->normalize_amount( $average_order_value * $orders_per_month * $projection_months );
+
+		return array(
+			'estimated_ltv' => $estimated_ltv,
+			'projection'    => array(
+				'projection_months'     => $projection_months,
+				'orders_per_month'      => $orders_per_month,
+				'days_since_first_order' => $days_since_first,
+			),
+		);
+	}
+
+	/**
+	 * @param int|null $days_since_last Order recency in days.
+	 * @param int      $total_orders Total orders.
+	 * @return string
+	 */
+	private function determine_health_status( $days_since_last, $total_orders ) {
+		if ( null === $days_since_last || 0 === $total_orders ) {
+			return 'churned';
+		}
+
+		$thresholds = $this->get_health_thresholds();
+
+		if ( $days_since_last <= $thresholds['active'] ) {
+			return 'active';
+		}
+
+		if ( $days_since_last <= $thresholds['at_risk'] ) {
+			return 'at_risk';
+		}
+
+		return 'churned';
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_health_thresholds() {
+		$thresholds = array(
+			'active'  => 60,
+			'at_risk' => 180,
+		);
+
+		if ( function_exists( 'apply_filters' ) ) {
+			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
+		}
+
+		$active  = isset( $thresholds['active'] ) ? absint( $thresholds['active'] ) : 60;
+		$at_risk = isset( $thresholds['at_risk'] ) ? absint( $thresholds['at_risk'] ) : 180;
+
+		if ( $active <= 0 ) {
+			$active = 60;
+		}
+
+		if ( $at_risk <= $active ) {
+			$at_risk = $active + 1;
+		}
+
+		return array(
+			'active'  => $active,
+			'at_risk' => $at_risk,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_paid_statuses() {
+		$statuses = function_exists( 'wc_get_is_paid_statuses' )
+			? wc_get_is_paid_statuses()
+			: array( 'processing', 'completed', 'on-hold' );
+
+		$statuses = array_filter( array_map( 'sanitize_text_field', (array) $statuses ) );
+		if ( empty( $statuses ) ) {
+			return array( 'processing', 'completed', 'on-hold' );
+		}
+
+		return array_values( array_unique( $statuses ) );
+	}
+
+	/**
+	 * @param mixed $amount Amount input.
+	 * @return float
+	 */
+	private function normalize_amount( $amount ) {
+		if ( function_exists( 'wc_format_decimal' ) ) {
+			return (float) wc_format_decimal( $amount, $this->get_price_decimals() );
+		}
+
+		return (float) $amount;
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_price_decimals() {
+		if ( function_exists( 'wc_get_price_decimals' ) ) {
+			return (int) wc_get_price_decimals();
+		}
+
+		return 2;
+	}
+
+	/**
+	 * @param float $value Currency amount.
+	 * @return string
+	 */
+	private function format_currency( $value ) {
+		$amount = $this->normalize_amount( $value );
+		if ( function_exists( 'wc_price' ) ) {
+			return wc_price( $amount );
+		}
+
+		return number_format( $amount, $this->get_price_decimals(), '.', '' );
+	}
+
+	/**
+	 * @param mixed $date Date instance.
+	 * @return string
+	 */
+	private function format_datetime( $date ) {
+		if ( ! $date || ! method_exists( $date, 'format' ) ) {
+			return '';
+		}
+
+		return $date->format( 'c' );
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_now_timestamp() {
+		if ( function_exists( 'current_time' ) ) {
+			return (int) current_time( 'timestamp' );
+		}
+
+		return time();
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
index 8d0c36e9b634b18599d5e317f273cafb58dea92a..6147e223ae90a48f8a6042ca9e6285131b15174c
--- a/src/Intent/Handlers/CustomerLookupHandler.php
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Intent\Handlers;
 
 use AgentWP\AI\Response;
+use AgentWP\Handlers\CustomerHandler;
 use AgentWP\Intent\Intent;
 
 class CustomerLookupHandler extends BaseHandler {
@@ -20,7 +21,81 @@
 	 * @return Response
 	 */
 	public function handle( array $context ): Response {
-		$message = 'I can look up customer profiles. Share an email or name.';
-		return $this->build_response( $context, $message );
+		$query = isset( $context['input'] ) ? (string) $context['input'] : '';
+		$query = trim( $query );
+
+		if ( '' === $query ) {
+			$message = 'I can look up customer profiles. Share an email or customer ID.';
+			return $this->build_response( $context, $message );
+		}
+
+		$email       = $this->extract_email( $query );
+		$customer_id = $this->extract_customer_id( $query );
+		if ( '' !== $email && ! ctype_digit( $query ) ) {
+			$customer_id = 0;
+		}
+
+		if ( '' === $email && 0 === $customer_id ) {
+			$message = 'Share an email address or customer ID to look up their profile.';
+			return $this->build_response( $context, $message );
+		}
+
+		$customer = new CustomerHandler();
+		$result   = $customer->handle(
+			array(
+				'email'       => $email,
+				'customer_id' => $customer_id,
+			)
+		);
+
+		if ( ! $result->is_success() ) {
+			return $result;
+		}
+
+		$data         = $result->get_data();
+		$total_orders = isset( $data['total_orders'] ) ? intval( $data['total_orders'] ) : 0;
+		$message      = 0 === $total_orders
+			? 'I could not find any orders for that customer.'
+			: sprintf( 'Found %d order%s for that customer.', $total_orders, 1 === $total_orders ? '' : 's' );
+
+		return $this->build_response( $context, $message, $data );
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return string
+	 */
+	private function extract_email( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return '';
+		}
+
+		if ( preg_match( '/[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}/i', $query, $matches ) ) {
+			return sanitize_email( $matches[0] );
+		}
+
+		return '';
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return int
+	 */
+	private function extract_customer_id( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return 0;
+		}
+
+		if ( ctype_digit( $query ) ) {
+			return absint( $query );
+		}
+
+		if ( preg_match( '/\b(\d+)\b/', $query, $matches ) ) {
+			return absint( $matches[1] );
+		}
+
+		return 0;
 	}
 }

file update:
diff --git a/src/Handlers/CustomerHandler.php b/src/Handlers/CustomerHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fb972f8b8b964729a341a13cfba62d8fcb3236ce
--- /dev/null
+++ b/src/Handlers/CustomerHandler.php
@@ -0,0 +1,696 @@
+<?php
+/**
+ * Handle customer profile requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Handlers;
+
+use AgentWP\AI\Response;
+
+class CustomerHandler {
+	const RECENT_LIMIT = 5;
+	const TOP_LIMIT    = 5;
+	const ORDER_BATCH  = 200;
+
+	/**
+	 * Handle a customer profile request.
+	 *
+	 * @param array $args Request arguments.
+	 * @return Response
+	 */
+	public function handle( array $args ): Response {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return Response::error( 'WooCommerce is required to fetch customer profiles.', 400 );
+		}
+
+		$normalized = $this->normalize_args( $args );
+		if ( 0 === $normalized['customer_id'] && '' === $normalized['email'] ) {
+			return Response::error( 'Provide a customer ID or email address.', 400 );
+		}
+
+		$paid_statuses = $this->get_paid_statuses();
+		$order_ids     = $this->collect_order_ids( $normalized, $paid_statuses );
+		$metrics       = $this->build_metrics( $order_ids );
+		$recent_orders = $this->get_recent_orders( $normalized, $paid_statuses );
+
+		$payload = array_merge(
+			$metrics,
+			array(
+				'customer'          => $this->build_customer_summary( $normalized, $recent_orders ),
+				'health_thresholds' => $this->get_health_thresholds(),
+				'included_statuses' => $paid_statuses,
+				'recent_orders'     => $recent_orders,
+			)
+		);
+
+		return Response::success( $payload );
+	}
+
+	/**
+	 * @param array $args Request args.
+	 * @return array
+	 */
+	private function normalize_args( array $args ) {
+		$email       = isset( $args['email'] ) ? sanitize_email( $args['email'] ) : '';
+		$customer_id = isset( $args['customer_id'] ) ? absint( $args['customer_id'] ) : 0;
+
+		if ( '' === $email && $customer_id > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $customer_id );
+			if ( $user && isset( $user->user_email ) ) {
+				$email = sanitize_email( $user->user_email );
+			}
+		}
+
+		return array(
+			'email'       => $email,
+			'customer_id' => $customer_id,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized request args.
+	 * @param array $statuses Paid statuses.
+	 * @return array
+	 */
+	private function collect_order_ids( array $normalized, array $statuses ) {
+		$order_ids = array();
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'customer' => $normalized['customer_id'],
+						'status'   => $statuses,
+					)
+				)
+			);
+		}
+
+		if ( '' !== $normalized['email'] && 0 === $normalized['customer_id'] ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'billing_email' => $normalized['email'],
+						'status'        => $statuses,
+					)
+				)
+			);
+		}
+
+		$order_ids = array_map( 'absint', $order_ids );
+		$order_ids = array_filter( array_unique( $order_ids ) );
+		sort( $order_ids );
+
+		return $order_ids;
+	}
+
+	/**
+	 * @param array $query_args Query arguments.
+	 * @return array
+	 */
+	private function query_order_ids( array $query_args ) {
+		$ids   = array();
+		$page  = 1;
+		$limit = self::ORDER_BATCH;
+
+		while ( true ) {
+			$args = array_merge(
+				$query_args,
+				array(
+					'limit'  => $limit,
+					'paged'  => $page,
+					'return' => 'ids',
+				)
+			);
+
+			$batch = wc_get_orders( $args );
+			if ( ! is_array( $batch ) || empty( $batch ) ) {
+				break;
+			}
+
+			$ids = array_merge( $ids, $batch );
+
+			if ( count( $batch ) < $limit ) {
+				break;
+			}
+
+			$page++;
+		}
+
+		return $ids;
+	}
+
+	/**
+	 * @param array $order_ids Order IDs to summarize.
+	 * @return array
+	 */
+	private function build_metrics( array $order_ids ) {
+		$total_orders = count( $order_ids );
+		$total_spent  = 0.0;
+		$first_ts     = null;
+		$last_ts      = null;
+		$first_date   = '';
+		$last_date    = '';
+
+		$product_totals  = array();
+		$category_totals = array();
+		$category_cache  = array();
+
+		foreach ( $order_ids as $order_id ) {
+			$order = function_exists( 'wc_get_order' ) ? wc_get_order( $order_id ) : null;
+			if ( ! $order || ! method_exists( $order, 'get_total' ) ) {
+				continue;
+			}
+
+			$total_spent += $this->normalize_amount( $order->get_total() );
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+			if ( $date_created ) {
+				$timestamp = $date_created->getTimestamp();
+				if ( null === $first_ts || $timestamp < $first_ts ) {
+					$first_ts   = $timestamp;
+					$first_date = $this->format_datetime( $date_created );
+				}
+
+				if ( null === $last_ts || $timestamp > $last_ts ) {
+					$last_ts   = $timestamp;
+					$last_date = $this->format_datetime( $date_created );
+				}
+			}
+
+			$this->accumulate_item_totals( $order, $product_totals, $category_totals, $category_cache );
+		}
+
+		$average_order_value = 0.0;
+		if ( $total_orders > 0 ) {
+			$average_order_value = $this->normalize_amount( $total_spent / $total_orders );
+		}
+
+		$days_since_last_order = $this->calculate_days_since( $last_ts );
+		$health_status         = $this->determine_health_status( $days_since_last_order, $total_orders );
+		$ltv_projection         = $this->calculate_ltv_projection( $total_orders, $average_order_value, $first_ts );
+
+		return array(
+			'total_orders'                  => $total_orders,
+			'total_spent'                   => $this->normalize_amount( $total_spent ),
+			'total_spent_formatted'         => $this->format_currency( $total_spent ),
+			'average_order_value'           => $average_order_value,
+			'average_order_value_formatted' => $this->format_currency( $average_order_value ),
+			'first_order_date'              => $first_date,
+			'last_order_date'               => $last_date,
+			'days_since_last_order'         => $days_since_last_order,
+			'favorite_products'             => $this->format_top_products( $product_totals ),
+			'favorite_categories'           => $this->format_top_categories( $category_totals ),
+			'estimated_ltv'                 => $ltv_projection['estimated_ltv'],
+			'estimated_ltv_formatted'       => $this->format_currency( $ltv_projection['estimated_ltv'] ),
+			'ltv_projection'                => $ltv_projection['projection'],
+			'health_status'                 => $health_status,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $recent_orders Recent order summaries.
+	 * @return array
+	 */
+	private function build_customer_summary( array $normalized, array $recent_orders ) {
+		$name  = '';
+		$email = $normalized['email'];
+
+		if ( $normalized['customer_id'] > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $normalized['customer_id'] );
+			if ( $user ) {
+				$first = isset( $user->first_name ) ? $user->first_name : '';
+				$last  = isset( $user->last_name ) ? $user->last_name : '';
+				$name  = trim( $first . ' ' . $last );
+				if ( '' === $name && isset( $user->display_name ) ) {
+					$name = (string) $user->display_name;
+				}
+				if ( '' === $email && isset( $user->user_email ) ) {
+					$email = sanitize_email( $user->user_email );
+				}
+			}
+		}
+
+		if ( '' === $name && ! empty( $recent_orders ) && isset( $recent_orders[0]['customer_name'] ) ) {
+			$name = sanitize_text_field( $recent_orders[0]['customer_name'] );
+		}
+
+		return array(
+			'customer_id' => $normalized['customer_id'],
+			'email'       => $email,
+			'name'        => $name,
+			'is_guest'    => 0 === $normalized['customer_id'],
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $statuses Status list.
+	 * @return array
+	 */
+	private function get_recent_orders( array $normalized, array $statuses ) {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$args = array(
+			'limit'   => self::RECENT_LIMIT,
+			'orderby' => 'date',
+			'order'   => 'DESC',
+			'status'  => $statuses,
+		);
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$args['customer'] = $normalized['customer_id'];
+		} elseif ( '' !== $normalized['email'] ) {
+			$args['billing_email'] = $normalized['email'];
+		}
+
+		$orders = wc_get_orders( $args );
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$recent = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$recent[] = $this->format_order_summary( $order );
+		}
+
+		return $recent;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_order_summary( $order ) {
+		$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+		$total        = method_exists( $order, 'get_total' ) ? $this->normalize_amount( $order->get_total() ) : 0.0;
+
+		return array(
+			'id'              => intval( $order->get_id() ),
+			'status'          => sanitize_text_field( $order->get_status() ),
+			'total'           => $total,
+			'total_formatted' => $this->format_currency( $total ),
+			'currency'        => sanitize_text_field( $order->get_currency() ),
+			'date_created'    => $this->format_datetime( $date_created ),
+			'customer_name'   => $this->get_customer_name( $order ),
+			'customer_email'  => $this->get_customer_email( $order ),
+			'items_summary'   => $this->format_items_summary( $order ),
+		);
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_name( $order ) {
+		$first = method_exists( $order, 'get_billing_first_name' ) ? $order->get_billing_first_name() : '';
+		$last  = method_exists( $order, 'get_billing_last_name' ) ? $order->get_billing_last_name() : '';
+		$name  = trim( $first . ' ' . $last );
+
+		if ( '' === $name && method_exists( $order, 'get_shipping_first_name' ) ) {
+			$first = $order->get_shipping_first_name();
+			$last  = method_exists( $order, 'get_shipping_last_name' ) ? $order->get_shipping_last_name() : '';
+			$name  = trim( $first . ' ' . $last );
+		}
+
+		return sanitize_text_field( $name );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_email( $order ) {
+		$email = method_exists( $order, 'get_billing_email' ) ? $order->get_billing_email() : '';
+		if ( '' === $email && method_exists( $order, 'get_meta' ) ) {
+			$email = $order->get_meta( '_shipping_email' );
+		}
+
+		return sanitize_email( $email );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_items_summary( $order ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return array();
+		}
+
+		$items = $order->get_items();
+		if ( ! is_array( $items ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_name' ) ) {
+				continue;
+			}
+
+			$name = sanitize_text_field( $item->get_name() );
+			$qty  = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+
+			if ( '' === $name ) {
+				continue;
+			}
+
+			$summary[] = array(
+				'name'     => $name,
+				'quantity' => $qty,
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @param array  $product_totals Product totals accumulator.
+	 * @param array  $category_totals Category totals accumulator.
+	 * @param array  $category_cache Category cache.
+	 * @return void
+	 */
+	private function accumulate_item_totals( $order, array &$product_totals, array &$category_totals, array &$category_cache ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return;
+		}
+
+		$items = $order->get_items( 'line_item' );
+		if ( ! is_array( $items ) ) {
+			return;
+		}
+
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_product_id' ) ) {
+				continue;
+			}
+
+			$product_id = absint( $item->get_product_id() );
+			if ( 0 === $product_id ) {
+				continue;
+			}
+
+			$quantity = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+			if ( $quantity < 1 ) {
+				continue;
+			}
+
+			if ( ! isset( $product_totals[ $product_id ] ) ) {
+				$product_totals[ $product_id ] = array(
+					'product_id' => $product_id,
+					'name'       => sanitize_text_field( $item->get_name() ),
+					'quantity'   => 0,
+				);
+			}
+
+			$product_totals[ $product_id ]['quantity'] += $quantity;
+
+			$categories = $this->get_product_categories( $product_id, $category_cache );
+			foreach ( $categories as $term_id => $name ) {
+				if ( ! isset( $category_totals[ $term_id ] ) ) {
+					$category_totals[ $term_id ] = array(
+						'category_id' => $term_id,
+						'name'        => $name,
+						'quantity'    => 0,
+					);
+				}
+
+				$category_totals[ $term_id ]['quantity'] += $quantity;
+			}
+		}
+	}
+
+	/**
+	 * @param int   $product_id Product ID.
+	 * @param array $cache Category cache.
+	 * @return array
+	 */
+	private function get_product_categories( $product_id, array &$cache ) {
+		$product_id = absint( $product_id );
+		if ( 0 === $product_id ) {
+			return array();
+		}
+
+		if ( isset( $cache[ $product_id ] ) ) {
+			return $cache[ $product_id ];
+		}
+
+		$categories = array();
+		if ( function_exists( 'wc_get_product_terms' ) ) {
+			$terms = wc_get_product_terms( $product_id, 'product_cat', array( 'fields' => 'all' ) );
+			if ( is_array( $terms ) ) {
+				foreach ( $terms as $term ) {
+					if ( ! is_object( $term ) || ! isset( $term->term_id ) ) {
+						continue;
+					}
+					$categories[ (int) $term->term_id ] = sanitize_text_field( $term->name );
+				}
+			}
+		}
+
+		$cache[ $product_id ] = $categories;
+
+		return $categories;
+	}
+
+	/**
+	 * @param array $totals Product totals.
+	 * @return array
+	 */
+	private function format_top_products( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param array $totals Category totals.
+	 * @return array
+	 */
+	private function format_top_categories( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param int|null $last_ts Last order timestamp.
+	 * @return int|null
+	 */
+	private function calculate_days_since( $last_ts ) {
+		if ( null === $last_ts ) {
+			return null;
+		}
+
+		$now_ts  = $this->get_now_timestamp();
+		$diff    = max( 0, $now_ts - $last_ts );
+		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+
+		return (int) floor( $diff / $seconds );
+	}
+
+	/**
+	 * Simple 12-month projection based on orders per month and average order value.
+	 *
+	 * @param int      $total_orders Order count.
+	 * @param float    $average_order_value Average order value.
+	 * @param int|null $first_ts First order timestamp.
+	 * @return array
+	 */
+	private function calculate_ltv_projection( $total_orders, $average_order_value, $first_ts ) {
+		$orders_per_month = 0.0;
+		$days_since_first = 0;
+
+		if ( $total_orders > 0 && null !== $first_ts ) {
+			$now_ts  = $this->get_now_timestamp();
+			$diff    = max( 0, $now_ts - $first_ts );
+			$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+			$days_since_first = (int) max( 1, floor( $diff / $seconds ) );
+			$orders_per_month = $total_orders / ( $days_since_first / 30 );
+		}
+
+		$orders_per_month = round( $orders_per_month, 2 );
+		$projection_months = 12;
+		$estimated_ltv = $this->normalize_amount( $average_order_value * $orders_per_month * $projection_months );
+
+		return array(
+			'estimated_ltv' => $estimated_ltv,
+			'projection'    => array(
+				'projection_months'     => $projection_months,
+				'orders_per_month'      => $orders_per_month,
+				'days_since_first_order' => $days_since_first,
+			),
+		);
+	}
+
+	/**
+	 * @param int|null $days_since_last Order recency in days.
+	 * @param int      $total_orders Total orders.
+	 * @return string
+	 */
+	private function determine_health_status( $days_since_last, $total_orders ) {
+		if ( null === $days_since_last || 0 === $total_orders ) {
+			return 'churned';
+		}
+
+		$thresholds = $this->get_health_thresholds();
+
+		if ( $days_since_last <= $thresholds['active'] ) {
+			return 'active';
+		}
+
+		if ( $days_since_last <= $thresholds['at_risk'] ) {
+			return 'at_risk';
+		}
+
+		return 'churned';
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_health_thresholds() {
+		$thresholds = array(
+			'active'  => 60,
+			'at_risk' => 180,
+		);
+
+		if ( function_exists( 'apply_filters' ) ) {
+			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
+		}
+
+		$active  = isset( $thresholds['active'] ) ? absint( $thresholds['active'] ) : 60;
+		$at_risk = isset( $thresholds['at_risk'] ) ? absint( $thresholds['at_risk'] ) : 180;
+
+		if ( $active <= 0 ) {
+			$active = 60;
+		}
+
+		if ( $at_risk <= $active ) {
+			$at_risk = $active + 1;
+		}
+
+		return array(
+			'active'  => $active,
+			'at_risk' => $at_risk,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_paid_statuses() {
+		$statuses = function_exists( 'wc_get_is_paid_statuses' )
+			? wc_get_is_paid_statuses()
+			: array( 'processing', 'completed', 'on-hold' );
+
+		$statuses = array_filter( array_map( 'sanitize_text_field', (array) $statuses ) );
+		if ( empty( $statuses ) ) {
+			return array( 'processing', 'completed', 'on-hold' );
+		}
+
+		return array_values( array_unique( $statuses ) );
+	}
+
+	/**
+	 * @param mixed $amount Amount input.
+	 * @return float
+	 */
+	private function normalize_amount( $amount ) {
+		if ( function_exists( 'wc_format_decimal' ) ) {
+			return (float) wc_format_decimal( $amount, $this->get_price_decimals() );
+		}
+
+		return (float) $amount;
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_price_decimals() {
+		if ( function_exists( 'wc_get_price_decimals' ) ) {
+			return (int) wc_get_price_decimals();
+		}
+
+		return 2;
+	}
+
+	/**
+	 * @param float $value Currency amount.
+	 * @return string
+	 */
+	private function format_currency( $value ) {
+		$amount = $this->normalize_amount( $value );
+		if ( function_exists( 'wc_price' ) ) {
+			return wc_price( $amount );
+		}
+
+		return number_format( $amount, $this->get_price_decimals(), '.', '' );
+	}
+
+	/**
+	 * @param mixed $date Date instance.
+	 * @return string
+	 */
+	private function format_datetime( $date ) {
+		if ( ! $date || ! method_exists( $date, 'format' ) ) {
+			return '';
+		}
+
+		return $date->format( 'c' );
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_now_timestamp() {
+		if ( function_exists( 'current_time' ) ) {
+			return (int) current_time( 'timestamp' );
+		}
+
+		return time();
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
index 8d0c36e9b634b18599d5e317f273cafb58dea92a..6147e223ae90a48f8a6042ca9e6285131b15174c
--- a/src/Intent/Handlers/CustomerLookupHandler.php
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Intent\Handlers;
 
 use AgentWP\AI\Response;
+use AgentWP\Handlers\CustomerHandler;
 use AgentWP\Intent\Intent;
 
 class CustomerLookupHandler extends BaseHandler {
@@ -20,7 +21,81 @@
 	 * @return Response
 	 */
 	public function handle( array $context ): Response {
-		$message = 'I can look up customer profiles. Share an email or name.';
-		return $this->build_response( $context, $message );
+		$query = isset( $context['input'] ) ? (string) $context['input'] : '';
+		$query = trim( $query );
+
+		if ( '' === $query ) {
+			$message = 'I can look up customer profiles. Share an email or customer ID.';
+			return $this->build_response( $context, $message );
+		}
+
+		$email       = $this->extract_email( $query );
+		$customer_id = $this->extract_customer_id( $query );
+		if ( '' !== $email && ! ctype_digit( $query ) ) {
+			$customer_id = 0;
+		}
+
+		if ( '' === $email && 0 === $customer_id ) {
+			$message = 'Share an email address or customer ID to look up their profile.';
+			return $this->build_response( $context, $message );
+		}
+
+		$customer = new CustomerHandler();
+		$result   = $customer->handle(
+			array(
+				'email'       => $email,
+				'customer_id' => $customer_id,
+			)
+		);
+
+		if ( ! $result->is_success() ) {
+			return $result;
+		}
+
+		$data         = $result->get_data();
+		$total_orders = isset( $data['total_orders'] ) ? intval( $data['total_orders'] ) : 0;
+		$message      = 0 === $total_orders
+			? 'I could not find any orders for that customer.'
+			: sprintf( 'Found %d order%s for that customer.', $total_orders, 1 === $total_orders ? '' : 's' );
+
+		return $this->build_response( $context, $message, $data );
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return string
+	 */
+	private function extract_email( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return '';
+		}
+
+		if ( preg_match( '/[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}/i', $query, $matches ) ) {
+			return sanitize_email( $matches[0] );
+		}
+
+		return '';
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return int
+	 */
+	private function extract_customer_id( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return 0;
+		}
+
+		if ( ctype_digit( $query ) ) {
+			return absint( $query );
+		}
+
+		if ( preg_match( '/\b(\d+)\b/', $query, $matches ) ) {
+			return absint( $matches[1] );
+		}
+
+		return 0;
 	}
 }


thinking
**Reviewing and refining customer handling logic**
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/Handlers/CustomerLookupHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 33ms:
<?php
/**
 * Handle customer lookup intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Handlers\CustomerHandler;
use AgentWP\Intent\Intent;

class CustomerLookupHandler extends BaseHandler {
	public function __construct() {
		parent::__construct( Intent::CUSTOMER_LOOKUP );
	}

	/**
	 * @param array $context Context data.
file update:
diff --git a/src/Handlers/CustomerHandler.php b/src/Handlers/CustomerHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fb972f8b8b964729a341a13cfba62d8fcb3236ce
--- /dev/null
+++ b/src/Handlers/CustomerHandler.php
@@ -0,0 +1,696 @@
+<?php
+/**
+ * Handle customer profile requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Handlers;
+
+use AgentWP\AI\Response;
+
+class CustomerHandler {
+	const RECENT_LIMIT = 5;
+	const TOP_LIMIT    = 5;
+	const ORDER_BATCH  = 200;
+
+	/**
+	 * Handle a customer profile request.
+	 *
+	 * @param array $args Request arguments.
+	 * @return Response
+	 */
+	public function handle( array $args ): Response {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return Response::error( 'WooCommerce is required to fetch customer profiles.', 400 );
+		}
+
+		$normalized = $this->normalize_args( $args );
+		if ( 0 === $normalized['customer_id'] && '' === $normalized['email'] ) {
+			return Response::error( 'Provide a customer ID or email address.', 400 );
+		}
+
+		$paid_statuses = $this->get_paid_statuses();
+		$order_ids     = $this->collect_order_ids( $normalized, $paid_statuses );
+		$metrics       = $this->build_metrics( $order_ids );
+		$recent_orders = $this->get_recent_orders( $normalized, $paid_statuses );
+
+		$payload = array_merge(
+			$metrics,
+			array(
+				'customer'          => $this->build_customer_summary( $normalized, $recent_orders ),
+				'health_thresholds' => $this->get_health_thresholds(),
+				'included_statuses' => $paid_statuses,
+				'recent_orders'     => $recent_orders,
+			)
+		);
+
+		return Response::success( $payload );
+	}
+
+	/**
+	 * @param array $args Request args.
+	 * @return array
+	 */
+	private function normalize_args( array $args ) {
+		$email       = isset( $args['email'] ) ? sanitize_email( $args['email'] ) : '';
+		$customer_id = isset( $args['customer_id'] ) ? absint( $args['customer_id'] ) : 0;
+
+		if ( '' === $email && $customer_id > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $customer_id );
+			if ( $user && isset( $user->user_email ) ) {
+				$email = sanitize_email( $user->user_email );
+			}
+		}
+
+		return array(
+			'email'       => $email,
+			'customer_id' => $customer_id,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized request args.
+	 * @param array $statuses Paid statuses.
+	 * @return array
+	 */
+	private function collect_order_ids( array $normalized, array $statuses ) {
+		$order_ids = array();
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'customer' => $normalized['customer_id'],
+						'status'   => $statuses,
+					)
+				)
+			);
+		}
+
+		if ( '' !== $normalized['email'] && 0 === $normalized['customer_id'] ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'billing_email' => $normalized['email'],
+						'status'        => $statuses,
+					)
+				)
+			);
+		}
+
+		$order_ids = array_map( 'absint', $order_ids );
+		$order_ids = array_filter( array_unique( $order_ids ) );
+		sort( $order_ids );
+
+		return $order_ids;
+	}
+
+	/**
+	 * @param array $query_args Query arguments.
+	 * @return array
+	 */
+	private function query_order_ids( array $query_args ) {
+		$ids   = array();
+		$page  = 1;
+		$limit = self::ORDER_BATCH;
+
+		while ( true ) {
+			$args = array_merge(
+				$query_args,
+				array(
+					'limit'  => $limit,
+					'paged'  => $page,
+					'return' => 'ids',
+				)
+			);
+
+			$batch = wc_get_orders( $args );
+			if ( ! is_array( $batch ) || empty( $batch ) ) {
+				break;
+			}
+
+			$ids = array_merge( $ids, $batch );
+
+			if ( count( $batch ) < $limit ) {
+				break;
+			}
+
+			$page++;
+		}
+
+		return $ids;
+	}
+
+	/**
+	 * @param array $order_ids Order IDs to summarize.
+	 * @return array
+	 */
+	private function build_metrics( array $order_ids ) {
+		$total_orders = count( $order_ids );
+		$total_spent  = 0.0;
+		$first_ts     = null;
+		$last_ts      = null;
+		$first_date   = '';
+		$last_date    = '';
+
+		$product_totals  = array();
+		$category_totals = array();
+		$category_cache  = array();
+
+		foreach ( $order_ids as $order_id ) {
+			$order = function_exists( 'wc_get_order' ) ? wc_get_order( $order_id ) : null;
+			if ( ! $order || ! method_exists( $order, 'get_total' ) ) {
+				continue;
+			}
+
+			$total_spent += $this->normalize_amount( $order->get_total() );
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+			if ( $date_created ) {
+				$timestamp = $date_created->getTimestamp();
+				if ( null === $first_ts || $timestamp < $first_ts ) {
+					$first_ts   = $timestamp;
+					$first_date = $this->format_datetime( $date_created );
+				}
+
+				if ( null === $last_ts || $timestamp > $last_ts ) {
+					$last_ts   = $timestamp;
+					$last_date = $this->format_datetime( $date_created );
+				}
+			}
+
+			$this->accumulate_item_totals( $order, $product_totals, $category_totals, $category_cache );
+		}
+
+		$average_order_value = 0.0;
+		if ( $total_orders > 0 ) {
+			$average_order_value = $this->normalize_amount( $total_spent / $total_orders );
+		}
+
+		$days_since_last_order = $this->calculate_days_since( $last_ts );
+		$health_status         = $this->determine_health_status( $days_since_last_order, $total_orders );
+		$ltv_projection         = $this->calculate_ltv_projection( $total_orders, $average_order_value, $first_ts );
+
+		return array(
+			'total_orders'                  => $total_orders,
+			'total_spent'                   => $this->normalize_amount( $total_spent ),
+			'total_spent_formatted'         => $this->format_currency( $total_spent ),
+			'average_order_value'           => $average_order_value,
+			'average_order_value_formatted' => $this->format_currency( $average_order_value ),
+			'first_order_date'              => $first_date,
+			'last_order_date'               => $last_date,
+			'days_since_last_order'         => $days_since_last_order,
+			'favorite_products'             => $this->format_top_products( $product_totals ),
+			'favorite_categories'           => $this->format_top_categories( $category_totals ),
+			'estimated_ltv'                 => $ltv_projection['estimated_ltv'],
+			'estimated_ltv_formatted'       => $this->format_currency( $ltv_projection['estimated_ltv'] ),
+			'ltv_projection'                => $ltv_projection['projection'],
+			'health_status'                 => $health_status,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $recent_orders Recent order summaries.
+	 * @return array
+	 */
+	private function build_customer_summary( array $normalized, array $recent_orders ) {
+		$name  = '';
+		$email = $normalized['email'];
+
+		if ( $normalized['customer_id'] > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $normalized['customer_id'] );
+			if ( $user ) {
+				$first = isset( $user->first_name ) ? $user->first_name : '';
+				$last  = isset( $user->last_name ) ? $user->last_name : '';
+				$name  = trim( $first . ' ' . $last );
+				if ( '' === $name && isset( $user->display_name ) ) {
+					$name = (string) $user->display_name;
+				}
+				if ( '' === $email && isset( $user->user_email ) ) {
+					$email = sanitize_email( $user->user_email );
+				}
+			}
+		}
+
+		if ( '' === $name && ! empty( $recent_orders ) && isset( $recent_orders[0]['customer_name'] ) ) {
+			$name = sanitize_text_field( $recent_orders[0]['customer_name'] );
+		}
+
+		return array(
+			'customer_id' => $normalized['customer_id'],
+			'email'       => $email,
+			'name'        => $name,
+			'is_guest'    => 0 === $normalized['customer_id'],
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $statuses Status list.
+	 * @return array
+	 */
+	private function get_recent_orders( array $normalized, array $statuses ) {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$args = array(
+			'limit'   => self::RECENT_LIMIT,
+			'orderby' => 'date',
+			'order'   => 'DESC',
+			'status'  => $statuses,
+		);
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$args['customer'] = $normalized['customer_id'];
+		} elseif ( '' !== $normalized['email'] ) {
+			$args['billing_email'] = $normalized['email'];
+		}
+
+		$orders = wc_get_orders( $args );
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$recent = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$recent[] = $this->format_order_summary( $order );
+		}
+
+		return $recent;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_order_summary( $order ) {
+		$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+		$total        = method_exists( $order, 'get_total' ) ? $this->normalize_amount( $order->get_total() ) : 0.0;
+
+		return array(
+			'id'              => intval( $order->get_id() ),
+			'status'          => sanitize_text_field( $order->get_status() ),
+			'total'           => $total,
+			'total_formatted' => $this->format_currency( $total ),
+			'currency'        => sanitize_text_field( $order->get_currency() ),
+			'date_created'    => $this->format_datetime( $date_created ),
+			'customer_name'   => $this->get_customer_name( $order ),
+			'customer_email'  => $this->get_customer_email( $order ),
+			'items_summary'   => $this->format_items_summary( $order ),
+		);
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_name( $order ) {
+		$first = method_exists( $order, 'get_billing_first_name' ) ? $order->get_billing_first_name() : '';
+		$last  = method_exists( $order, 'get_billing_last_name' ) ? $order->get_billing_last_name() : '';
+		$name  = trim( $first . ' ' . $last );
+
+		if ( '' === $name && method_exists( $order, 'get_shipping_first_name' ) ) {
+			$first = $order->get_shipping_first_name();
+			$last  = method_exists( $order, 'get_shipping_last_name' ) ? $order->get_shipping_last_name() : '';
+			$name  = trim( $first . ' ' . $last );
+		}
+
+		return sanitize_text_field( $name );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_email( $order ) {
+		$email = method_exists( $order, 'get_billing_email' ) ? $order->get_billing_email() : '';
+		if ( '' === $email && method_exists( $order, 'get_meta' ) ) {
+			$email = $order->get_meta( '_shipping_email' );
+		}
+
+		return sanitize_email( $email );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_items_summary( $order ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return array();
+		}
+
+		$items = $order->get_items();
+		if ( ! is_array( $items ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_name' ) ) {
+				continue;
+			}
+
+			$name = sanitize_text_field( $item->get_name() );
+			$qty  = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+
+			if ( '' === $name ) {
+				continue;
+			}
+
+			$summary[] = array(
+				'name'     => $name,
+				'quantity' => $qty,
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @param array  $product_totals Product totals accumulator.
+	 * @param array  $category_totals Category totals accumulator.
+	 * @param array  $category_cache Category cache.
+	 * @return void
+	 */
+	private function accumulate_item_totals( $order, array &$product_totals, array &$category_totals, array &$category_cache ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return;
+		}
+
+		$items = $order->get_items( 'line_item' );
+		if ( ! is_array( $items ) ) {
+			return;
+		}
+
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_product_id' ) ) {
+				continue;
+			}
+
+			$product_id = absint( $item->get_product_id() );
+			if ( 0 === $product_id ) {
+				continue;
+			}
+
+			$quantity = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+			if ( $quantity < 1 ) {
+				continue;
+			}
+
+			if ( ! isset( $product_totals[ $product_id ] ) ) {
+				$product_totals[ $product_id ] = array(
+					'product_id' => $product_id,
+					'name'       => sanitize_text_field( $item->get_name() ),
+					'quantity'   => 0,
+				);
+			}
+
+			$product_totals[ $product_id ]['quantity'] += $quantity;
+
+			$categories = $this->get_product_categories( $product_id, $category_cache );
+			foreach ( $categories as $term_id => $name ) {
+				if ( ! isset( $category_totals[ $term_id ] ) ) {
+					$category_totals[ $term_id ] = array(
+						'category_id' => $term_id,
+						'name'        => $name,
+						'quantity'    => 0,
+					);
+				}
+
+				$category_totals[ $term_id ]['quantity'] += $quantity;
+			}
+		}
+	}
+
+	/**
+	 * @param int   $product_id Product ID.
+	 * @param array $cache Category cache.
+	 * @return array
+	 */
+	private function get_product_categories( $product_id, array &$cache ) {
+		$product_id = absint( $product_id );
+		if ( 0 === $product_id ) {
+			return array();
+		}
+
+		if ( isset( $cache[ $product_id ] ) ) {
+			return $cache[ $product_id ];
+		}
+
+		$categories = array();
+		if ( function_exists( 'wc_get_product_terms' ) ) {
+			$terms = wc_get_product_terms( $product_id, 'product_cat', array( 'fields' => 'all' ) );
+			if ( is_array( $terms ) ) {
+				foreach ( $terms as $term ) {
+					if ( ! is_object( $term ) || ! isset( $term->term_id ) ) {
+						continue;
+					}
+					$categories[ (int) $term->term_id ] = sanitize_text_field( $term->name );
+				}
+			}
+		}
+
+		$cache[ $product_id ] = $categories;
+
+		return $categories;
+	}
+
+	/**
+	 * @param array $totals Product totals.
+	 * @return array
+	 */
+	private function format_top_products( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param array $totals Category totals.
+	 * @return array
+	 */
+	private function format_top_categories( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param int|null $last_ts Last order timestamp.
+	 * @return int|null
+	 */
+	private function calculate_days_since( $last_ts ) {
+		if ( null === $last_ts ) {
+			return null;
+		}
+
+		$now_ts  = $this->get_now_timestamp();
+		$diff    = max( 0, $now_ts - $last_ts );
+		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+
+		return (int) floor( $diff / $seconds );
+	}
+
+	/**
+	 * Simple 12-month projection based on orders per month and average order value.
+	 *
+	 * @param int      $total_orders Order count.
+	 * @param float    $average_order_value Average order value.
+	 * @param int|null $first_ts First order timestamp.
+	 * @return array
+	 */
+	private function calculate_ltv_projection( $total_orders, $average_order_value, $first_ts ) {
+		$orders_per_month = 0.0;
+		$days_since_first = 0;
+
+		if ( $total_orders > 0 && null !== $first_ts ) {
+			$now_ts  = $this->get_now_timestamp();
+			$diff    = max( 0, $now_ts - $first_ts );
+			$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+			$days_since_first = (int) max( 1, floor( $diff / $seconds ) );
+			$orders_per_month = $total_orders / ( $days_since_first / 30 );
+		}
+
+		$orders_per_month = round( $orders_per_month, 2 );
+		$projection_months = 12;
+		$estimated_ltv = $this->normalize_amount( $average_order_value * $orders_per_month * $projection_months );
+
+		return array(
+			'estimated_ltv' => $estimated_ltv,
+			'projection'    => array(
+				'projection_months'     => $projection_months,
+				'orders_per_month'      => $orders_per_month,
+				'days_since_first_order' => $days_since_first,
+			),
+		);
+	}
+
+	/**
+	 * @param int|null $days_since_last Order recency in days.
+	 * @param int      $total_orders Total orders.
+	 * @return string
+	 */
+	private function determine_health_status( $days_since_last, $total_orders ) {
+		if ( null === $days_since_last || 0 === $total_orders ) {
+			return 'churned';
+		}
+
+		$thresholds = $this->get_health_thresholds();
+
+		if ( $days_since_last <= $thresholds['active'] ) {
+			return 'active';
+		}
+
+		if ( $days_since_last <= $thresholds['at_risk'] ) {
+			return 'at_risk';
+		}
+
+		return 'churned';
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_health_thresholds() {
+		$thresholds = array(
+			'active'  => 60,
+			'at_risk' => 180,
+		);
+
+		if ( function_exists( 'apply_filters' ) ) {
+			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
+		}
+
+		$active  = isset( $thresholds['active'] ) ? absint( $thresholds['active'] ) : 60;
+		$at_risk = isset( $thresholds['at_risk'] ) ? absint( $thresholds['at_risk'] ) : 180;
+
+		if ( $active <= 0 ) {
+			$active = 60;
+		}
+
+		if ( $at_risk <= $active ) {
+			$at_risk = $active + 1;
+		}
+
+		return array(
+			'active'  => $active,
+			'at_risk' => $at_risk,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_paid_statuses() {
+		$statuses = function_exists( 'wc_get_is_paid_statuses' )
+			? wc_get_is_paid_statuses()
+			: array( 'processing', 'completed', 'on-hold' );
+
+		$statuses = array_filter( array_map( 'sanitize_text_field', (array) $statuses ) );
+		if ( empty( $statuses ) ) {
+			return array( 'processing', 'completed', 'on-hold' );
+		}
+
+		return array_values( array_unique( $statuses ) );
+	}
+
+	/**
+	 * @param mixed $amount Amount input.
+	 * @return float
+	 */
+	private function normalize_amount( $amount ) {
+		if ( function_exists( 'wc_format_decimal' ) ) {
+			return (float) wc_format_decimal( $amount, $this->get_price_decimals() );
+		}
+
+		return (float) $amount;
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_price_decimals() {
+		if ( function_exists( 'wc_get_price_decimals' ) ) {
+			return (int) wc_get_price_decimals();
+		}
+
+		return 2;
+	}
+
+	/**
+	 * @param float $value Currency amount.
+	 * @return string
+	 */
+	private function format_currency( $value ) {
+		$amount = $this->normalize_amount( $value );
+		if ( function_exists( 'wc_price' ) ) {
+			return wc_price( $amount );
+		}
+
+		return number_format( $amount, $this->get_price_decimals(), '.', '' );
+	}
+
+	/**
+	 * @param mixed $date Date instance.
+	 * @return string
+	 */
+	private function format_datetime( $date ) {
+		if ( ! $date || ! method_exists( $date, 'format' ) ) {
+			return '';
+		}
+
+		return $date->format( 'c' );
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_now_timestamp() {
+		if ( function_exists( 'current_time' ) ) {
+			return (int) current_time( 'timestamp' );
+		}
+
+		return time();
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
index 8d0c36e9b634b18599d5e317f273cafb58dea92a..6147e223ae90a48f8a6042ca9e6285131b15174c
--- a/src/Intent/Handlers/CustomerLookupHandler.php
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Intent\Handlers;
 
 use AgentWP\AI\Response;
+use AgentWP\Handlers\CustomerHandler;
 use AgentWP\Intent\Intent;
 
 class CustomerLookupHandler extends BaseHandler {
@@ -20,7 +21,81 @@
 	 * @return Response
 	 */
 	public function handle( array $context ): Response {
-		$message = 'I can look up customer profiles. Share an email or name.';
-		return $this->build_response( $context, $message );
+		$query = isset( $context['input'] ) ? (string) $context['input'] : '';
+		$query = trim( $query );
+
+		if ( '' === $query ) {
+			$message = 'I can look up customer profiles. Share an email or customer ID.';
+			return $this->build_response( $context, $message );
+		}
+
+		$email       = $this->extract_email( $query );
+		$customer_id = $this->extract_customer_id( $query );
+		if ( '' !== $email && ! ctype_digit( $query ) ) {
+			$customer_id = 0;
+		}
+
+		if ( '' === $email && 0 === $customer_id ) {
+			$message = 'Share an email address or customer ID to look up their profile.';
+			return $this->build_response( $context, $message );
+		}
+
+		$customer = new CustomerHandler();
+		$result   = $customer->handle(
+			array(
+				'email'       => $email,
+				'customer_id' => $customer_id,
+			)
+		);
+
+		if ( ! $result->is_success() ) {
+			return $result;
+		}
+
+		$data         = $result->get_data();
+		$total_orders = isset( $data['total_orders'] ) ? intval( $data['total_orders'] ) : 0;
+		$message      = 0 === $total_orders
+			? 'I could not find any orders for that customer.'
+			: sprintf( 'Found %d order%s for that customer.', $total_orders, 1 === $total_orders ? '' : 's' );
+
+		return $this->build_response( $context, $message, $data );
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return string
+	 */
+	private function extract_email( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return '';
+		}
+
+		if ( preg_match( '/[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}/i', $query, $matches ) ) {
+			return sanitize_email( $matches[0] );
+		}
+
+		return '';
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return int
+	 */
+	private function extract_customer_id( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return 0;
+		}
+
+		if ( ctype_digit( $query ) ) {
+			return absint( $query );
+		}
+
+		if ( preg_match( '/\b(\d+)\b/', $query, $matches ) ) {
+			return absint( $matches[1] );
+		}
+
+		return 0;
 	}
 }


thinking
**Preparing final response structure**

I’m organizing a clear summary with status, detailed change list, verification notes, and risks or follow-ups—making sure to mention the new health thresholds filter and rationale for handling email versus customer ID in lookups. Now I’ll draft the final message with all these points covered.
codex
Implemented customer LTV profiling with batched order aggregation and wired the customer lookup intent to return those profiles.

Status: DONE

Summary of changes:
- Added `src/Handlers/CustomerHandler.php` to compute totals, AOV, favorites, LTV projection, health status (via `agentwp_customer_health_thresholds`), and recent order summaries with guest email lookup.
- Updated `src/Intent/Handlers/CustomerLookupHandler.php` to extract email/ID from prompts and return CustomerHandler results.

How to verify:
- Not provided (no format/lint/test commands listed).

Risks / follow-ups:
- LTV is a simple 12‑month projection based on order frequency and AOV; adjust the formula or included statuses if you want a different horizon.
- Customer ID + email inputs prioritize ID; merge both if you want guest and registered orders combined.
file update:
diff --git a/src/Handlers/CustomerHandler.php b/src/Handlers/CustomerHandler.php
new file mode 100644
index 0000000000000000000000000000000000000000..fb972f8b8b964729a341a13cfba62d8fcb3236ce
--- /dev/null
+++ b/src/Handlers/CustomerHandler.php
@@ -0,0 +1,696 @@
+<?php
+/**
+ * Handle customer profile requests.
+ *
+ * @package AgentWP
+ */
+
+namespace AgentWP\Handlers;
+
+use AgentWP\AI\Response;
+
+class CustomerHandler {
+	const RECENT_LIMIT = 5;
+	const TOP_LIMIT    = 5;
+	const ORDER_BATCH  = 200;
+
+	/**
+	 * Handle a customer profile request.
+	 *
+	 * @param array $args Request arguments.
+	 * @return Response
+	 */
+	public function handle( array $args ): Response {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return Response::error( 'WooCommerce is required to fetch customer profiles.', 400 );
+		}
+
+		$normalized = $this->normalize_args( $args );
+		if ( 0 === $normalized['customer_id'] && '' === $normalized['email'] ) {
+			return Response::error( 'Provide a customer ID or email address.', 400 );
+		}
+
+		$paid_statuses = $this->get_paid_statuses();
+		$order_ids     = $this->collect_order_ids( $normalized, $paid_statuses );
+		$metrics       = $this->build_metrics( $order_ids );
+		$recent_orders = $this->get_recent_orders( $normalized, $paid_statuses );
+
+		$payload = array_merge(
+			$metrics,
+			array(
+				'customer'          => $this->build_customer_summary( $normalized, $recent_orders ),
+				'health_thresholds' => $this->get_health_thresholds(),
+				'included_statuses' => $paid_statuses,
+				'recent_orders'     => $recent_orders,
+			)
+		);
+
+		return Response::success( $payload );
+	}
+
+	/**
+	 * @param array $args Request args.
+	 * @return array
+	 */
+	private function normalize_args( array $args ) {
+		$email       = isset( $args['email'] ) ? sanitize_email( $args['email'] ) : '';
+		$customer_id = isset( $args['customer_id'] ) ? absint( $args['customer_id'] ) : 0;
+
+		if ( '' === $email && $customer_id > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $customer_id );
+			if ( $user && isset( $user->user_email ) ) {
+				$email = sanitize_email( $user->user_email );
+			}
+		}
+
+		return array(
+			'email'       => $email,
+			'customer_id' => $customer_id,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized request args.
+	 * @param array $statuses Paid statuses.
+	 * @return array
+	 */
+	private function collect_order_ids( array $normalized, array $statuses ) {
+		$order_ids = array();
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'customer' => $normalized['customer_id'],
+						'status'   => $statuses,
+					)
+				)
+			);
+		}
+
+		if ( '' !== $normalized['email'] && 0 === $normalized['customer_id'] ) {
+			$order_ids = array_merge(
+				$order_ids,
+				$this->query_order_ids(
+					array(
+						'billing_email' => $normalized['email'],
+						'status'        => $statuses,
+					)
+				)
+			);
+		}
+
+		$order_ids = array_map( 'absint', $order_ids );
+		$order_ids = array_filter( array_unique( $order_ids ) );
+		sort( $order_ids );
+
+		return $order_ids;
+	}
+
+	/**
+	 * @param array $query_args Query arguments.
+	 * @return array
+	 */
+	private function query_order_ids( array $query_args ) {
+		$ids   = array();
+		$page  = 1;
+		$limit = self::ORDER_BATCH;
+
+		while ( true ) {
+			$args = array_merge(
+				$query_args,
+				array(
+					'limit'  => $limit,
+					'paged'  => $page,
+					'return' => 'ids',
+				)
+			);
+
+			$batch = wc_get_orders( $args );
+			if ( ! is_array( $batch ) || empty( $batch ) ) {
+				break;
+			}
+
+			$ids = array_merge( $ids, $batch );
+
+			if ( count( $batch ) < $limit ) {
+				break;
+			}
+
+			$page++;
+		}
+
+		return $ids;
+	}
+
+	/**
+	 * @param array $order_ids Order IDs to summarize.
+	 * @return array
+	 */
+	private function build_metrics( array $order_ids ) {
+		$total_orders = count( $order_ids );
+		$total_spent  = 0.0;
+		$first_ts     = null;
+		$last_ts      = null;
+		$first_date   = '';
+		$last_date    = '';
+
+		$product_totals  = array();
+		$category_totals = array();
+		$category_cache  = array();
+
+		foreach ( $order_ids as $order_id ) {
+			$order = function_exists( 'wc_get_order' ) ? wc_get_order( $order_id ) : null;
+			if ( ! $order || ! method_exists( $order, 'get_total' ) ) {
+				continue;
+			}
+
+			$total_spent += $this->normalize_amount( $order->get_total() );
+
+			$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+			if ( $date_created ) {
+				$timestamp = $date_created->getTimestamp();
+				if ( null === $first_ts || $timestamp < $first_ts ) {
+					$first_ts   = $timestamp;
+					$first_date = $this->format_datetime( $date_created );
+				}
+
+				if ( null === $last_ts || $timestamp > $last_ts ) {
+					$last_ts   = $timestamp;
+					$last_date = $this->format_datetime( $date_created );
+				}
+			}
+
+			$this->accumulate_item_totals( $order, $product_totals, $category_totals, $category_cache );
+		}
+
+		$average_order_value = 0.0;
+		if ( $total_orders > 0 ) {
+			$average_order_value = $this->normalize_amount( $total_spent / $total_orders );
+		}
+
+		$days_since_last_order = $this->calculate_days_since( $last_ts );
+		$health_status         = $this->determine_health_status( $days_since_last_order, $total_orders );
+		$ltv_projection         = $this->calculate_ltv_projection( $total_orders, $average_order_value, $first_ts );
+
+		return array(
+			'total_orders'                  => $total_orders,
+			'total_spent'                   => $this->normalize_amount( $total_spent ),
+			'total_spent_formatted'         => $this->format_currency( $total_spent ),
+			'average_order_value'           => $average_order_value,
+			'average_order_value_formatted' => $this->format_currency( $average_order_value ),
+			'first_order_date'              => $first_date,
+			'last_order_date'               => $last_date,
+			'days_since_last_order'         => $days_since_last_order,
+			'favorite_products'             => $this->format_top_products( $product_totals ),
+			'favorite_categories'           => $this->format_top_categories( $category_totals ),
+			'estimated_ltv'                 => $ltv_projection['estimated_ltv'],
+			'estimated_ltv_formatted'       => $this->format_currency( $ltv_projection['estimated_ltv'] ),
+			'ltv_projection'                => $ltv_projection['projection'],
+			'health_status'                 => $health_status,
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $recent_orders Recent order summaries.
+	 * @return array
+	 */
+	private function build_customer_summary( array $normalized, array $recent_orders ) {
+		$name  = '';
+		$email = $normalized['email'];
+
+		if ( $normalized['customer_id'] > 0 && function_exists( 'get_userdata' ) ) {
+			$user = get_userdata( $normalized['customer_id'] );
+			if ( $user ) {
+				$first = isset( $user->first_name ) ? $user->first_name : '';
+				$last  = isset( $user->last_name ) ? $user->last_name : '';
+				$name  = trim( $first . ' ' . $last );
+				if ( '' === $name && isset( $user->display_name ) ) {
+					$name = (string) $user->display_name;
+				}
+				if ( '' === $email && isset( $user->user_email ) ) {
+					$email = sanitize_email( $user->user_email );
+				}
+			}
+		}
+
+		if ( '' === $name && ! empty( $recent_orders ) && isset( $recent_orders[0]['customer_name'] ) ) {
+			$name = sanitize_text_field( $recent_orders[0]['customer_name'] );
+		}
+
+		return array(
+			'customer_id' => $normalized['customer_id'],
+			'email'       => $email,
+			'name'        => $name,
+			'is_guest'    => 0 === $normalized['customer_id'],
+		);
+	}
+
+	/**
+	 * @param array $normalized Normalized args.
+	 * @param array $statuses Status list.
+	 * @return array
+	 */
+	private function get_recent_orders( array $normalized, array $statuses ) {
+		if ( ! function_exists( 'wc_get_orders' ) ) {
+			return array();
+		}
+
+		$args = array(
+			'limit'   => self::RECENT_LIMIT,
+			'orderby' => 'date',
+			'order'   => 'DESC',
+			'status'  => $statuses,
+		);
+
+		if ( $normalized['customer_id'] > 0 ) {
+			$args['customer'] = $normalized['customer_id'];
+		} elseif ( '' !== $normalized['email'] ) {
+			$args['billing_email'] = $normalized['email'];
+		}
+
+		$orders = wc_get_orders( $args );
+		if ( ! is_array( $orders ) ) {
+			return array();
+		}
+
+		$recent = array();
+		foreach ( $orders as $order ) {
+			if ( ! is_object( $order ) || ! method_exists( $order, 'get_id' ) ) {
+				continue;
+			}
+
+			$recent[] = $this->format_order_summary( $order );
+		}
+
+		return $recent;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_order_summary( $order ) {
+		$date_created = method_exists( $order, 'get_date_created' ) ? $order->get_date_created() : null;
+		$total        = method_exists( $order, 'get_total' ) ? $this->normalize_amount( $order->get_total() ) : 0.0;
+
+		return array(
+			'id'              => intval( $order->get_id() ),
+			'status'          => sanitize_text_field( $order->get_status() ),
+			'total'           => $total,
+			'total_formatted' => $this->format_currency( $total ),
+			'currency'        => sanitize_text_field( $order->get_currency() ),
+			'date_created'    => $this->format_datetime( $date_created ),
+			'customer_name'   => $this->get_customer_name( $order ),
+			'customer_email'  => $this->get_customer_email( $order ),
+			'items_summary'   => $this->format_items_summary( $order ),
+		);
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_name( $order ) {
+		$first = method_exists( $order, 'get_billing_first_name' ) ? $order->get_billing_first_name() : '';
+		$last  = method_exists( $order, 'get_billing_last_name' ) ? $order->get_billing_last_name() : '';
+		$name  = trim( $first . ' ' . $last );
+
+		if ( '' === $name && method_exists( $order, 'get_shipping_first_name' ) ) {
+			$first = $order->get_shipping_first_name();
+			$last  = method_exists( $order, 'get_shipping_last_name' ) ? $order->get_shipping_last_name() : '';
+			$name  = trim( $first . ' ' . $last );
+		}
+
+		return sanitize_text_field( $name );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return string
+	 */
+	private function get_customer_email( $order ) {
+		$email = method_exists( $order, 'get_billing_email' ) ? $order->get_billing_email() : '';
+		if ( '' === $email && method_exists( $order, 'get_meta' ) ) {
+			$email = $order->get_meta( '_shipping_email' );
+		}
+
+		return sanitize_email( $email );
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @return array
+	 */
+	private function format_items_summary( $order ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return array();
+		}
+
+		$items = $order->get_items();
+		if ( ! is_array( $items ) ) {
+			return array();
+		}
+
+		$summary = array();
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_name' ) ) {
+				continue;
+			}
+
+			$name = sanitize_text_field( $item->get_name() );
+			$qty  = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+
+			if ( '' === $name ) {
+				continue;
+			}
+
+			$summary[] = array(
+				'name'     => $name,
+				'quantity' => $qty,
+			);
+		}
+
+		return $summary;
+	}
+
+	/**
+	 * @param object $order Order instance.
+	 * @param array  $product_totals Product totals accumulator.
+	 * @param array  $category_totals Category totals accumulator.
+	 * @param array  $category_cache Category cache.
+	 * @return void
+	 */
+	private function accumulate_item_totals( $order, array &$product_totals, array &$category_totals, array &$category_cache ) {
+		if ( ! method_exists( $order, 'get_items' ) ) {
+			return;
+		}
+
+		$items = $order->get_items( 'line_item' );
+		if ( ! is_array( $items ) ) {
+			return;
+		}
+
+		foreach ( $items as $item ) {
+			if ( ! is_object( $item ) || ! method_exists( $item, 'get_product_id' ) ) {
+				continue;
+			}
+
+			$product_id = absint( $item->get_product_id() );
+			if ( 0 === $product_id ) {
+				continue;
+			}
+
+			$quantity = method_exists( $item, 'get_quantity' ) ? intval( $item->get_quantity() ) : 1;
+			if ( $quantity < 1 ) {
+				continue;
+			}
+
+			if ( ! isset( $product_totals[ $product_id ] ) ) {
+				$product_totals[ $product_id ] = array(
+					'product_id' => $product_id,
+					'name'       => sanitize_text_field( $item->get_name() ),
+					'quantity'   => 0,
+				);
+			}
+
+			$product_totals[ $product_id ]['quantity'] += $quantity;
+
+			$categories = $this->get_product_categories( $product_id, $category_cache );
+			foreach ( $categories as $term_id => $name ) {
+				if ( ! isset( $category_totals[ $term_id ] ) ) {
+					$category_totals[ $term_id ] = array(
+						'category_id' => $term_id,
+						'name'        => $name,
+						'quantity'    => 0,
+					);
+				}
+
+				$category_totals[ $term_id ]['quantity'] += $quantity;
+			}
+		}
+	}
+
+	/**
+	 * @param int   $product_id Product ID.
+	 * @param array $cache Category cache.
+	 * @return array
+	 */
+	private function get_product_categories( $product_id, array &$cache ) {
+		$product_id = absint( $product_id );
+		if ( 0 === $product_id ) {
+			return array();
+		}
+
+		if ( isset( $cache[ $product_id ] ) ) {
+			return $cache[ $product_id ];
+		}
+
+		$categories = array();
+		if ( function_exists( 'wc_get_product_terms' ) ) {
+			$terms = wc_get_product_terms( $product_id, 'product_cat', array( 'fields' => 'all' ) );
+			if ( is_array( $terms ) ) {
+				foreach ( $terms as $term ) {
+					if ( ! is_object( $term ) || ! isset( $term->term_id ) ) {
+						continue;
+					}
+					$categories[ (int) $term->term_id ] = sanitize_text_field( $term->name );
+				}
+			}
+		}
+
+		$cache[ $product_id ] = $categories;
+
+		return $categories;
+	}
+
+	/**
+	 * @param array $totals Product totals.
+	 * @return array
+	 */
+	private function format_top_products( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param array $totals Category totals.
+	 * @return array
+	 */
+	private function format_top_categories( array $totals ) {
+		if ( empty( $totals ) ) {
+			return array();
+		}
+
+		usort(
+			$totals,
+			function ( $left, $right ) {
+				$left_qty  = isset( $left['quantity'] ) ? (int) $left['quantity'] : 0;
+				$right_qty = isset( $right['quantity'] ) ? (int) $right['quantity'] : 0;
+				if ( $left_qty === $right_qty ) {
+					return 0;
+				}
+
+				return ( $left_qty > $right_qty ) ? -1 : 1;
+			}
+		);
+
+		return array_slice( array_values( $totals ), 0, self::TOP_LIMIT );
+	}
+
+	/**
+	 * @param int|null $last_ts Last order timestamp.
+	 * @return int|null
+	 */
+	private function calculate_days_since( $last_ts ) {
+		if ( null === $last_ts ) {
+			return null;
+		}
+
+		$now_ts  = $this->get_now_timestamp();
+		$diff    = max( 0, $now_ts - $last_ts );
+		$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+
+		return (int) floor( $diff / $seconds );
+	}
+
+	/**
+	 * Simple 12-month projection based on orders per month and average order value.
+	 *
+	 * @param int      $total_orders Order count.
+	 * @param float    $average_order_value Average order value.
+	 * @param int|null $first_ts First order timestamp.
+	 * @return array
+	 */
+	private function calculate_ltv_projection( $total_orders, $average_order_value, $first_ts ) {
+		$orders_per_month = 0.0;
+		$days_since_first = 0;
+
+		if ( $total_orders > 0 && null !== $first_ts ) {
+			$now_ts  = $this->get_now_timestamp();
+			$diff    = max( 0, $now_ts - $first_ts );
+			$seconds = defined( 'DAY_IN_SECONDS' ) ? DAY_IN_SECONDS : 86400;
+			$days_since_first = (int) max( 1, floor( $diff / $seconds ) );
+			$orders_per_month = $total_orders / ( $days_since_first / 30 );
+		}
+
+		$orders_per_month = round( $orders_per_month, 2 );
+		$projection_months = 12;
+		$estimated_ltv = $this->normalize_amount( $average_order_value * $orders_per_month * $projection_months );
+
+		return array(
+			'estimated_ltv' => $estimated_ltv,
+			'projection'    => array(
+				'projection_months'     => $projection_months,
+				'orders_per_month'      => $orders_per_month,
+				'days_since_first_order' => $days_since_first,
+			),
+		);
+	}
+
+	/**
+	 * @param int|null $days_since_last Order recency in days.
+	 * @param int      $total_orders Total orders.
+	 * @return string
+	 */
+	private function determine_health_status( $days_since_last, $total_orders ) {
+		if ( null === $days_since_last || 0 === $total_orders ) {
+			return 'churned';
+		}
+
+		$thresholds = $this->get_health_thresholds();
+
+		if ( $days_since_last <= $thresholds['active'] ) {
+			return 'active';
+		}
+
+		if ( $days_since_last <= $thresholds['at_risk'] ) {
+			return 'at_risk';
+		}
+
+		return 'churned';
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_health_thresholds() {
+		$thresholds = array(
+			'active'  => 60,
+			'at_risk' => 180,
+		);
+
+		if ( function_exists( 'apply_filters' ) ) {
+			$thresholds = apply_filters( 'agentwp_customer_health_thresholds', $thresholds );
+		}
+
+		$active  = isset( $thresholds['active'] ) ? absint( $thresholds['active'] ) : 60;
+		$at_risk = isset( $thresholds['at_risk'] ) ? absint( $thresholds['at_risk'] ) : 180;
+
+		if ( $active <= 0 ) {
+			$active = 60;
+		}
+
+		if ( $at_risk <= $active ) {
+			$at_risk = $active + 1;
+		}
+
+		return array(
+			'active'  => $active,
+			'at_risk' => $at_risk,
+		);
+	}
+
+	/**
+	 * @return array
+	 */
+	private function get_paid_statuses() {
+		$statuses = function_exists( 'wc_get_is_paid_statuses' )
+			? wc_get_is_paid_statuses()
+			: array( 'processing', 'completed', 'on-hold' );
+
+		$statuses = array_filter( array_map( 'sanitize_text_field', (array) $statuses ) );
+		if ( empty( $statuses ) ) {
+			return array( 'processing', 'completed', 'on-hold' );
+		}
+
+		return array_values( array_unique( $statuses ) );
+	}
+
+	/**
+	 * @param mixed $amount Amount input.
+	 * @return float
+	 */
+	private function normalize_amount( $amount ) {
+		if ( function_exists( 'wc_format_decimal' ) ) {
+			return (float) wc_format_decimal( $amount, $this->get_price_decimals() );
+		}
+
+		return (float) $amount;
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_price_decimals() {
+		if ( function_exists( 'wc_get_price_decimals' ) ) {
+			return (int) wc_get_price_decimals();
+		}
+
+		return 2;
+	}
+
+	/**
+	 * @param float $value Currency amount.
+	 * @return string
+	 */
+	private function format_currency( $value ) {
+		$amount = $this->normalize_amount( $value );
+		if ( function_exists( 'wc_price' ) ) {
+			return wc_price( $amount );
+		}
+
+		return number_format( $amount, $this->get_price_decimals(), '.', '' );
+	}
+
+	/**
+	 * @param mixed $date Date instance.
+	 * @return string
+	 */
+	private function format_datetime( $date ) {
+		if ( ! $date || ! method_exists( $date, 'format' ) ) {
+			return '';
+		}
+
+		return $date->format( 'c' );
+	}
+
+	/**
+	 * @return int
+	 */
+	private function get_now_timestamp() {
+		if ( function_exists( 'current_time' ) ) {
+			return (int) current_time( 'timestamp' );
+		}
+
+		return time();
+	}
+}
diff --git a/src/Intent/Handlers/CustomerLookupHandler.php b/src/Intent/Handlers/CustomerLookupHandler.php
index 8d0c36e9b634b18599d5e317f273cafb58dea92a..6147e223ae90a48f8a6042ca9e6285131b15174c
--- a/src/Intent/Handlers/CustomerLookupHandler.php
+++ b/src/Intent/Handlers/CustomerLookupHandler.php
@@ -8,6 +8,7 @@
 namespace AgentWP\Intent\Handlers;
 
 use AgentWP\AI\Response;
+use AgentWP\Handlers\CustomerHandler;
 use AgentWP\Intent\Intent;
 
 class CustomerLookupHandler extends BaseHandler {
@@ -20,7 +21,81 @@
 	 * @return Response
 	 */
 	public function handle( array $context ): Response {
-		$message = 'I can look up customer profiles. Share an email or name.';
-		return $this->build_response( $context, $message );
+		$query = isset( $context['input'] ) ? (string) $context['input'] : '';
+		$query = trim( $query );
+
+		if ( '' === $query ) {
+			$message = 'I can look up customer profiles. Share an email or customer ID.';
+			return $this->build_response( $context, $message );
+		}
+
+		$email       = $this->extract_email( $query );
+		$customer_id = $this->extract_customer_id( $query );
+		if ( '' !== $email && ! ctype_digit( $query ) ) {
+			$customer_id = 0;
+		}
+
+		if ( '' === $email && 0 === $customer_id ) {
+			$message = 'Share an email address or customer ID to look up their profile.';
+			return $this->build_response( $context, $message );
+		}
+
+		$customer = new CustomerHandler();
+		$result   = $customer->handle(
+			array(
+				'email'       => $email,
+				'customer_id' => $customer_id,
+			)
+		);
+
+		if ( ! $result->is_success() ) {
+			return $result;
+		}
+
+		$data         = $result->get_data();
+		$total_orders = isset( $data['total_orders'] ) ? intval( $data['total_orders'] ) : 0;
+		$message      = 0 === $total_orders
+			? 'I could not find any orders for that customer.'
+			: sprintf( 'Found %d order%s for that customer.', $total_orders, 1 === $total_orders ? '' : 's' );
+
+		return $this->build_response( $context, $message, $data );
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return string
+	 */
+	private function extract_email( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return '';
+		}
+
+		if ( preg_match( '/[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}/i', $query, $matches ) ) {
+			return sanitize_email( $matches[0] );
+		}
+
+		return '';
+	}
+
+	/**
+	 * @param string $query Raw query.
+	 * @return int
+	 */
+	private function extract_customer_id( $query ) {
+		$query = trim( (string) $query );
+		if ( '' === $query ) {
+			return 0;
+		}
+
+		if ( ctype_digit( $query ) ) {
+			return absint( $query );
+		}
+
+		if ( preg_match( '/\b(\d+)\b/', $query, $matches ) ) {
+			return absint( $matches[1] );
+		}
+
+		return 0;
 	}
 }

tokens used
132,952
