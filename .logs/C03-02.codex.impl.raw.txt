**Status**
- DONE

**Summary of changes**
- Added `ToolSuggestionProvider` and wired `AbstractAgenticHandler` to surface tool suggestions directly from handler tool lists.
- Updated `Engine`/`FunctionRegistry` to derive default suggestions from handlers and filter them against the `ToolRegistry`, with the service provider passing the registry through.
- Added unit coverage for derived/filtered suggestions and refreshed documentation to reflect the tool-driven strategy.

**How to verify**
- Not run (no verification commands provided).
- Optional: `vendor/bin/phpunit --filter FunctionRegistryTest`

**Risks / follow-ups**
- Suggestions are now filtered to registered tools; extensions that only used legacy hooks without registering tool schemas may see fewer suggestions.
- Custom handlers that do not implement `ToolSuggestionProvider` will no longer receive default suggestions unless they use the legacy hooks.

OpenAI Codex v0.87.0 (research preview)
--------
workdir: /Users/ahmedyounis/Documents/Projects/agentwp
model: gpt-5.2-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019bd1e5-b942-7a52-989b-6de02b6bb3a9
--------
user
You are implementing task C03-02 in this git repository.

1) Read the spec: .plans/C03-02.md
2) Read handoff/context: .t2/handoff/C03-02.md

Implement the spec fully.

Verification commands (run if non-empty):
- format: 
- lint: 
- test: 

In your final response, include:
- Status: DONE or NEEDS-REVIEW
- Summary of changes
- How to verify (exact commands)
- Risks / follow-ups

mcp startup: no servers

thinking
**Preparing to read files with shell commands**
exec
/bin/zsh -lc ls in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 37ms:
agentwp.php
assets
composer.json
composer.lock
docker
docker-compose.demo.yml
docker-compose.yml
docs
includes
languages
node_modules
package-lock.json
package.json
phpcs.xml
phpstan
phpstan.neon
phpunit.xml.dist
plan_tasks.csv
playwright.config.cjs
react
exec
/bin/zsh -lc 'cat .plans/C03-02.md' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 69ms:
# C03-02 — Resolve FunctionRegistry vs ToolRegistry strategy

Choose and implement a strategy: Option A keep `src/Intent/FunctionRegistry.php` as legacy suggestions; Option B replace it with a tool-driven suggestion system (e.g., `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists). Update docs and tests; keep backward compatibility for extension hooks where possible.
exec
/bin/zsh -lc 'cat .t2/handoff/C03-02.md' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 68ms:
# Handoff: C03-02

Created: 2026-01-18T16:17:31.947120Z

Spec: .plans/C03-02.md

thinking
**Locating function registry**
exec
/bin/zsh -lc 'rg -n "FunctionRegistry|ToolRegistry|suggest" src includes docs tests react' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 61ms:
docs/openapi.json:539:          "function_suggestions": {
react/src/features/command-deck/TypeaheadDropdown.tsx:84:      aria-label="Search suggestions"
docs/DEVELOPER.md:371:Override the default intent-to-function mapping (function suggestions only).
docs/DEVELOPER.md:372:This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
docs/DEVELOPER.md:384:Register additional function suggestions after defaults are registered.
docs/DEVELOPER.md:391:  AgentWP\Intent\FunctionRegistry $registry,
docs/DEVELOPER.md:459:use AgentWP\Contracts\ToolRegistryInterface;
docs/DEVELOPER.md:472:		ToolRegistryInterface $toolRegistry,
docs/DEVELOPER.md:536:use AgentWP\Contracts\ToolRegistryInterface;
docs/DEVELOPER.md:547:				$c->get( ToolRegistryInterface::class )
docs/DEVELOPER.md:622:- [ ] Register the schema in `IntentServiceProvider::registerToolRegistry()`.
react/src/types/api.ts:496:      function_suggestions?: string[];
docs/EXTENSIONS.md:33:- **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
docs/EXTENSIONS.md:36:- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
docs/EXTENSIONS.md:38:If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
docs/EXTENSIONS.md:115:Register custom function suggestions (legacy) that are surfaced in response payloads.
docs/EXTENSIONS.md:116:This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
docs/EXTENSIONS.md:124:- `FunctionRegistry $registry` — Registry for AI functions
docs/EXTENSIONS.md:138:Customize which function suggestions are associated with each intent.
docs/EXTENSIONS.md:139:This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.

thinking
**Evaluating option complexity**

I'm reviewing FunctionRegistry and Engine to assess which option, A or B, fits better based on their usage and implementation complexity.
exec
/bin/zsh -lc "sed -n '1,220p' src/Intent/FunctionRegistry.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 71ms:
<?php
/**
 * OpenAI function registry for intent handlers.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

class FunctionRegistry {
	/**
	 * @var array<string, Handler>
	 */
	private $map = array();

	/**
	 * @param string  $function_name OpenAI function name.
	 * @param Handler $handler Handler instance.
	 * @return void
	 */

thinking
**Reviewing function registry usage**

FunctionRegistry provides function names per intent from a mapping of function names to handlers; next, I'll verify how IntentServiceProvider registers this registry.
exec
/bin/zsh -lc "sed -n '1,260p' src/Providers/IntentServiceProvider.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 68ms:
<?php
/**
 * Intent service provider.
 *
 * @package AgentWP\Providers
 */

namespace AgentWP\Providers;

use AgentWP\AI\Functions\ConfirmRefund;
use AgentWP\AI\Functions\ConfirmStatusUpdate;
use AgentWP\AI\Functions\ConfirmStockUpdate;
use AgentWP\AI\Functions\DraftEmail;
use AgentWP\AI\Functions\GetCustomerProfile;
use AgentWP\AI\Functions\GetSalesReport;
use AgentWP\AI\Functions\PrepareBulkStatusUpdate;
use AgentWP\AI\Functions\PrepareRefund;
use AgentWP\AI\Functions\PrepareStatusUpdate;
use AgentWP\AI\Functions\PrepareStockUpdate;
use AgentWP\AI\Functions\SearchOrders;
exec
/bin/zsh -lc "sed -n '260,620p' src/Providers/IntentServiceProvider.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 72ms:
		);
	}

	/**
	 * Register tool dispatcher with all executable tools.
	 *
	 * Pre-registers order tools centrally so handlers can use them
	 * without defining inline executors.
	 *
	 * @return void
	 */
	private function registerToolDispatcher(): void {
		if ( ! class_exists( ToolDispatcher::class ) ) {
			return;
		}

		$this->container->singleton(
			ToolDispatcherInterface::class,
			function ( $c ) {
				$dispatcher = new ToolDispatcher(

thinking
**Planning tool-driven suggestion system**

I'm deciding to implement a new class for tool-driven suggestions, possibly inheriting from the existing registry and incorporating handler tool lists, while ensuring backward compatibility and updating docs and tests. Next, I'll inspect the Engine to inform this strategy.
exec
/bin/zsh -lc "sed -n '1,240p' src/Intent/Engine.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 69ms:
<?php
/**
 * Intent engine for routing requests.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

use AgentWP\AI\Response;
use AgentWP\Contracts\ContextBuilderInterface;
use AgentWP\Contracts\HooksInterface;
use AgentWP\Contracts\IntentClassifierInterface;
use AgentWP\Contracts\MemoryStoreInterface;

class Engine {
	/**
	 * @var IntentClassifierInterface
	 */
	private $classifier;

thinking
**Evaluating FunctionRegistry replacement**

I'm comparing keeping FunctionRegistry versus replacing it with a tool-driven suggestion system that leverages handlers' tool lists. Next, I'll inspect handler implementations like OrderSearchHandler to check how getToolNames works and inform the new approach.
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/Handlers/AbstractAgenticHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 61ms:
<?php
/**
 * Abstract base class for agentic intent handlers.
 *
 * Encapsulates the common agentic loop pattern used by all AI-powered handlers.
 *
 * @package AgentWP\Intent\Handlers
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Config\AgentWPConfig;
use AgentWP\Contracts\AIClientFactoryInterface;
use AgentWP\Contracts\OpenAIClientInterface;
use AgentWP\Contracts\ToolDispatcherInterface;
use AgentWP\Contracts\ToolRegistryInterface;
use AgentWP\Intent\ToolDispatcher;

/**

thinking
**Inspecting function registration in engine**

I'm checking the Engine class for the register_default_functions method to understand how functions are mapped to handlers and how that connects to tool suggestions.
exec
/bin/zsh -lc 'rg -n "register_default_functions|function" src/Intent/Engine.php src/Intent/FunctionRegistry.php' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 70ms:
src/Intent/FunctionRegistry.php:3: * OpenAI function registry for intent handlers.
src/Intent/FunctionRegistry.php:17:	 * @param string  $function_name OpenAI function name.
src/Intent/FunctionRegistry.php:21:	public function register( $function_name, Handler $handler ) {
src/Intent/FunctionRegistry.php:22:		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
src/Intent/FunctionRegistry.php:23:		if ( '' === $function_name ) {
src/Intent/FunctionRegistry.php:27:		$this->map[ $function_name ] = $handler;
src/Intent/FunctionRegistry.php:31:	 * @param string $function_name OpenAI function name.
src/Intent/FunctionRegistry.php:34:	public function get_handler( $function_name ) {
src/Intent/FunctionRegistry.php:35:		$function_name = is_string( $function_name ) ? trim( $function_name ) : '';
src/Intent/FunctionRegistry.php:36:		if ( '' === $function_name ) {
src/Intent/FunctionRegistry.php:40:		return isset( $this->map[ $function_name ] ) ? $this->map[ $function_name ] : null;
src/Intent/FunctionRegistry.php:47:	public function get_functions_for_intent( $intent ) {
src/Intent/FunctionRegistry.php:51:		foreach ( $this->map as $function_name => $handler ) {
src/Intent/FunctionRegistry.php:53:				$names[] = $function_name;
src/Intent/FunctionRegistry.php:65:	public function all() {
src/Intent/Engine.php:35:	private $function_registry;
src/Intent/Engine.php:58:	 * @param FunctionRegistry          $function_registry Function registry.
src/Intent/Engine.php:66:	public function __construct(
src/Intent/Engine.php:68:		FunctionRegistry $function_registry,
src/Intent/Engine.php:79:		$this->function_registry = $function_registry;
exec
/bin/zsh -lc "sed -n '230,330p' src/Intent/Engine.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 64ms:
		if ( ! $response->is_success() ) {
			return $response->get_message();
		}

		$data = $response->get_data();
		if ( is_array( $data ) && isset( $data['message'] ) ) {
			return (string) $data['message'];
		}

		return '';
	}

	/**
	 * Register default functions with their associated handlers.
	 *
	 * @return void
	 */
	private function register_default_functions(): void {
		$mapping = array(
			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),


thinking
**Planning tool-driven suggestion integration**

FunctionRegistry is separate from the tool registry and includes possibly outdated function names; to follow spec Option B, I'll replace suggestion logic with a tool-driven system based on ToolSuggestionRegistry derived from the tool registry and handlers. I'll maintain backward compatibility by keeping FunctionRegistry as an adapter layer that supports existing extension hooks while routing suggestions through the new tool-based system.
thinking
**Designing ToolSuggestionRegistry with hook adaptation**

I'll create a ToolSuggestionRegistry that gathers suggestions by intent and adapt existing extension hooks to modify its suggestions, implementing FunctionRegistry as a thin wrapper for backward compatibility while shifting core logic to the new system. Next, I'll examine the HooksInterface and locate existing hook usages to integrate filter applications properly.
exec
/bin/zsh -lc 'rg -n "agentwp_register_intent_functions|agentwp_default_function_mapping" -S src docs tests' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 80ms:
docs/DEVELOPER.md:370:### `agentwp_default_function_mapping`
docs/DEVELOPER.md:377:  'agentwp_default_function_mapping',
docs/DEVELOPER.md:383:### `agentwp_register_intent_functions`
docs/DEVELOPER.md:390:  'agentwp_register_intent_functions',
docs/DEVELOPER.md:627:- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
docs/ARCHITECTURE-IMPROVEMENT-PLAN.md:46:  - “functions” (`src/Intent/FunctionRegistry.php`, docs and filters such as `agentwp_register_intent_functions`)
docs/EXTENSIONS.md:113:### `agentwp_register_intent_functions` (Action)
docs/EXTENSIONS.md:129:add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
docs/EXTENSIONS.md:136:### `agentwp_default_function_mapping` (Filter)
docs/EXTENSIONS.md:154:add_filter( 'agentwp_default_function_mapping', function( $mapping, $engine ) {
docs/EXTENSIONS.md:584:add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
docs/EXTENSIONS.md:590:add_filter( 'agentwp_default_function_mapping', function( $mapping, $engine ) {
docs/EXTENSIONS.md:874:| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
docs/EXTENSIONS.md:875:| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
docs/ARCHITECTURE.md:307:- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
docs/ARCHITECTURE.md:399:   - `agentwp_register_intent_functions`
docs/ARCHITECTURE.md:400:   - `agentwp_default_function_mapping`
src/Intent/Engine.php:92:			$this->hooks->doAction( 'agentwp_register_intent_functions', $this->function_registry, $this );
src/Intent/Engine.php:259:			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
tests/Unit/Intent/EngineHooksTest.php:81:			$hooks->wasActionFired( 'agentwp_register_intent_functions' ),

thinking
**Inspecting getToolNames in handlers**

I'll check the getToolNames method in one intent handler to see how tool names are derived and how they might inform suggestion generation.
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/Handlers/OrderSearchHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 69ms:
<?php
/**
 * Handle order search intents.
 *
 * @package AgentWP\Intent\Handlers
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\Contracts\AIClientFactoryInterface;
use AgentWP\Contracts\ToolDispatcherInterface;
use AgentWP\Contracts\ToolRegistryInterface;
use AgentWP\Intent\Attributes\HandlesIntent;
use AgentWP\Intent\Intent;

/**
 * Handles order search intents using the agentic loop.
 *
 * Uses the centrally-registered SearchOrdersTool for execution.
 */

thinking
**Assessing suggestion naming and source**

I'm verifying that the response should keep using "function_suggestions" for compatibility but derive its content from tool names instead of functions. I'll explore the BaseHandler and related response code to support this tool-driven suggestion approach while considering a new internal registry name to clarify roles.
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/Handlers/BaseHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 67ms:
<?php
/**
 * Base handler for intent responses.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Intent\Handler;
use AgentWP\Intent\Intent;

abstract class BaseHandler implements Handler {
	protected string $intent;

	/**
	 * @param string $intent Intent identifier.
	 */
	public function __construct( string $intent ) {

thinking
**Planning registry refactor**

I'm deciding to replace the current FunctionRegistry with a tool-driven suggestion system while preserving hooks, and will review existing tests referencing FunctionRegistry to guide necessary updates.
exec
/bin/zsh -lc "sed -n '1,220p' tests/Unit/Intent/EngineHooksTest.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 69ms:
<?php
/**
 * Unit tests for Engine hooks injection.
 *
 * @package AgentWP\Tests\Unit\Intent
 */

namespace AgentWP\Tests\Unit\Intent;

use AgentWP\AI\Response;
use AgentWP\Intent\ContextBuilder;
use AgentWP\Intent\Engine;
use AgentWP\Intent\FunctionRegistry;
use AgentWP\Intent\Handler;
use AgentWP\Intent\HandlerRegistry;
use AgentWP\Intent\Handlers\FallbackHandler;
use AgentWP\Intent\Intent;
use AgentWP\Contracts\IntentClassifierInterface;
use AgentWP\Tests\Fakes\FakeMemoryStore;
use AgentWP\Tests\Fakes\FakeWPFunctions;

thinking
**Evaluating handler classes for suggestion mapping**

I'm assessing whether the existing HandlerRegistry suffices for mapping intents to tool names or if a new ToolSuggestionRegistry is needed, noting getToolNames is abstract and not all handlers extend the agentic base. Next, I'll review tests around FunctionRegistry and SimpleHandlers to guide a fallback strategy for non-agentic handlers.
exec
/bin/zsh -lc "sed -n '1,200p' tests/Unit/Intent/Handlers/SimpleHandlersTest.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 70ms:
<?php
/**
 * Basic intent handler coverage.
 */

namespace AgentWP\Tests\Unit\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Contracts\AnalyticsServiceInterface;
use AgentWP\Contracts\EmailDraftServiceInterface;
use AgentWP\Contracts\OrderRefundServiceInterface;
use AgentWP\Contracts\OrderStatusServiceInterface;
use AgentWP\Intent\Handlers\AnalyticsQueryHandler;
use AgentWP\Intent\Handlers\EmailDraftHandler;
use AgentWP\Intent\Handlers\FallbackHandler;
use AgentWP\Intent\Handlers\OrderRefundHandler;
use AgentWP\Intent\Handlers\OrderStatusHandler;
use AgentWP\Intent\Intent;
use AgentWP\Intent\Tools\ConfirmRefundTool;
use AgentWP\Intent\Tools\ConfirmStatusUpdateTool;

thinking
**Checking test coverage impact**
exec
/bin/zsh -lc "sed -n '1,220p' tests/Integration/Intent/EngineTest.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 68ms:
<?php
/**
 * Integration tests for intent engine.
 */

namespace AgentWP\Tests\Integration\Intent;

use AgentWP\AI\Response;
use AgentWP\Intent\ContextBuilder;
use AgentWP\Intent\Engine;
use AgentWP\Intent\FunctionRegistry;
use AgentWP\Intent\Handler;
use AgentWP\Intent\HandlerRegistry;
use AgentWP\Intent\Handlers\FallbackHandler;
use AgentWP\Intent\Intent;
use AgentWP\Contracts\IntentClassifierInterface;
use AgentWP\Tests\Fakes\FakeMemoryStore;
use AgentWP\Tests\TestCase;

class EngineTest extends TestCase {

thinking
**Checking integration tests using FunctionRegistry**

I'm reviewing integration tests like ToolExecutionPathTest that reference FunctionRegistry to see if they relate to suggestions and require updates for the new suggestion system.
exec
/bin/zsh -lc "sed -n '1,260p' tests/Integration/Intent/ToolExecutionPathTest.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 65ms:
<?php
/**
 * Integration tests covering the full Engine → handler → tool dispatcher execution path.
 */

namespace AgentWP\Tests\Integration\Intent;

use AgentWP\AI\Functions\AbstractFunction;
use AgentWP\AI\Response;
use AgentWP\Contracts\OpenAIClientInterface;
use AgentWP\Intent\ContextBuilder;
use AgentWP\Intent\Engine;
use AgentWP\Intent\FunctionRegistry;
use AgentWP\Intent\HandlerRegistry;
use AgentWP\Intent\Handlers\AbstractAgenticHandler;
use AgentWP\Intent\Handlers\FallbackHandler;
use AgentWP\Intent\Intent;
use AgentWP\Contracts\IntentClassifierInterface;
use AgentWP\Tests\Fakes\FakeAIClientFactory;
use AgentWP\Tests\Fakes\FakeMemoryStore;

thinking
**Evaluating registry refactor options**

I'm reviewing whether to create a new ToolSuggestionRegistry and interface or adapt FunctionRegistry to inherit from ToolRegistry for minimal changes. Tests expect FunctionRegistry, so I'll check container wiring tests next to plan updates and compatibility handling.
exec
/bin/zsh -lc "sed -n '1,260p' tests/Integration/Container/ContainerWiringTest.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 72ms:
<?php
/**
 * Integration tests for container wiring and resolution.
 *
 * Verifies that the container correctly registers bindings, resolves
 * Engine with handlers/registries, and REST controllers resolve
 * dependencies via RestController::resolve().
 *
 * @package AgentWP\Tests\Integration\Container
 */

namespace AgentWP\Tests\Integration\Container;

use AgentWP\AI\Response;
use AgentWP\Container\Container;
use AgentWP\Container\ContainerInterface;
use AgentWP\Contracts\AIClientFactoryInterface;
use AgentWP\Contracts\AnalyticsServiceInterface;
use AgentWP\Contracts\CacheInterface;
use AgentWP\Contracts\ClockInterface;


thinking
**Considering backward compatibility with FunctionRegistry**

The plan is to introduce a new ToolSuggestionRegistry integrated with the engine while keeping FunctionRegistry as a shim for backward compatibility, mapping old hooks to the new system and deriving suggestions from the tool and handler registries.
thinking
**Exploring handler-based tool name retrieval**

I'm checking if handlers from HandlerRegistry support a getToolNames method to derive tool suggestions per intent, planning to fallback on manual mappings if unavailable.
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/HandlerRegistry.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 67ms:
<?php
/**
 * Intent handler registry for O(1) handler resolution.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

/**
 * Registry for intent handlers with O(1) lookup performance.
 *
 * Replaces the O(n) linear search in Engine::resolve_handler()
 * with a hashmap-based approach.
 */
class HandlerRegistry {
	/**
	 * @var Handler[] Map of intent to handler instance.
	 */
	private array $handlers = [];


thinking
**Planning tool-driven suggestion integration**

The suggestion system should detect handlers' getToolNames method dynamically to gather tool suggestions without enforcing new interfaces, preserving backward compatibility with existing extension hooks by mapping them onto the new suggestions approach.
thinking
**Designing tool suggestion registry with backward support**

I'm outlining a new ToolSuggestionRegistry to centralize suggestions from handlers and hooks, while planning a legacy FunctionRegistry adapter to maintain backward-compatible function registration by mapping functions to handler intents and tools via reflection and handler introspection.
exec
/bin/zsh -lc "rg -n \"get_handler\\(|FunctionRegistry\" src tests" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 83ms:
tests/Integration/Intent/ToolExecutionPathTest.php:13:use AgentWP\Intent\FunctionRegistry;
tests/Integration/Intent/ToolExecutionPathTest.php:153:			new FunctionRegistry(),
tests/Integration/Intent/ToolExecutionPathTest.php:299:			new FunctionRegistry(),
src/Providers/IntentServiceProvider.php:62:use AgentWP\Intent\FunctionRegistry;
src/Providers/IntentServiceProvider.php:84:		$this->registerFunctionRegistry();
src/Providers/IntentServiceProvider.php:218:	private function registerFunctionRegistry(): void {
src/Providers/IntentServiceProvider.php:219:		if ( ! class_exists( FunctionRegistry::class ) ) {
src/Providers/IntentServiceProvider.php:224:			FunctionRegistry::class,
src/Providers/IntentServiceProvider.php:225:			fn() => new FunctionRegistry()
src/Providers/IntentServiceProvider.php:376:					$this->container->get( FunctionRegistry::class ),
tests/Integration/Intent/EngineTest.php:11:use AgentWP\Intent\FunctionRegistry;
tests/Integration/Intent/EngineTest.php:58:			new FunctionRegistry(),
tests/Integration/Intent/EngineTest.php:93:			new FunctionRegistry(),
tests/Integration/Intent/EngineTest.php:153:			new FunctionRegistry(),
tests/Integration/Architecture/BoundariesTest.php:756:			'FunctionRegistry',
tests/Integration/Container/ContainerWiringTest.php:49:use AgentWP\Intent\FunctionRegistry;
tests/Integration/Container/ContainerWiringTest.php:220:			$this->container->has( FunctionRegistry::class ),
tests/Integration/Container/ContainerWiringTest.php:221:			'IntentServiceProvider should register FunctionRegistry'
tests/Integration/Container/ContainerWiringTest.php:333:	 * Test that FunctionRegistry is shared.
tests/Integration/Container/ContainerWiringTest.php:338:		$registry1 = $this->container->get( FunctionRegistry::class );


thinking
**Designing tool suggestion registry**

I'm planning to introduce a new registry class mapping intents to tool names for suggestions while keeping the existing FunctionRegistry for backward compatibility, potentially repurposed or wrapped to align with the new tool-driven approach. Next, I'll adapt the Engine's function registration to derive mappings from handlers and the new tool registry rather than static defaults.
thinking
**Refining tool-driven suggestion approach**

I'm leaning toward keeping FunctionRegistry as the suggestion storage but changing Engine's default registration to derive suggestions automatically from handlers' tool names, requiring making the getToolNames method public and adding an interface to mark handlers as tool suggestion providers. This satisfies option B without adding a new registry class while preserving backward compatibility and hooks.
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/Handler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 68ms:
<?php
/**
 * Intent handler contract.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

use AgentWP\AI\Response;

interface Handler {
	/**
	 * @param string $intent Intent identifier.
	 * @return bool
	 */
	public function canHandle( string $intent ): bool;

	/**
	 * @param array $context Enriched request context.

thinking
**Considering design of tool suggestion interface**

I'm weighing creating a new explicit interface for tool suggestions, possibly via a ToolSuggestionRegistry that combines ToolRegistry with handler-declared tool lists, ensuring suggestions align with specific intents rather than defaulting to all tools. I need to verify whether intent-based suggestion methods exist and how handler tool lists can best integrate without exposing too much publicly.
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/Intent.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 73ms:
<?php
/**
 * Intent categories.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

class Intent {
	const ORDER_SEARCH    = 'ORDER_SEARCH';
	const ORDER_REFUND    = 'ORDER_REFUND';
	const ORDER_STATUS    = 'ORDER_STATUS';
	const PRODUCT_STOCK   = 'PRODUCT_STOCK';
	const EMAIL_DRAFT     = 'EMAIL_DRAFT';
	const ANALYTICS_QUERY = 'ANALYTICS_QUERY';
	const CUSTOMER_LOOKUP = 'CUSTOMER_LOOKUP';
	const UNKNOWN         = 'UNKNOWN';

	/**


thinking
**Planning public tool suggestion method**

I'm deciding to add a public `getSuggestedTools` method in the base handler that wraps the protected `getToolNames`, avoiding visibility changes in subclasses. I'll define a `ToolSuggestionProviderInterface` in the Contracts folder to formalize this new method.
thinking
**Settling on interface placement**

I'm leaning toward defining the ToolSuggestionProvider interface within the Intent namespace rather than Contracts, aligning it with other handler-related interfaces and keeping related functionality grouped.
exec
/bin/zsh -lc 'rg -n "Interface" src/Intent src/Contracts | head' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 72ms:
src/Contracts/AIClientFactoryInterface.php:11: * Interface for creating AI clients.
src/Contracts/AIClientFactoryInterface.php:13:interface AIClientFactoryInterface {
src/Contracts/AIClientFactoryInterface.php:20:	 * @return OpenAIClientInterface
src/Contracts/AIClientFactoryInterface.php:22:	public function create( string $intent, array $options = array() ): OpenAIClientInterface;
src/Intent/IntentClassifier.php:8: *             Planned removal: 1.0.0. Resolve IntentClassifierInterface from the DI container.
src/Intent/IntentClassifier.php:14:use AgentWP\Contracts\IntentClassifierInterface;
src/Intent/IntentClassifier.php:21: *             Instead, resolve IntentClassifierInterface from the DI container which returns
src/Intent/IntentClassifier.php:30: * $classifier = $container->get(IntentClassifierInterface::class);
src/Intent/IntentClassifier.php:36:class IntentClassifier implements IntentClassifierInterface {
src/Intent/IntentClassifier.php:56:				'Resolve IntentClassifierInterface from the DI container for the canonical implementation. ' .


thinking
**Considering interface placement and design**

Evaluating whether to introduce a new interface for tool suggestion providers, leaning toward adding a dedicated interface in the Intent area for clarity and consistency, though method existence checks might suffice; next step is to review existing docs and structure to finalize placement.
thinking
**Planning documentation updates**

Preparing to revise multiple docs to reflect that function suggestions now derive from tool names, renaming them as "tool suggestions," and considering keeping the old FunctionRegistry file as a legacy adapter for compatibility.
exec
/bin/zsh -lc "sed -n '340,520p' docs/DEVELOPER.md" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 68ms:
```
array $thresholds = apply_filters(
  'agentwp_customer_health_thresholds',
  array $thresholds
);
```

### `agentwp_encryption_rotation_materials`
Provide additional key material for API key rotation.

Signature:
```
array $rotations = apply_filters(
  'agentwp_encryption_rotation_materials',
  array $rotations
);
```

### `agentwp_intent_handlers`
Extend the intent handler list (see extension guide below).



thinking
**Planning suggestion registry redesign**

I'm considering introducing a new ToolSuggestionRegistry to map intents to suggested tools while keeping FunctionRegistry as a legacy wrapper for backward compatibility with existing hooks that register functions by name and handler. The challenge is integrating intent-based suggestions with current function registration signatures and handler management without breaking compatibility.
thinking
**Designing hybrid suggestion registry**

I'm refining a plan to introduce a new ToolSuggestionRegistry that stores intent-to-tool mappings while keeping FunctionRegistry as a legacy wrapper for backward compatibility with hooks. Engine will use ToolSuggestionRegistry for canonical suggestions derived from handlers’ tool lists, and FunctionRegistry will delegate to it but retain legacy function-handler maps for older extensions. This hybrid design ensures minimal breaking changes while enabling a tool-driven suggestion system.
thinking
**Planning FunctionRegistry upgrade for hybrid suggestions**

I'm leaning toward upgrading FunctionRegistry to manage both legacy handler mappings and new tool-driven intent-to-tool suggestions, merging both in retrieval to preserve backward compatibility while supporting tool-based suggestions from Engine. This avoids adding new classes and keeps hooks functional without breaking existing APIs.
exec
/bin/zsh -lc "rg -n \"->all\\(\\)\" src tests docs | head" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 70ms:
rg: unrecognized flag ->

thinking
**Refining search terms**

I'm shifting to search specifically for the call to `get_function_registry()->all` to avoid unrelated matches from other `all()` methods.
exec
/bin/zsh -lc "rg -n \"FunctionRegistry\\)|get_function_registry|function_registry->all\" src tests" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 71ms:
src/Intent/Engine.php:193:	public function get_function_registry() {


thinking
**Preserving legacy function map**

Decided to keep the original all() method returning the function-to-handler map for backward compatibility, avoiding breaking extensions relying on it. The new intent-specific mapping stays internal, and Engine will adapt by adding a method to handlers exposing suggested tools publicly for registering intent-based suggestions.
thinking
**Defining interface for tool suggestions**

Decided to create a ToolSuggestionProviderInterface with getSuggestedTools to expose handlers' tool names without changing protected methods. AbstractAgenticHandler implements this, allowing Engine to collect suggestions via instanceof checks without modifying subclasses.
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/Handlers/ProductStockHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 67ms:
<?php
/**
 * Handle product stock intents.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\Contracts\AIClientFactoryInterface;
use AgentWP\Contracts\ToolDispatcherInterface;
use AgentWP\Contracts\ToolRegistryInterface;
use AgentWP\Intent\Attributes\HandlesIntent;
use AgentWP\Intent\Intent;

/**
 * Handles product stock intents using the agentic loop.
 *
 * Uses the centrally-registered SearchProductTool, PrepareStockUpdateTool,
 * and ConfirmStockUpdateTool for execution.

thinking
**Adjusting suggestions to exclude non-tools**

I'll remove "select_orders" and "bulk_update" from suggestions and update related tests since the old order search mapping included "select_orders" but it’s no longer relevant.
exec
/bin/zsh -lc 'rg -n "function_suggestions|search_orders|select_orders|bulk_update|prepare_status_update" tests' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 70ms:
tests/fixtures/openai/chat-success.json:15:              "name": "search_orders",
tests/fixtures/openai/chat-stream.txt:2:data: {"id":"chatcmpl-stream","choices":[{"delta":{"content":"world","tool_calls":[{"index":0,"id":"call_1","type":"function","function":{"name":"search_orders","arguments":"{\"order_id\":123"}}]}}]}
tests/fixtures/openai/chat-success-no-usage-tools.json:15:              "name": "search_orders",
tests/Unit/Validation/ToolArgumentValidatorTest.php:115:			'search_orders',
tests/Unit/Validation/ToolArgumentValidatorTest.php:138:			'search_orders',
tests/Unit/Validation/ToolArgumentValidationIntegrationTest.php:50:									'name'      => 'search_orders',
tests/Unit/Validation/ToolArgumentValidationIntegrationTest.php:129:									'name'      => 'search_orders',
tests/Unit/Validation/ToolArgumentValidationIntegrationTest.php:233:									'name'      => 'search_orders',
tests/Unit/Billing/UsageTrackerTest.php:639:										'name'      => 'search_orders',
tests/Unit/AI/OpenAIClientTest.php:913:		$this->assertSame( 'search_orders', $tool_calls[0]['function']['name'] );
tests/Unit/Services/OrderStatusServiceTest.php:162:	// prepare_bulk_update() tests
tests/Unit/Services/OrderStatusServiceTest.php:165:	public function test_prepare_bulk_update_returns_permission_denied_when_not_allowed(): void {
tests/Unit/Services/OrderStatusServiceTest.php:168:		$result = $this->service->prepare_bulk_update( array( 1, 2, 3 ), 'completed' );
tests/Unit/Services/OrderStatusServiceTest.php:174:	public function test_prepare_bulk_update_returns_invalid_input_for_empty_order_ids(): void {
tests/Unit/Services/OrderStatusServiceTest.php:175:		$result = $this->service->prepare_bulk_update( array(), 'completed' );
tests/Unit/Services/OrderStatusServiceTest.php:182:	public function test_prepare_bulk_update_returns_limit_exceeded_for_too_many_orders(): void {
tests/Unit/Services/OrderStatusServiceTest.php:185:		$result = $this->service->prepare_bulk_update( $order_ids, 'completed' );
tests/Unit/Services/OrderStatusServiceTest.php:192:	public function test_prepare_bulk_update_returns_invalid_input_for_unknown_status(): void {
tests/Unit/Services/OrderStatusServiceTest.php:193:		$result = $this->service->prepare_bulk_update( array( 1, 2 ), 'nonexistent' );
tests/Unit/Services/OrderStatusServiceTest.php:199:	public function test_prepare_bulk_update_succeeds_with_valid_orders(): void {

thinking
**Checking function_suggestions usage and tests**

I'm verifying if function_suggestions are derived from tool names now and whether relevant tests assert expected function_suggestions, to determine if test updates or OpenAPI doc changes are needed.
exec
/bin/zsh -lc 'rg -n "function_suggestions" tests -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 76ms:
tests/Unit/Intent/Handlers/SimpleHandlersTest.php:112:					'function_suggestions' => array( 'search_orders' ),
tests/Unit/Intent/Handlers/SimpleHandlersTest.php:123:			$this->assertArrayHasKey( 'function_suggestions', $data );


thinking
**Planning test updates for registry changes**

I’m identifying that existing tests don’t cover default suggestions or tool-driven mapping, so I’ll update or add tests—likely in EngineHooksTest—to ensure the new dynamic function mapping from tools works and existing filters are properly applied.
thinking
**Designing interface and registry updates**

I'm planning to add a ToolSuggestionProvider interface with getSuggestedTools implemented by AbstractAgenticHandler, update FunctionRegistry to register suggestions per intent from these tools, and modify Engine to build default function mappings from handlers' suggested tools while preserving backward-compatible hooks and registrations.
exec
/bin/zsh -lc "sed -n '1,220p' docs/EXTENSIONS.md" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 66ms:
# AgentWP Extension Points

This document is the **single source of truth** for all supported actions, filters, and extension points in AgentWP. Extension developers should reference this document when building integrations.

> **Maintenance note:** When adding new hooks to the codebase, document them here with their file location, parameters, and purpose.

## Table of Contents

- [Tools vs Functions Terminology](#tools-vs-functions-terminology)
- [Core Plugin Hooks](#core-plugin-hooks)
- [Intent System Hooks](#intent-system-hooks)
- [Intent Classification Hooks](#intent-classification-hooks)
- [Error Handling Hooks](#error-handling-hooks)
- [Configuration Hooks](#configuration-hooks)
- [Customer Service Hooks](#customer-service-hooks)
- [Encryption Hooks](#encryption-hooks)
- [Notification Hooks](#notification-hooks)
- [Extension Patterns](#extension-patterns)
  - [Custom Service Provider](#registering-a-custom-service-provider)
  - [Custom Intent Handler](#adding-a-custom-intent-handler)


thinking
**Clarifying function registry usage in docs**

I'm verifying that the FunctionRegistry's register method expects a function name and a Handler instance, meaning the current example using `new MyCustomFunction()` is likely incorrect; the docs will be updated to clearly show registering handlers for suggestions and indicate how to override with filters.
thinking
**Planning ARCHITECTURE.md update**

I'll inspect the function registry section in docs/ARCHITECTURE.md to prepare for aligning it with the updated function suggestion approach.
exec
/bin/zsh -lc "sed -n '280,360p' docs/ARCHITECTURE.md" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 64ms:

### WooCommerce Gateway Abstractions

Services do not call WooCommerce functions directly. Instead, gateway interfaces (`src/Contracts/`) abstract all WooCommerce operations:

| Interface | Implementation | Wraps |
|-----------|----------------|-------|
| `WooCommerceRefundGatewayInterface` | `WooCommerceRefundGateway` | `wc_create_refund()`, `wc_get_order()` |
| `WooCommerceOrderGatewayInterface` | `WooCommerceOrderGateway` | Order status updates |
| `WooCommerceStockGatewayInterface` | `WooCommerceStockGateway` | Stock level updates |
| `WooCommerceUserGatewayInterface` | `WooCommerceUserGateway` | Customer data access |

This abstraction enables:
- **Unit testing** with fakes/mocks (no WooCommerce runtime required)
- **Consistent error handling** across all WooCommerce operations
- **Clear boundaries** between domain logic and infrastructure

## 1.2) Tool Execution Architecture

AgentWP uses OpenAI function calling (tools) to enable AI-driven workflows. The architecture separates tool schemas from execution logic.


thinking
**Updating FunctionRegistry and docs for new suggestion source**

Planning to add a snake_case method to FunctionRegistry for registering suggestions from tool names and update relevant docs to reflect that suggestions now come from tools instead of legacy hooks. Architecture plan updates will be minor or skipped, and boundary tests will remain as FunctionRegistry likely stays.
thinking
**Designing new interface and test plan for tool suggestions**

Planning to add a ToolSuggestionProvider interface with getSuggestedTools method and update AbstractAgenticHandler to implement it, enabling handlers to supply tool-based suggestions. Also drafting new Engine test to verify suggestions registration and response inclusion, plus updating docs and FunctionRegistry accordingly.
exec
/bin/zsh -lc "cat <<'PHP' > src/Intent/ToolSuggestionProvider.php
<?php
/**
 * Tool suggestion provider contract for intent handlers.
 *
 * @package AgentWP
 */

namespace AgentWP\\Intent;

interface ToolSuggestionProvider {
	/**
	 * Get tool names to surface as suggestions for this handler's intents.
	 *
	 * @return array<string>
	 */
	public function getSuggestedTools(): array;
}
PHP
" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 69ms:


thinking
**Updating abstract handler**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -18,2 +18,3 @@
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
@@ -27,3 +28,3 @@
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
@@ -103,2 +104,11 @@
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
apply_patch(auto_approved=true) exited 0 in 25ms:
Success. Updated the following files:
M src/Intent/Handlers/AbstractAgenticHandler.php
file update:
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.

file update:
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.


thinking
**Switching to apply_patch tool**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/FunctionRegistry.php
@@ -2,3 +2,3 @@
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
@@ -16,2 +16,12 @@
 	/**
+	 * @var ToolRegistry|null
+	 */
+	private ?ToolRegistry $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
@@ -30,2 +40,22 @@
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistry $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
@@ -56,2 +86,10 @@
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
@@ -67,2 +105,53 @@
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		if ( method_exists( $handler, 'getToolNames' ) ) {
+			$names = $handler->getToolNames();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
apply_patch(auto_approved=true) exited 0 in 37ms:
Success. Updated the following files:
M src/Intent/FunctionRegistry.php
file update:
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..ff0757504418ecd216b0723584c6c536acef7274
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
@@ -14,6 +14,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistry|null
+	 */
+	private ?ToolRegistry $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +38,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistry $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +84,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +103,55 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		if ( method_exists( $handler, 'getToolNames' ) ) {
+			$names = $handler->getToolNames();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.

file update:
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..ff0757504418ecd216b0723584c6c536acef7274
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
@@ -14,6 +14,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistry|null
+	 */
+	private ?ToolRegistry $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +38,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistry $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +84,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +103,55 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		if ( method_exists( $handler, 'getToolNames' ) ) {
+			$names = $handler->getToolNames();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.


thinking
**Evaluating type hinting for registries**

I'm deciding to switch FunctionRegistry to depend on ToolRegistryInterface to reduce coupling, so I'll verify the interface methods next to ensure it supports needed calls like `get`.
exec
/bin/zsh -lc "sed -n '1,200p' src/Contracts/ToolRegistryInterface.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 50ms:
<?php
/**
 * Tool registry interface.
 *
 * Provides function schema definitions for intent handlers,
 * enabling dependency injection and avoiding hidden instantiation.
 *
 * @package AgentWP\Contracts
 */

namespace AgentWP\Contracts;

use AgentWP\AI\Functions\FunctionSchema;

/**
 * Registry for AI function schemas.
 */
interface ToolRegistryInterface {

	/**
file update:
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..ff0757504418ecd216b0723584c6c536acef7274
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
@@ -14,6 +14,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistry|null
+	 */
+	private ?ToolRegistry $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +38,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistry $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +84,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +103,55 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		if ( method_exists( $handler, 'getToolNames' ) ) {
+			$names = $handler->getToolNames();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.



thinking
**Refining interface usage and method calls**

Decided to replace ToolRegistry typing in FunctionRegistry with the ToolRegistryInterface for better abstraction and will update relevant types and method calls accordingly. Also identified that calling the protected getToolNames method causes errors despite method_exists returning true, so the fallback to getToolNames will be removed in favor of relying solely on the public getSuggestedTools method from ToolSuggestionProvider to avoid visibility issues and maintain compatibility.
thinking
**Enforcing ToolSuggestionProvider for tool suggestions**

Decided to update function derivation to use tool suggestions only if a handler implements ToolSuggestionProvider, relying on AbstractAgenticHandler to cover existing agentic handlers while excluding non-agentic ones. Also planning to switch filter_known_tools to use ToolRegistryInterface for consistency.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/FunctionRegistry.php
@@ -9,2 +9,4 @@
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
@@ -16,5 +18,5 @@
 	/**
-	 * @var ToolRegistry|null
+	 * @var ToolRegistryInterface|null
 	 */
-	private ?ToolRegistry $tool_registry = null;
+	private ?ToolRegistryInterface $tool_registry = null;
 
@@ -45,3 +47,3 @@
 	 */
-	public function set_tool_registry( ToolRegistry $registry ): void {
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
 		$this->tool_registry = $registry;
@@ -120,7 +122,2 @@
 			$names = $handler->getSuggestedTools();
-			return is_array( $names ) ? $names : array();
-		}
-
-		if ( method_exists( $handler, 'getToolNames' ) ) {
-			$names = $handler->getToolNames();
 			return is_array( $names ) ? $names : array();
apply_patch(auto_approved=true) exited 0 in 43ms:
Success. Updated the following files:
M src/Intent/FunctionRegistry.php
file update:
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.

file update:
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.


thinking
**Updating engine constructor with optional tool registry**

I'm adding an optional ToolRegistryInterface parameter to the Engine constructor and injecting HandlerRegistry, updating the function registry to set its handler registry after assignment, and handling nullability to avoid breaking existing tests while enhancing integration flexibility.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Engine.php
@@ -14,2 +14,3 @@
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
 
@@ -64,2 +65,3 @@
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
@@ -73,3 +75,4 @@
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
@@ -88,2 +91,7 @@
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
apply_patch(auto_approved=true) exited 0 in 39ms:
Success. Updated the following files:
M src/Intent/Engine.php
file update:
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..6523e74f25e40199de545d9bd61ed0033d443fc6
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,7 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
 
 class Engine {
 	/**
@@ -62,6 +63,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +73,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +89,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.

file update:
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..6523e74f25e40199de545d9bd61ed0033d443fc6
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,7 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
 
 class Engine {
 	/**
@@ -62,6 +63,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +73,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +89,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.


thinking
**Updating service provider for validation**

I'm modifying the service provider to pass the ToolRegistryInterface to the Engine constructor, enabling proper validation while ensuring existing tests remain compatible.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/src/Providers/IntentServiceProvider.php
@@ -381,3 +381,4 @@
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
apply_patch(auto_approved=true) exited 0 in 47ms:
Success. Updated the following files:
M src/Providers/IntentServiceProvider.php
file update:
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..6523e74f25e40199de545d9bd61ed0033d443fc6
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,7 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
 
 class Engine {
 	/**
@@ -62,6 +63,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +73,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +89,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

file update:
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..6523e74f25e40199de545d9bd61ed0033d443fc6
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,7 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
 
 class Engine {
 	/**
@@ -62,6 +63,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +73,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +89,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Checking autoload and planning docs/tests updates**

The new class fits the existing PSR-4 autoloading from src/, so no composer changes are needed. Next, I'll update multiple docs to reflect Option B and plan adding or updating tests for the new suggestion filtering behavior, including enhancements to the fake tool registry for coverage.
exec
/bin/zsh -lc "sed -n '1,200p' tests/Fakes/FakeToolRegistry.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 71ms:
<?php
/**
 * Fake tool registry for testing.
 */

namespace AgentWP\Tests\Fakes;

use AgentWP\AI\Functions\FunctionSchema;
use AgentWP\Contracts\ToolRegistryInterface;

/**
 * Fake implementation of ToolRegistryInterface for testing.
 *
 * Returns empty arrays by default but can be pre-populated with schemas.
 */
class FakeToolRegistry implements ToolRegistryInterface {

	/**
	 * @var array<string, FunctionSchema>
	 */
file update:
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..6523e74f25e40199de545d9bd61ed0033d443fc6
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,7 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
 
 class Engine {
 	/**
@@ -62,6 +63,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +73,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +89,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);



thinking
**Updating docs and tests for tool suggestions**

I'll update documentation to reflect the new ToolSuggestionProvider using handler tool names or tool registry, deprecating the legacy intent function registry as fallback. Tests will be updated to cover filtering of default mapped function names against the actual tool registry to avoid suggesting unknown tools like 'select_orders' or 'bulk_update'.
thinking
**Redesigning default function mapping to derive from handler tool suggestions**

I'm planning to modify default function mapping generation to build suggestions from handlers' tool lists via ToolSuggestionProvider instead of static arrays, aligning with the tool-driven suggestion system (Option B). This keeps backward-compatible hooks but shifts default suggestions to actual tool names filtered by the tool registry, ensuring suggestions reflect real registered tools.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Engine.php
@@ -255,11 +255,15 @@
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
apply_patch(auto_approved=true) exited 0 in 66ms:
Success. Updated the following files:
M src/Intent/Engine.php
file update:
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..9ce1e731f8239482bb7e8e4221e527d76fbe94d5
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,7 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
 
 class Engine {
 	/**
@@ -62,6 +63,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +73,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +89,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +253,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

file update:
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..9ce1e731f8239482bb7e8e4221e527d76fbe94d5
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,7 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
 
 class Engine {
 	/**
@@ -62,6 +63,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +73,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +89,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +253,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Adding missing import for provider**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/Engine.php
@@ -15,2 +15,3 @@
 use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
apply_patch(auto_approved=true) exited 0 in 77ms:
Success. Updated the following files:
M src/Intent/Engine.php
file update:
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

file update:
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);



thinking
**Planning function suggestion tests**

The engine applies filters on empty mappings as before, but now function suggestions derive from tool names too; I'll update the FunctionRegistry docs and add new tests to cover this new suggestion behavior since existing tests don’t fully verify it.
thinking
**Scoping tests for function suggestion filtering**

I'll add unit tests in FunctionRegistry or Engine to verify suggestions coming from ToolSuggestionProvider and tool filtering, starting by reviewing existing tests in the Intent test directory.
exec
/bin/zsh -lc 'rg -n "FunctionRegistry" tests/Unit -S' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 75ms:
tests/Unit/Intent/EngineHooksTest.php:13:use AgentWP\Intent\FunctionRegistry;
tests/Unit/Intent/EngineHooksTest.php:42:			new FunctionRegistry(),
tests/Unit/Intent/EngineHooksTest.php:71:			new FunctionRegistry(),
tests/Unit/Intent/EngineHooksTest.php:100:			new FunctionRegistry(),
tests/Unit/Intent/EngineHooksTest.php:143:			new FunctionRegistry(),
tests/Unit/Intent/EngineHooksTest.php:174:			new FunctionRegistry(),
tests/Unit/Intent/EngineHooksTest.php:204:			new FunctionRegistry(),
file update:
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);



thinking
**Planning FunctionRegistry tests**

I'm outlining tests for FunctionRegistry to cover deriving suggestions from handler registry without mapping and filtering suggestions by the tool registry. Next, I'll implement fakes for handler and tool registries to verify expected suggestion behavior.
thinking
**Refining compatibility and docs for suggestions**

I'm confirming that only handlers implementing ToolSuggestionProvider produce suggestions now, which may reduce legacy suggestions for custom handlers. I'll add fallback notes and update docs to explain the new derivation and filtering logic, plus create unit tests verifying this behavior with filtered suggestions.
exec
/bin/zsh -lc "sed -n '1,160p' tests/TestCase.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 71ms:
<?php
/**
 * Base test case for AgentWP.
 */

namespace AgentWP\Tests;

use WP_Mock\Tools\TestCase as WP_Mock_TestCase;

class TestCase extends WP_Mock_TestCase {
}
file update:
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Deciding test setup approach**

Decided to skip WP_Mock for the new test, extending TestCase instead, and to implement a simple Handler and ToolSuggestionProvider with a stub tool schema, possibly using AbstractFunction for easier function schema implementation.
exec
/bin/zsh -lc "sed -n '1,200p' src/AI/Functions/AbstractFunction.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 39ms:
<?php
/**
 * Base class for tool definitions.
 *
 * @package AgentWP
 */

namespace AgentWP\AI\Functions;

abstract class AbstractFunction implements FunctionSchema {
	/**
	 * @var array<string, array>
	 */
	private static $definition_cache = array();

	/**
	 * @return array
	 */
	public function to_tool_definition() {
		$class_name = static::class;
file update:
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);



thinking
**Drafting tests with anonymous classes**

I'm preparing tests that use anonymous classes implementing Handler and ToolSuggestionProvider, including required methods like handle returning a successful Response. The tests will verify that function suggestions are properly derived and sorted, and that filtering via a tool registry with stub schemas works as expected.
thinking
**Updating developer docs for function mapping**

I'm revising the developer docs to clarify that default intent-to-function mapping now derives from handler tool lists and filters through the ToolRegistry when present. I'll add notes about registering additional suggestions being filtered, mention the ToolSuggestionProvider interface, and provide guidance for extension authors on customizing handlers.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docs/DEVELOPER.md
@@ -370,3 +370,4 @@
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
@@ -384,2 +385,3 @@
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
apply_patch(auto_approved=true) exited 0 in 64ms:
Success. Updated the following files:
M docs/DEVELOPER.md
file update:
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..882fc04c7f06daecd0f520a16ccfb96cc972a64a
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

file update:
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..882fc04c7f06daecd0f520a16ccfb96cc972a64a
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Updating extension docs**

I'm updating docs/EXTENSIONS.md to clarify that function registry suggestions come from ToolSuggestionProvider and are filtered, noting this in terminology, intent functions, default mappings, and extension patterns.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docs/EXTENSIONS.md
@@ -35,3 +35,3 @@
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
@@ -116,2 +116,3 @@
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
@@ -138,2 +139,3 @@
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
apply_patch(auto_approved=true) exited 0 in 63ms:
Success. Updated the following files:
M docs/EXTENSIONS.md
file update:
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..882fc04c7f06daecd0f520a16ccfb96cc972a64a
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..3d14f689a7be19faf3a2db7f55bef7dae2fc2f14
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

file update:
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..882fc04c7f06daecd0f520a16ccfb96cc972a64a
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..3d14f689a7be19faf3a2db7f55bef7dae2fc2f14
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Updating architecture docs**

I'm revising the Function registry description in the architecture documentation to improve clarity or accuracy.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docs/ARCHITECTURE.md
@@ -306,3 +306,3 @@
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
apply_patch(auto_approved=true) exited 0 in 78ms:
Success. Updated the following files:
M docs/ARCHITECTURE.md
file update:
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..8dc577ca09ceec9555b4802154fb9efafc2c28bf
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..882fc04c7f06daecd0f520a16ccfb96cc972a64a
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..3d14f689a7be19faf3a2db7f55bef7dae2fc2f14
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

file update:
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..8dc577ca09ceec9555b4802154fb9efafc2c28bf
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..882fc04c7f06daecd0f520a16ccfb96cc972a64a
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..3d14f689a7be19faf3a2db7f55bef7dae2fc2f14
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Reviewing architecture plan for update**
exec
/bin/zsh -lc "sed -n '90,140p' docs/ARCHITECTURE-IMPROVEMENT-PLAN.md" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 73ms:
  - Replace “since 2.0.0 / removed in 3.0.0” language in `src/Intent/IntentClassifier.php` with plugin-appropriate versions (or document that these are “internal architecture versions” and keep them consistent everywhere).
  - Ensure PHPUnit runs without noisy deprecations by default (either by updating tests, adjusting triggering conditions, or documenting expected warnings).

Deliverable: clear release history + predictable upgrades.

### Phase 3 — Clarify “Functions” vs “Tools” (Intent System)

Goal: reduce conceptual complexity and make extension points easier to use safely.

- [ ] Document the canonical terminology:
  - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
  - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
  - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
  - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
- [ ] Fix mapping drift:
  - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
- [ ] Improve unknown-tool behavior:
  - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).

file update:
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..8dc577ca09ceec9555b4802154fb9efafc2c28bf
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..882fc04c7f06daecd0f520a16ccfb96cc972a64a
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..3d14f689a7be19faf3a2db7f55bef7dae2fc2f14
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Marking completed tasks in documentation**

I'm updating task checkboxes to reflect that Option B, mapping drift fix, and document canonical terminology are done, marking them with [x] in the relevant docs.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -98,9 +98,9 @@
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
apply_patch(auto_approved=true) exited 0 in 80ms:
Success. Updated the following files:
M docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..8dc577ca09ceec9555b4802154fb9efafc2c28bf
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..882fc04c7f06daecd0f520a16ccfb96cc972a64a
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..3d14f689a7be19faf3a2db7f55bef7dae2fc2f14
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..8dc577ca09ceec9555b4802154fb9efafc2c28bf
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..882fc04c7f06daecd0f520a16ccfb96cc972a64a
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..3d14f689a7be19faf3a2db7f55bef7dae2fc2f14
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Planning documentation updates**

I'm identifying where to add details about the new ToolSuggestionProvider interface, focusing on docs/EXTENSIONS.md near the "Custom Intent Handler" section since it currently lacks mention of this interface and related suggestion functionality.
exec
/bin/zsh -lc 'rg -n "Custom Intent Handler|Adding a Custom Intent Handler|intent handler" docs/EXTENSIONS.md' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 71ms:
20:  - [Custom Intent Handler](#adding-a-custom-intent-handler)
90:Modify the list of intent handlers before registration.
505:    // Register a custom intent handler
519:### Adding a Custom Intent Handler
875:| Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
888:| Tag | `intent.handler` | IntentServiceProvider.php | Register intent handlers |
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..8dc577ca09ceec9555b4802154fb9efafc2c28bf
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..882fc04c7f06daecd0f520a16ccfb96cc972a64a
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..3d14f689a7be19faf3a2db7f55bef7dae2fc2f14
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

exec
/bin/zsh -lc "sed -n '520,620p' docs/EXTENSIONS.md" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 72ms:

```php
use AgentWP\Intent\Attributes\HandlesIntent;
use AgentWP\Intent\Handlers\BaseHandler;
use AgentWP\AI\Response;

#[HandlesIntent( 'shipment_delay' )]
class ShipmentDelayHandler extends BaseHandler {

    public function __construct() {
        parent::__construct( 'shipment_delay' );
    }

    public function handle( array $context ): Response {
        // Handle the intent
        return $this->build_response( $context, 'Shipment delay handled.' );
    }
}

// Register via filter
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..8dc577ca09ceec9555b4802154fb9efafc2c28bf
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..882fc04c7f06daecd0f520a16ccfb96cc972a64a
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..3d14f689a7be19faf3a2db7f55bef7dae2fc2f14
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Adding note on custom intent handlers**

I'm planning a minimal patch to update "Registering Custom AI Functions" with a note about filtering suggestions via ToolRegistry and recommending implementing ToolSuggestionProvider or using AbstractAgenticHandler for automatic suggestions.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docs/EXTENSIONS.md
@@ -582,3 +582,3 @@
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
apply_patch(auto_approved=true) exited 0 in 98ms:
Success. Updated the following files:
M docs/EXTENSIONS.md
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..8dc577ca09ceec9555b4802154fb9efafc2c28bf
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..882fc04c7f06daecd0f520a16ccfb96cc972a64a
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..27ceb5cd7bb0036c3708e0ed24dc9e983d39c408
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..8dc577ca09ceec9555b4802154fb9efafc2c28bf
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..882fc04c7f06daecd0f520a16ccfb96cc972a64a
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..27ceb5cd7bb0036c3708e0ed24dc9e983d39c408
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Reviewing extension guide references**

Planning to search docs/DEVELOPER.md for mentions of suggestion mapping and function mapping to update the extension guide accordingly.
exec
/bin/zsh -lc 'rg -n "function suggestions|function_suggestions|agentwp_register_intent_functions|agentwp_default_function_mapping" docs/DEVELOPER.md' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 74ms:
370:### `agentwp_default_function_mapping`
371:Override the default intent-to-tool suggestion mapping (function suggestions only).
373:This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
378:  'agentwp_default_function_mapping',
384:### `agentwp_register_intent_functions`
385:Register additional function suggestions after defaults are registered.
392:  'agentwp_register_intent_functions',
629:- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..8dc577ca09ceec9555b4802154fb9efafc2c28bf
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..882fc04c7f06daecd0f520a16ccfb96cc972a64a
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..27ceb5cd7bb0036c3708e0ed24dc9e983d39c408
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Updating checklist with tool suggestions**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docs/DEVELOPER.md
@@ -628,3 +628,3 @@
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
apply_patch(auto_approved=true) exited 0 in 100ms:
Success. Updated the following files:
M docs/DEVELOPER.md
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..8dc577ca09ceec9555b4802154fb9efafc2c28bf
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..27ceb5cd7bb0036c3708e0ed24dc9e983d39c408
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..8dc577ca09ceec9555b4802154fb9efafc2c28bf
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..27ceb5cd7bb0036c3708e0ed24dc9e983d39c408
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Planning documentation updates**

I'm checking docs/ARCHITECTURE.md for references to "function suggestions" or mapping to update them accordingly.
exec
/bin/zsh -lc 'rg -n "function suggestions|function_suggestions|default_function_mapping|register_intent_functions|FunctionRegistry" docs/ARCHITECTURE.md' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 64ms:
307:- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
398:6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
399:   - `agentwp_register_intent_functions`
400:   - `agentwp_default_function_mapping`
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..8dc577ca09ceec9555b4802154fb9efafc2c28bf
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..27ceb5cd7bb0036c3708e0ed24dc9e983d39c408
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Updating optional step with ToolSuggestionProvider**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docs/ARCHITECTURE.md
@@ -398,4 +398,4 @@
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
apply_patch(auto_approved=true) exited 0 in 86ms:
Success. Updated the following files:
M docs/ARCHITECTURE.md
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..27ceb5cd7bb0036c3708e0ed24dc9e983d39c408
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..27ceb5cd7bb0036c3708e0ed24dc9e983d39c408
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Updating docs and planning new test file**

I'm updating documentation where the example function name and comments may be inconsistent and clarifying filter descriptions with mapping info. Next, I'll create a new test file using shell command redirection to implement the test.
exec
/bin/zsh -lc "cat <<'PHP' > tests/Unit/Intent/FunctionRegistryTest.php
<?php
/**
 * Unit tests for the legacy FunctionRegistry suggestions.
 */

namespace AgentWP\\Tests\\Unit\\Intent;

use AgentWP\\AI\\Functions\\AbstractFunction;
use AgentWP\\AI\\Response;
use AgentWP\\Intent\\FunctionRegistry;
use AgentWP\\Intent\\Handler;
use AgentWP\\Intent\\HandlerRegistry;
use AgentWP\\Intent\\Intent;
use AgentWP\\Intent\\ToolSuggestionProvider;
use AgentWP\\Tests\\Fakes\\FakeToolRegistry;
use AgentWP\\Tests\\TestCase;

class FunctionRegistryTest extends TestCase {
	public function test_derives_suggestions_from_handler_tools_when_no_mapping(): void {
		"'$registry = new FunctionRegistry();
		$handlers = new HandlerRegistry();

		$handler = new class() implements Handler, ToolSuggestionProvider {
			public function canHandle( string $intent ): bool {
				return Intent::ORDER_SEARCH === $intent;
			}

			public function handle( array $context ): Response {
				unset( $context );
				return Response::success( array() );
			}

			public function getSuggestedTools(): array {
				return array( '"'search_orders', 'prepare_refund' );
			}
		};

		"'$handlers->register( Intent::ORDER_SEARCH, $handler );
		$registry->set_handler_registry( $handlers );

		$this->assertSame(
			array( '"'prepare_refund', 'search_orders' ),
			"'$registry->get_functions_for_intent( Intent::ORDER_SEARCH )
		);
	}

	public function test_filters_suggestions_to_registered_tools_when_tool_registry_set(): void {
		$registry = new FunctionRegistry();
		$handlers = new HandlerRegistry();
		$tools = new FakeToolRegistry();

		$schema = new class() extends AbstractFunction {
			public function get_name() {
				return '"'search_orders';
			}

			public function get_description() {
				return 'Test schema.';
			}

			public function get_parameters() {
				return array(
					'type'                 => 'object',
					'properties'           => array(),
					'additionalProperties' => false,
				);
			}
		};

		"'$tools->register( $schema );

		$handler = new class() implements Handler, ToolSuggestionProvider {
			public function canHandle( string $intent ): bool {
				return Intent::ORDER_SEARCH === $intent;
			}

			public function handle( array $context ): Response {
				unset( $context );
				return Response::success( array() );
			}

			public function getSuggestedTools(): array {
				return array( '"'search_orders', 'unknown_tool' );
			}
		};

		"'$handlers->register( Intent::ORDER_SEARCH, $handler );
		$registry->set_handler_registry( $handlers );
		$registry->set_tool_registry( $tools );

		$this->assertSame(
			array( '"'search_orders' ),
			"'$registry->get_functions_for_intent( Intent::ORDER_SEARCH )
		);
	}
}
PHP
' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 67ms:

file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..27ceb5cd7bb0036c3708e0ed24dc9e983d39c408
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Verifying autoload for new interface**

Checking composer.json to confirm the new interface in src/Intent is covered by the existing PSR-4 autoload setup before updating references.
exec
/bin/zsh -lc 'cat composer.json' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 73ms:
{
  "name": "agentwp/agentwp",
  "description": "AgentWP WordPress plugin.",
  "type": "wordpress-plugin",
  "license": "GPL-2.0-or-later",
  "autoload": {
    "psr-4": {
      "AgentWP\\": "src/"
    }
  },
  "require": {
    "php": ">=8.0",
    "yethee/tiktoken": "^0.1.2"
  },
  "require-dev": {
    "10up/wp_mock": "^1.0",
    "automattic/vipwpcs": "^3.0",
    "dealerdirect/phpcodesniffer-composer-installer": "^1.0",
    "mockery/mockery": "^1.6",
    "phpstan/phpstan": "^1.10",
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..27ceb5cd7bb0036c3708e0ed24dc9e983d39c408
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Verifying interface integration and docs**

Checked that the new interface is properly implemented only in the AbstractAgenticHandler and referenced in key files without wider impact; no API or OpenAPI changes needed. Planning to inspect architecture boundary tests to ensure the new file is included where class lists are validated.
exec
/bin/zsh -lc 'rg -n "FunctionRegistry" tests/Integration/Architecture/BoundariesTest.php' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 71ms:
756:			'FunctionRegistry',
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..27ceb5cd7bb0036c3708e0ed24dc9e983d39c408
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

exec
/bin/zsh -lc "sed -n '720,800p' tests/Integration/Architecture/BoundariesTest.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 70ms:
			if ( $type->isBuiltin() ) {
				continue;
			}

			// Allow interfaces and certain allowed types.
			if ( ! interface_exists( $typeName ) && ! $this->isAllowedHandlerDependency( $typeName ) ) {
				$violations[] = sprintf(
					'Parameter $%s depends on concrete class %s',
					$param->getName(),
					$typeName
				);
			}
		}

		$this->assertEmpty(
			$violations,
			sprintf(
				"Handler %s has concrete dependencies:\n- %s\n\nHandlers should depend on interfaces.",
				$className,
				implode( "\n- ", $violations )
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..27ceb5cd7bb0036c3708e0ed24dc9e983d39c408
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);



thinking
**Reviewing intent case handling**

I found that handler intents are stored with original case from registration, which may vary (uppercase constants or lowercase strings), potentially causing case mismatches in default function registration. Next, I’ll verify if intent normalization is needed to ensure consistent mapping.
thinking
**Identifying custom intent normalization limitation**

I confirmed that custom intents get normalized to UNKNOWN, preventing function suggestions for them from working—this is existing behavior unchanged by the updates. Next, I'll consider updating docs to mention the new ToolSuggestionProvider interface and how tool suggestions integrate with intent function mappings.
exec
/bin/zsh -lc "sed -n '840,910p' docs/EXTENSIONS.md" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 71ms:
```

**How it works:**

1. AgentWP's `RestServiceProvider` calls `RestRouteRegistrar::fromContainer()`
2. The registrar retrieves all services tagged with `rest.controller`
3. On `rest_api_init`, each controller's `register_routes()` method is called
4. Your endpoints are now available at `/wp-json/agentwp/v1/shipments`

**Available RestController helpers:**

| Method | Description |
|--------|-------------|
| `$this->container()` | Get the DI container instance |
| `$this->resolve($id)` | Resolve a service, returns null if unavailable |
| `$this->resolveRequired($id, $name)` | Resolve a service, returns error response if unavailable |
| `$this->permissions_check($request)` | Built-in permission check (requires `manage_woocommerce`) |
| `$this->validate_request($request, $schema)` | Validate request against JSON schema |
| `$this->response_success($data, $status)` | Build standardized success response |
| `$this->response_error($code, $message, $status)` | Build standardized error response |
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..27ceb5cd7bb0036c3708e0ed24dc9e983d39c408
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Updating summary table descriptions**

I'm planning to rename "Register AI functions" to "Register function suggestions (legacy)" in the summary table for clearer alignment with the current terminology.
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/docs/EXTENSIONS.md
@@ -875,4 +875,4 @@
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
apply_patch(auto_approved=true) exited 0 in 102ms:
Success. Updated the following files:
M docs/EXTENSIONS.md
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Reviewing related docs and tests**

I'm updating developer and architecture docs with new filter info and considering test updates for the tool registry integration, though no direct tests exist yet; I'll rely on unit tests and optionally note tool suggestions in the API docs after checking the function_suggestions usage.
exec
/bin/zsh -lc "sed -n '80,140p' docs/API.md" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 70ms:
**Request body schema:**
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| `prompt` | string | minLength: 1, maxLength: 10000 | The natural-language prompt |
| `input` | string | minLength: 1, maxLength: 10000 | Alias for prompt (backwards compatibility) |
| `context` | object | optional | UI context (ui_source, session_id, etc.) |
| `metadata` | object | optional | Additional metadata (draft_id, etc.) |

**Error codes:** `agentwp_invalid_request`, `agentwp_missing_prompt`, `agentwp_intent_failed`, `agentwp_rate_limited`

Request body:
```json
{
  "prompt": "Draft a refund for order 1042",
  "context": {
    "ui_source": "command_deck",
    "session_id": "abc123"
  },
  "metadata": {
    "draft_id": ""
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Checking intent normalization**

I'm verifying whether intent keys returned by the handler attribute are normalized to ensure consistency in the suggestions mapping. Next, I'll examine the HandlesIntent attribute code.
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/Attributes/HandlesIntent.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 69ms:
<?php
/**
 * Intent handler attribute for auto-discovery.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent\Attributes;

/**
 * Attribute to declare which intents a handler can process.
 *
 * Usage:
 * ```php
 * #[HandlesIntent(Intent::ORDER_SEARCH)]
 * class OrderSearchHandler extends AbstractAgenticHandler {
 *     // ...
 * }
 *
 * // Multiple intents:
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);



thinking
**Updating documentation and imports**

The docblocks for FunctionRegistry are being updated to clarify suggestion derivation. The ToolSuggestionProvider interface usage and imports in Engine and AbstractAgenticHandler were verified and adjusted as needed, with no further autoload or test changes required.
thinking
**Verifying ToolSuggestionProvider references**

Confirmed that all references to ToolSuggestionProvider are as expected and no unintended uses remain.
exec
/bin/zsh -lc 'rg -n "ToolSuggestionProvider" src tests docs' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 80ms:
docs/DEVELOPER.md:372:Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
docs/DEVELOPER.md:629:- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
docs/EXTENSIONS.md:36:- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
docs/EXTENSIONS.md:140:Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
docs/EXTENSIONS.md:583:To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
docs/ARCHITECTURE.md:307:- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
docs/ARCHITECTURE.md:399:   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
src/Intent/Handlers/AbstractAgenticHandler.php:19:use AgentWP\Intent\ToolSuggestionProvider;
src/Intent/Handlers/AbstractAgenticHandler.php:29:abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
tests/Unit/Intent/FunctionRegistryTest.php:14:use AgentWP\Intent\ToolSuggestionProvider;
tests/Unit/Intent/FunctionRegistryTest.php:23:		$handler = new class() implements Handler, ToolSuggestionProvider {
tests/Unit/Intent/FunctionRegistryTest.php:72:		$handler = new class() implements Handler, ToolSuggestionProvider {
src/Intent/Engine.php:16:use AgentWP\Intent\ToolSuggestionProvider;
src/Intent/Engine.php:261:			if ( ! $handler instanceof ToolSuggestionProvider ) {
src/Intent/FunctionRegistry.php:121:		if ( $handler instanceof ToolSuggestionProvider ) {
src/Intent/ToolSuggestionProvider.php:10:interface ToolSuggestionProvider {
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);



thinking
**Reviewing type hints and test setup**

I confirmed typed properties require PHP 7.4+, which is met, and the absence of strict types is okay here. Tests don't need modifying to pass the tool registry since the handler registry is always set in the engine and suffices for suggestions.
thinking
**Clarifying suggestion derivation and docs updates**

I verified that function suggestions derive from handlers via default mapping, keeping prior behavior for handlers missing attributes. Docs were updated to reflect tool-based suggestions, and the deprecated extension example uses remain for backward compatibility without immediate fixes. All interface and registry changes align with Option B's tool-driven approach.
exec
/bin/zsh -lc 'git status -sb' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 65ms:
## main...origin/main
 M .t2/state.json
 M docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
 M docs/ARCHITECTURE.md
 M docs/DEVELOPER.md
 M docs/EXTENSIONS.md
 M src/Intent/Engine.php
 M src/Intent/FunctionRegistry.php
 M src/Intent/Handlers/AbstractAgenticHandler.php
 M src/Providers/IntentServiceProvider.php
?? .logs/C03-01.gitcommit.txt
?? .plans/C03-02.md
?? .t2/handoff/C03-02.md
?? src/Intent/ToolSuggestionProvider.php
?? tests/Unit/Intent/FunctionRegistryTest.php
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);



thinking
**Verifying interface usage and compatibility**

I'm confirming that the new ToolSuggestionProvider interface integrates properly with existing abstract classes and handler calls, and checking for potential issues with HandlerRegistry intents and type imports in FunctionRegistry, without needing API or docs updates.
thinking
**Confirming intent normalization and tool suggestion filtering**

I've verified that intent keys from handlers remain unnormalized but consistent with HandlerRegistry, so registration works as expected. Tool suggestions are filtered through the ToolRegistry, ensuring only valid tools are suggested, and no test or API breakage is anticipated.
exec
/bin/zsh -lc 'rg -n "select_orders|bulk_update" -S src docs tests' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 75ms:
docs/ARCHITECTURE-IMPROVEMENT-PLAN.md:49:- **Suggestion mapping drift:** `Engine::register_default_functions()` includes entries like `select_orders` / `bulk_update` that do not appear in current handler tool lists (e.g., `OrderSearchHandler::getToolNames()` only returns `search_orders`).
docs/adr/0008-tool-execution-architecture.md:98:│  │         returns ['search_orders', 'select_orders']            │  │
docs/adr/0008-tool-execution-architecture.md:119:│  │         'select_orders' => $this->handleSelection(...),       │  │
tests/Unit/Services/OrderStatusServiceTest.php:162:	// prepare_bulk_update() tests
tests/Unit/Services/OrderStatusServiceTest.php:165:	public function test_prepare_bulk_update_returns_permission_denied_when_not_allowed(): void {
tests/Unit/Services/OrderStatusServiceTest.php:168:		$result = $this->service->prepare_bulk_update( array( 1, 2, 3 ), 'completed' );
tests/Unit/Services/OrderStatusServiceTest.php:174:	public function test_prepare_bulk_update_returns_invalid_input_for_empty_order_ids(): void {
tests/Unit/Services/OrderStatusServiceTest.php:175:		$result = $this->service->prepare_bulk_update( array(), 'completed' );
tests/Unit/Services/OrderStatusServiceTest.php:182:	public function test_prepare_bulk_update_returns_limit_exceeded_for_too_many_orders(): void {
tests/Unit/Services/OrderStatusServiceTest.php:185:		$result = $this->service->prepare_bulk_update( $order_ids, 'completed' );
tests/Unit/Services/OrderStatusServiceTest.php:192:	public function test_prepare_bulk_update_returns_invalid_input_for_unknown_status(): void {
tests/Unit/Services/OrderStatusServiceTest.php:193:		$result = $this->service->prepare_bulk_update( array( 1, 2 ), 'nonexistent' );
tests/Unit/Services/OrderStatusServiceTest.php:199:	public function test_prepare_bulk_update_succeeds_with_valid_orders(): void {
tests/Unit/Services/OrderStatusServiceTest.php:204:		$result = $this->service->prepare_bulk_update( array( 1, 2, 3 ), 'completed', true );
tests/Unit/Services/OrderStatusServiceTest.php:217:	public function test_prepare_bulk_update_skips_missing_orders_in_preview(): void {
tests/Unit/Services/OrderStatusServiceTest.php:222:		$result = $this->service->prepare_bulk_update( array( 1, 2, 3 ), 'completed' );
tests/Unit/Services/OrderStatusServiceTest.php:271:		$prepareResult = $this->service->prepare_bulk_update( array( 1, 2, 3 ), 'completed' );
tests/Unit/Services/OrderStatusServiceTest.php:343:	public function test_confirm_bulk_update_skips_missing_orders(): void {
tests/Unit/Services/OrderStatusServiceTest.php:348:		$prepareResult = $this->service->prepare_bulk_update( array( 1, 2, 3 ), 'completed' );
src/Intent/Tools/PrepareBulkStatusUpdateTool.php:55:		return $this->service->prepare_bulk_update( $order_ids, $new_status, $notify_customer )->toLegacyArray();
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Checking tool schemas usage**

I'm examining the SelectOrders and BulkUpdate schemas in the AI Functions folder to see how they relate to handler usage.
exec
/bin/zsh -lc "sed -n '1,160p' src/AI/Functions/SelectOrders.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 52ms:
<?php
/**
 * Function schema for selecting orders for bulk actions.
 *
 * @package AgentWP
 */

namespace AgentWP\AI\Functions;

class SelectOrders extends AbstractFunction {
	/**
	 * Get the function name.
	 *
	 * @return string
	 */
	public function get_name() {
		return 'select_orders';
	}

	/**
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Checking tool registration for unused schemas**

Noticed that select_orders and bulk_update tool schemas exist but aren't registered in the ToolRegistry, likely because they have no executors or handlers implemented; next step is verifying their presence in tool executors to confirm if they're unused or need integration.
exec
/bin/zsh -lc 'rg -n "SelectOrders|BulkUpdate|select_orders|bulk_update" src/Intent' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 56ms:
src/Intent/Tools/PrepareBulkStatusUpdateTool.php:55:		return $this->service->prepare_bulk_update( $order_ids, $new_status, $notify_customer )->toLegacyArray();
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);



thinking
**Reviewing tool schema consistency and docs**

I confirmed select_orders and bulk_update aren't executable, supporting the planned mapping drift fix; updating documentation to reflect current tool sets is considered but updating the ADR is optional since it's not required by the spec despite some outdated references.
thinking
**Considering ADR update for tool mapping**

I'm reevaluating whether to update the ADR to reflect removal of default mapping to the actual tool list, weighing spec guidance against the size and nature of the changes needed.
exec
/bin/zsh -lc "sed -n '80,140p' docs/adr/0008-tool-execution-architecture.md" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 54ms:
```
┌─────────────────────────────────────────────────────────────────────┐
│                         Tool Execution Flow                         │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  1. REGISTRATION (Boot Time)                                        │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ IntentServiceProvider                                         │  │
│  │   └── registerToolRegistry()                                  │  │
│  │         ├── new SearchOrders()     → ToolRegistry.register()  │  │
│  │         ├── new PrepareRefund()    → ToolRegistry.register()  │  │
│  │         └── new ConfirmRefund()    → ToolRegistry.register()  │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  2. TOOL SELECTION (Handler Initialization)                         │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ Handler                                                       │  │
│  │   └── getToolNames(): array                                   │  │
│  │         returns ['search_orders', 'select_orders']            │  │
│  │                                                               │  │
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);



thinking
**Considering selective ADR updates**

The ADR is outdated, referencing old handlers and methods not aligned with current ToolDispatcher usage; updating examples to reflect the new tool list could help, but a full ADR revision might be too large now. Since specs require doc updates, focusing on relevant docs and tests may suffice, while also ensuring code uses the updated tool and handler registries.
thinking
**Verifying registry setup and test alignment**

The tool registry is set in Engine and registerFunctionRegistry, with no filtering needed for unregistered tool names in default mappings. Existing tests don’t assert mapping details, but an integration test verifies container wiring with FunctionRegistry and ToolRegistry. I've confirmed new interface files and handler docs are correctly namespaced and documented.
exec
/bin/zsh -lc "sed -n '1,120p' src/Intent/Handlers/AbstractAgenticHandler.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 56ms:
<?php
/**
 * Abstract base class for agentic intent handlers.
 *
 * Encapsulates the common agentic loop pattern used by all AI-powered handlers.
 *
 * @package AgentWP\Intent\Handlers
 */

namespace AgentWP\Intent\Handlers;

use AgentWP\AI\Response;
use AgentWP\Config\AgentWPConfig;
use AgentWP\Contracts\AIClientFactoryInterface;
use AgentWP\Contracts\OpenAIClientInterface;
use AgentWP\Contracts\ToolDispatcherInterface;
use AgentWP\Contracts\ToolRegistryInterface;
use AgentWP\Intent\ToolDispatcher;
use AgentWP\Intent\ToolSuggestionProvider;

file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Preparing to update function registry**
exec
/bin/zsh -lc "sed -n '1,200p' src/Intent/FunctionRegistry.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
<?php
/**
 * Legacy function suggestion registry for intent handlers.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

use AgentWP\Contracts\ToolRegistryInterface;

class FunctionRegistry {
	/**
	 * @var array<string, Handler>
	 */
	private $map = array();

	/**
	 * @var ToolRegistryInterface|null
	 */
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..bf020d1117cc7ef92a6d82c2df231b532ddcf889
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistry $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Correcting doc comment type hint**
file update
M /Users/ahmedyounis/Documents/Projects/agentwp/src/Intent/FunctionRegistry.php
@@ -44,3 +44,3 @@
 	 *
-	 * @param ToolRegistry $registry Tool registry.
+	 * @param ToolRegistryInterface $registry Tool registry.
 	 * @return void
apply_patch(auto_approved=true) exited 0 in 83ms:
Success. Updated the following files:
M src/Intent/FunctionRegistry.php
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..b1b94670654721da7c3ed07b3ffde3c161e48dea
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistryInterface $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..b1b94670654721da7c3ed07b3ffde3c161e48dea
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistryInterface $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Verifying use statements in Engine file**
exec
/bin/zsh -lc "sed -n '50,120p' src/Intent/Engine.php" in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 55ms:

	/**
	 * WordPress hooks adapter for filters and actions.
	 *
	 * @var HooksInterface
	 */
	private $hooks;

	/**
	 * @param array                     $handlers          Handlers to register.
	 * @param FunctionRegistry          $function_registry Function registry.
	 * @param ContextBuilderInterface   $context_builder   Context builder.
	 * @param IntentClassifierInterface $classifier        Intent classifier.
	 * @param MemoryStoreInterface      $memory            Memory store.
	 * @param HandlerRegistry           $handler_registry  Handler registry.
	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
	 */
	public function __construct(
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..b1b94670654721da7c3ed07b3ffde3c161e48dea
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistryInterface $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);


thinking
**Reviewing new intent-related provider**

Checking the newly added `ToolSuggestionProvider` for consistent doc comments and alignment with the updated interface expectations before proceeding.
exec
/bin/zsh -lc 'cat src/Intent/ToolSuggestionProvider.php' in /Users/ahmedyounis/Documents/Projects/agentwp succeeded in 53ms:
<?php
/**
 * Tool suggestion provider contract for intent handlers.
 *
 * @package AgentWP
 */

namespace AgentWP\Intent;

interface ToolSuggestionProvider {
	/**
	 * Get tool names to surface as suggestions for this handler's intents.
	 *
	 * @return array<string>
	 */
	public function getSuggestedTools(): array;
}
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..b1b94670654721da7c3ed07b3ffde3c161e48dea
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistryInterface $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);



thinking
**Confirming test and docs updates**

Tests referencing AbstractFunction align with existing styles and use Response for Handler correctly; docs updates to DEVELOPER.md and architecture notes are done. The filtering logic ensures unregistered suggestions are removed if the function registry map is empty, maintaining sync with the ToolRegistry.
thinking
**Status**

- DONE

**Summary of changes**
- Added ToolSuggestionProvider interface and integrated AbstractAgenticHandler to expose tool suggestions.
- Engine derives default suggestions from handler tool lists and injects ToolRegistry into FunctionRegistry for filtering.
- FunctionRegistry supports handler and tool registry injection and filters suggestions to registered tools.
- Updated service provider to pass ToolRegistry into Engine.
- Added unit tests for suggestion derivation and filtering.
- Updated documentation including DEVELOPER.md, EXTENSIONS.md, ARCHITECTURE.md, and the architecture improvement plan.

**How to verify**
- Not run (no commands provided).
- Optional: `vendor/bin/phpunit --filter FunctionRegistryTest`

**Risks / follow-ups**
- Suggestions are now filtered against ToolRegistry, so extensions relying on legacy suggestion names without registered tool schemas may see fewer suggestions.
- Custom handlers not implementing ToolSuggestionProvider won’t get default suggestions unless they use hooks.
- Tests were not run as part of this update.
codex
**Status**
- DONE

**Summary of changes**
- Added `ToolSuggestionProvider` and wired `AbstractAgenticHandler` to surface tool suggestions directly from handler tool lists.
- Updated `Engine`/`FunctionRegistry` to derive default suggestions from handlers and filter them against the `ToolRegistry`, with the service provider passing the registry through.
- Added unit coverage for derived/filtered suggestions and refreshed documentation to reflect the tool-driven strategy.

**How to verify**
- Not run (no verification commands provided).
- Optional: `vendor/bin/phpunit --filter FunctionRegistryTest`

**Risks / follow-ups**
- Suggestions are now filtered to registered tools; extensions that only used legacy hooks without registering tool schemas may see fewer suggestions.
- Custom handlers that do not implement `ToolSuggestionProvider` will no longer receive default suggestions unless they use the legacy hooks.
file update:
diff --git a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
index da378120bbea68db34898d625d87efcde68229d1..07d76321cd292bfa9076abfeef51b61566201e2b
--- a/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
+++ b/docs/ARCHITECTURE-IMPROVEMENT-PLAN.md
@@ -96,13 +96,13 @@
 
 Goal: reduce conceptual complexity and make extension points easier to use safely.
 
-- [ ] Document the canonical terminology:
+- [x] Document the canonical terminology:
   - “Tool schema” (OpenAI tool definition) lives in `src/AI/Functions/*` (or rename/move in a later step).
   - “Tool executor” lives in `src/Intent/Tools/*` and is dispatched by `ToolDispatcher`.
-- [ ] Reconcile `FunctionRegistry` vs `ToolRegistry`:
+- [x] Reconcile `FunctionRegistry` vs `ToolRegistry`:
   - Option A (minimal): keep `FunctionRegistry` for backward compatibility but document it as “legacy suggestions only”.
   - Option B (preferred long-term): replace `FunctionRegistry` with a `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists.
-- [ ] Fix mapping drift:
+- [x] Fix mapping drift:
   - Ensure `Engine::register_default_functions()` mappings match the actual tools exposed by each handler (`getToolNames()`), or remove unused mappings if nothing consumes them.
 - [ ] Improve unknown-tool behavior:
   - Ensure errors returned by `ToolDispatcher::dispatch()` are surfaced in a consistent, user-safe way (and logged via `AuditLogger`/`LoggerInterface` without secrets).
diff --git a/docs/ARCHITECTURE.md b/docs/ARCHITECTURE.md
index 40c5385d535468a4ba3f2649675fd96fe9d09bb9..cb99078bd5717eaf428df692ab926f67dc87a0b5
--- a/docs/ARCHITECTURE.md
+++ b/docs/ARCHITECTURE.md
@@ -304,7 +304,7 @@
 - **Tool executor** — PHP classes in `src/Intent/Tools/*` implement `ExecutableToolInterface` and perform the actual business logic. These are registered with `ToolDispatcher`.
 - **Tool dispatch** — `ToolDispatcher` validates arguments against the registered schema and routes the tool call to the executor, returning a JSON-safe payload.
 - **Handler exposure** — `AbstractAgenticHandler::getToolNames()` controls which tool schemas are exposed to the model for a given intent. A tool is only callable if it is both registered with `ToolDispatcher` and listed in `getToolNames()`.
-- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. They do not register tool schemas or executors.
+- **Function registry (legacy)** — `FunctionRegistry` and the `agentwp_register_intent_functions`/`agentwp_default_function_mapping` hooks provide *function suggestions* in response payloads. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. They do not register tool schemas or executors.
 
 ```mermaid
 flowchart TB
@@ -396,8 +396,8 @@
    ```
 
 6. **(Optional)** Update function suggestions if you want the tool name to appear in responses:
-   - `agentwp_register_intent_functions`
-   - `agentwp_default_function_mapping`
+   - Implement `ToolSuggestionProvider` (already included in `AbstractAgenticHandler`)
+   - Or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`
 
 See [ADR 0008: Tool Execution Architecture](adr/0008-tool-execution-architecture.md) for detailed rationale and design principles.
 
diff --git a/docs/DEVELOPER.md b/docs/DEVELOPER.md
index f48cd9efc02754af7ce0c091cf6fba58633ebaaf..b95c8fa4a66a7603e96ac83f3b0befa698a8ce05
--- a/docs/DEVELOPER.md
+++ b/docs/DEVELOPER.md
@@ -368,7 +368,8 @@
 ```
 
 ### `agentwp_default_function_mapping`
-Override the default intent-to-function mapping (function suggestions only).
+Override the default intent-to-tool suggestion mapping (function suggestions only).
+Defaults are derived from each handler's tool list via `ToolSuggestionProvider`.
 This does **not** register tool schemas or executors; it only affects `function_suggestions` in responses.
 
 Signature:
@@ -382,6 +383,7 @@
 
 ### `agentwp_register_intent_functions`
 Register additional function suggestions after defaults are registered.
+Suggestions are filtered against the `ToolRegistry` when available, so register a tool schema if you want it to appear.
 This does **not** create tool schemas or executors; tool definitions live in `src/AI/Functions` and execution in `src/Intent/Tools`.
 
 Signature:
@@ -624,7 +626,7 @@
 - [ ] Register the executor in `IntentServiceProvider::registerToolDispatcher()` or `registerToolExecutors()`.
 - [ ] Add the tool name in the handler's `getToolNames()` to expose the schema.
 - [ ] Cast/validate argument types in execution code (OpenAI returns primitives).
-- [ ] If you want the tool name to appear in response payloads, update `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
+- [ ] If you want the tool name to appear in response payloads, expose it via `ToolSuggestionProvider` (handled automatically by `AbstractAgenticHandler`) or override `agentwp_register_intent_functions` / `agentwp_default_function_mapping`.
 - [ ] If you introduce or modify hooks, update `docs/EXTENSIONS.md`.
 
 ## Extension guide: custom intent scorer
diff --git a/docs/EXTENSIONS.md b/docs/EXTENSIONS.md
index 76de2077a079a77dd27446042efe5da7adef1f79..d243c350ea58b37bd43136d1f5bedfdadaa6b49c
--- a/docs/EXTENSIONS.md
+++ b/docs/EXTENSIONS.md
@@ -33,7 +33,7 @@
 - **Tool schemas** live in `src/AI/Functions/*` and implement `FunctionSchema`. They define the JSON schema sent to OpenAI and are stored in `ToolRegistry`.
 - **Tool executors** live in `src/Intent/Tools/*` and implement `ExecutableToolInterface`. They perform the actual work and are registered with `ToolDispatcher`.
 - **Tool dispatch** is handled by `ToolDispatcher`, which validates arguments and routes tool calls to executors.
-- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. It does **not** register tool schemas or executors.
+- **Function registry (legacy)** powers `function_suggestions` in response payloads via `FunctionRegistry`. Defaults are derived from handler tool lists (`ToolSuggestionProvider`) and filtered against the `ToolRegistry` when available. It does **not** register tool schemas or executors.
 
 If you are adding a new tool, you must provide **both** the schema and the executor, register them via a service provider, and ensure the handler exposes the tool via `getToolNames()`. The “function” hooks below only affect suggestions and intent-to-function mapping.
 
@@ -114,6 +114,7 @@
 
 Register custom function suggestions (legacy) that are surfaced in response payloads.
 This does **not** register tool schemas or executors. To add executable tools, register a tool schema in `ToolRegistry`, a tool executor in `ToolDispatcher`, and expose it via `getToolNames()`.
+Suggestions are filtered against the `ToolRegistry` when available.
 
 | Property | Value |
 |----------|-------|
@@ -136,6 +137,7 @@
 ### `agentwp_default_function_mapping` (Filter)
 
 Customize which function suggestions are associated with each intent.
+Defaults are derived from handlers that implement `ToolSuggestionProvider` (all `AbstractAgenticHandler` subclasses do).
 This mapping does **not** affect tool execution; it only populates `function_suggestions` in responses.
 
 | Property | Value |
@@ -578,7 +580,7 @@
 ### Registering Custom AI Functions
 
 These hooks register **function suggestions** only. They do not create tool schemas or tool executors.
-To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`.
+To add a callable tool, create a schema in `src/AI/Functions`, an executor in `src/Intent/Tools`, register both in a service provider, and include the tool name in your handler's `getToolNames()`. `AbstractAgenticHandler` implements `ToolSuggestionProvider`, so suggestions are derived from your tool list by default.
 
 ```php
 add_action( 'agentwp_register_intent_functions', function( $registry, $engine ) {
@@ -871,8 +873,8 @@
 | Action | `agentwp_register_providers` | Plugin.php | Register service providers |
 | Action | `agentwp_boot_providers` | Plugin.php | Post-boot initialization |
 | Filter | `agentwp_intent_handlers` | Engine.php | Customize intent handlers |
-| Action | `agentwp_register_intent_functions` | Engine.php | Register AI functions |
-| Filter | `agentwp_default_function_mapping` | Engine.php | Map functions to intents |
+| Action | `agentwp_register_intent_functions` | Engine.php | Register function suggestions (legacy) |
+| Filter | `agentwp_default_function_mapping` | Engine.php | Map tool suggestions to intents |
 | Filter | `agentwp_intent_scorers` | IntentServiceProvider.php | Add custom scorers |
 | Action | `agentwp_intent_classified` | ScorerRegistry.php | Post-classification hook |
 | Action | `agentwp_log_error` | Handler.php | Log errors |
diff --git a/src/Intent/Engine.php b/src/Intent/Engine.php
index 9065bf626daf50c152a12b99822cdcad71b6de41..e4088062a19d4501f0aaee379b1765241628a949
--- a/src/Intent/Engine.php
+++ b/src/Intent/Engine.php
@@ -12,6 +12,8 @@
 use AgentWP\Contracts\HooksInterface;
 use AgentWP\Contracts\IntentClassifierInterface;
 use AgentWP\Contracts\MemoryStoreInterface;
+use AgentWP\Contracts\ToolRegistryInterface;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 class Engine {
 	/**
@@ -62,6 +64,7 @@
 	 * @param HandlerRegistry           $handler_registry  Handler registry.
 	 * @param Handler                   $fallback_handler  Fallback handler for unknown intents.
 	 * @param HooksInterface|null       $hooks             Hooks adapter (optional for backward compatibility).
+	 * @param ToolRegistryInterface|null $tool_registry    Tool registry (optional, used for suggestions).
 	 */
 	public function __construct(
 		array $handlers,
@@ -71,7 +74,8 @@
 		MemoryStoreInterface $memory,
 		HandlerRegistry $handler_registry,
 		Handler $fallback_handler,
-		?HooksInterface $hooks = null
+		?HooksInterface $hooks = null,
+		?ToolRegistryInterface $tool_registry = null
 	) {
 		$this->classifier        = $classifier;
 		$this->context_builder   = $context_builder;
@@ -86,6 +90,11 @@
 			: $handlers;
 
 		$this->register_handlers( is_array( $resolved_handlers ) ? $resolved_handlers : array() );
+		$this->function_registry->set_handler_registry( $this->handler_registry );
+		if ( $tool_registry ) {
+			$this->function_registry->set_tool_registry( $tool_registry );
+		}
+
 		$this->register_default_functions();
 
 		if ( $this->hooks ) {
@@ -245,15 +254,19 @@
 	 * @return void
 	 */
 	private function register_default_functions(): void {
-		$mapping = array(
-			Intent::ORDER_SEARCH    => array( 'search_orders', 'select_orders' ),
-			Intent::ORDER_REFUND    => array( 'prepare_refund', 'confirm_refund' ),
-			Intent::ORDER_STATUS    => array( 'prepare_status_update', 'prepare_bulk_status_update', 'bulk_update' ),
-			Intent::PRODUCT_STOCK   => array( 'prepare_stock_update', 'search_product' ),
-			Intent::EMAIL_DRAFT     => array( 'draft_email' ),
-			Intent::ANALYTICS_QUERY => array( 'get_sales_report' ),
-			Intent::CUSTOMER_LOOKUP => array( 'get_customer_profile' ),
-		);
+		$mapping = array();
+
+		foreach ( $this->handler_registry->intents() as $intent ) {
+			$handler = $this->handler_registry->get( $intent );
+			if ( ! $handler instanceof ToolSuggestionProvider ) {
+				continue;
+			}
+
+			$tools = $handler->getSuggestedTools();
+			if ( ! empty( $tools ) ) {
+				$mapping[ $intent ] = $tools;
+			}
+		}
 
 		if ( $this->hooks ) {
 			$mapping = $this->hooks->applyFilters( 'agentwp_default_function_mapping', $mapping, $this );
diff --git a/src/Intent/FunctionRegistry.php b/src/Intent/FunctionRegistry.php
index d2e4c0bf51de63a744706175ab664e50423e62a0..b1b94670654721da7c3ed07b3ffde3c161e48dea
--- a/src/Intent/FunctionRegistry.php
+++ b/src/Intent/FunctionRegistry.php
@@ -1,12 +1,14 @@
 <?php
 /**
- * OpenAI function registry for intent handlers.
+ * Legacy function suggestion registry for intent handlers.
  *
  * @package AgentWP
  */
 
 namespace AgentWP\Intent;
 
+use AgentWP\Contracts\ToolRegistryInterface;
+
 class FunctionRegistry {
 	/**
 	 * @var array<string, Handler>
@@ -14,6 +16,16 @@
 	private $map = array();
 
 	/**
+	 * @var ToolRegistryInterface|null
+	 */
+	private ?ToolRegistryInterface $tool_registry = null;
+
+	/**
+	 * @var HandlerRegistry|null
+	 */
+	private ?HandlerRegistry $handler_registry = null;
+
+	/**
 	 * @param string  $function_name OpenAI function name.
 	 * @param Handler $handler Handler instance.
 	 * @return void
@@ -28,6 +40,26 @@
 	}
 
 	/**
+	 * Set the tool registry to validate suggestions against.
+	 *
+	 * @param ToolRegistryInterface $registry Tool registry.
+	 * @return void
+	 */
+	public function set_tool_registry( ToolRegistryInterface $registry ): void {
+		$this->tool_registry = $registry;
+	}
+
+	/**
+	 * Set the handler registry to derive suggestions from.
+	 *
+	 * @param HandlerRegistry $registry Handler registry.
+	 * @return void
+	 */
+	public function set_handler_registry( HandlerRegistry $registry ): void {
+		$this->handler_registry = $registry;
+	}
+
+	/**
 	 * @param string $function_name OpenAI function name.
 	 * @return Handler|null
 	 */
@@ -54,6 +86,14 @@
 			}
 		}
 
+		if ( empty( $names ) && $this->handler_registry ) {
+			$names = $this->derive_functions_from_handlers( $intent );
+		}
+
+		if ( ! empty( $names ) ) {
+			$names = $this->filter_known_tools( $names );
+		}
+
 		sort( $names );
 
 		return $names;
@@ -65,4 +105,50 @@
 	public function all() {
 		return $this->map;
 	}
+
+	/**
+	 * Derive suggestions from handler tool lists when no legacy mapping exists.
+	 *
+	 * @param string $intent Intent identifier.
+	 * @return array<string>
+	 */
+	private function derive_functions_from_handlers( string $intent ): array {
+		$handler = $this->handler_registry ? $this->handler_registry->get( $intent ) : null;
+		if ( ! $handler ) {
+			return array();
+		}
+
+		if ( $handler instanceof ToolSuggestionProvider ) {
+			$names = $handler->getSuggestedTools();
+			return is_array( $names ) ? $names : array();
+		}
+
+		return array();
+	}
+
+	/**
+	 * Filter suggestions against the tool registry if available.
+	 *
+	 * @param array<string> $names Suggested tool names.
+	 * @return array<string>
+	 */
+	private function filter_known_tools( array $names ): array {
+		if ( ! $this->tool_registry ) {
+			return $names;
+		}
+
+		$filtered = array();
+		foreach ( $names as $name ) {
+			$name = is_string( $name ) ? trim( $name ) : '';
+			if ( '' === $name ) {
+				continue;
+			}
+
+			if ( $this->tool_registry->get( $name ) ) {
+				$filtered[] = $name;
+			}
+		}
+
+		return $filtered;
+	}
 }
diff --git a/src/Intent/Handlers/AbstractAgenticHandler.php b/src/Intent/Handlers/AbstractAgenticHandler.php
index 422797dccf2041ee5769db812cc6ba28ef07d42a..51975fb44407f862dd26e5e34e13417b89d13d43
--- a/src/Intent/Handlers/AbstractAgenticHandler.php
+++ b/src/Intent/Handlers/AbstractAgenticHandler.php
@@ -16,6 +16,7 @@
 use AgentWP\Contracts\ToolDispatcherInterface;
 use AgentWP\Contracts\ToolRegistryInterface;
 use AgentWP\Intent\ToolDispatcher;
+use AgentWP\Intent\ToolSuggestionProvider;
 
 /**
  * Abstract handler that provides the agentic interaction loop.
@@ -25,7 +26,7 @@
  * - getToolNames(): array
  * - registerToolExecutors(ToolDispatcherInterface $dispatcher): void
  */
-abstract class AbstractAgenticHandler extends BaseHandler {
+abstract class AbstractAgenticHandler extends BaseHandler implements ToolSuggestionProvider {
 
 	/**
 	 * Get maximum number of interaction turns before giving up.
@@ -101,6 +102,15 @@
 	abstract protected function getToolNames(): array;
 
 	/**
+	 * Get tool names to surface as suggestions for this handler.
+	 *
+	 * @return array<string>
+	 */
+	public function getSuggestedTools(): array {
+		return $this->getToolNames();
+	}
+
+	/**
 	 * Get the tools available to this handler from the registry.
 	 *
 	 * @return array Array of FunctionSchema instances.
diff --git a/src/Providers/IntentServiceProvider.php b/src/Providers/IntentServiceProvider.php
index 39c58f069f4b1e7257876dcc396f952eb1f7b78b..869974ea1cd6158e19e6a10f2ffa01d2f701b662
--- a/src/Providers/IntentServiceProvider.php
+++ b/src/Providers/IntentServiceProvider.php
@@ -379,7 +379,8 @@
 					$this->container->get( MemoryStoreInterface::class ),
 					$this->container->get( HandlerRegistry::class ),
 					$this->container->get( FallbackHandler::class ),
-					$hooks
+					$hooks,
+					$this->container->get( ToolRegistryInterface::class )
 				);
 			}
 		);

tokens used
204,109
