All 519 tests pass. The refactoring is complete.

---

## Status: DONE

## Summary of changes

1. **ProductStockService.php** (`src/Services/ProductStockService.php:59`)
   - Replaced `instanceof \WC_Product` check with a null check (`null === $product`)
   - The gateway already validates products and returns null for invalid ones, so the service no longer needs to check WooCommerce types directly

2. **OrderFormatter.php** (`src/Services/OrderSearch/OrderFormatter.php`)
   - Removed unused `WC_Order` import statement
   - Removed dead code methods that directly depended on `WC_Order`:
     - `format(WC_Order $order)` 
     - `formatMany(array $orders)`
     - `getCustomerName(WC_Order $order)`
     - `getCustomerEmail(WC_Order $order)`
     - `formatItemsSummary(WC_Order $order)`
     - `formatShippingAddress(WC_Order $order)`
   - Kept only the DTO-based methods: `formatDTO()`, `formatManyDTOs()`, `formatQuerySummary()`, and `sanitizeAddressArray()`

## How to verify

```bash
# Run all tests
./vendor/bin/phpunit --testdox

# Run specific service tests
./vendor/bin/phpunit tests/Unit/Services/ProductStockServiceTest.php --testdox

# Verify no WP/WC globals in Services directory
grep -r "WC_Order\|WC_Product\|wc_get_\|get_option\|update_option" src/Services/
```

## Risks / follow-ups

- **Low risk**: The removed `format()` and `formatMany()` methods in OrderFormatter were confirmed to be unused (dead code). If any external code was using these methods, they would need to be updated to use `formatDTO()` and `formatManyDTOs()` instead.
- **None identified for ProductStockService**: The change is semantically equivalent - the gateway already returns null for invalid products, so the behavior is unchanged.
