All changes are complete. Let me provide a summary:

---

**Status: DONE**

## Summary of Changes

### Files Modified:

1. **`src/Config/AgentWPConfig.php`**
   - Added `ERROR_CODE_SERVICE_UNAVAILABLE = 'agentwp_service_unavailable'` constant for 500 error responses when required dependencies cannot be resolved

2. **`src/API/RestController.php`**
   - Added new `resolveRequired()` method that returns a 500 error response when a required dependency cannot be resolved from the container
   - Provides clear error messages indicating why the service is unavailable (container not initialized, not registered, resolved to null, or exception thrown)

3. **`src/Rest/IntentController.php`** (lines 69-72)
   - Replaced broken fallback pattern `$engine = $this->resolve(Engine::class); if (!$engine) { $engine = new Engine(); }` 
   - Now uses `resolveRequired(Engine::class, 'Intent engine')` which returns 500 error if Engine cannot be resolved
   - Removed broken fallback that would create an Engine with no handlers

4. **`src/Rest/AnalyticsController.php`** (lines 52-56)
   - Replaced fallback pattern `$service = $this->resolve(AnalyticsServiceInterface::class); if (!$service) { $service = new AnalyticsService(); }`
   - Now uses `resolveRequired(AnalyticsServiceInterface::class, 'Analytics service')`
   - Removed unused `AnalyticsService` import

## How to Verify

```bash
# Check PHP syntax
php -l src/Config/AgentWPConfig.php
php -l src/API/RestController.php
php -l src/Rest/IntentController.php
php -l src/Rest/AnalyticsController.php

# Run tests (if available)
./vendor/bin/phpunit

# Manual verification:
# 1. When container is properly initialized, /intent and /analytics endpoints work normally
# 2. If Engine or AnalyticsService is not registered in container, endpoints return 500 with clear error message
```

## Acceptance Criteria Verification

- **No core controller instantiates domain services directly in normal runtime**: Verified by grep for `new [A-Z]` patterns - only `WP_Error` instantiations remain (WordPress core types, not domain services)
- **Clear 500 error when required dependency cannot be resolved**: `resolveRequired()` returns structured error response with `agentwp_service_unavailable` code

## Risks / Follow-ups

1. **Risk**: If the container is not properly bootstrapped (e.g., service providers not registered), the `/intent` and `/analytics` endpoints will now return 500 errors instead of silently working with broken fallbacks. This is the intended behavior.

2. **Follow-up consideration**: Static utility classes like `Index` (search) and `UsageTracker` (billing) remain as static method calls. These are infrastructure/data access classes, not domain services, so they don't need container injection. However, if testing requirements change, consider refactoring them to interfaces.
