---

## Status: DONE

## Summary of Changes

Implemented executable tools for order operations following the spec in C04-04.md. The key changes:

### New Files Created:

1. **`src/Contracts/ExecutableToolInterface.php`** - Contract defining `getName()` and `execute(array $arguments): array` methods for self-contained tools

2. **`src/Intent/Tools/SearchOrdersTool.php`** - Executable tool calling `OrderSearchServiceInterface::handle()`

3. **`src/Intent/Tools/PrepareRefundTool.php`** - Executable tool calling `OrderRefundServiceInterface::prepare_refund()`

4. **`src/Intent/Tools/ConfirmRefundTool.php`** - Executable tool calling `OrderRefundServiceInterface::confirm_refund()`

5. **`src/Intent/Tools/PrepareStatusUpdateTool.php`** - Executable tool calling `OrderStatusServiceInterface::prepare_status_update()`

6. **`src/Intent/Tools/PrepareBulkStatusUpdateTool.php`** - Executable tool calling `OrderStatusServiceInterface::prepare_bulk_status_update()`

7. **`src/Intent/Tools/ConfirmStatusUpdateTool.php`** - Executable tool calling `OrderStatusServiceInterface::confirm_status_update()`

8. **`tests/Fakes/FakeToolDispatcher.php`** - Test double for `ToolDispatcherInterface` with tool registration support

### Modified Files:

1. **`src/Contracts/ToolDispatcherInterface.php`** - Added `registerTool()` and `registerTools()` methods

2. **`src/Intent/ToolDispatcher.php`** - Implemented new interface methods for registering `ExecutableToolInterface` instances

3. **`src/Providers/IntentServiceProvider.php`** - Added `registerToolDispatcher()` to centrally wire all tools and updated handler registrations

4. **`src/Intent/Handlers/OrderSearchHandler.php`** - Updated constructor to accept `ToolDispatcherInterface` instead of service; `registerToolExecutors()` now no-op

5. **`src/Intent/Handlers/OrderRefundHandler.php`** - Same pattern as above

6. **`src/Intent/Handlers/OrderStatusHandler.php`** - Same pattern as above

7. **`tests/Unit/OrderRefundHandlerTest.php`** - Updated to use new constructor signature with `FakeToolDispatcher`

8. **`tests/Unit/Intent/Handlers/OrderSearchHandlerTest.php`** - Updated to use new constructor signature

9. **`tests/Unit/Intent/Handlers/SimpleHandlersTest.php`** - Updated to use new constructor signatures with pre-registered tools

10. **`tests/Unit/Validation/ToolArgumentValidationIntegrationTest.php`** - Updated to use new constructor signature

## How to Verify

```bash
# Run all intent-related tests
./vendor/bin/phpunit --filter "Intent"

# Run handler tests specifically
./vendor/bin/phpunit --filter "OrderRefundHandlerTest|OrderSearchHandlerTest|SimpleHandlersTest|ToolArgumentValidationIntegrationTest"

# Run full test suite (excluding pre-existing Search module issues)
./vendor/bin/phpunit --filter "^(?!.*Search)"
```

Expected: All tests pass (109 intent tests, 715 non-search tests)

## Risks / Follow-ups

1. **Pre-existing Search module test failures** - 8 tests in `tests/Unit/Search/` fail due to undefined constants (`DEFAULT_LIMIT`, `BACKFILL_LIMIT`, `BACKFILL_WINDOW`). These are unrelated to this task.

2. **Deprecation warnings** - `IntentClassifier` shows deprecation warnings during tests. This is expected per ADR-0003.

3. **FakeToolDispatcher doesn't validate** - The test double bypasses argument validation. For validation-specific tests, we simulate validation failure by not registering tools. This is a conscious test design choice.
