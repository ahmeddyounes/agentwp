id,title,spec
C01-01,"Fix docs link check","Ensure all markdown links under `docs/` resolve (create missing targets or update broken relative links). Run `composer run docs:check-links` and iterate until it passes."
C01-02,"Make HooksInterface::applyFilters variadic","Update `src/Contracts/HooksInterface.php` so `applyFilters()` accepts variadic args (to match real usage in `src/Intent/Engine.php`) and fix the PHPDoc/signature mismatch. Target: PHPStan no longer reports HookInterface argument/param errors."
C01-03,"Align WPFunctions + test fakes with HooksInterface","Update `src/Infrastructure/WPFunctions.php` `applyFilters()` signature to match `HooksInterface` (keep behavior equivalent). Update any test fakes implementing `HooksInterface` (e.g., `tests/Fakes/FakeWPFunctions.php`) to match. Run `composer run phpstan`."
C01-04,"Fix RateLimiter PHPStan always-true condition","In `src/Infrastructure/RateLimiting/RateLimiter.php`, simplify `checkAndIncrement()`’s `finally` block so PHPStan no longer flags the lock-release condition as always true, while preserving fail-open semantics and always releasing the lock when acquired."
C01-05,"Make PHPStan green","Run `composer run phpstan` and fix remaining errors (keep changes minimal and covered by existing tests). Acceptance: `composer run phpstan` reports 0 errors."
C01-06,"Fix React ESLint for Node scripts","Update `react/eslint.config.js` to treat `react/scripts/**/*.cjs` as Node/CommonJS (node globals enabled; `require()` allowed) or exclude the scripts from lint. Acceptance: `npm --prefix react run lint` passes."
C01-07,"CI parity validation","Run `./scripts/validate.sh` and fix failures until all checks pass (PHPCS errors, PHPUnit, PHPStan, OpenAPI validation, React typecheck/lint/format/test/build)."
C02-01,"Choose authoritative current version","Decide the authoritative plugin version that matches the implemented upgrader steps and shipped functionality (likely >= `0.1.2`). Document the decision and release boundaries in `docs/CHANGELOG.md`."
C02-02,"Align plugin/UI version numbers","Update `agentwp.php` (`Version:` header + `AGENTWP_VERSION`) to the chosen version. Optionally align `react/package.json` `version` if you want a single version across PHP+UI. Acceptance: version strings are consistent and documented."
C02-03,"Reconcile Upgrader steps with versioning","Update `src/Plugin/Upgrader.php` so step versions correspond to real release versions and are coherent with `AGENTWP_VERSION` (steps should only exist for versions > installed and <= current). Add/adjust idempotent steps as needed; keep PHPUnit green."
C02-04,"Finalize CHANGELOG release sections","Move implemented items out of `[Unreleased]` into dated, versioned sections that match the chosen versioning. Ensure docs that reference releases/versions remain accurate (`docs/DEVELOPER.md`, `docs/ARCHITECTURE.md`)."
C02-05,"Fix deprecation messaging + PHPUnit noise","Update `src/Intent/IntentClassifier.php` deprecation text to match the project’s versioning/deprecation policy. Ensure `vendor/bin/phpunit` runs without noisy deprecation output (either by adjusting triggers, tests, or documented expectations)."
C03-01,"Document tools vs functions terminology","Update docs (`docs/DEVELOPER.md`, `docs/EXTENSIONS.md`, `docs/ARCHITECTURE.md`) to clearly define: tool schemas (`src/AI/Functions/*`), tool executors (`src/Intent/Tools/*`), tool dispatch (`ToolDispatcher`), and handler exposure via `getToolNames()`."
C03-02,"Resolve FunctionRegistry vs ToolRegistry strategy","Choose and implement a strategy: Option A keep `src/Intent/FunctionRegistry.php` as legacy suggestions; Option B replace it with a tool-driven suggestion system (e.g., `ToolSuggestionRegistry` or derive suggestions from `ToolRegistry` + handler tool lists). Update docs and tests; keep backward compatibility for extension hooks where possible."
C03-03,"Fix Engine default mapping drift","Audit `src/Intent/Engine.php::register_default_functions()` (e.g., `select_orders`, `bulk_update`) against the actually registered schemas/executors and handler tool lists. Remove or fully implement missing mappings so `function_suggestions` is accurate. Add/adjust tests to prevent regression."
C03-04,"Improve unknown-tool failure handling","Ensure `ToolDispatcher::dispatch()` failures (unknown tool, schema validation errors) produce consistent, user-safe results and are logged via `LoggerInterface`/`AuditLoggerInterface` without leaking secrets. Add unit/integration tests for unknown tool + invalid args."
C04-01,"Bind HooksInterface and WPUserFunctionsInterface in DI","In `src/Providers/CoreServiceProvider.php`, bind `AgentWP\\Contracts\\HooksInterface` and `AgentWP\\Contracts\\WPUserFunctionsInterface` to the `WPFunctions` singleton. Simplify `IntentServiceProvider` to rely on container resolution (remove fallbacks). Validate with PHPStan + PHPUnit."
C04-02,"Document tagging contract","Update `docs/EXTENSIONS.md` to document the tag contracts for `rest.controller` and `intent.handler` (constructor expectations, how container resolves them, how tags are discovered)."
C04-03,"Add agentwp_register_tools extension hook","Add an action hook (e.g., `agentwp_register_tools`) that exposes `ToolRegistryInterface` and `ToolDispatcherInterface` so third parties can register schemas and executors without a full provider. Call it during boot/registration in `IntentServiceProvider`, document it in `docs/EXTENSIONS.md`, and add an integration test proving it works."
C05-01,"Make REST capability configurable","Add `rest.capability` to `src/Config/AgentWPConfig.php` (default `manage_woocommerce`, filter `agentwp_config_rest_capability`) and update `src/Rest/RestController.php::permissions_check()` to use it. Add tests for default + filtered capability."
C05-02,"Audit nonce enforcement for state-changing endpoints","Verify every state-changing route in `src/Rest/*Controller.php` uses `permission_callback => permissions_check` (and thus nonce verification). Add/adjust a smoke test to prevent new endpoints from skipping the nonce requirement."
C05-03,"Add admin-only diagnostics endpoint","Implement a new endpoint (suggested: `GET /agentwp/v1/diagnostics`) returning health status, recent REST log metadata, rate-limit status, key config flags (demo mode/model), and search index state. Ensure admin-only access and canonical response envelope. Update OpenAPI (`docs/openapi.json` + controller `@openapi` annotations), update `docs/API.md`, and add tests."
C05-04,"Strengthen log redaction + tests","Extend `src/Infrastructure/WooCommerceLogger.php` secret redaction (message + nested context) to cover missed patterns/keys. Add unit tests confirming secrets are redacted consistently."
C06-01,"Decide cron vs Action Scheduler (ADR)","Evaluate background jobs (`src/Search/Index.php` backfill; `src/Billing/UsageTracker.php` purge) and decide whether to migrate to Action Scheduler (with fallback) or harden WP-Cron. Write an ADR in `docs/adr/` documenting the decision and compatibility plan."
C06-02,"Implement resilient Search backfill scheduling","Implement the chosen scheduling mechanism for search backfill: idempotent scheduling, safe locking, bounded execution time, and recovery when stuck. Update `docs/search-index.md` and add tests around scheduling/state transitions."
C06-03,"Implement resilient Usage purge scheduling","Implement the chosen scheduling mechanism for usage purge with idempotence, safe multisite behavior, and recovery. Update operational docs (e.g., `docs/OPERATIONAL-KNOBS.md`) and add tests."
C06-04,"Multisite behavior documentation + audit","Document network activation/upgrade/uninstall expectations and audit `uninstall.php` for multisite correctness. Add tests where feasible (e.g., option key lists, helper behavior under mocked multisite)."
C07-01,"Harden ESLint config for scripts/tests environments","Refine `react/eslint.config.js` so scripts and tests use correct environments/globals (Node vs jsdom/browser) without weakening lint for app code. Acceptance: `npm --prefix react run lint` passes."
C07-02,"Consolidate React components structure","Decide whether to keep `react/components` or migrate to `react/src/components`. If migrating: update `react/tsconfig.json` paths and all imports accordingly. Acceptance: `npm --prefix react run typecheck` and `npm --prefix react run build` pass."
C07-03,"Align API client error handling with REST envelope","Update `react/src/api/AgentWPClient.ts` to parse `{success,data,error}` consistently and expose typed errors aligned with backend `ResponseFormatter`. Update hooks/stores to use it. Add unit tests with MSW for success + error envelopes."
C07-04,"Add UI tests for critical flows","Add/expand React Testing Library tests for settings/API key flow, intent submission + response rendering, and error rendering/retry states. Acceptance: `npm --prefix react run test` passes."
C99-01,"Definition of Done validation run","Run and fix until green: `composer run phpcs`, `composer run phpstan`, `vendor/bin/phpunit`, `composer run openapi:validate`, `composer run docs:check-links`, `npm --prefix react run typecheck`, `npm --prefix react run lint`, `npm --prefix react run test`, `npm --prefix react run build`, and `./scripts/validate.sh`."
